var sw=Object.defineProperty;var rw=(t,e,i)=>e in t?sw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var v=(t,e,i)=>rw(t,typeof e!="symbol"?e+"":e,i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function i(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=i(r);fetch(r.href,o)}})();function Qv(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ph={exports:{}},Ee={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var By;function aw(){if(By)return Ee;By=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),c=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),g=Symbol.for("react.memo"),_=Symbol.for("react.lazy"),m=Symbol.iterator;function y(A){return A===null||typeof A!="object"?null:(A=m&&A[m]||A["@@iterator"],typeof A=="function"?A:null)}var T={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},R=Object.assign,x={};function O(A,D,Y){this.props=A,this.context=D,this.refs=x,this.updater=Y||T}O.prototype.isReactComponent={},O.prototype.setState=function(A,D){if(typeof A!="object"&&typeof A!="function"&&A!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,A,D,"setState")},O.prototype.forceUpdate=function(A){this.updater.enqueueForceUpdate(this,A,"forceUpdate")};function N(){}N.prototype=O.prototype;function B(A,D,Y){this.props=A,this.context=D,this.refs=x,this.updater=Y||T}var P=B.prototype=new N;P.constructor=B,R(P,O.prototype),P.isPureReactComponent=!0;var j=Array.isArray,z={H:null,A:null,T:null,S:null},q=Object.prototype.hasOwnProperty;function ue(A,D,Y,K,J,re){return Y=re.ref,{$$typeof:t,type:A,key:D,ref:Y!==void 0?Y:null,props:re}}function oe(A,D){return ue(A.type,D,void 0,void 0,void 0,A.props)}function G(A){return typeof A=="object"&&A!==null&&A.$$typeof===t}function ae(A){var D={"=":"=0",":":"=2"};return"$"+A.replace(/[=:]/g,function(Y){return D[Y]})}var te=/\/+/g;function ge(A,D){return typeof A=="object"&&A!==null&&A.key!=null?ae(""+A.key):D.toString(36)}function ce(){}function _e(A){switch(A.status){case"fulfilled":return A.value;case"rejected":throw A.reason;default:switch(typeof A.status=="string"?A.then(ce,ce):(A.status="pending",A.then(function(D){A.status==="pending"&&(A.status="fulfilled",A.value=D)},function(D){A.status==="pending"&&(A.status="rejected",A.reason=D)})),A.status){case"fulfilled":return A.value;case"rejected":throw A.reason}}throw A}function Pe(A,D,Y,K,J){var re=typeof A;(re==="undefined"||re==="boolean")&&(A=null);var fe=!1;if(A===null)fe=!0;else switch(re){case"bigint":case"string":case"number":fe=!0;break;case"object":switch(A.$$typeof){case t:case e:fe=!0;break;case _:return fe=A._init,Pe(fe(A._payload),D,Y,K,J)}}if(fe)return J=J(A),fe=K===""?"."+ge(A,0):K,j(J)?(Y="",fe!=null&&(Y=fe.replace(te,"$&/")+"/"),Pe(J,D,Y,"",function(xe){return xe})):J!=null&&(G(J)&&(J=oe(J,Y+(J.key==null||A&&A.key===J.key?"":(""+J.key).replace(te,"$&/")+"/")+fe)),D.push(J)),1;fe=0;var le=K===""?".":K+":";if(j(A))for(var he=0;he<A.length;he++)K=A[he],re=le+ge(K,he),fe+=Pe(K,D,Y,re,J);else if(he=y(A),typeof he=="function")for(A=he.call(A),he=0;!(K=A.next()).done;)K=K.value,re=le+ge(K,he++),fe+=Pe(K,D,Y,re,J);else if(re==="object"){if(typeof A.then=="function")return Pe(_e(A),D,Y,K,J);throw D=String(A),Error("Objects are not valid as a React child (found: "+(D==="[object Object]"?"object with keys {"+Object.keys(A).join(", ")+"}":D)+"). If you meant to render a collection of children, use an array instead.")}return fe}function w(A,D,Y){if(A==null)return A;var K=[],J=0;return Pe(A,K,"","",function(re){return D.call(Y,re,J++)}),K}function I(A){if(A._status===-1){var D=A._result;D=D(),D.then(function(Y){(A._status===0||A._status===-1)&&(A._status=1,A._result=Y)},function(Y){(A._status===0||A._status===-1)&&(A._status=2,A._result=Y)}),A._status===-1&&(A._status=0,A._result=D)}if(A._status===1)return A._result.default;throw A._result}var M=typeof reportError=="function"?reportError:function(A){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var D=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof A=="object"&&A!==null&&typeof A.message=="string"?String(A.message):String(A),error:A});if(!window.dispatchEvent(D))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",A);return}console.error(A)};function X(){}return Ee.Children={map:w,forEach:function(A,D,Y){w(A,function(){D.apply(this,arguments)},Y)},count:function(A){var D=0;return w(A,function(){D++}),D},toArray:function(A){return w(A,function(D){return D})||[]},only:function(A){if(!G(A))throw Error("React.Children.only expected to receive a single React element child.");return A}},Ee.Component=O,Ee.Fragment=i,Ee.Profiler=r,Ee.PureComponent=B,Ee.StrictMode=n,Ee.Suspense=h,Ee.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=z,Ee.act=function(){throw Error("act(...) is not supported in production builds of React.")},Ee.cache=function(A){return function(){return A.apply(null,arguments)}},Ee.cloneElement=function(A,D,Y){if(A==null)throw Error("The argument must be a React element, but you passed "+A+".");var K=R({},A.props),J=A.key,re=void 0;if(D!=null)for(fe in D.ref!==void 0&&(re=void 0),D.key!==void 0&&(J=""+D.key),D)!q.call(D,fe)||fe==="key"||fe==="__self"||fe==="__source"||fe==="ref"&&D.ref===void 0||(K[fe]=D[fe]);var fe=arguments.length-2;if(fe===1)K.children=Y;else if(1<fe){for(var le=Array(fe),he=0;he<fe;he++)le[he]=arguments[he+2];K.children=le}return ue(A.type,J,void 0,void 0,re,K)},Ee.createContext=function(A){return A={$$typeof:c,_currentValue:A,_currentValue2:A,_threadCount:0,Provider:null,Consumer:null},A.Provider=A,A.Consumer={$$typeof:o,_context:A},A},Ee.createElement=function(A,D,Y){var K,J={},re=null;if(D!=null)for(K in D.key!==void 0&&(re=""+D.key),D)q.call(D,K)&&K!=="key"&&K!=="__self"&&K!=="__source"&&(J[K]=D[K]);var fe=arguments.length-2;if(fe===1)J.children=Y;else if(1<fe){for(var le=Array(fe),he=0;he<fe;he++)le[he]=arguments[he+2];J.children=le}if(A&&A.defaultProps)for(K in fe=A.defaultProps,fe)J[K]===void 0&&(J[K]=fe[K]);return ue(A,re,void 0,void 0,null,J)},Ee.createRef=function(){return{current:null}},Ee.forwardRef=function(A){return{$$typeof:f,render:A}},Ee.isValidElement=G,Ee.lazy=function(A){return{$$typeof:_,_payload:{_status:-1,_result:A},_init:I}},Ee.memo=function(A,D){return{$$typeof:g,type:A,compare:D===void 0?null:D}},Ee.startTransition=function(A){var D=z.T,Y={};z.T=Y;try{var K=A(),J=z.S;J!==null&&J(Y,K),typeof K=="object"&&K!==null&&typeof K.then=="function"&&K.then(X,M)}catch(re){M(re)}finally{z.T=D}},Ee.unstable_useCacheRefresh=function(){return z.H.useCacheRefresh()},Ee.use=function(A){return z.H.use(A)},Ee.useActionState=function(A,D,Y){return z.H.useActionState(A,D,Y)},Ee.useCallback=function(A,D){return z.H.useCallback(A,D)},Ee.useContext=function(A){return z.H.useContext(A)},Ee.useDebugValue=function(){},Ee.useDeferredValue=function(A,D){return z.H.useDeferredValue(A,D)},Ee.useEffect=function(A,D){return z.H.useEffect(A,D)},Ee.useId=function(){return z.H.useId()},Ee.useImperativeHandle=function(A,D,Y){return z.H.useImperativeHandle(A,D,Y)},Ee.useInsertionEffect=function(A,D){return z.H.useInsertionEffect(A,D)},Ee.useLayoutEffect=function(A,D){return z.H.useLayoutEffect(A,D)},Ee.useMemo=function(A,D){return z.H.useMemo(A,D)},Ee.useOptimistic=function(A,D){return z.H.useOptimistic(A,D)},Ee.useReducer=function(A,D,Y){return z.H.useReducer(A,D,Y)},Ee.useRef=function(A){return z.H.useRef(A)},Ee.useState=function(A){return z.H.useState(A)},Ee.useSyncExternalStore=function(A,D,Y){return z.H.useSyncExternalStore(A,D,Y)},Ee.useTransition=function(){return z.H.useTransition()},Ee.version="19.0.0",Ee}var Uy;function Tg(){return Uy||(Uy=1,Ph.exports=aw()),Ph.exports}var ee=Tg();const ow=Qv(ee);var Nh={exports:{}},ka={},Ih={exports:{}},Dh={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fy;function lw(){return Fy||(Fy=1,function(t){function e(w,I){var M=w.length;w.push(I);e:for(;0<M;){var X=M-1>>>1,A=w[X];if(0<r(A,I))w[X]=I,w[M]=A,M=X;else break e}}function i(w){return w.length===0?null:w[0]}function n(w){if(w.length===0)return null;var I=w[0],M=w.pop();if(M!==I){w[0]=M;e:for(var X=0,A=w.length,D=A>>>1;X<D;){var Y=2*(X+1)-1,K=w[Y],J=Y+1,re=w[J];if(0>r(K,M))J<A&&0>r(re,K)?(w[X]=re,w[J]=M,X=J):(w[X]=K,w[Y]=M,X=Y);else if(J<A&&0>r(re,M))w[X]=re,w[J]=M,X=J;else break e}}return I}function r(w,I){var M=w.sortIndex-I.sortIndex;return M!==0?M:w.id-I.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var c=Date,f=c.now();t.unstable_now=function(){return c.now()-f}}var h=[],g=[],_=1,m=null,y=3,T=!1,R=!1,x=!1,O=typeof setTimeout=="function"?setTimeout:null,N=typeof clearTimeout=="function"?clearTimeout:null,B=typeof setImmediate<"u"?setImmediate:null;function P(w){for(var I=i(g);I!==null;){if(I.callback===null)n(g);else if(I.startTime<=w)n(g),I.sortIndex=I.expirationTime,e(h,I);else break;I=i(g)}}function j(w){if(x=!1,P(w),!R)if(i(h)!==null)R=!0,_e();else{var I=i(g);I!==null&&Pe(j,I.startTime-w)}}var z=!1,q=-1,ue=5,oe=-1;function G(){return!(t.unstable_now()-oe<ue)}function ae(){if(z){var w=t.unstable_now();oe=w;var I=!0;try{e:{R=!1,x&&(x=!1,N(q),q=-1),T=!0;var M=y;try{t:{for(P(w),m=i(h);m!==null&&!(m.expirationTime>w&&G());){var X=m.callback;if(typeof X=="function"){m.callback=null,y=m.priorityLevel;var A=X(m.expirationTime<=w);if(w=t.unstable_now(),typeof A=="function"){m.callback=A,P(w),I=!0;break t}m===i(h)&&n(h),P(w)}else n(h);m=i(h)}if(m!==null)I=!0;else{var D=i(g);D!==null&&Pe(j,D.startTime-w),I=!1}}break e}finally{m=null,y=M,T=!1}I=void 0}}finally{I?te():z=!1}}}var te;if(typeof B=="function")te=function(){B(ae)};else if(typeof MessageChannel<"u"){var ge=new MessageChannel,ce=ge.port2;ge.port1.onmessage=ae,te=function(){ce.postMessage(null)}}else te=function(){O(ae,0)};function _e(){z||(z=!0,te())}function Pe(w,I){q=O(function(){w(t.unstable_now())},I)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(w){w.callback=null},t.unstable_continueExecution=function(){R||T||(R=!0,_e())},t.unstable_forceFrameRate=function(w){0>w||125<w?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ue=0<w?Math.floor(1e3/w):5},t.unstable_getCurrentPriorityLevel=function(){return y},t.unstable_getFirstCallbackNode=function(){return i(h)},t.unstable_next=function(w){switch(y){case 1:case 2:case 3:var I=3;break;default:I=y}var M=y;y=I;try{return w()}finally{y=M}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(w,I){switch(w){case 1:case 2:case 3:case 4:case 5:break;default:w=3}var M=y;y=w;try{return I()}finally{y=M}},t.unstable_scheduleCallback=function(w,I,M){var X=t.unstable_now();switch(typeof M=="object"&&M!==null?(M=M.delay,M=typeof M=="number"&&0<M?X+M:X):M=X,w){case 1:var A=-1;break;case 2:A=250;break;case 5:A=1073741823;break;case 4:A=1e4;break;default:A=5e3}return A=M+A,w={id:_++,callback:I,priorityLevel:w,startTime:M,expirationTime:A,sortIndex:-1},M>X?(w.sortIndex=M,e(g,w),i(h)===null&&w===i(g)&&(x?(N(q),q=-1):x=!0,Pe(j,M-X))):(w.sortIndex=A,e(h,w),R||T||(R=!0,_e())),w},t.unstable_shouldYield=G,t.unstable_wrapCallback=function(w){var I=y;return function(){var M=y;y=I;try{return w.apply(this,arguments)}finally{y=M}}}}(Dh)),Dh}var Ly;function cw(){return Ly||(Ly=1,Ih.exports=lw()),Ih.exports}var kh={exports:{}},Et={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zy;function uw(){if(zy)return Et;zy=1;var t=Tg();function e(h){var g="https://react.dev/errors/"+h;if(1<arguments.length){g+="?args[]="+encodeURIComponent(arguments[1]);for(var _=2;_<arguments.length;_++)g+="&args[]="+encodeURIComponent(arguments[_])}return"Minified React error #"+h+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(){}var n={d:{f:i,r:function(){throw Error(e(522))},D:i,C:i,L:i,m:i,X:i,S:i,M:i},p:0,findDOMNode:null},r=Symbol.for("react.portal");function o(h,g,_){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:m==null?null:""+m,children:h,containerInfo:g,implementation:_}}var c=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function f(h,g){if(h==="font")return"";if(typeof g=="string")return g==="use-credentials"?g:""}return Et.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,Et.createPortal=function(h,g){var _=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!g||g.nodeType!==1&&g.nodeType!==9&&g.nodeType!==11)throw Error(e(299));return o(h,g,null,_)},Et.flushSync=function(h){var g=c.T,_=n.p;try{if(c.T=null,n.p=2,h)return h()}finally{c.T=g,n.p=_,n.d.f()}},Et.preconnect=function(h,g){typeof h=="string"&&(g?(g=g.crossOrigin,g=typeof g=="string"?g==="use-credentials"?g:"":void 0):g=null,n.d.C(h,g))},Et.prefetchDNS=function(h){typeof h=="string"&&n.d.D(h)},Et.preinit=function(h,g){if(typeof h=="string"&&g&&typeof g.as=="string"){var _=g.as,m=f(_,g.crossOrigin),y=typeof g.integrity=="string"?g.integrity:void 0,T=typeof g.fetchPriority=="string"?g.fetchPriority:void 0;_==="style"?n.d.S(h,typeof g.precedence=="string"?g.precedence:void 0,{crossOrigin:m,integrity:y,fetchPriority:T}):_==="script"&&n.d.X(h,{crossOrigin:m,integrity:y,fetchPriority:T,nonce:typeof g.nonce=="string"?g.nonce:void 0})}},Et.preinitModule=function(h,g){if(typeof h=="string")if(typeof g=="object"&&g!==null){if(g.as==null||g.as==="script"){var _=f(g.as,g.crossOrigin);n.d.M(h,{crossOrigin:_,integrity:typeof g.integrity=="string"?g.integrity:void 0,nonce:typeof g.nonce=="string"?g.nonce:void 0})}}else g==null&&n.d.M(h)},Et.preload=function(h,g){if(typeof h=="string"&&typeof g=="object"&&g!==null&&typeof g.as=="string"){var _=g.as,m=f(_,g.crossOrigin);n.d.L(h,_,{crossOrigin:m,integrity:typeof g.integrity=="string"?g.integrity:void 0,nonce:typeof g.nonce=="string"?g.nonce:void 0,type:typeof g.type=="string"?g.type:void 0,fetchPriority:typeof g.fetchPriority=="string"?g.fetchPriority:void 0,referrerPolicy:typeof g.referrerPolicy=="string"?g.referrerPolicy:void 0,imageSrcSet:typeof g.imageSrcSet=="string"?g.imageSrcSet:void 0,imageSizes:typeof g.imageSizes=="string"?g.imageSizes:void 0,media:typeof g.media=="string"?g.media:void 0})}},Et.preloadModule=function(h,g){if(typeof h=="string")if(g){var _=f(g.as,g.crossOrigin);n.d.m(h,{as:typeof g.as=="string"&&g.as!=="script"?g.as:void 0,crossOrigin:_,integrity:typeof g.integrity=="string"?g.integrity:void 0})}else n.d.m(h)},Et.requestFormReset=function(h){n.d.r(h)},Et.unstable_batchedUpdates=function(h,g){return h(g)},Et.useFormState=function(h,g,_){return c.H.useFormState(h,g,_)},Et.useFormStatus=function(){return c.H.useHostTransitionStatus()},Et.version="19.0.0",Et}var Vy;function Gv(){if(Vy)return kh.exports;Vy=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),kh.exports=uw(),kh.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hy;function fw(){if(Hy)return ka;Hy=1;var t=cw(),e=Tg(),i=Gv();function n(s){var a="https://react.dev/errors/"+s;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)a+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+s+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}var o=Symbol.for("react.element"),c=Symbol.for("react.transitional.element"),f=Symbol.for("react.portal"),h=Symbol.for("react.fragment"),g=Symbol.for("react.strict_mode"),_=Symbol.for("react.profiler"),m=Symbol.for("react.provider"),y=Symbol.for("react.consumer"),T=Symbol.for("react.context"),R=Symbol.for("react.forward_ref"),x=Symbol.for("react.suspense"),O=Symbol.for("react.suspense_list"),N=Symbol.for("react.memo"),B=Symbol.for("react.lazy"),P=Symbol.for("react.offscreen"),j=Symbol.for("react.memo_cache_sentinel"),z=Symbol.iterator;function q(s){return s===null||typeof s!="object"?null:(s=z&&s[z]||s["@@iterator"],typeof s=="function"?s:null)}var ue=Symbol.for("react.client.reference");function oe(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===ue?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case h:return"Fragment";case f:return"Portal";case _:return"Profiler";case g:return"StrictMode";case x:return"Suspense";case O:return"SuspenseList"}if(typeof s=="object")switch(s.$$typeof){case T:return(s.displayName||"Context")+".Provider";case y:return(s._context.displayName||"Context")+".Consumer";case R:var a=s.render;return s=s.displayName,s||(s=a.displayName||a.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case N:return a=s.displayName||null,a!==null?a:oe(s.type)||"Memo";case B:a=s._payload,s=s._init;try{return oe(s(a))}catch{}}return null}var G=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ae=Object.assign,te,ge;function ce(s){if(te===void 0)try{throw Error()}catch(l){var a=l.stack.trim().match(/\n( *(at )?)/);te=a&&a[1]||"",ge=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+te+s+ge}var _e=!1;function Pe(s,a){if(!s||_e)return"";_e=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var u={DetermineComponentFrameRoot:function(){try{if(a){var ne=function(){throw Error()};if(Object.defineProperty(ne.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ne,[])}catch(Z){var $=Z}Reflect.construct(s,[],ne)}else{try{ne.call()}catch(Z){$=Z}s.call(ne.prototype)}}else{try{throw Error()}catch(Z){$=Z}(ne=s())&&typeof ne.catch=="function"&&ne.catch(function(){})}}catch(Z){if(Z&&$&&typeof Z.stack=="string")return[Z.stack,$.stack]}return[null,null]}};u.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var d=Object.getOwnPropertyDescriptor(u.DetermineComponentFrameRoot,"name");d&&d.configurable&&Object.defineProperty(u.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var p=u.DetermineComponentFrameRoot(),b=p[0],S=p[1];if(b&&S){var C=b.split(`
`),U=S.split(`
`);for(d=u=0;u<C.length&&!C[u].includes("DetermineComponentFrameRoot");)u++;for(;d<U.length&&!U[d].includes("DetermineComponentFrameRoot");)d++;if(u===C.length||d===U.length)for(u=C.length-1,d=U.length-1;1<=u&&0<=d&&C[u]!==U[d];)d--;for(;1<=u&&0<=d;u--,d--)if(C[u]!==U[d]){if(u!==1||d!==1)do if(u--,d--,0>d||C[u]!==U[d]){var Q=`
`+C[u].replace(" at new "," at ");return s.displayName&&Q.includes("<anonymous>")&&(Q=Q.replace("<anonymous>",s.displayName)),Q}while(1<=u&&0<=d);break}}}finally{_e=!1,Error.prepareStackTrace=l}return(l=s?s.displayName||s.name:"")?ce(l):""}function w(s){switch(s.tag){case 26:case 27:case 5:return ce(s.type);case 16:return ce("Lazy");case 13:return ce("Suspense");case 19:return ce("SuspenseList");case 0:case 15:return s=Pe(s.type,!1),s;case 11:return s=Pe(s.type.render,!1),s;case 1:return s=Pe(s.type,!0),s;default:return""}}function I(s){try{var a="";do a+=w(s),s=s.return;while(s);return a}catch(l){return`
Error generating stack: `+l.message+`
`+l.stack}}function M(s){var a=s,l=s;if(s.alternate)for(;a.return;)a=a.return;else{s=a;do a=s,a.flags&4098&&(l=a.return),s=a.return;while(s)}return a.tag===3?l:null}function X(s){if(s.tag===13){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function A(s){if(M(s)!==s)throw Error(n(188))}function D(s){var a=s.alternate;if(!a){if(a=M(s),a===null)throw Error(n(188));return a!==s?null:s}for(var l=s,u=a;;){var d=l.return;if(d===null)break;var p=d.alternate;if(p===null){if(u=d.return,u!==null){l=u;continue}break}if(d.child===p.child){for(p=d.child;p;){if(p===l)return A(d),s;if(p===u)return A(d),a;p=p.sibling}throw Error(n(188))}if(l.return!==u.return)l=d,u=p;else{for(var b=!1,S=d.child;S;){if(S===l){b=!0,l=d,u=p;break}if(S===u){b=!0,u=d,l=p;break}S=S.sibling}if(!b){for(S=p.child;S;){if(S===l){b=!0,l=p,u=d;break}if(S===u){b=!0,u=p,l=d;break}S=S.sibling}if(!b)throw Error(n(189))}}if(l.alternate!==u)throw Error(n(190))}if(l.tag!==3)throw Error(n(188));return l.stateNode.current===l?s:a}function Y(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s;for(s=s.child;s!==null;){if(a=Y(s),a!==null)return a;s=s.sibling}return null}var K=Array.isArray,J=i.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,re={pending:!1,data:null,method:null,action:null},fe=[],le=-1;function he(s){return{current:s}}function xe(s){0>le||(s.current=fe[le],fe[le]=null,le--)}function ye(s,a){le++,fe[le]=s.current,s.current=a}var Tt=he(null),ii=he(null),ni=he(null),Un=he(null);function Ne(s,a){switch(ye(ni,a),ye(ii,s),ye(Tt,null),s=a.nodeType,s){case 9:case 11:a=(a=a.documentElement)&&(a=a.namespaceURI)?fy(a):0;break;default:if(s=s===8?a.parentNode:a,a=s.tagName,s=s.namespaceURI)s=fy(s),a=hy(s,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}xe(Tt),ye(Tt,a)}function Ce(){xe(Tt),xe(ii),xe(ni)}function Tu(s){s.memoizedState!==null&&ye(Un,s);var a=Tt.current,l=hy(a,s.type);a!==l&&(ye(ii,s),ye(Tt,l))}function To(s){ii.current===s&&(xe(Tt),xe(ii)),Un.current===s&&(xe(Un),Oa._currentValue=re)}var Su=Object.prototype.hasOwnProperty,Au=t.unstable_scheduleCallback,Eu=t.unstable_cancelCallback,BA=t.unstable_shouldYield,UA=t.unstable_requestPaint,pi=t.unstable_now,FA=t.unstable_getCurrentPriorityLevel,ep=t.unstable_ImmediatePriority,tp=t.unstable_UserBlockingPriority,So=t.unstable_NormalPriority,LA=t.unstable_LowPriority,ip=t.unstable_IdlePriority,zA=t.log,VA=t.unstable_setDisableYieldValue,Lr=null,It=null;function HA(s){if(It&&typeof It.onCommitFiberRoot=="function")try{It.onCommitFiberRoot(Lr,s,void 0,(s.current.flags&128)===128)}catch{}}function Ji(s){if(typeof zA=="function"&&VA(s),It&&typeof It.setStrictMode=="function")try{It.setStrictMode(Lr,s)}catch{}}var Dt=Math.clz32?Math.clz32:XA,jA=Math.log,WA=Math.LN2;function XA(s){return s>>>=0,s===0?32:31-(jA(s)/WA|0)|0}var Ao=128,Eo=4194304;function Fn(s){var a=s&42;if(a!==0)return a;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function wo(s,a){var l=s.pendingLanes;if(l===0)return 0;var u=0,d=s.suspendedLanes,p=s.pingedLanes,b=s.warmLanes;s=s.finishedLanes!==0;var S=l&134217727;return S!==0?(l=S&~d,l!==0?u=Fn(l):(p&=S,p!==0?u=Fn(p):s||(b=S&~b,b!==0&&(u=Fn(b))))):(S=l&~d,S!==0?u=Fn(S):p!==0?u=Fn(p):s||(b=l&~b,b!==0&&(u=Fn(b)))),u===0?0:a!==0&&a!==u&&!(a&d)&&(d=u&-u,b=a&-a,d>=b||d===32&&(b&4194176)!==0)?a:u}function zr(s,a){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&a)===0}function $A(s,a){switch(s){case 1:case 2:case 4:case 8:return a+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function np(){var s=Ao;return Ao<<=1,!(Ao&4194176)&&(Ao=128),s}function sp(){var s=Eo;return Eo<<=1,!(Eo&62914560)&&(Eo=4194304),s}function wu(s){for(var a=[],l=0;31>l;l++)a.push(s);return a}function Vr(s,a){s.pendingLanes|=a,a!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function YA(s,a,l,u,d,p){var b=s.pendingLanes;s.pendingLanes=l,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=l,s.entangledLanes&=l,s.errorRecoveryDisabledLanes&=l,s.shellSuspendCounter=0;var S=s.entanglements,C=s.expirationTimes,U=s.hiddenUpdates;for(l=b&~l;0<l;){var Q=31-Dt(l),ne=1<<Q;S[Q]=0,C[Q]=-1;var $=U[Q];if($!==null)for(U[Q]=null,Q=0;Q<$.length;Q++){var Z=$[Q];Z!==null&&(Z.lane&=-536870913)}l&=~ne}u!==0&&rp(s,u,0),p!==0&&d===0&&s.tag!==0&&(s.suspendedLanes|=p&~(b&~a))}function rp(s,a,l){s.pendingLanes|=a,s.suspendedLanes&=~a;var u=31-Dt(a);s.entangledLanes|=a,s.entanglements[u]=s.entanglements[u]|1073741824|l&4194218}function ap(s,a){var l=s.entangledLanes|=a;for(s=s.entanglements;l;){var u=31-Dt(l),d=1<<u;d&a|s[u]&a&&(s[u]|=a),l&=~d}}function op(s){return s&=-s,2<s?8<s?s&134217727?32:268435456:8:2}function lp(){var s=J.p;return s!==0?s:(s=window.event,s===void 0?32:Oy(s.type))}function qA(s,a){var l=J.p;try{return J.p=s,a()}finally{J.p=l}}var en=Math.random().toString(36).slice(2),St="__reactFiber$"+en,Mt="__reactProps$"+en,Rs="__reactContainer$"+en,Ru="__reactEvents$"+en,KA="__reactListeners$"+en,ZA="__reactHandles$"+en,cp="__reactResources$"+en,Hr="__reactMarker$"+en;function xu(s){delete s[St],delete s[Mt],delete s[Ru],delete s[KA],delete s[ZA]}function Ln(s){var a=s[St];if(a)return a;for(var l=s.parentNode;l;){if(a=l[Rs]||l[St]){if(l=a.alternate,a.child!==null||l!==null&&l.child!==null)for(s=py(s);s!==null;){if(l=s[St])return l;s=py(s)}return a}s=l,l=s.parentNode}return null}function xs(s){if(s=s[St]||s[Rs]){var a=s.tag;if(a===5||a===6||a===13||a===26||a===27||a===3)return s}return null}function jr(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s.stateNode;throw Error(n(33))}function Cs(s){var a=s[cp];return a||(a=s[cp]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function ut(s){s[Hr]=!0}var up=new Set,fp={};function zn(s,a){Ms(s,a),Ms(s+"Capture",a)}function Ms(s,a){for(fp[s]=a,s=0;s<a.length;s++)up.add(a[s])}var Pi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),QA=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),hp={},dp={};function GA(s){return Su.call(dp,s)?!0:Su.call(hp,s)?!1:QA.test(s)?dp[s]=!0:(hp[s]=!0,!1)}function Ro(s,a,l){if(GA(a))if(l===null)s.removeAttribute(a);else{switch(typeof l){case"undefined":case"function":case"symbol":s.removeAttribute(a);return;case"boolean":var u=a.toLowerCase().slice(0,5);if(u!=="data-"&&u!=="aria-"){s.removeAttribute(a);return}}s.setAttribute(a,""+l)}}function xo(s,a,l){if(l===null)s.removeAttribute(a);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(a);return}s.setAttribute(a,""+l)}}function Ni(s,a,l,u){if(u===null)s.removeAttribute(l);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(l);return}s.setAttributeNS(a,l,""+u)}}function Ht(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function gp(s){var a=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function JA(s){var a=gp(s)?"checked":"value",l=Object.getOwnPropertyDescriptor(s.constructor.prototype,a),u=""+s[a];if(!s.hasOwnProperty(a)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var d=l.get,p=l.set;return Object.defineProperty(s,a,{configurable:!0,get:function(){return d.call(this)},set:function(b){u=""+b,p.call(this,b)}}),Object.defineProperty(s,a,{enumerable:l.enumerable}),{getValue:function(){return u},setValue:function(b){u=""+b},stopTracking:function(){s._valueTracker=null,delete s[a]}}}}function Co(s){s._valueTracker||(s._valueTracker=JA(s))}function pp(s){if(!s)return!1;var a=s._valueTracker;if(!a)return!0;var l=a.getValue(),u="";return s&&(u=gp(s)?s.checked?"true":"false":s.value),s=u,s!==l?(a.setValue(s),!0):!1}function Mo(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var eE=/[\n"\\]/g;function jt(s){return s.replace(eE,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function Cu(s,a,l,u,d,p,b,S){s.name="",b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"?s.type=b:s.removeAttribute("type"),a!=null?b==="number"?(a===0&&s.value===""||s.value!=a)&&(s.value=""+Ht(a)):s.value!==""+Ht(a)&&(s.value=""+Ht(a)):b!=="submit"&&b!=="reset"||s.removeAttribute("value"),a!=null?Mu(s,b,Ht(a)):l!=null?Mu(s,b,Ht(l)):u!=null&&s.removeAttribute("value"),d==null&&p!=null&&(s.defaultChecked=!!p),d!=null&&(s.checked=d&&typeof d!="function"&&typeof d!="symbol"),S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"?s.name=""+Ht(S):s.removeAttribute("name")}function _p(s,a,l,u,d,p,b,S){if(p!=null&&typeof p!="function"&&typeof p!="symbol"&&typeof p!="boolean"&&(s.type=p),a!=null||l!=null){if(!(p!=="submit"&&p!=="reset"||a!=null))return;l=l!=null?""+Ht(l):"",a=a!=null?""+Ht(a):l,S||a===s.value||(s.value=a),s.defaultValue=a}u=u??d,u=typeof u!="function"&&typeof u!="symbol"&&!!u,s.checked=S?s.checked:!!u,s.defaultChecked=!!u,b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(s.name=b)}function Mu(s,a,l){a==="number"&&Mo(s.ownerDocument)===s||s.defaultValue===""+l||(s.defaultValue=""+l)}function Os(s,a,l,u){if(s=s.options,a){a={};for(var d=0;d<l.length;d++)a["$"+l[d]]=!0;for(l=0;l<s.length;l++)d=a.hasOwnProperty("$"+s[l].value),s[l].selected!==d&&(s[l].selected=d),d&&u&&(s[l].defaultSelected=!0)}else{for(l=""+Ht(l),a=null,d=0;d<s.length;d++){if(s[d].value===l){s[d].selected=!0,u&&(s[d].defaultSelected=!0);return}a!==null||s[d].disabled||(a=s[d])}a!==null&&(a.selected=!0)}}function mp(s,a,l){if(a!=null&&(a=""+Ht(a),a!==s.value&&(s.value=a),l==null)){s.defaultValue!==a&&(s.defaultValue=a);return}s.defaultValue=l!=null?""+Ht(l):""}function yp(s,a,l,u){if(a==null){if(u!=null){if(l!=null)throw Error(n(92));if(K(u)){if(1<u.length)throw Error(n(93));u=u[0]}l=u}l==null&&(l=""),a=l}l=Ht(a),s.defaultValue=l,u=s.textContent,u===l&&u!==""&&u!==null&&(s.value=u)}function Ps(s,a){if(a){var l=s.firstChild;if(l&&l===s.lastChild&&l.nodeType===3){l.nodeValue=a;return}}s.textContent=a}var tE=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function bp(s,a,l){var u=a.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?u?s.setProperty(a,""):a==="float"?s.cssFloat="":s[a]="":u?s.setProperty(a,l):typeof l!="number"||l===0||tE.has(a)?a==="float"?s.cssFloat=l:s[a]=(""+l).trim():s[a]=l+"px"}function vp(s,a,l){if(a!=null&&typeof a!="object")throw Error(n(62));if(s=s.style,l!=null){for(var u in l)!l.hasOwnProperty(u)||a!=null&&a.hasOwnProperty(u)||(u.indexOf("--")===0?s.setProperty(u,""):u==="float"?s.cssFloat="":s[u]="");for(var d in a)u=a[d],a.hasOwnProperty(d)&&l[d]!==u&&bp(s,d,u)}else for(var p in a)a.hasOwnProperty(p)&&bp(s,p,a[p])}function Ou(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var iE=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),nE=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Oo(s){return nE.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}var Pu=null;function Nu(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Ns=null,Is=null;function Tp(s){var a=xs(s);if(a&&(s=a.stateNode)){var l=s[Mt]||null;e:switch(s=a.stateNode,a.type){case"input":if(Cu(s,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),a=l.name,l.type==="radio"&&a!=null){for(l=s;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+jt(""+a)+'"][type="radio"]'),a=0;a<l.length;a++){var u=l[a];if(u!==s&&u.form===s.form){var d=u[Mt]||null;if(!d)throw Error(n(90));Cu(u,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name)}}for(a=0;a<l.length;a++)u=l[a],u.form===s.form&&pp(u)}break e;case"textarea":mp(s,l.value,l.defaultValue);break e;case"select":a=l.value,a!=null&&Os(s,!!l.multiple,a,!1)}}}var Iu=!1;function Sp(s,a,l){if(Iu)return s(a,l);Iu=!0;try{var u=s(a);return u}finally{if(Iu=!1,(Ns!==null||Is!==null)&&(dl(),Ns&&(a=Ns,s=Is,Is=Ns=null,Tp(a),s)))for(a=0;a<s.length;a++)Tp(s[a])}}function Wr(s,a){var l=s.stateNode;if(l===null)return null;var u=l[Mt]||null;if(u===null)return null;l=u[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(u=!u.disabled)||(s=s.type,u=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!u;break e;default:s=!1}if(s)return null;if(l&&typeof l!="function")throw Error(n(231,a,typeof l));return l}var Du=!1;if(Pi)try{var Xr={};Object.defineProperty(Xr,"passive",{get:function(){Du=!0}}),window.addEventListener("test",Xr,Xr),window.removeEventListener("test",Xr,Xr)}catch{Du=!1}var tn=null,ku=null,Po=null;function Ap(){if(Po)return Po;var s,a=ku,l=a.length,u,d="value"in tn?tn.value:tn.textContent,p=d.length;for(s=0;s<l&&a[s]===d[s];s++);var b=l-s;for(u=1;u<=b&&a[l-u]===d[p-u];u++);return Po=d.slice(s,1<u?1-u:void 0)}function No(s){var a=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&a===13&&(s=13)):s=a,s===10&&(s=13),32<=s||s===13?s:0}function Io(){return!0}function Ep(){return!1}function Ot(s){function a(l,u,d,p,b){this._reactName=l,this._targetInst=d,this.type=u,this.nativeEvent=p,this.target=b,this.currentTarget=null;for(var S in s)s.hasOwnProperty(S)&&(l=s[S],this[S]=l?l(p):p[S]);return this.isDefaultPrevented=(p.defaultPrevented!=null?p.defaultPrevented:p.returnValue===!1)?Io:Ep,this.isPropagationStopped=Ep,this}return ae(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=Io)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=Io)},persist:function(){},isPersistent:Io}),a}var Vn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Do=Ot(Vn),$r=ae({},Vn,{view:0,detail:0}),sE=Ot($r),Bu,Uu,Yr,ko=ae({},$r,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Lu,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Yr&&(Yr&&s.type==="mousemove"?(Bu=s.screenX-Yr.screenX,Uu=s.screenY-Yr.screenY):Uu=Bu=0,Yr=s),Bu)},movementY:function(s){return"movementY"in s?s.movementY:Uu}}),wp=Ot(ko),rE=ae({},ko,{dataTransfer:0}),aE=Ot(rE),oE=ae({},$r,{relatedTarget:0}),Fu=Ot(oE),lE=ae({},Vn,{animationName:0,elapsedTime:0,pseudoElement:0}),cE=Ot(lE),uE=ae({},Vn,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),fE=Ot(uE),hE=ae({},Vn,{data:0}),Rp=Ot(hE),dE={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},gE={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},pE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function _E(s){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(s):(s=pE[s])?!!a[s]:!1}function Lu(){return _E}var mE=ae({},$r,{key:function(s){if(s.key){var a=dE[s.key]||s.key;if(a!=="Unidentified")return a}return s.type==="keypress"?(s=No(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?gE[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Lu,charCode:function(s){return s.type==="keypress"?No(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?No(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),yE=Ot(mE),bE=ae({},ko,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),xp=Ot(bE),vE=ae({},$r,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Lu}),TE=Ot(vE),SE=ae({},Vn,{propertyName:0,elapsedTime:0,pseudoElement:0}),AE=Ot(SE),EE=ae({},ko,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),wE=Ot(EE),RE=ae({},Vn,{newState:0,oldState:0}),xE=Ot(RE),CE=[9,13,27,32],zu=Pi&&"CompositionEvent"in window,qr=null;Pi&&"documentMode"in document&&(qr=document.documentMode);var ME=Pi&&"TextEvent"in window&&!qr,Cp=Pi&&(!zu||qr&&8<qr&&11>=qr),Mp=" ",Op=!1;function Pp(s,a){switch(s){case"keyup":return CE.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Np(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var Ds=!1;function OE(s,a){switch(s){case"compositionend":return Np(a);case"keypress":return a.which!==32?null:(Op=!0,Mp);case"textInput":return s=a.data,s===Mp&&Op?null:s;default:return null}}function PE(s,a){if(Ds)return s==="compositionend"||!zu&&Pp(s,a)?(s=Ap(),Po=ku=tn=null,Ds=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Cp&&a.locale!=="ko"?null:a.data;default:return null}}var NE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ip(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a==="input"?!!NE[s.type]:a==="textarea"}function Dp(s,a,l,u){Ns?Is?Is.push(u):Is=[u]:Ns=u,a=yl(a,"onChange"),0<a.length&&(l=new Do("onChange","change",null,l,u),s.push({event:l,listeners:a}))}var Kr=null,Zr=null;function IE(s){ay(s,0)}function Bo(s){var a=jr(s);if(pp(a))return s}function kp(s,a){if(s==="change")return a}var Bp=!1;if(Pi){var Vu;if(Pi){var Hu="oninput"in document;if(!Hu){var Up=document.createElement("div");Up.setAttribute("oninput","return;"),Hu=typeof Up.oninput=="function"}Vu=Hu}else Vu=!1;Bp=Vu&&(!document.documentMode||9<document.documentMode)}function Fp(){Kr&&(Kr.detachEvent("onpropertychange",Lp),Zr=Kr=null)}function Lp(s){if(s.propertyName==="value"&&Bo(Zr)){var a=[];Dp(a,Zr,s,Nu(s)),Sp(IE,a)}}function DE(s,a,l){s==="focusin"?(Fp(),Kr=a,Zr=l,Kr.attachEvent("onpropertychange",Lp)):s==="focusout"&&Fp()}function kE(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return Bo(Zr)}function BE(s,a){if(s==="click")return Bo(a)}function UE(s,a){if(s==="input"||s==="change")return Bo(a)}function FE(s,a){return s===a&&(s!==0||1/s===1/a)||s!==s&&a!==a}var kt=typeof Object.is=="function"?Object.is:FE;function Qr(s,a){if(kt(s,a))return!0;if(typeof s!="object"||s===null||typeof a!="object"||a===null)return!1;var l=Object.keys(s),u=Object.keys(a);if(l.length!==u.length)return!1;for(u=0;u<l.length;u++){var d=l[u];if(!Su.call(a,d)||!kt(s[d],a[d]))return!1}return!0}function zp(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function Vp(s,a){var l=zp(s);s=0;for(var u;l;){if(l.nodeType===3){if(u=s+l.textContent.length,s<=a&&u>=a)return{node:l,offset:a-s};s=u}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=zp(l)}}function Hp(s,a){return s&&a?s===a?!0:s&&s.nodeType===3?!1:a&&a.nodeType===3?Hp(s,a.parentNode):"contains"in s?s.contains(a):s.compareDocumentPosition?!!(s.compareDocumentPosition(a)&16):!1:!1}function jp(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var a=Mo(s.document);a instanceof s.HTMLIFrameElement;){try{var l=typeof a.contentWindow.location.href=="string"}catch{l=!1}if(l)s=a.contentWindow;else break;a=Mo(s.document)}return a}function ju(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a&&(a==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||a==="textarea"||s.contentEditable==="true")}function LE(s,a){var l=jp(a);a=s.focusedElem;var u=s.selectionRange;if(l!==a&&a&&a.ownerDocument&&Hp(a.ownerDocument.documentElement,a)){if(u!==null&&ju(a)){if(s=u.start,l=u.end,l===void 0&&(l=s),"selectionStart"in a)a.selectionStart=s,a.selectionEnd=Math.min(l,a.value.length);else if(l=(s=a.ownerDocument||document)&&s.defaultView||window,l.getSelection){l=l.getSelection();var d=a.textContent.length,p=Math.min(u.start,d);u=u.end===void 0?p:Math.min(u.end,d),!l.extend&&p>u&&(d=u,u=p,p=d),d=Vp(a,p);var b=Vp(a,u);d&&b&&(l.rangeCount!==1||l.anchorNode!==d.node||l.anchorOffset!==d.offset||l.focusNode!==b.node||l.focusOffset!==b.offset)&&(s=s.createRange(),s.setStart(d.node,d.offset),l.removeAllRanges(),p>u?(l.addRange(s),l.extend(b.node,b.offset)):(s.setEnd(b.node,b.offset),l.addRange(s)))}}for(s=[],l=a;l=l.parentNode;)l.nodeType===1&&s.push({element:l,left:l.scrollLeft,top:l.scrollTop});for(typeof a.focus=="function"&&a.focus(),a=0;a<s.length;a++)l=s[a],l.element.scrollLeft=l.left,l.element.scrollTop=l.top}}var zE=Pi&&"documentMode"in document&&11>=document.documentMode,ks=null,Wu=null,Gr=null,Xu=!1;function Wp(s,a,l){var u=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;Xu||ks==null||ks!==Mo(u)||(u=ks,"selectionStart"in u&&ju(u)?u={start:u.selectionStart,end:u.selectionEnd}:(u=(u.ownerDocument&&u.ownerDocument.defaultView||window).getSelection(),u={anchorNode:u.anchorNode,anchorOffset:u.anchorOffset,focusNode:u.focusNode,focusOffset:u.focusOffset}),Gr&&Qr(Gr,u)||(Gr=u,u=yl(Wu,"onSelect"),0<u.length&&(a=new Do("onSelect","select",null,a,l),s.push({event:a,listeners:u}),a.target=ks)))}function Hn(s,a){var l={};return l[s.toLowerCase()]=a.toLowerCase(),l["Webkit"+s]="webkit"+a,l["Moz"+s]="moz"+a,l}var Bs={animationend:Hn("Animation","AnimationEnd"),animationiteration:Hn("Animation","AnimationIteration"),animationstart:Hn("Animation","AnimationStart"),transitionrun:Hn("Transition","TransitionRun"),transitionstart:Hn("Transition","TransitionStart"),transitioncancel:Hn("Transition","TransitionCancel"),transitionend:Hn("Transition","TransitionEnd")},$u={},Xp={};Pi&&(Xp=document.createElement("div").style,"AnimationEvent"in window||(delete Bs.animationend.animation,delete Bs.animationiteration.animation,delete Bs.animationstart.animation),"TransitionEvent"in window||delete Bs.transitionend.transition);function jn(s){if($u[s])return $u[s];if(!Bs[s])return s;var a=Bs[s],l;for(l in a)if(a.hasOwnProperty(l)&&l in Xp)return $u[s]=a[l];return s}var $p=jn("animationend"),Yp=jn("animationiteration"),qp=jn("animationstart"),VE=jn("transitionrun"),HE=jn("transitionstart"),jE=jn("transitioncancel"),Kp=jn("transitionend"),Zp=new Map,Qp="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function si(s,a){Zp.set(s,a),zn(a,[s])}var Wt=[],Us=0,Yu=0;function Uo(){for(var s=Us,a=Yu=Us=0;a<s;){var l=Wt[a];Wt[a++]=null;var u=Wt[a];Wt[a++]=null;var d=Wt[a];Wt[a++]=null;var p=Wt[a];if(Wt[a++]=null,u!==null&&d!==null){var b=u.pending;b===null?d.next=d:(d.next=b.next,b.next=d),u.pending=d}p!==0&&Gp(l,d,p)}}function Fo(s,a,l,u){Wt[Us++]=s,Wt[Us++]=a,Wt[Us++]=l,Wt[Us++]=u,Yu|=u,s.lanes|=u,s=s.alternate,s!==null&&(s.lanes|=u)}function qu(s,a,l,u){return Fo(s,a,l,u),Lo(s)}function nn(s,a){return Fo(s,null,null,a),Lo(s)}function Gp(s,a,l){s.lanes|=l;var u=s.alternate;u!==null&&(u.lanes|=l);for(var d=!1,p=s.return;p!==null;)p.childLanes|=l,u=p.alternate,u!==null&&(u.childLanes|=l),p.tag===22&&(s=p.stateNode,s===null||s._visibility&1||(d=!0)),s=p,p=p.return;d&&a!==null&&s.tag===3&&(p=s.stateNode,d=31-Dt(l),p=p.hiddenUpdates,s=p[d],s===null?p[d]=[a]:s.push(a),a.lane=l|536870912)}function Lo(s){if(50<Aa)throw Aa=0,th=null,Error(n(185));for(var a=s.return;a!==null;)s=a,a=s.return;return s.tag===3?s.stateNode:null}var Fs={},Jp=new WeakMap;function Xt(s,a){if(typeof s=="object"&&s!==null){var l=Jp.get(s);return l!==void 0?l:(a={value:s,source:a,stack:I(a)},Jp.set(s,a),a)}return{value:s,source:a,stack:I(a)}}var Ls=[],zs=0,zo=null,Vo=0,$t=[],Yt=0,Wn=null,Ii=1,Di="";function Xn(s,a){Ls[zs++]=Vo,Ls[zs++]=zo,zo=s,Vo=a}function e_(s,a,l){$t[Yt++]=Ii,$t[Yt++]=Di,$t[Yt++]=Wn,Wn=s;var u=Ii;s=Di;var d=32-Dt(u)-1;u&=~(1<<d),l+=1;var p=32-Dt(a)+d;if(30<p){var b=d-d%5;p=(u&(1<<b)-1).toString(32),u>>=b,d-=b,Ii=1<<32-Dt(a)+d|l<<d|u,Di=p+s}else Ii=1<<p|l<<d|u,Di=s}function Ku(s){s.return!==null&&(Xn(s,1),e_(s,1,0))}function Zu(s){for(;s===zo;)zo=Ls[--zs],Ls[zs]=null,Vo=Ls[--zs],Ls[zs]=null;for(;s===Wn;)Wn=$t[--Yt],$t[Yt]=null,Di=$t[--Yt],$t[Yt]=null,Ii=$t[--Yt],$t[Yt]=null}var xt=null,pt=null,ke=!1,ri=null,_i=!1,Qu=Error(n(519));function $n(s){var a=Error(n(418,""));throw ta(Xt(a,s)),Qu}function t_(s){var a=s.stateNode,l=s.type,u=s.memoizedProps;switch(a[St]=s,a[Mt]=u,l){case"dialog":Ie("cancel",a),Ie("close",a);break;case"iframe":case"object":case"embed":Ie("load",a);break;case"video":case"audio":for(l=0;l<wa.length;l++)Ie(wa[l],a);break;case"source":Ie("error",a);break;case"img":case"image":case"link":Ie("error",a),Ie("load",a);break;case"details":Ie("toggle",a);break;case"input":Ie("invalid",a),_p(a,u.value,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name,!0),Co(a);break;case"select":Ie("invalid",a);break;case"textarea":Ie("invalid",a),yp(a,u.value,u.defaultValue,u.children),Co(a)}l=u.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||a.textContent===""+l||u.suppressHydrationWarning===!0||uy(a.textContent,l)?(u.popover!=null&&(Ie("beforetoggle",a),Ie("toggle",a)),u.onScroll!=null&&Ie("scroll",a),u.onScrollEnd!=null&&Ie("scrollend",a),u.onClick!=null&&(a.onclick=bl),a=!0):a=!1,a||$n(s)}function i_(s){for(xt=s.return;xt;)switch(xt.tag){case 3:case 27:_i=!0;return;case 5:case 13:_i=!1;return;default:xt=xt.return}}function Jr(s){if(s!==xt)return!1;if(!ke)return i_(s),ke=!0,!1;var a=!1,l;if((l=s.tag!==3&&s.tag!==27)&&((l=s.tag===5)&&(l=s.type,l=!(l!=="form"&&l!=="button")||yh(s.type,s.memoizedProps)),l=!l),l&&(a=!0),a&&pt&&$n(s),i_(s),s.tag===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(n(317));e:{for(s=s.nextSibling,a=0;s;){if(s.nodeType===8)if(l=s.data,l==="/$"){if(a===0){pt=oi(s.nextSibling);break e}a--}else l!=="$"&&l!=="$!"&&l!=="$?"||a++;s=s.nextSibling}pt=null}}else pt=xt?oi(s.stateNode.nextSibling):null;return!0}function ea(){pt=xt=null,ke=!1}function ta(s){ri===null?ri=[s]:ri.push(s)}var ia=Error(n(460)),n_=Error(n(474)),Gu={then:function(){}};function s_(s){return s=s.status,s==="fulfilled"||s==="rejected"}function Ho(){}function r_(s,a,l){switch(l=s[l],l===void 0?s.push(a):l!==a&&(a.then(Ho,Ho),a=l),a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,s===ia?Error(n(483)):s;default:if(typeof a.status=="string")a.then(Ho,Ho);else{if(s=We,s!==null&&100<s.shellSuspendCounter)throw Error(n(482));s=a,s.status="pending",s.then(function(u){if(a.status==="pending"){var d=a;d.status="fulfilled",d.value=u}},function(u){if(a.status==="pending"){var d=a;d.status="rejected",d.reason=u}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,s===ia?Error(n(483)):s}throw na=a,ia}}var na=null;function a_(){if(na===null)throw Error(n(459));var s=na;return na=null,s}var Vs=null,sa=0;function jo(s){var a=sa;return sa+=1,Vs===null&&(Vs=[]),r_(Vs,s,a)}function ra(s,a){a=a.props.ref,s.ref=a!==void 0?a:null}function Wo(s,a){throw a.$$typeof===o?Error(n(525)):(s=Object.prototype.toString.call(a),Error(n(31,s==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":s)))}function o_(s){var a=s._init;return a(s._payload)}function l_(s){function a(V,k){if(s){var W=V.deletions;W===null?(V.deletions=[k],V.flags|=16):W.push(k)}}function l(V,k){if(!s)return null;for(;k!==null;)a(V,k),k=k.sibling;return null}function u(V){for(var k=new Map;V!==null;)V.key!==null?k.set(V.key,V):k.set(V.index,V),V=V.sibling;return k}function d(V,k){return V=pn(V,k),V.index=0,V.sibling=null,V}function p(V,k,W){return V.index=W,s?(W=V.alternate,W!==null?(W=W.index,W<k?(V.flags|=33554434,k):W):(V.flags|=33554434,k)):(V.flags|=1048576,k)}function b(V){return s&&V.alternate===null&&(V.flags|=33554434),V}function S(V,k,W,ie){return k===null||k.tag!==6?(k=Yf(W,V.mode,ie),k.return=V,k):(k=d(k,W),k.return=V,k)}function C(V,k,W,ie){var de=W.type;return de===h?Q(V,k,W.props.children,ie,W.key):k!==null&&(k.elementType===de||typeof de=="object"&&de!==null&&de.$$typeof===B&&o_(de)===k.type)?(k=d(k,W.props),ra(k,W),k.return=V,k):(k=ll(W.type,W.key,W.props,null,V.mode,ie),ra(k,W),k.return=V,k)}function U(V,k,W,ie){return k===null||k.tag!==4||k.stateNode.containerInfo!==W.containerInfo||k.stateNode.implementation!==W.implementation?(k=qf(W,V.mode,ie),k.return=V,k):(k=d(k,W.children||[]),k.return=V,k)}function Q(V,k,W,ie,de){return k===null||k.tag!==7?(k=is(W,V.mode,ie,de),k.return=V,k):(k=d(k,W),k.return=V,k)}function ne(V,k,W){if(typeof k=="string"&&k!==""||typeof k=="number"||typeof k=="bigint")return k=Yf(""+k,V.mode,W),k.return=V,k;if(typeof k=="object"&&k!==null){switch(k.$$typeof){case c:return W=ll(k.type,k.key,k.props,null,V.mode,W),ra(W,k),W.return=V,W;case f:return k=qf(k,V.mode,W),k.return=V,k;case B:var ie=k._init;return k=ie(k._payload),ne(V,k,W)}if(K(k)||q(k))return k=is(k,V.mode,W,null),k.return=V,k;if(typeof k.then=="function")return ne(V,jo(k),W);if(k.$$typeof===T)return ne(V,rl(V,k),W);Wo(V,k)}return null}function $(V,k,W,ie){var de=k!==null?k.key:null;if(typeof W=="string"&&W!==""||typeof W=="number"||typeof W=="bigint")return de!==null?null:S(V,k,""+W,ie);if(typeof W=="object"&&W!==null){switch(W.$$typeof){case c:return W.key===de?C(V,k,W,ie):null;case f:return W.key===de?U(V,k,W,ie):null;case B:return de=W._init,W=de(W._payload),$(V,k,W,ie)}if(K(W)||q(W))return de!==null?null:Q(V,k,W,ie,null);if(typeof W.then=="function")return $(V,k,jo(W),ie);if(W.$$typeof===T)return $(V,k,rl(V,W),ie);Wo(V,W)}return null}function Z(V,k,W,ie,de){if(typeof ie=="string"&&ie!==""||typeof ie=="number"||typeof ie=="bigint")return V=V.get(W)||null,S(k,V,""+ie,de);if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case c:return V=V.get(ie.key===null?W:ie.key)||null,C(k,V,ie,de);case f:return V=V.get(ie.key===null?W:ie.key)||null,U(k,V,ie,de);case B:var Re=ie._init;return ie=Re(ie._payload),Z(V,k,W,ie,de)}if(K(ie)||q(ie))return V=V.get(W)||null,Q(k,V,ie,de,null);if(typeof ie.then=="function")return Z(V,k,W,jo(ie),de);if(ie.$$typeof===T)return Z(V,k,W,rl(k,ie),de);Wo(k,ie)}return null}function pe(V,k,W,ie){for(var de=null,Re=null,me=k,be=k=0,dt=null;me!==null&&be<W.length;be++){me.index>be?(dt=me,me=null):dt=me.sibling;var Be=$(V,me,W[be],ie);if(Be===null){me===null&&(me=dt);break}s&&me&&Be.alternate===null&&a(V,me),k=p(Be,k,be),Re===null?de=Be:Re.sibling=Be,Re=Be,me=dt}if(be===W.length)return l(V,me),ke&&Xn(V,be),de;if(me===null){for(;be<W.length;be++)me=ne(V,W[be],ie),me!==null&&(k=p(me,k,be),Re===null?de=me:Re.sibling=me,Re=me);return ke&&Xn(V,be),de}for(me=u(me);be<W.length;be++)dt=Z(me,V,be,W[be],ie),dt!==null&&(s&&dt.alternate!==null&&me.delete(dt.key===null?be:dt.key),k=p(dt,k,be),Re===null?de=dt:Re.sibling=dt,Re=dt);return s&&me.forEach(function(Sn){return a(V,Sn)}),ke&&Xn(V,be),de}function Se(V,k,W,ie){if(W==null)throw Error(n(151));for(var de=null,Re=null,me=k,be=k=0,dt=null,Be=W.next();me!==null&&!Be.done;be++,Be=W.next()){me.index>be?(dt=me,me=null):dt=me.sibling;var Sn=$(V,me,Be.value,ie);if(Sn===null){me===null&&(me=dt);break}s&&me&&Sn.alternate===null&&a(V,me),k=p(Sn,k,be),Re===null?de=Sn:Re.sibling=Sn,Re=Sn,me=dt}if(Be.done)return l(V,me),ke&&Xn(V,be),de;if(me===null){for(;!Be.done;be++,Be=W.next())Be=ne(V,Be.value,ie),Be!==null&&(k=p(Be,k,be),Re===null?de=Be:Re.sibling=Be,Re=Be);return ke&&Xn(V,be),de}for(me=u(me);!Be.done;be++,Be=W.next())Be=Z(me,V,be,Be.value,ie),Be!==null&&(s&&Be.alternate!==null&&me.delete(Be.key===null?be:Be.key),k=p(Be,k,be),Re===null?de=Be:Re.sibling=Be,Re=Be);return s&&me.forEach(function(nw){return a(V,nw)}),ke&&Xn(V,be),de}function Ge(V,k,W,ie){if(typeof W=="object"&&W!==null&&W.type===h&&W.key===null&&(W=W.props.children),typeof W=="object"&&W!==null){switch(W.$$typeof){case c:e:{for(var de=W.key;k!==null;){if(k.key===de){if(de=W.type,de===h){if(k.tag===7){l(V,k.sibling),ie=d(k,W.props.children),ie.return=V,V=ie;break e}}else if(k.elementType===de||typeof de=="object"&&de!==null&&de.$$typeof===B&&o_(de)===k.type){l(V,k.sibling),ie=d(k,W.props),ra(ie,W),ie.return=V,V=ie;break e}l(V,k);break}else a(V,k);k=k.sibling}W.type===h?(ie=is(W.props.children,V.mode,ie,W.key),ie.return=V,V=ie):(ie=ll(W.type,W.key,W.props,null,V.mode,ie),ra(ie,W),ie.return=V,V=ie)}return b(V);case f:e:{for(de=W.key;k!==null;){if(k.key===de)if(k.tag===4&&k.stateNode.containerInfo===W.containerInfo&&k.stateNode.implementation===W.implementation){l(V,k.sibling),ie=d(k,W.children||[]),ie.return=V,V=ie;break e}else{l(V,k);break}else a(V,k);k=k.sibling}ie=qf(W,V.mode,ie),ie.return=V,V=ie}return b(V);case B:return de=W._init,W=de(W._payload),Ge(V,k,W,ie)}if(K(W))return pe(V,k,W,ie);if(q(W)){if(de=q(W),typeof de!="function")throw Error(n(150));return W=de.call(W),Se(V,k,W,ie)}if(typeof W.then=="function")return Ge(V,k,jo(W),ie);if(W.$$typeof===T)return Ge(V,k,rl(V,W),ie);Wo(V,W)}return typeof W=="string"&&W!==""||typeof W=="number"||typeof W=="bigint"?(W=""+W,k!==null&&k.tag===6?(l(V,k.sibling),ie=d(k,W),ie.return=V,V=ie):(l(V,k),ie=Yf(W,V.mode,ie),ie.return=V,V=ie),b(V)):l(V,k)}return function(V,k,W,ie){try{sa=0;var de=Ge(V,k,W,ie);return Vs=null,de}catch(me){if(me===ia)throw me;var Re=Qt(29,me,null,V.mode);return Re.lanes=ie,Re.return=V,Re}finally{}}}var Yn=l_(!0),c_=l_(!1),Hs=he(null),Xo=he(0);function u_(s,a){s=Xi,ye(Xo,s),ye(Hs,a),Xi=s|a.baseLanes}function Ju(){ye(Xo,Xi),ye(Hs,Hs.current)}function ef(){Xi=Xo.current,xe(Hs),xe(Xo)}var qt=he(null),mi=null;function sn(s){var a=s.alternate;ye(ot,ot.current&1),ye(qt,s),mi===null&&(a===null||Hs.current!==null||a.memoizedState!==null)&&(mi=s)}function f_(s){if(s.tag===22){if(ye(ot,ot.current),ye(qt,s),mi===null){var a=s.alternate;a!==null&&a.memoizedState!==null&&(mi=s)}}else rn()}function rn(){ye(ot,ot.current),ye(qt,qt.current)}function ki(s){xe(qt),mi===s&&(mi=null),xe(ot)}var ot=he(0);function $o(s){for(var a=s;a!==null;){if(a.tag===13){var l=a.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||l.data==="$?"||l.data==="$!"))return a}else if(a.tag===19&&a.memoizedProps.revealOrder!==void 0){if(a.flags&128)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var WE=typeof AbortController<"u"?AbortController:function(){var s=[],a=this.signal={aborted:!1,addEventListener:function(l,u){s.push(u)}};this.abort=function(){a.aborted=!0,s.forEach(function(l){return l()})}},XE=t.unstable_scheduleCallback,$E=t.unstable_NormalPriority,lt={$$typeof:T,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function tf(){return{controller:new WE,data:new Map,refCount:0}}function aa(s){s.refCount--,s.refCount===0&&XE($E,function(){s.controller.abort()})}var oa=null,nf=0,js=0,Ws=null;function YE(s,a){if(oa===null){var l=oa=[];nf=0,js=ch(),Ws={status:"pending",value:void 0,then:function(u){l.push(u)}}}return nf++,a.then(h_,h_),a}function h_(){if(--nf===0&&oa!==null){Ws!==null&&(Ws.status="fulfilled");var s=oa;oa=null,js=0,Ws=null;for(var a=0;a<s.length;a++)(0,s[a])()}}function qE(s,a){var l=[],u={status:"pending",value:null,reason:null,then:function(d){l.push(d)}};return s.then(function(){u.status="fulfilled",u.value=a;for(var d=0;d<l.length;d++)(0,l[d])(a)},function(d){for(u.status="rejected",u.reason=d,d=0;d<l.length;d++)(0,l[d])(void 0)}),u}var d_=G.S;G.S=function(s,a){typeof a=="object"&&a!==null&&typeof a.then=="function"&&YE(s,a),d_!==null&&d_(s,a)};var qn=he(null);function sf(){var s=qn.current;return s!==null?s:We.pooledCache}function Yo(s,a){a===null?ye(qn,qn.current):ye(qn,a.pool)}function g_(){var s=sf();return s===null?null:{parent:lt._currentValue,pool:s}}var an=0,we=null,Fe=null,it=null,qo=!1,Xs=!1,Kn=!1,Ko=0,la=0,$s=null,KE=0;function tt(){throw Error(n(321))}function rf(s,a){if(a===null)return!1;for(var l=0;l<a.length&&l<s.length;l++)if(!kt(s[l],a[l]))return!1;return!0}function af(s,a,l,u,d,p){return an=p,we=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,G.H=s===null||s.memoizedState===null?Zn:on,Kn=!1,p=l(u,d),Kn=!1,Xs&&(p=__(a,l,u,d)),p_(s),p}function p_(s){G.H=yi;var a=Fe!==null&&Fe.next!==null;if(an=0,it=Fe=we=null,qo=!1,la=0,$s=null,a)throw Error(n(300));s===null||ft||(s=s.dependencies,s!==null&&sl(s)&&(ft=!0))}function __(s,a,l,u){we=s;var d=0;do{if(Xs&&($s=null),la=0,Xs=!1,25<=d)throw Error(n(301));if(d+=1,it=Fe=null,s.updateQueue!=null){var p=s.updateQueue;p.lastEffect=null,p.events=null,p.stores=null,p.memoCache!=null&&(p.memoCache.index=0)}G.H=Qn,p=a(l,u)}while(Xs);return p}function ZE(){var s=G.H,a=s.useState()[0];return a=typeof a.then=="function"?ca(a):a,s=s.useState()[0],(Fe!==null?Fe.memoizedState:null)!==s&&(we.flags|=1024),a}function of(){var s=Ko!==0;return Ko=0,s}function lf(s,a,l){a.updateQueue=s.updateQueue,a.flags&=-2053,s.lanes&=~l}function cf(s){if(qo){for(s=s.memoizedState;s!==null;){var a=s.queue;a!==null&&(a.pending=null),s=s.next}qo=!1}an=0,it=Fe=we=null,Xs=!1,la=Ko=0,$s=null}function Pt(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return it===null?we.memoizedState=it=s:it=it.next=s,it}function nt(){if(Fe===null){var s=we.alternate;s=s!==null?s.memoizedState:null}else s=Fe.next;var a=it===null?we.memoizedState:it.next;if(a!==null)it=a,Fe=s;else{if(s===null)throw we.alternate===null?Error(n(467)):Error(n(310));Fe=s,s={memoizedState:Fe.memoizedState,baseState:Fe.baseState,baseQueue:Fe.baseQueue,queue:Fe.queue,next:null},it===null?we.memoizedState=it=s:it=it.next=s}return it}var Zo;Zo=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}};function ca(s){var a=la;return la+=1,$s===null&&($s=[]),s=r_($s,s,a),a=we,(it===null?a.memoizedState:it.next)===null&&(a=a.alternate,G.H=a===null||a.memoizedState===null?Zn:on),s}function Qo(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return ca(s);if(s.$$typeof===T)return At(s)}throw Error(n(438,String(s)))}function uf(s){var a=null,l=we.updateQueue;if(l!==null&&(a=l.memoCache),a==null){var u=we.alternate;u!==null&&(u=u.updateQueue,u!==null&&(u=u.memoCache,u!=null&&(a={data:u.data.map(function(d){return d.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),l===null&&(l=Zo(),we.updateQueue=l),l.memoCache=a,l=a.data[a.index],l===void 0)for(l=a.data[a.index]=Array(s),u=0;u<s;u++)l[u]=j;return a.index++,l}function Bi(s,a){return typeof a=="function"?a(s):a}function Go(s){var a=nt();return ff(a,Fe,s)}function ff(s,a,l){var u=s.queue;if(u===null)throw Error(n(311));u.lastRenderedReducer=l;var d=s.baseQueue,p=u.pending;if(p!==null){if(d!==null){var b=d.next;d.next=p.next,p.next=b}a.baseQueue=d=p,u.pending=null}if(p=s.baseState,d===null)s.memoizedState=p;else{a=d.next;var S=b=null,C=null,U=a,Q=!1;do{var ne=U.lane&-536870913;if(ne!==U.lane?(De&ne)===ne:(an&ne)===ne){var $=U.revertLane;if($===0)C!==null&&(C=C.next={lane:0,revertLane:0,action:U.action,hasEagerState:U.hasEagerState,eagerState:U.eagerState,next:null}),ne===js&&(Q=!0);else if((an&$)===$){U=U.next,$===js&&(Q=!0);continue}else ne={lane:0,revertLane:U.revertLane,action:U.action,hasEagerState:U.hasEagerState,eagerState:U.eagerState,next:null},C===null?(S=C=ne,b=p):C=C.next=ne,we.lanes|=$,_n|=$;ne=U.action,Kn&&l(p,ne),p=U.hasEagerState?U.eagerState:l(p,ne)}else $={lane:ne,revertLane:U.revertLane,action:U.action,hasEagerState:U.hasEagerState,eagerState:U.eagerState,next:null},C===null?(S=C=$,b=p):C=C.next=$,we.lanes|=ne,_n|=ne;U=U.next}while(U!==null&&U!==a);if(C===null?b=p:C.next=S,!kt(p,s.memoizedState)&&(ft=!0,Q&&(l=Ws,l!==null)))throw l;s.memoizedState=p,s.baseState=b,s.baseQueue=C,u.lastRenderedState=p}return d===null&&(u.lanes=0),[s.memoizedState,u.dispatch]}function hf(s){var a=nt(),l=a.queue;if(l===null)throw Error(n(311));l.lastRenderedReducer=s;var u=l.dispatch,d=l.pending,p=a.memoizedState;if(d!==null){l.pending=null;var b=d=d.next;do p=s(p,b.action),b=b.next;while(b!==d);kt(p,a.memoizedState)||(ft=!0),a.memoizedState=p,a.baseQueue===null&&(a.baseState=p),l.lastRenderedState=p}return[p,u]}function m_(s,a,l){var u=we,d=nt(),p=ke;if(p){if(l===void 0)throw Error(n(407));l=l()}else l=a();var b=!kt((Fe||d).memoizedState,l);if(b&&(d.memoizedState=l,ft=!0),d=d.queue,pf(v_.bind(null,u,d,s),[s]),d.getSnapshot!==a||b||it!==null&&it.memoizedState.tag&1){if(u.flags|=2048,Ys(9,b_.bind(null,u,d,l,a),{destroy:void 0},null),We===null)throw Error(n(349));p||an&60||y_(u,a,l)}return l}function y_(s,a,l){s.flags|=16384,s={getSnapshot:a,value:l},a=we.updateQueue,a===null?(a=Zo(),we.updateQueue=a,a.stores=[s]):(l=a.stores,l===null?a.stores=[s]:l.push(s))}function b_(s,a,l,u){a.value=l,a.getSnapshot=u,T_(a)&&S_(s)}function v_(s,a,l){return l(function(){T_(a)&&S_(s)})}function T_(s){var a=s.getSnapshot;s=s.value;try{var l=a();return!kt(s,l)}catch{return!0}}function S_(s){var a=nn(s,2);a!==null&&Ct(a,s,2)}function df(s){var a=Pt();if(typeof s=="function"){var l=s;if(s=l(),Kn){Ji(!0);try{l()}finally{Ji(!1)}}}return a.memoizedState=a.baseState=s,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Bi,lastRenderedState:s},a}function A_(s,a,l,u){return s.baseState=l,ff(s,Fe,typeof u=="function"?u:Bi)}function QE(s,a,l,u,d){if(tl(s))throw Error(n(485));if(s=a.action,s!==null){var p={payload:d,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(b){p.listeners.push(b)}};G.T!==null?l(!0):p.isTransition=!1,u(p),l=a.pending,l===null?(p.next=a.pending=p,E_(a,p)):(p.next=l.next,a.pending=l.next=p)}}function E_(s,a){var l=a.action,u=a.payload,d=s.state;if(a.isTransition){var p=G.T,b={};G.T=b;try{var S=l(d,u),C=G.S;C!==null&&C(b,S),w_(s,a,S)}catch(U){gf(s,a,U)}finally{G.T=p}}else try{p=l(d,u),w_(s,a,p)}catch(U){gf(s,a,U)}}function w_(s,a,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(u){R_(s,a,u)},function(u){return gf(s,a,u)}):R_(s,a,l)}function R_(s,a,l){a.status="fulfilled",a.value=l,x_(a),s.state=l,a=s.pending,a!==null&&(l=a.next,l===a?s.pending=null:(l=l.next,a.next=l,E_(s,l)))}function gf(s,a,l){var u=s.pending;if(s.pending=null,u!==null){u=u.next;do a.status="rejected",a.reason=l,x_(a),a=a.next;while(a!==u)}s.action=null}function x_(s){s=s.listeners;for(var a=0;a<s.length;a++)(0,s[a])()}function C_(s,a){return a}function M_(s,a){if(ke){var l=We.formState;if(l!==null){e:{var u=we;if(ke){if(pt){t:{for(var d=pt,p=_i;d.nodeType!==8;){if(!p){d=null;break t}if(d=oi(d.nextSibling),d===null){d=null;break t}}p=d.data,d=p==="F!"||p==="F"?d:null}if(d){pt=oi(d.nextSibling),u=d.data==="F!";break e}}$n(u)}u=!1}u&&(a=l[0])}}return l=Pt(),l.memoizedState=l.baseState=a,u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:C_,lastRenderedState:a},l.queue=u,l=Y_.bind(null,we,u),u.dispatch=l,u=df(!1),p=vf.bind(null,we,!1,u.queue),u=Pt(),d={state:a,dispatch:null,action:s,pending:null},u.queue=d,l=QE.bind(null,we,d,p,l),d.dispatch=l,u.memoizedState=s,[a,l,!1]}function O_(s){var a=nt();return P_(a,Fe,s)}function P_(s,a,l){a=ff(s,a,C_)[0],s=Go(Bi)[0],a=typeof a=="object"&&a!==null&&typeof a.then=="function"?ca(a):a;var u=nt(),d=u.queue,p=d.dispatch;return l!==u.memoizedState&&(we.flags|=2048,Ys(9,GE.bind(null,d,l),{destroy:void 0},null)),[a,p,s]}function GE(s,a){s.action=a}function N_(s){var a=nt(),l=Fe;if(l!==null)return P_(a,l,s);nt(),a=a.memoizedState,l=nt();var u=l.queue.dispatch;return l.memoizedState=s,[a,u,!1]}function Ys(s,a,l,u){return s={tag:s,create:a,inst:l,deps:u,next:null},a=we.updateQueue,a===null&&(a=Zo(),we.updateQueue=a),l=a.lastEffect,l===null?a.lastEffect=s.next=s:(u=l.next,l.next=s,s.next=u,a.lastEffect=s),s}function I_(){return nt().memoizedState}function Jo(s,a,l,u){var d=Pt();we.flags|=s,d.memoizedState=Ys(1|a,l,{destroy:void 0},u===void 0?null:u)}function el(s,a,l,u){var d=nt();u=u===void 0?null:u;var p=d.memoizedState.inst;Fe!==null&&u!==null&&rf(u,Fe.memoizedState.deps)?d.memoizedState=Ys(a,l,p,u):(we.flags|=s,d.memoizedState=Ys(1|a,l,p,u))}function D_(s,a){Jo(8390656,8,s,a)}function pf(s,a){el(2048,8,s,a)}function k_(s,a){return el(4,2,s,a)}function B_(s,a){return el(4,4,s,a)}function U_(s,a){if(typeof a=="function"){s=s();var l=a(s);return function(){typeof l=="function"?l():a(null)}}if(a!=null)return s=s(),a.current=s,function(){a.current=null}}function F_(s,a,l){l=l!=null?l.concat([s]):null,el(4,4,U_.bind(null,a,s),l)}function _f(){}function L_(s,a){var l=nt();a=a===void 0?null:a;var u=l.memoizedState;return a!==null&&rf(a,u[1])?u[0]:(l.memoizedState=[s,a],s)}function z_(s,a){var l=nt();a=a===void 0?null:a;var u=l.memoizedState;if(a!==null&&rf(a,u[1]))return u[0];if(u=s(),Kn){Ji(!0);try{s()}finally{Ji(!1)}}return l.memoizedState=[u,a],u}function mf(s,a,l){return l===void 0||an&1073741824?s.memoizedState=a:(s.memoizedState=l,s=Hm(),we.lanes|=s,_n|=s,l)}function V_(s,a,l,u){return kt(l,a)?l:Hs.current!==null?(s=mf(s,l,u),kt(s,a)||(ft=!0),s):an&42?(s=Hm(),we.lanes|=s,_n|=s,a):(ft=!0,s.memoizedState=l)}function H_(s,a,l,u,d){var p=J.p;J.p=p!==0&&8>p?p:8;var b=G.T,S={};G.T=S,vf(s,!1,a,l);try{var C=d(),U=G.S;if(U!==null&&U(S,C),C!==null&&typeof C=="object"&&typeof C.then=="function"){var Q=qE(C,u);ua(s,a,Q,Lt(s))}else ua(s,a,u,Lt(s))}catch(ne){ua(s,a,{then:function(){},status:"rejected",reason:ne},Lt())}finally{J.p=p,G.T=b}}function JE(){}function yf(s,a,l,u){if(s.tag!==5)throw Error(n(476));var d=j_(s).queue;H_(s,d,a,re,l===null?JE:function(){return W_(s),l(u)})}function j_(s){var a=s.memoizedState;if(a!==null)return a;a={memoizedState:re,baseState:re,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Bi,lastRenderedState:re},next:null};var l={};return a.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Bi,lastRenderedState:l},next:null},s.memoizedState=a,s=s.alternate,s!==null&&(s.memoizedState=a),a}function W_(s){var a=j_(s).next.queue;ua(s,a,{},Lt())}function bf(){return At(Oa)}function X_(){return nt().memoizedState}function $_(){return nt().memoizedState}function e1(s){for(var a=s.return;a!==null;){switch(a.tag){case 24:case 3:var l=Lt();s=un(l);var u=fn(a,s,l);u!==null&&(Ct(u,a,l),da(u,a,l)),a={cache:tf()},s.payload=a;return}a=a.return}}function t1(s,a,l){var u=Lt();l={lane:u,revertLane:0,action:l,hasEagerState:!1,eagerState:null,next:null},tl(s)?q_(a,l):(l=qu(s,a,l,u),l!==null&&(Ct(l,s,u),K_(l,a,u)))}function Y_(s,a,l){var u=Lt();ua(s,a,l,u)}function ua(s,a,l,u){var d={lane:u,revertLane:0,action:l,hasEagerState:!1,eagerState:null,next:null};if(tl(s))q_(a,d);else{var p=s.alternate;if(s.lanes===0&&(p===null||p.lanes===0)&&(p=a.lastRenderedReducer,p!==null))try{var b=a.lastRenderedState,S=p(b,l);if(d.hasEagerState=!0,d.eagerState=S,kt(S,b))return Fo(s,a,d,0),We===null&&Uo(),!1}catch{}finally{}if(l=qu(s,a,d,u),l!==null)return Ct(l,s,u),K_(l,a,u),!0}return!1}function vf(s,a,l,u){if(u={lane:2,revertLane:ch(),action:u,hasEagerState:!1,eagerState:null,next:null},tl(s)){if(a)throw Error(n(479))}else a=qu(s,l,u,2),a!==null&&Ct(a,s,2)}function tl(s){var a=s.alternate;return s===we||a!==null&&a===we}function q_(s,a){Xs=qo=!0;var l=s.pending;l===null?a.next=a:(a.next=l.next,l.next=a),s.pending=a}function K_(s,a,l){if(l&4194176){var u=a.lanes;u&=s.pendingLanes,l|=u,a.lanes=l,ap(s,l)}}var yi={readContext:At,use:Qo,useCallback:tt,useContext:tt,useEffect:tt,useImperativeHandle:tt,useLayoutEffect:tt,useInsertionEffect:tt,useMemo:tt,useReducer:tt,useRef:tt,useState:tt,useDebugValue:tt,useDeferredValue:tt,useTransition:tt,useSyncExternalStore:tt,useId:tt};yi.useCacheRefresh=tt,yi.useMemoCache=tt,yi.useHostTransitionStatus=tt,yi.useFormState=tt,yi.useActionState=tt,yi.useOptimistic=tt;var Zn={readContext:At,use:Qo,useCallback:function(s,a){return Pt().memoizedState=[s,a===void 0?null:a],s},useContext:At,useEffect:D_,useImperativeHandle:function(s,a,l){l=l!=null?l.concat([s]):null,Jo(4194308,4,U_.bind(null,a,s),l)},useLayoutEffect:function(s,a){return Jo(4194308,4,s,a)},useInsertionEffect:function(s,a){Jo(4,2,s,a)},useMemo:function(s,a){var l=Pt();a=a===void 0?null:a;var u=s();if(Kn){Ji(!0);try{s()}finally{Ji(!1)}}return l.memoizedState=[u,a],u},useReducer:function(s,a,l){var u=Pt();if(l!==void 0){var d=l(a);if(Kn){Ji(!0);try{l(a)}finally{Ji(!1)}}}else d=a;return u.memoizedState=u.baseState=d,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:d},u.queue=s,s=s.dispatch=t1.bind(null,we,s),[u.memoizedState,s]},useRef:function(s){var a=Pt();return s={current:s},a.memoizedState=s},useState:function(s){s=df(s);var a=s.queue,l=Y_.bind(null,we,a);return a.dispatch=l,[s.memoizedState,l]},useDebugValue:_f,useDeferredValue:function(s,a){var l=Pt();return mf(l,s,a)},useTransition:function(){var s=df(!1);return s=H_.bind(null,we,s.queue,!0,!1),Pt().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,a,l){var u=we,d=Pt();if(ke){if(l===void 0)throw Error(n(407));l=l()}else{if(l=a(),We===null)throw Error(n(349));De&60||y_(u,a,l)}d.memoizedState=l;var p={value:l,getSnapshot:a};return d.queue=p,D_(v_.bind(null,u,p,s),[s]),u.flags|=2048,Ys(9,b_.bind(null,u,p,l,a),{destroy:void 0},null),l},useId:function(){var s=Pt(),a=We.identifierPrefix;if(ke){var l=Di,u=Ii;l=(u&~(1<<32-Dt(u)-1)).toString(32)+l,a=":"+a+"R"+l,l=Ko++,0<l&&(a+="H"+l.toString(32)),a+=":"}else l=KE++,a=":"+a+"r"+l.toString(32)+":";return s.memoizedState=a},useCacheRefresh:function(){return Pt().memoizedState=e1.bind(null,we)}};Zn.useMemoCache=uf,Zn.useHostTransitionStatus=bf,Zn.useFormState=M_,Zn.useActionState=M_,Zn.useOptimistic=function(s){var a=Pt();a.memoizedState=a.baseState=s;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=l,a=vf.bind(null,we,!0,l),l.dispatch=a,[s,a]};var on={readContext:At,use:Qo,useCallback:L_,useContext:At,useEffect:pf,useImperativeHandle:F_,useInsertionEffect:k_,useLayoutEffect:B_,useMemo:z_,useReducer:Go,useRef:I_,useState:function(){return Go(Bi)},useDebugValue:_f,useDeferredValue:function(s,a){var l=nt();return V_(l,Fe.memoizedState,s,a)},useTransition:function(){var s=Go(Bi)[0],a=nt().memoizedState;return[typeof s=="boolean"?s:ca(s),a]},useSyncExternalStore:m_,useId:X_};on.useCacheRefresh=$_,on.useMemoCache=uf,on.useHostTransitionStatus=bf,on.useFormState=O_,on.useActionState=O_,on.useOptimistic=function(s,a){var l=nt();return A_(l,Fe,s,a)};var Qn={readContext:At,use:Qo,useCallback:L_,useContext:At,useEffect:pf,useImperativeHandle:F_,useInsertionEffect:k_,useLayoutEffect:B_,useMemo:z_,useReducer:hf,useRef:I_,useState:function(){return hf(Bi)},useDebugValue:_f,useDeferredValue:function(s,a){var l=nt();return Fe===null?mf(l,s,a):V_(l,Fe.memoizedState,s,a)},useTransition:function(){var s=hf(Bi)[0],a=nt().memoizedState;return[typeof s=="boolean"?s:ca(s),a]},useSyncExternalStore:m_,useId:X_};Qn.useCacheRefresh=$_,Qn.useMemoCache=uf,Qn.useHostTransitionStatus=bf,Qn.useFormState=N_,Qn.useActionState=N_,Qn.useOptimistic=function(s,a){var l=nt();return Fe!==null?A_(l,Fe,s,a):(l.baseState=s,[s,l.queue.dispatch])};function Tf(s,a,l,u){a=s.memoizedState,l=l(u,a),l=l==null?a:ae({},a,l),s.memoizedState=l,s.lanes===0&&(s.updateQueue.baseState=l)}var Sf={isMounted:function(s){return(s=s._reactInternals)?M(s)===s:!1},enqueueSetState:function(s,a,l){s=s._reactInternals;var u=Lt(),d=un(u);d.payload=a,l!=null&&(d.callback=l),a=fn(s,d,u),a!==null&&(Ct(a,s,u),da(a,s,u))},enqueueReplaceState:function(s,a,l){s=s._reactInternals;var u=Lt(),d=un(u);d.tag=1,d.payload=a,l!=null&&(d.callback=l),a=fn(s,d,u),a!==null&&(Ct(a,s,u),da(a,s,u))},enqueueForceUpdate:function(s,a){s=s._reactInternals;var l=Lt(),u=un(l);u.tag=2,a!=null&&(u.callback=a),a=fn(s,u,l),a!==null&&(Ct(a,s,l),da(a,s,l))}};function Z_(s,a,l,u,d,p,b){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(u,p,b):a.prototype&&a.prototype.isPureReactComponent?!Qr(l,u)||!Qr(d,p):!0}function Q_(s,a,l,u){s=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(l,u),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(l,u),a.state!==s&&Sf.enqueueReplaceState(a,a.state,null)}function Gn(s,a){var l=a;if("ref"in a){l={};for(var u in a)u!=="ref"&&(l[u]=a[u])}if(s=s.defaultProps){l===a&&(l=ae({},l));for(var d in s)l[d]===void 0&&(l[d]=s[d])}return l}var il=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)};function G_(s){il(s)}function J_(s){console.error(s)}function em(s){il(s)}function nl(s,a){try{var l=s.onUncaughtError;l(a.value,{componentStack:a.stack})}catch(u){setTimeout(function(){throw u})}}function tm(s,a,l){try{var u=s.onCaughtError;u(l.value,{componentStack:l.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(d){setTimeout(function(){throw d})}}function Af(s,a,l){return l=un(l),l.tag=3,l.payload={element:null},l.callback=function(){nl(s,a)},l}function im(s){return s=un(s),s.tag=3,s}function nm(s,a,l,u){var d=l.type.getDerivedStateFromError;if(typeof d=="function"){var p=u.value;s.payload=function(){return d(p)},s.callback=function(){tm(a,l,u)}}var b=l.stateNode;b!==null&&typeof b.componentDidCatch=="function"&&(s.callback=function(){tm(a,l,u),typeof d!="function"&&(mn===null?mn=new Set([this]):mn.add(this));var S=u.stack;this.componentDidCatch(u.value,{componentStack:S!==null?S:""})})}function i1(s,a,l,u,d){if(l.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){if(a=l.alternate,a!==null&&ha(a,l,d,!0),l=qt.current,l!==null){switch(l.tag){case 13:return mi===null?sh():l.alternate===null&&Qe===0&&(Qe=3),l.flags&=-257,l.flags|=65536,l.lanes=d,u===Gu?l.flags|=16384:(a=l.updateQueue,a===null?l.updateQueue=new Set([u]):a.add(u),ah(s,u,d)),!1;case 22:return l.flags|=65536,u===Gu?l.flags|=16384:(a=l.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([u])},l.updateQueue=a):(l=a.retryQueue,l===null?a.retryQueue=new Set([u]):l.add(u)),ah(s,u,d)),!1}throw Error(n(435,l.tag))}return ah(s,u,d),sh(),!1}if(ke)return a=qt.current,a!==null?(!(a.flags&65536)&&(a.flags|=256),a.flags|=65536,a.lanes=d,u!==Qu&&(s=Error(n(422),{cause:u}),ta(Xt(s,l)))):(u!==Qu&&(a=Error(n(423),{cause:u}),ta(Xt(a,l))),s=s.current.alternate,s.flags|=65536,d&=-d,s.lanes|=d,u=Xt(u,l),d=Af(s.stateNode,u,d),Ff(s,d),Qe!==4&&(Qe=2)),!1;var p=Error(n(520),{cause:u});if(p=Xt(p,l),Ta===null?Ta=[p]:Ta.push(p),Qe!==4&&(Qe=2),a===null)return!0;u=Xt(u,l),l=a;do{switch(l.tag){case 3:return l.flags|=65536,s=d&-d,l.lanes|=s,s=Af(l.stateNode,u,s),Ff(l,s),!1;case 1:if(a=l.type,p=l.stateNode,(l.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||p!==null&&typeof p.componentDidCatch=="function"&&(mn===null||!mn.has(p))))return l.flags|=65536,d&=-d,l.lanes|=d,d=im(d),nm(d,s,l,u),Ff(l,d),!1}l=l.return}while(l!==null);return!1}var sm=Error(n(461)),ft=!1;function _t(s,a,l,u){a.child=s===null?c_(a,null,l,u):Yn(a,s.child,l,u)}function rm(s,a,l,u,d){l=l.render;var p=a.ref;if("ref"in u){var b={};for(var S in u)S!=="ref"&&(b[S]=u[S])}else b=u;return es(a),u=af(s,a,l,b,p,d),S=of(),s!==null&&!ft?(lf(s,a,d),Ui(s,a,d)):(ke&&S&&Ku(a),a.flags|=1,_t(s,a,u,d),a.child)}function am(s,a,l,u,d){if(s===null){var p=l.type;return typeof p=="function"&&!$f(p)&&p.defaultProps===void 0&&l.compare===null?(a.tag=15,a.type=p,om(s,a,p,u,d)):(s=ll(l.type,null,u,a,a.mode,d),s.ref=a.ref,s.return=a,a.child=s)}if(p=s.child,!Nf(s,d)){var b=p.memoizedProps;if(l=l.compare,l=l!==null?l:Qr,l(b,u)&&s.ref===a.ref)return Ui(s,a,d)}return a.flags|=1,s=pn(p,u),s.ref=a.ref,s.return=a,a.child=s}function om(s,a,l,u,d){if(s!==null){var p=s.memoizedProps;if(Qr(p,u)&&s.ref===a.ref)if(ft=!1,a.pendingProps=u=p,Nf(s,d))s.flags&131072&&(ft=!0);else return a.lanes=s.lanes,Ui(s,a,d)}return Ef(s,a,l,u,d)}function lm(s,a,l){var u=a.pendingProps,d=u.children,p=(a.stateNode._pendingVisibility&2)!==0,b=s!==null?s.memoizedState:null;if(fa(s,a),u.mode==="hidden"||p){if(a.flags&128){if(u=b!==null?b.baseLanes|l:l,s!==null){for(d=a.child=s.child,p=0;d!==null;)p=p|d.lanes|d.childLanes,d=d.sibling;a.childLanes=p&~u}else a.childLanes=0,a.child=null;return cm(s,a,u,l)}if(l&536870912)a.memoizedState={baseLanes:0,cachePool:null},s!==null&&Yo(a,b!==null?b.cachePool:null),b!==null?u_(a,b):Ju(),f_(a);else return a.lanes=a.childLanes=536870912,cm(s,a,b!==null?b.baseLanes|l:l,l)}else b!==null?(Yo(a,b.cachePool),u_(a,b),rn(),a.memoizedState=null):(s!==null&&Yo(a,null),Ju(),rn());return _t(s,a,d,l),a.child}function cm(s,a,l,u){var d=sf();return d=d===null?null:{parent:lt._currentValue,pool:d},a.memoizedState={baseLanes:l,cachePool:d},s!==null&&Yo(a,null),Ju(),f_(a),s!==null&&ha(s,a,u,!0),null}function fa(s,a){var l=a.ref;if(l===null)s!==null&&s.ref!==null&&(a.flags|=2097664);else{if(typeof l!="function"&&typeof l!="object")throw Error(n(284));(s===null||s.ref!==l)&&(a.flags|=2097664)}}function Ef(s,a,l,u,d){return es(a),l=af(s,a,l,u,void 0,d),u=of(),s!==null&&!ft?(lf(s,a,d),Ui(s,a,d)):(ke&&u&&Ku(a),a.flags|=1,_t(s,a,l,d),a.child)}function um(s,a,l,u,d,p){return es(a),a.updateQueue=null,l=__(a,u,l,d),p_(s),u=of(),s!==null&&!ft?(lf(s,a,p),Ui(s,a,p)):(ke&&u&&Ku(a),a.flags|=1,_t(s,a,l,p),a.child)}function fm(s,a,l,u,d){if(es(a),a.stateNode===null){var p=Fs,b=l.contextType;typeof b=="object"&&b!==null&&(p=At(b)),p=new l(u,p),a.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,p.updater=Sf,a.stateNode=p,p._reactInternals=a,p=a.stateNode,p.props=u,p.state=a.memoizedState,p.refs={},Bf(a),b=l.contextType,p.context=typeof b=="object"&&b!==null?At(b):Fs,p.state=a.memoizedState,b=l.getDerivedStateFromProps,typeof b=="function"&&(Tf(a,l,b,u),p.state=a.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof p.getSnapshotBeforeUpdate=="function"||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(b=p.state,typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount(),b!==p.state&&Sf.enqueueReplaceState(p,p.state,null),pa(a,u,p,d),ga(),p.state=a.memoizedState),typeof p.componentDidMount=="function"&&(a.flags|=4194308),u=!0}else if(s===null){p=a.stateNode;var S=a.memoizedProps,C=Gn(l,S);p.props=C;var U=p.context,Q=l.contextType;b=Fs,typeof Q=="object"&&Q!==null&&(b=At(Q));var ne=l.getDerivedStateFromProps;Q=typeof ne=="function"||typeof p.getSnapshotBeforeUpdate=="function",S=a.pendingProps!==S,Q||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(S||U!==b)&&Q_(a,p,u,b),cn=!1;var $=a.memoizedState;p.state=$,pa(a,u,p,d),ga(),U=a.memoizedState,S||$!==U||cn?(typeof ne=="function"&&(Tf(a,l,ne,u),U=a.memoizedState),(C=cn||Z_(a,l,C,u,$,U,b))?(Q||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount()),typeof p.componentDidMount=="function"&&(a.flags|=4194308)):(typeof p.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=u,a.memoizedState=U),p.props=u,p.state=U,p.context=b,u=C):(typeof p.componentDidMount=="function"&&(a.flags|=4194308),u=!1)}else{p=a.stateNode,Uf(s,a),b=a.memoizedProps,Q=Gn(l,b),p.props=Q,ne=a.pendingProps,$=p.context,U=l.contextType,C=Fs,typeof U=="object"&&U!==null&&(C=At(U)),S=l.getDerivedStateFromProps,(U=typeof S=="function"||typeof p.getSnapshotBeforeUpdate=="function")||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(b!==ne||$!==C)&&Q_(a,p,u,C),cn=!1,$=a.memoizedState,p.state=$,pa(a,u,p,d),ga();var Z=a.memoizedState;b!==ne||$!==Z||cn||s!==null&&s.dependencies!==null&&sl(s.dependencies)?(typeof S=="function"&&(Tf(a,l,S,u),Z=a.memoizedState),(Q=cn||Z_(a,l,Q,u,$,Z,C)||s!==null&&s.dependencies!==null&&sl(s.dependencies))?(U||typeof p.UNSAFE_componentWillUpdate!="function"&&typeof p.componentWillUpdate!="function"||(typeof p.componentWillUpdate=="function"&&p.componentWillUpdate(u,Z,C),typeof p.UNSAFE_componentWillUpdate=="function"&&p.UNSAFE_componentWillUpdate(u,Z,C)),typeof p.componentDidUpdate=="function"&&(a.flags|=4),typeof p.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof p.componentDidUpdate!="function"||b===s.memoizedProps&&$===s.memoizedState||(a.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||b===s.memoizedProps&&$===s.memoizedState||(a.flags|=1024),a.memoizedProps=u,a.memoizedState=Z),p.props=u,p.state=Z,p.context=C,u=Q):(typeof p.componentDidUpdate!="function"||b===s.memoizedProps&&$===s.memoizedState||(a.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||b===s.memoizedProps&&$===s.memoizedState||(a.flags|=1024),u=!1)}return p=u,fa(s,a),u=(a.flags&128)!==0,p||u?(p=a.stateNode,l=u&&typeof l.getDerivedStateFromError!="function"?null:p.render(),a.flags|=1,s!==null&&u?(a.child=Yn(a,s.child,null,d),a.child=Yn(a,null,l,d)):_t(s,a,l,d),a.memoizedState=p.state,s=a.child):s=Ui(s,a,d),s}function hm(s,a,l,u){return ea(),a.flags|=256,_t(s,a,l,u),a.child}var wf={dehydrated:null,treeContext:null,retryLane:0};function Rf(s){return{baseLanes:s,cachePool:g_()}}function xf(s,a,l){return s=s!==null?s.childLanes&~l:0,a&&(s|=Gt),s}function dm(s,a,l){var u=a.pendingProps,d=!1,p=(a.flags&128)!==0,b;if((b=p)||(b=s!==null&&s.memoizedState===null?!1:(ot.current&2)!==0),b&&(d=!0,a.flags&=-129),b=(a.flags&32)!==0,a.flags&=-33,s===null){if(ke){if(d?sn(a):rn(),ke){var S=pt,C;if(C=S){e:{for(C=S,S=_i;C.nodeType!==8;){if(!S){S=null;break e}if(C=oi(C.nextSibling),C===null){S=null;break e}}S=C}S!==null?(a.memoizedState={dehydrated:S,treeContext:Wn!==null?{id:Ii,overflow:Di}:null,retryLane:536870912},C=Qt(18,null,null,0),C.stateNode=S,C.return=a,a.child=C,xt=a,pt=null,C=!0):C=!1}C||$n(a)}if(S=a.memoizedState,S!==null&&(S=S.dehydrated,S!==null))return S.data==="$!"?a.lanes=16:a.lanes=536870912,null;ki(a)}return S=u.children,u=u.fallback,d?(rn(),d=a.mode,S=Mf({mode:"hidden",children:S},d),u=is(u,d,l,null),S.return=a,u.return=a,S.sibling=u,a.child=S,d=a.child,d.memoizedState=Rf(l),d.childLanes=xf(s,b,l),a.memoizedState=wf,u):(sn(a),Cf(a,S))}if(C=s.memoizedState,C!==null&&(S=C.dehydrated,S!==null)){if(p)a.flags&256?(sn(a),a.flags&=-257,a=Of(s,a,l)):a.memoizedState!==null?(rn(),a.child=s.child,a.flags|=128,a=null):(rn(),d=u.fallback,S=a.mode,u=Mf({mode:"visible",children:u.children},S),d=is(d,S,l,null),d.flags|=2,u.return=a,d.return=a,u.sibling=d,a.child=u,Yn(a,s.child,null,l),u=a.child,u.memoizedState=Rf(l),u.childLanes=xf(s,b,l),a.memoizedState=wf,a=d);else if(sn(a),S.data==="$!"){if(b=S.nextSibling&&S.nextSibling.dataset,b)var U=b.dgst;b=U,u=Error(n(419)),u.stack="",u.digest=b,ta({value:u,source:null,stack:null}),a=Of(s,a,l)}else if(ft||ha(s,a,l,!1),b=(l&s.childLanes)!==0,ft||b){if(b=We,b!==null){if(u=l&-l,u&42)u=1;else switch(u){case 2:u=1;break;case 8:u=4;break;case 32:u=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:u=64;break;case 268435456:u=134217728;break;default:u=0}if(u=u&(b.suspendedLanes|l)?0:u,u!==0&&u!==C.retryLane)throw C.retryLane=u,nn(s,u),Ct(b,s,u),sm}S.data==="$?"||sh(),a=Of(s,a,l)}else S.data==="$?"?(a.flags|=128,a.child=s.child,a=m1.bind(null,s),S._reactRetry=a,a=null):(s=C.treeContext,pt=oi(S.nextSibling),xt=a,ke=!0,ri=null,_i=!1,s!==null&&($t[Yt++]=Ii,$t[Yt++]=Di,$t[Yt++]=Wn,Ii=s.id,Di=s.overflow,Wn=a),a=Cf(a,u.children),a.flags|=4096);return a}return d?(rn(),d=u.fallback,S=a.mode,C=s.child,U=C.sibling,u=pn(C,{mode:"hidden",children:u.children}),u.subtreeFlags=C.subtreeFlags&31457280,U!==null?d=pn(U,d):(d=is(d,S,l,null),d.flags|=2),d.return=a,u.return=a,u.sibling=d,a.child=u,u=d,d=a.child,S=s.child.memoizedState,S===null?S=Rf(l):(C=S.cachePool,C!==null?(U=lt._currentValue,C=C.parent!==U?{parent:U,pool:U}:C):C=g_(),S={baseLanes:S.baseLanes|l,cachePool:C}),d.memoizedState=S,d.childLanes=xf(s,b,l),a.memoizedState=wf,u):(sn(a),l=s.child,s=l.sibling,l=pn(l,{mode:"visible",children:u.children}),l.return=a,l.sibling=null,s!==null&&(b=a.deletions,b===null?(a.deletions=[s],a.flags|=16):b.push(s)),a.child=l,a.memoizedState=null,l)}function Cf(s,a){return a=Mf({mode:"visible",children:a},s.mode),a.return=s,s.child=a}function Mf(s,a){return Lm(s,a,0,null)}function Of(s,a,l){return Yn(a,s.child,null,l),s=Cf(a,a.pendingProps.children),s.flags|=2,a.memoizedState=null,s}function gm(s,a,l){s.lanes|=a;var u=s.alternate;u!==null&&(u.lanes|=a),Df(s.return,a,l)}function Pf(s,a,l,u,d){var p=s.memoizedState;p===null?s.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:u,tail:l,tailMode:d}:(p.isBackwards=a,p.rendering=null,p.renderingStartTime=0,p.last=u,p.tail=l,p.tailMode=d)}function pm(s,a,l){var u=a.pendingProps,d=u.revealOrder,p=u.tail;if(_t(s,a,u.children,l),u=ot.current,u&2)u=u&1|2,a.flags|=128;else{if(s!==null&&s.flags&128)e:for(s=a.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&gm(s,l,a);else if(s.tag===19)gm(s,l,a);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===a)break e;for(;s.sibling===null;){if(s.return===null||s.return===a)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}u&=1}switch(ye(ot,u),d){case"forwards":for(l=a.child,d=null;l!==null;)s=l.alternate,s!==null&&$o(s)===null&&(d=l),l=l.sibling;l=d,l===null?(d=a.child,a.child=null):(d=l.sibling,l.sibling=null),Pf(a,!1,d,l,p);break;case"backwards":for(l=null,d=a.child,a.child=null;d!==null;){if(s=d.alternate,s!==null&&$o(s)===null){a.child=d;break}s=d.sibling,d.sibling=l,l=d,d=s}Pf(a,!0,l,null,p);break;case"together":Pf(a,!1,null,null,void 0);break;default:a.memoizedState=null}return a.child}function Ui(s,a,l){if(s!==null&&(a.dependencies=s.dependencies),_n|=a.lanes,!(l&a.childLanes))if(s!==null){if(ha(s,a,l,!1),(l&a.childLanes)===0)return null}else return null;if(s!==null&&a.child!==s.child)throw Error(n(153));if(a.child!==null){for(s=a.child,l=pn(s,s.pendingProps),a.child=l,l.return=a;s.sibling!==null;)s=s.sibling,l=l.sibling=pn(s,s.pendingProps),l.return=a;l.sibling=null}return a.child}function Nf(s,a){return s.lanes&a?!0:(s=s.dependencies,!!(s!==null&&sl(s)))}function n1(s,a,l){switch(a.tag){case 3:Ne(a,a.stateNode.containerInfo),ln(a,lt,s.memoizedState.cache),ea();break;case 27:case 5:Tu(a);break;case 4:Ne(a,a.stateNode.containerInfo);break;case 10:ln(a,a.type,a.memoizedProps.value);break;case 13:var u=a.memoizedState;if(u!==null)return u.dehydrated!==null?(sn(a),a.flags|=128,null):l&a.child.childLanes?dm(s,a,l):(sn(a),s=Ui(s,a,l),s!==null?s.sibling:null);sn(a);break;case 19:var d=(s.flags&128)!==0;if(u=(l&a.childLanes)!==0,u||(ha(s,a,l,!1),u=(l&a.childLanes)!==0),d){if(u)return pm(s,a,l);a.flags|=128}if(d=a.memoizedState,d!==null&&(d.rendering=null,d.tail=null,d.lastEffect=null),ye(ot,ot.current),u)break;return null;case 22:case 23:return a.lanes=0,lm(s,a,l);case 24:ln(a,lt,s.memoizedState.cache)}return Ui(s,a,l)}function _m(s,a,l){if(s!==null)if(s.memoizedProps!==a.pendingProps)ft=!0;else{if(!Nf(s,l)&&!(a.flags&128))return ft=!1,n1(s,a,l);ft=!!(s.flags&131072)}else ft=!1,ke&&a.flags&1048576&&e_(a,Vo,a.index);switch(a.lanes=0,a.tag){case 16:e:{s=a.pendingProps;var u=a.elementType,d=u._init;if(u=d(u._payload),a.type=u,typeof u=="function")$f(u)?(s=Gn(u,s),a.tag=1,a=fm(null,a,u,s,l)):(a.tag=0,a=Ef(null,a,u,s,l));else{if(u!=null){if(d=u.$$typeof,d===R){a.tag=11,a=rm(null,a,u,s,l);break e}else if(d===N){a.tag=14,a=am(null,a,u,s,l);break e}}throw a=oe(u)||u,Error(n(306,a,""))}}return a;case 0:return Ef(s,a,a.type,a.pendingProps,l);case 1:return u=a.type,d=Gn(u,a.pendingProps),fm(s,a,u,d,l);case 3:e:{if(Ne(a,a.stateNode.containerInfo),s===null)throw Error(n(387));var p=a.pendingProps;d=a.memoizedState,u=d.element,Uf(s,a),pa(a,p,null,l);var b=a.memoizedState;if(p=b.cache,ln(a,lt,p),p!==d.cache&&kf(a,[lt],l,!0),ga(),p=b.element,d.isDehydrated)if(d={element:p,isDehydrated:!1,cache:b.cache},a.updateQueue.baseState=d,a.memoizedState=d,a.flags&256){a=hm(s,a,p,l);break e}else if(p!==u){u=Xt(Error(n(424)),a),ta(u),a=hm(s,a,p,l);break e}else for(pt=oi(a.stateNode.containerInfo.firstChild),xt=a,ke=!0,ri=null,_i=!0,l=c_(a,null,p,l),a.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling;else{if(ea(),p===u){a=Ui(s,a,l);break e}_t(s,a,p,l)}a=a.child}return a;case 26:return fa(s,a),s===null?(l=by(a.type,null,a.pendingProps,null))?a.memoizedState=l:ke||(l=a.type,s=a.pendingProps,u=vl(ni.current).createElement(l),u[St]=a,u[Mt]=s,mt(u,l,s),ut(u),a.stateNode=u):a.memoizedState=by(a.type,s.memoizedProps,a.pendingProps,s.memoizedState),null;case 27:return Tu(a),s===null&&ke&&(u=a.stateNode=_y(a.type,a.pendingProps,ni.current),xt=a,_i=!0,pt=oi(u.firstChild)),u=a.pendingProps.children,s!==null||ke?_t(s,a,u,l):a.child=Yn(a,null,u,l),fa(s,a),a.child;case 5:return s===null&&ke&&((d=u=pt)&&(u=I1(u,a.type,a.pendingProps,_i),u!==null?(a.stateNode=u,xt=a,pt=oi(u.firstChild),_i=!1,d=!0):d=!1),d||$n(a)),Tu(a),d=a.type,p=a.pendingProps,b=s!==null?s.memoizedProps:null,u=p.children,yh(d,p)?u=null:b!==null&&yh(d,b)&&(a.flags|=32),a.memoizedState!==null&&(d=af(s,a,ZE,null,null,l),Oa._currentValue=d),fa(s,a),_t(s,a,u,l),a.child;case 6:return s===null&&ke&&((s=l=pt)&&(l=D1(l,a.pendingProps,_i),l!==null?(a.stateNode=l,xt=a,pt=null,s=!0):s=!1),s||$n(a)),null;case 13:return dm(s,a,l);case 4:return Ne(a,a.stateNode.containerInfo),u=a.pendingProps,s===null?a.child=Yn(a,null,u,l):_t(s,a,u,l),a.child;case 11:return rm(s,a,a.type,a.pendingProps,l);case 7:return _t(s,a,a.pendingProps,l),a.child;case 8:return _t(s,a,a.pendingProps.children,l),a.child;case 12:return _t(s,a,a.pendingProps.children,l),a.child;case 10:return u=a.pendingProps,ln(a,a.type,u.value),_t(s,a,u.children,l),a.child;case 9:return d=a.type._context,u=a.pendingProps.children,es(a),d=At(d),u=u(d),a.flags|=1,_t(s,a,u,l),a.child;case 14:return am(s,a,a.type,a.pendingProps,l);case 15:return om(s,a,a.type,a.pendingProps,l);case 19:return pm(s,a,l);case 22:return lm(s,a,l);case 24:return es(a),u=At(lt),s===null?(d=sf(),d===null&&(d=We,p=tf(),d.pooledCache=p,p.refCount++,p!==null&&(d.pooledCacheLanes|=l),d=p),a.memoizedState={parent:u,cache:d},Bf(a),ln(a,lt,d)):(s.lanes&l&&(Uf(s,a),pa(a,null,null,l),ga()),d=s.memoizedState,p=a.memoizedState,d.parent!==u?(d={parent:u,cache:u},a.memoizedState=d,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=d),ln(a,lt,u)):(u=p.cache,ln(a,lt,u),u!==d.cache&&kf(a,[lt],l,!0))),_t(s,a,a.pendingProps.children,l),a.child;case 29:throw a.pendingProps}throw Error(n(156,a.tag))}var If=he(null),Jn=null,Fi=null;function ln(s,a,l){ye(If,a._currentValue),a._currentValue=l}function Li(s){s._currentValue=If.current,xe(If)}function Df(s,a,l){for(;s!==null;){var u=s.alternate;if((s.childLanes&a)!==a?(s.childLanes|=a,u!==null&&(u.childLanes|=a)):u!==null&&(u.childLanes&a)!==a&&(u.childLanes|=a),s===l)break;s=s.return}}function kf(s,a,l,u){var d=s.child;for(d!==null&&(d.return=s);d!==null;){var p=d.dependencies;if(p!==null){var b=d.child;p=p.firstContext;e:for(;p!==null;){var S=p;p=d;for(var C=0;C<a.length;C++)if(S.context===a[C]){p.lanes|=l,S=p.alternate,S!==null&&(S.lanes|=l),Df(p.return,l,s),u||(b=null);break e}p=S.next}}else if(d.tag===18){if(b=d.return,b===null)throw Error(n(341));b.lanes|=l,p=b.alternate,p!==null&&(p.lanes|=l),Df(b,l,s),b=null}else b=d.child;if(b!==null)b.return=d;else for(b=d;b!==null;){if(b===s){b=null;break}if(d=b.sibling,d!==null){d.return=b.return,b=d;break}b=b.return}d=b}}function ha(s,a,l,u){s=null;for(var d=a,p=!1;d!==null;){if(!p){if(d.flags&524288)p=!0;else if(d.flags&262144)break}if(d.tag===10){var b=d.alternate;if(b===null)throw Error(n(387));if(b=b.memoizedProps,b!==null){var S=d.type;kt(d.pendingProps.value,b.value)||(s!==null?s.push(S):s=[S])}}else if(d===Un.current){if(b=d.alternate,b===null)throw Error(n(387));b.memoizedState.memoizedState!==d.memoizedState.memoizedState&&(s!==null?s.push(Oa):s=[Oa])}d=d.return}s!==null&&kf(a,s,l,u),a.flags|=262144}function sl(s){for(s=s.firstContext;s!==null;){if(!kt(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function es(s){Jn=s,Fi=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function At(s){return mm(Jn,s)}function rl(s,a){return Jn===null&&es(s),mm(s,a)}function mm(s,a){var l=a._currentValue;if(a={context:a,memoizedValue:l,next:null},Fi===null){if(s===null)throw Error(n(308));Fi=a,s.dependencies={lanes:0,firstContext:a},s.flags|=524288}else Fi=Fi.next=a;return l}var cn=!1;function Bf(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Uf(s,a){s=s.updateQueue,a.updateQueue===s&&(a.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function un(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function fn(s,a,l){var u=s.updateQueue;if(u===null)return null;if(u=u.shared,Ke&2){var d=u.pending;return d===null?a.next=a:(a.next=d.next,d.next=a),u.pending=a,a=Lo(s),Gp(s,null,l),a}return Fo(s,u,a,l),Lo(s)}function da(s,a,l){if(a=a.updateQueue,a!==null&&(a=a.shared,(l&4194176)!==0)){var u=a.lanes;u&=s.pendingLanes,l|=u,a.lanes=l,ap(s,l)}}function Ff(s,a){var l=s.updateQueue,u=s.alternate;if(u!==null&&(u=u.updateQueue,l===u)){var d=null,p=null;if(l=l.firstBaseUpdate,l!==null){do{var b={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};p===null?d=p=b:p=p.next=b,l=l.next}while(l!==null);p===null?d=p=a:p=p.next=a}else d=p=a;l={baseState:u.baseState,firstBaseUpdate:d,lastBaseUpdate:p,shared:u.shared,callbacks:u.callbacks},s.updateQueue=l;return}s=l.lastBaseUpdate,s===null?l.firstBaseUpdate=a:s.next=a,l.lastBaseUpdate=a}var Lf=!1;function ga(){if(Lf){var s=Ws;if(s!==null)throw s}}function pa(s,a,l,u){Lf=!1;var d=s.updateQueue;cn=!1;var p=d.firstBaseUpdate,b=d.lastBaseUpdate,S=d.shared.pending;if(S!==null){d.shared.pending=null;var C=S,U=C.next;C.next=null,b===null?p=U:b.next=U,b=C;var Q=s.alternate;Q!==null&&(Q=Q.updateQueue,S=Q.lastBaseUpdate,S!==b&&(S===null?Q.firstBaseUpdate=U:S.next=U,Q.lastBaseUpdate=C))}if(p!==null){var ne=d.baseState;b=0,Q=U=C=null,S=p;do{var $=S.lane&-536870913,Z=$!==S.lane;if(Z?(De&$)===$:(u&$)===$){$!==0&&$===js&&(Lf=!0),Q!==null&&(Q=Q.next={lane:0,tag:S.tag,payload:S.payload,callback:null,next:null});e:{var pe=s,Se=S;$=a;var Ge=l;switch(Se.tag){case 1:if(pe=Se.payload,typeof pe=="function"){ne=pe.call(Ge,ne,$);break e}ne=pe;break e;case 3:pe.flags=pe.flags&-65537|128;case 0:if(pe=Se.payload,$=typeof pe=="function"?pe.call(Ge,ne,$):pe,$==null)break e;ne=ae({},ne,$);break e;case 2:cn=!0}}$=S.callback,$!==null&&(s.flags|=64,Z&&(s.flags|=8192),Z=d.callbacks,Z===null?d.callbacks=[$]:Z.push($))}else Z={lane:$,tag:S.tag,payload:S.payload,callback:S.callback,next:null},Q===null?(U=Q=Z,C=ne):Q=Q.next=Z,b|=$;if(S=S.next,S===null){if(S=d.shared.pending,S===null)break;Z=S,S=Z.next,Z.next=null,d.lastBaseUpdate=Z,d.shared.pending=null}}while(!0);Q===null&&(C=ne),d.baseState=C,d.firstBaseUpdate=U,d.lastBaseUpdate=Q,p===null&&(d.shared.lanes=0),_n|=b,s.lanes=b,s.memoizedState=ne}}function ym(s,a){if(typeof s!="function")throw Error(n(191,s));s.call(a)}function bm(s,a){var l=s.callbacks;if(l!==null)for(s.callbacks=null,s=0;s<l.length;s++)ym(l[s],a)}function _a(s,a){try{var l=a.updateQueue,u=l!==null?l.lastEffect:null;if(u!==null){var d=u.next;l=d;do{if((l.tag&s)===s){u=void 0;var p=l.create,b=l.inst;u=p(),b.destroy=u}l=l.next}while(l!==d)}}catch(S){He(a,a.return,S)}}function hn(s,a,l){try{var u=a.updateQueue,d=u!==null?u.lastEffect:null;if(d!==null){var p=d.next;u=p;do{if((u.tag&s)===s){var b=u.inst,S=b.destroy;if(S!==void 0){b.destroy=void 0,d=a;var C=l;try{S()}catch(U){He(d,C,U)}}}u=u.next}while(u!==p)}}catch(U){He(a,a.return,U)}}function vm(s){var a=s.updateQueue;if(a!==null){var l=s.stateNode;try{bm(a,l)}catch(u){He(s,s.return,u)}}}function Tm(s,a,l){l.props=Gn(s.type,s.memoizedProps),l.state=s.memoizedState;try{l.componentWillUnmount()}catch(u){He(s,a,u)}}function ts(s,a){try{var l=s.ref;if(l!==null){var u=s.stateNode;switch(s.tag){case 26:case 27:case 5:var d=u;break;default:d=u}typeof l=="function"?s.refCleanup=l(d):l.current=d}}catch(p){He(s,a,p)}}function Bt(s,a){var l=s.ref,u=s.refCleanup;if(l!==null)if(typeof u=="function")try{u()}catch(d){He(s,a,d)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(d){He(s,a,d)}else l.current=null}function Sm(s){var a=s.type,l=s.memoizedProps,u=s.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":l.autoFocus&&u.focus();break e;case"img":l.src?u.src=l.src:l.srcSet&&(u.srcset=l.srcSet)}}catch(d){He(s,s.return,d)}}function Am(s,a,l){try{var u=s.stateNode;C1(u,s.type,l,a),u[Mt]=a}catch(d){He(s,s.return,d)}}function Em(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27||s.tag===4}function zf(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||Em(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==27&&s.tag!==18;){if(s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Vf(s,a,l){var u=s.tag;if(u===5||u===6)s=s.stateNode,a?l.nodeType===8?l.parentNode.insertBefore(s,a):l.insertBefore(s,a):(l.nodeType===8?(a=l.parentNode,a.insertBefore(s,l)):(a=l,a.appendChild(s)),l=l._reactRootContainer,l!=null||a.onclick!==null||(a.onclick=bl));else if(u!==4&&u!==27&&(s=s.child,s!==null))for(Vf(s,a,l),s=s.sibling;s!==null;)Vf(s,a,l),s=s.sibling}function al(s,a,l){var u=s.tag;if(u===5||u===6)s=s.stateNode,a?l.insertBefore(s,a):l.appendChild(s);else if(u!==4&&u!==27&&(s=s.child,s!==null))for(al(s,a,l),s=s.sibling;s!==null;)al(s,a,l),s=s.sibling}var zi=!1,Ze=!1,Hf=!1,wm=typeof WeakSet=="function"?WeakSet:Set,ht=null,Rm=!1;function s1(s,a){if(s=s.containerInfo,_h=Rl,s=jp(s),ju(s)){if("selectionStart"in s)var l={start:s.selectionStart,end:s.selectionEnd};else e:{l=(l=s.ownerDocument)&&l.defaultView||window;var u=l.getSelection&&l.getSelection();if(u&&u.rangeCount!==0){l=u.anchorNode;var d=u.anchorOffset,p=u.focusNode;u=u.focusOffset;try{l.nodeType,p.nodeType}catch{l=null;break e}var b=0,S=-1,C=-1,U=0,Q=0,ne=s,$=null;t:for(;;){for(var Z;ne!==l||d!==0&&ne.nodeType!==3||(S=b+d),ne!==p||u!==0&&ne.nodeType!==3||(C=b+u),ne.nodeType===3&&(b+=ne.nodeValue.length),(Z=ne.firstChild)!==null;)$=ne,ne=Z;for(;;){if(ne===s)break t;if($===l&&++U===d&&(S=b),$===p&&++Q===u&&(C=b),(Z=ne.nextSibling)!==null)break;ne=$,$=ne.parentNode}ne=Z}l=S===-1||C===-1?null:{start:S,end:C}}else l=null}l=l||{start:0,end:0}}else l=null;for(mh={focusedElem:s,selectionRange:l},Rl=!1,ht=a;ht!==null;)if(a=ht,s=a.child,(a.subtreeFlags&1028)!==0&&s!==null)s.return=a,ht=s;else for(;ht!==null;){switch(a=ht,p=a.alternate,s=a.flags,a.tag){case 0:break;case 11:case 15:break;case 1:if(s&1024&&p!==null){s=void 0,l=a,d=p.memoizedProps,p=p.memoizedState,u=l.stateNode;try{var pe=Gn(l.type,d,l.elementType===l.type);s=u.getSnapshotBeforeUpdate(pe,p),u.__reactInternalSnapshotBeforeUpdate=s}catch(Se){He(l,l.return,Se)}}break;case 3:if(s&1024){if(s=a.stateNode.containerInfo,l=s.nodeType,l===9)Th(s);else if(l===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":Th(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if(s&1024)throw Error(n(163))}if(s=a.sibling,s!==null){s.return=a.return,ht=s;break}ht=a.return}return pe=Rm,Rm=!1,pe}function xm(s,a,l){var u=l.flags;switch(l.tag){case 0:case 11:case 15:Hi(s,l),u&4&&_a(5,l);break;case 1:if(Hi(s,l),u&4)if(s=l.stateNode,a===null)try{s.componentDidMount()}catch(S){He(l,l.return,S)}else{var d=Gn(l.type,a.memoizedProps);a=a.memoizedState;try{s.componentDidUpdate(d,a,s.__reactInternalSnapshotBeforeUpdate)}catch(S){He(l,l.return,S)}}u&64&&vm(l),u&512&&ts(l,l.return);break;case 3:if(Hi(s,l),u&64&&(u=l.updateQueue,u!==null)){if(s=null,l.child!==null)switch(l.child.tag){case 27:case 5:s=l.child.stateNode;break;case 1:s=l.child.stateNode}try{bm(u,s)}catch(S){He(l,l.return,S)}}break;case 26:Hi(s,l),u&512&&ts(l,l.return);break;case 27:case 5:Hi(s,l),a===null&&u&4&&Sm(l),u&512&&ts(l,l.return);break;case 12:Hi(s,l);break;case 13:Hi(s,l),u&4&&Om(s,l);break;case 22:if(d=l.memoizedState!==null||zi,!d){a=a!==null&&a.memoizedState!==null||Ze;var p=zi,b=Ze;zi=d,(Ze=a)&&!b?dn(s,l,(l.subtreeFlags&8772)!==0):Hi(s,l),zi=p,Ze=b}u&512&&(l.memoizedProps.mode==="manual"?ts(l,l.return):Bt(l,l.return));break;default:Hi(s,l)}}function Cm(s){var a=s.alternate;a!==null&&(s.alternate=null,Cm(a)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(a=s.stateNode,a!==null&&xu(a)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var st=null,Ut=!1;function Vi(s,a,l){for(l=l.child;l!==null;)Mm(s,a,l),l=l.sibling}function Mm(s,a,l){if(It&&typeof It.onCommitFiberUnmount=="function")try{It.onCommitFiberUnmount(Lr,l)}catch{}switch(l.tag){case 26:Ze||Bt(l,a),Vi(s,a,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:Ze||Bt(l,a);var u=st,d=Ut;for(st=l.stateNode,Vi(s,a,l),l=l.stateNode,a=l.attributes;a.length;)l.removeAttributeNode(a[0]);xu(l),st=u,Ut=d;break;case 5:Ze||Bt(l,a);case 6:d=st;var p=Ut;if(st=null,Vi(s,a,l),st=d,Ut=p,st!==null)if(Ut)try{s=st,u=l.stateNode,s.nodeType===8?s.parentNode.removeChild(u):s.removeChild(u)}catch(b){He(l,a,b)}else try{st.removeChild(l.stateNode)}catch(b){He(l,a,b)}break;case 18:st!==null&&(Ut?(a=st,l=l.stateNode,a.nodeType===8?vh(a.parentNode,l):a.nodeType===1&&vh(a,l),Da(a)):vh(st,l.stateNode));break;case 4:u=st,d=Ut,st=l.stateNode.containerInfo,Ut=!0,Vi(s,a,l),st=u,Ut=d;break;case 0:case 11:case 14:case 15:Ze||hn(2,l,a),Ze||hn(4,l,a),Vi(s,a,l);break;case 1:Ze||(Bt(l,a),u=l.stateNode,typeof u.componentWillUnmount=="function"&&Tm(l,a,u)),Vi(s,a,l);break;case 21:Vi(s,a,l);break;case 22:Ze||Bt(l,a),Ze=(u=Ze)||l.memoizedState!==null,Vi(s,a,l),Ze=u;break;default:Vi(s,a,l)}}function Om(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{Da(s)}catch(l){He(a,a.return,l)}}function r1(s){switch(s.tag){case 13:case 19:var a=s.stateNode;return a===null&&(a=s.stateNode=new wm),a;case 22:return s=s.stateNode,a=s._retryCache,a===null&&(a=s._retryCache=new wm),a;default:throw Error(n(435,s.tag))}}function jf(s,a){var l=r1(s);a.forEach(function(u){var d=y1.bind(null,s,u);l.has(u)||(l.add(u),u.then(d,d))})}function Kt(s,a){var l=a.deletions;if(l!==null)for(var u=0;u<l.length;u++){var d=l[u],p=s,b=a,S=b;e:for(;S!==null;){switch(S.tag){case 27:case 5:st=S.stateNode,Ut=!1;break e;case 3:st=S.stateNode.containerInfo,Ut=!0;break e;case 4:st=S.stateNode.containerInfo,Ut=!0;break e}S=S.return}if(st===null)throw Error(n(160));Mm(p,b,d),st=null,Ut=!1,p=d.alternate,p!==null&&(p.return=null),d.return=null}if(a.subtreeFlags&13878)for(a=a.child;a!==null;)Pm(a,s),a=a.sibling}var ai=null;function Pm(s,a){var l=s.alternate,u=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:Kt(a,s),Zt(s),u&4&&(hn(3,s,s.return),_a(3,s),hn(5,s,s.return));break;case 1:Kt(a,s),Zt(s),u&512&&(Ze||l===null||Bt(l,l.return)),u&64&&zi&&(s=s.updateQueue,s!==null&&(u=s.callbacks,u!==null&&(l=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=l===null?u:l.concat(u))));break;case 26:var d=ai;if(Kt(a,s),Zt(s),u&512&&(Ze||l===null||Bt(l,l.return)),u&4){var p=l!==null?l.memoizedState:null;if(u=s.memoizedState,l===null)if(u===null)if(s.stateNode===null){e:{u=s.type,l=s.memoizedProps,d=d.ownerDocument||d;t:switch(u){case"title":p=d.getElementsByTagName("title")[0],(!p||p[Hr]||p[St]||p.namespaceURI==="http://www.w3.org/2000/svg"||p.hasAttribute("itemprop"))&&(p=d.createElement(u),d.head.insertBefore(p,d.querySelector("head > title"))),mt(p,u,l),p[St]=s,ut(p),u=p;break e;case"link":var b=Sy("link","href",d).get(u+(l.href||""));if(b){for(var S=0;S<b.length;S++)if(p=b[S],p.getAttribute("href")===(l.href==null?null:l.href)&&p.getAttribute("rel")===(l.rel==null?null:l.rel)&&p.getAttribute("title")===(l.title==null?null:l.title)&&p.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){b.splice(S,1);break t}}p=d.createElement(u),mt(p,u,l),d.head.appendChild(p);break;case"meta":if(b=Sy("meta","content",d).get(u+(l.content||""))){for(S=0;S<b.length;S++)if(p=b[S],p.getAttribute("content")===(l.content==null?null:""+l.content)&&p.getAttribute("name")===(l.name==null?null:l.name)&&p.getAttribute("property")===(l.property==null?null:l.property)&&p.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&p.getAttribute("charset")===(l.charSet==null?null:l.charSet)){b.splice(S,1);break t}}p=d.createElement(u),mt(p,u,l),d.head.appendChild(p);break;default:throw Error(n(468,u))}p[St]=s,ut(p),u=p}s.stateNode=u}else Ay(d,s.type,s.stateNode);else s.stateNode=Ty(d,u,s.memoizedProps);else p!==u?(p===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):p.count--,u===null?Ay(d,s.type,s.stateNode):Ty(d,u,s.memoizedProps)):u===null&&s.stateNode!==null&&Am(s,s.memoizedProps,l.memoizedProps)}break;case 27:if(u&4&&s.alternate===null){d=s.stateNode,p=s.memoizedProps;try{for(var C=d.firstChild;C;){var U=C.nextSibling,Q=C.nodeName;C[Hr]||Q==="HEAD"||Q==="BODY"||Q==="SCRIPT"||Q==="STYLE"||Q==="LINK"&&C.rel.toLowerCase()==="stylesheet"||d.removeChild(C),C=U}for(var ne=s.type,$=d.attributes;$.length;)d.removeAttributeNode($[0]);mt(d,ne,p),d[St]=s,d[Mt]=p}catch(pe){He(s,s.return,pe)}}case 5:if(Kt(a,s),Zt(s),u&512&&(Ze||l===null||Bt(l,l.return)),s.flags&32){d=s.stateNode;try{Ps(d,"")}catch(pe){He(s,s.return,pe)}}u&4&&s.stateNode!=null&&(d=s.memoizedProps,Am(s,d,l!==null?l.memoizedProps:d)),u&1024&&(Hf=!0);break;case 6:if(Kt(a,s),Zt(s),u&4){if(s.stateNode===null)throw Error(n(162));u=s.memoizedProps,l=s.stateNode;try{l.nodeValue=u}catch(pe){He(s,s.return,pe)}}break;case 3:if(Al=null,d=ai,ai=Tl(a.containerInfo),Kt(a,s),ai=d,Zt(s),u&4&&l!==null&&l.memoizedState.isDehydrated)try{Da(a.containerInfo)}catch(pe){He(s,s.return,pe)}Hf&&(Hf=!1,Nm(s));break;case 4:u=ai,ai=Tl(s.stateNode.containerInfo),Kt(a,s),Zt(s),ai=u;break;case 12:Kt(a,s),Zt(s);break;case 13:Kt(a,s),Zt(s),s.child.flags&8192&&s.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&(Gf=pi()),u&4&&(u=s.updateQueue,u!==null&&(s.updateQueue=null,jf(s,u)));break;case 22:if(u&512&&(Ze||l===null||Bt(l,l.return)),C=s.memoizedState!==null,U=l!==null&&l.memoizedState!==null,Q=zi,ne=Ze,zi=Q||C,Ze=ne||U,Kt(a,s),Ze=ne,zi=Q,Zt(s),a=s.stateNode,a._current=s,a._visibility&=-3,a._visibility|=a._pendingVisibility&2,u&8192&&(a._visibility=C?a._visibility&-2:a._visibility|1,C&&(a=zi||Ze,l===null||U||a||qs(s)),s.memoizedProps===null||s.memoizedProps.mode!=="manual"))e:for(l=null,a=s;;){if(a.tag===5||a.tag===26||a.tag===27){if(l===null){U=l=a;try{if(d=U.stateNode,C)p=d.style,typeof p.setProperty=="function"?p.setProperty("display","none","important"):p.display="none";else{b=U.stateNode,S=U.memoizedProps.style;var Z=S!=null&&S.hasOwnProperty("display")?S.display:null;b.style.display=Z==null||typeof Z=="boolean"?"":(""+Z).trim()}}catch(pe){He(U,U.return,pe)}}}else if(a.tag===6){if(l===null){U=a;try{U.stateNode.nodeValue=C?"":U.memoizedProps}catch(pe){He(U,U.return,pe)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===s)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break e;for(;a.sibling===null;){if(a.return===null||a.return===s)break e;l===a&&(l=null),a=a.return}l===a&&(l=null),a.sibling.return=a.return,a=a.sibling}u&4&&(u=s.updateQueue,u!==null&&(l=u.retryQueue,l!==null&&(u.retryQueue=null,jf(s,l))));break;case 19:Kt(a,s),Zt(s),u&4&&(u=s.updateQueue,u!==null&&(s.updateQueue=null,jf(s,u)));break;case 21:break;default:Kt(a,s),Zt(s)}}function Zt(s){var a=s.flags;if(a&2){try{if(s.tag!==27){e:{for(var l=s.return;l!==null;){if(Em(l)){var u=l;break e}l=l.return}throw Error(n(160))}switch(u.tag){case 27:var d=u.stateNode,p=zf(s);al(s,p,d);break;case 5:var b=u.stateNode;u.flags&32&&(Ps(b,""),u.flags&=-33);var S=zf(s);al(s,S,b);break;case 3:case 4:var C=u.stateNode.containerInfo,U=zf(s);Vf(s,U,C);break;default:throw Error(n(161))}}}catch(Q){He(s,s.return,Q)}s.flags&=-3}a&4096&&(s.flags&=-4097)}function Nm(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var a=s;Nm(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),s=s.sibling}}function Hi(s,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)xm(s,a.alternate,a),a=a.sibling}function qs(s){for(s=s.child;s!==null;){var a=s;switch(a.tag){case 0:case 11:case 14:case 15:hn(4,a,a.return),qs(a);break;case 1:Bt(a,a.return);var l=a.stateNode;typeof l.componentWillUnmount=="function"&&Tm(a,a.return,l),qs(a);break;case 26:case 27:case 5:Bt(a,a.return),qs(a);break;case 22:Bt(a,a.return),a.memoizedState===null&&qs(a);break;default:qs(a)}s=s.sibling}}function dn(s,a,l){for(l=l&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var u=a.alternate,d=s,p=a,b=p.flags;switch(p.tag){case 0:case 11:case 15:dn(d,p,l),_a(4,p);break;case 1:if(dn(d,p,l),u=p,d=u.stateNode,typeof d.componentDidMount=="function")try{d.componentDidMount()}catch(U){He(u,u.return,U)}if(u=p,d=u.updateQueue,d!==null){var S=u.stateNode;try{var C=d.shared.hiddenCallbacks;if(C!==null)for(d.shared.hiddenCallbacks=null,d=0;d<C.length;d++)ym(C[d],S)}catch(U){He(u,u.return,U)}}l&&b&64&&vm(p),ts(p,p.return);break;case 26:case 27:case 5:dn(d,p,l),l&&u===null&&b&4&&Sm(p),ts(p,p.return);break;case 12:dn(d,p,l);break;case 13:dn(d,p,l),l&&b&4&&Om(d,p);break;case 22:p.memoizedState===null&&dn(d,p,l),ts(p,p.return);break;default:dn(d,p,l)}a=a.sibling}}function Wf(s,a){var l=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(l=s.memoizedState.cachePool.pool),s=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(s=a.memoizedState.cachePool.pool),s!==l&&(s!=null&&s.refCount++,l!=null&&aa(l))}function Xf(s,a){s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&aa(s))}function gn(s,a,l,u){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)Im(s,a,l,u),a=a.sibling}function Im(s,a,l,u){var d=a.flags;switch(a.tag){case 0:case 11:case 15:gn(s,a,l,u),d&2048&&_a(9,a);break;case 3:gn(s,a,l,u),d&2048&&(s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&aa(s)));break;case 12:if(d&2048){gn(s,a,l,u),s=a.stateNode;try{var p=a.memoizedProps,b=p.id,S=p.onPostCommit;typeof S=="function"&&S(b,a.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(C){He(a,a.return,C)}}else gn(s,a,l,u);break;case 23:break;case 22:p=a.stateNode,a.memoizedState!==null?p._visibility&4?gn(s,a,l,u):ma(s,a):p._visibility&4?gn(s,a,l,u):(p._visibility|=4,Ks(s,a,l,u,(a.subtreeFlags&10256)!==0)),d&2048&&Wf(a.alternate,a);break;case 24:gn(s,a,l,u),d&2048&&Xf(a.alternate,a);break;default:gn(s,a,l,u)}}function Ks(s,a,l,u,d){for(d=d&&(a.subtreeFlags&10256)!==0,a=a.child;a!==null;){var p=s,b=a,S=l,C=u,U=b.flags;switch(b.tag){case 0:case 11:case 15:Ks(p,b,S,C,d),_a(8,b);break;case 23:break;case 22:var Q=b.stateNode;b.memoizedState!==null?Q._visibility&4?Ks(p,b,S,C,d):ma(p,b):(Q._visibility|=4,Ks(p,b,S,C,d)),d&&U&2048&&Wf(b.alternate,b);break;case 24:Ks(p,b,S,C,d),d&&U&2048&&Xf(b.alternate,b);break;default:Ks(p,b,S,C,d)}a=a.sibling}}function ma(s,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var l=s,u=a,d=u.flags;switch(u.tag){case 22:ma(l,u),d&2048&&Wf(u.alternate,u);break;case 24:ma(l,u),d&2048&&Xf(u.alternate,u);break;default:ma(l,u)}a=a.sibling}}var ya=8192;function Zs(s){if(s.subtreeFlags&ya)for(s=s.child;s!==null;)Dm(s),s=s.sibling}function Dm(s){switch(s.tag){case 26:Zs(s),s.flags&ya&&s.memoizedState!==null&&Y1(ai,s.memoizedState,s.memoizedProps);break;case 5:Zs(s);break;case 3:case 4:var a=ai;ai=Tl(s.stateNode.containerInfo),Zs(s),ai=a;break;case 22:s.memoizedState===null&&(a=s.alternate,a!==null&&a.memoizedState!==null?(a=ya,ya=16777216,Zs(s),ya=a):Zs(s));break;default:Zs(s)}}function km(s){var a=s.alternate;if(a!==null&&(s=a.child,s!==null)){a.child=null;do a=s.sibling,s.sibling=null,s=a;while(s!==null)}}function ba(s){var a=s.deletions;if(s.flags&16){if(a!==null)for(var l=0;l<a.length;l++){var u=a[l];ht=u,Um(u,s)}km(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Bm(s),s=s.sibling}function Bm(s){switch(s.tag){case 0:case 11:case 15:ba(s),s.flags&2048&&hn(9,s,s.return);break;case 3:ba(s);break;case 12:ba(s);break;case 22:var a=s.stateNode;s.memoizedState!==null&&a._visibility&4&&(s.return===null||s.return.tag!==13)?(a._visibility&=-5,ol(s)):ba(s);break;default:ba(s)}}function ol(s){var a=s.deletions;if(s.flags&16){if(a!==null)for(var l=0;l<a.length;l++){var u=a[l];ht=u,Um(u,s)}km(s)}for(s=s.child;s!==null;){switch(a=s,a.tag){case 0:case 11:case 15:hn(8,a,a.return),ol(a);break;case 22:l=a.stateNode,l._visibility&4&&(l._visibility&=-5,ol(a));break;default:ol(a)}s=s.sibling}}function Um(s,a){for(;ht!==null;){var l=ht;switch(l.tag){case 0:case 11:case 15:hn(8,l,a);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var u=l.memoizedState.cachePool.pool;u!=null&&u.refCount++}break;case 24:aa(l.memoizedState.cache)}if(u=l.child,u!==null)u.return=l,ht=u;else e:for(l=s;ht!==null;){u=ht;var d=u.sibling,p=u.return;if(Cm(u),u===l){ht=null;break e}if(d!==null){d.return=p,ht=d;break e}ht=p}}}function a1(s,a,l,u){this.tag=s,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=u,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Qt(s,a,l,u){return new a1(s,a,l,u)}function $f(s){return s=s.prototype,!(!s||!s.isReactComponent)}function pn(s,a){var l=s.alternate;return l===null?(l=Qt(s.tag,a,s.key,s.mode),l.elementType=s.elementType,l.type=s.type,l.stateNode=s.stateNode,l.alternate=s,s.alternate=l):(l.pendingProps=a,l.type=s.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=s.flags&31457280,l.childLanes=s.childLanes,l.lanes=s.lanes,l.child=s.child,l.memoizedProps=s.memoizedProps,l.memoizedState=s.memoizedState,l.updateQueue=s.updateQueue,a=s.dependencies,l.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},l.sibling=s.sibling,l.index=s.index,l.ref=s.ref,l.refCleanup=s.refCleanup,l}function Fm(s,a){s.flags&=31457282;var l=s.alternate;return l===null?(s.childLanes=0,s.lanes=a,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=l.memoizedProps,s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,a=l.dependencies,s.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),s}function ll(s,a,l,u,d,p){var b=0;if(u=s,typeof s=="function")$f(s)&&(b=1);else if(typeof s=="string")b=X1(s,l,Tt.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case h:return is(l.children,d,p,a);case g:b=8,d|=24;break;case _:return s=Qt(12,l,a,d|2),s.elementType=_,s.lanes=p,s;case x:return s=Qt(13,l,a,d),s.elementType=x,s.lanes=p,s;case O:return s=Qt(19,l,a,d),s.elementType=O,s.lanes=p,s;case P:return Lm(l,d,p,a);default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case m:case T:b=10;break e;case y:b=9;break e;case R:b=11;break e;case N:b=14;break e;case B:b=16,u=null;break e}b=29,l=Error(n(130,s===null?"null":typeof s,"")),u=null}return a=Qt(b,l,a,d),a.elementType=s,a.type=u,a.lanes=p,a}function is(s,a,l,u){return s=Qt(7,s,u,a),s.lanes=l,s}function Lm(s,a,l,u){s=Qt(22,s,u,a),s.elementType=P,s.lanes=l;var d={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var p=d._current;if(p===null)throw Error(n(456));if(!(d._pendingVisibility&2)){var b=nn(p,2);b!==null&&(d._pendingVisibility|=2,Ct(b,p,2))}},attach:function(){var p=d._current;if(p===null)throw Error(n(456));if(d._pendingVisibility&2){var b=nn(p,2);b!==null&&(d._pendingVisibility&=-3,Ct(b,p,2))}}};return s.stateNode=d,s}function Yf(s,a,l){return s=Qt(6,s,null,a),s.lanes=l,s}function qf(s,a,l){return a=Qt(4,s.children!==null?s.children:[],s.key,a),a.lanes=l,a.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},a}function ji(s){s.flags|=4}function zm(s,a){if(a.type!=="stylesheet"||a.state.loading&4)s.flags&=-16777217;else if(s.flags|=16777216,!Ey(a)){if(a=qt.current,a!==null&&((De&4194176)===De?mi!==null:(De&62914560)!==De&&!(De&536870912)||a!==mi))throw na=Gu,n_;s.flags|=8192}}function cl(s,a){a!==null&&(s.flags|=4),s.flags&16384&&(a=s.tag!==22?sp():536870912,s.lanes|=a,Gs|=a)}function va(s,a){if(!ke)switch(s.tailMode){case"hidden":a=s.tail;for(var l=null;a!==null;)a.alternate!==null&&(l=a),a=a.sibling;l===null?s.tail=null:l.sibling=null;break;case"collapsed":l=s.tail;for(var u=null;l!==null;)l.alternate!==null&&(u=l),l=l.sibling;u===null?a||s.tail===null?s.tail=null:s.tail.sibling=null:u.sibling=null}}function qe(s){var a=s.alternate!==null&&s.alternate.child===s.child,l=0,u=0;if(a)for(var d=s.child;d!==null;)l|=d.lanes|d.childLanes,u|=d.subtreeFlags&31457280,u|=d.flags&31457280,d.return=s,d=d.sibling;else for(d=s.child;d!==null;)l|=d.lanes|d.childLanes,u|=d.subtreeFlags,u|=d.flags,d.return=s,d=d.sibling;return s.subtreeFlags|=u,s.childLanes=l,a}function o1(s,a,l){var u=a.pendingProps;switch(Zu(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qe(a),null;case 1:return qe(a),null;case 3:return l=a.stateNode,u=null,s!==null&&(u=s.memoizedState.cache),a.memoizedState.cache!==u&&(a.flags|=2048),Li(lt),Ce(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(s===null||s.child===null)&&(Jr(a)?ji(a):s===null||s.memoizedState.isDehydrated&&!(a.flags&256)||(a.flags|=1024,ri!==null&&(ih(ri),ri=null))),qe(a),null;case 26:return l=a.memoizedState,s===null?(ji(a),l!==null?(qe(a),zm(a,l)):(qe(a),a.flags&=-16777217)):l?l!==s.memoizedState?(ji(a),qe(a),zm(a,l)):(qe(a),a.flags&=-16777217):(s.memoizedProps!==u&&ji(a),qe(a),a.flags&=-16777217),null;case 27:To(a),l=ni.current;var d=a.type;if(s!==null&&a.stateNode!=null)s.memoizedProps!==u&&ji(a);else{if(!u){if(a.stateNode===null)throw Error(n(166));return qe(a),null}s=Tt.current,Jr(a)?t_(a):(s=_y(d,u,l),a.stateNode=s,ji(a))}return qe(a),null;case 5:if(To(a),l=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==u&&ji(a);else{if(!u){if(a.stateNode===null)throw Error(n(166));return qe(a),null}if(s=Tt.current,Jr(a))t_(a);else{switch(d=vl(ni.current),s){case 1:s=d.createElementNS("http://www.w3.org/2000/svg",l);break;case 2:s=d.createElementNS("http://www.w3.org/1998/Math/MathML",l);break;default:switch(l){case"svg":s=d.createElementNS("http://www.w3.org/2000/svg",l);break;case"math":s=d.createElementNS("http://www.w3.org/1998/Math/MathML",l);break;case"script":s=d.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild);break;case"select":s=typeof u.is=="string"?d.createElement("select",{is:u.is}):d.createElement("select"),u.multiple?s.multiple=!0:u.size&&(s.size=u.size);break;default:s=typeof u.is=="string"?d.createElement(l,{is:u.is}):d.createElement(l)}}s[St]=a,s[Mt]=u;e:for(d=a.child;d!==null;){if(d.tag===5||d.tag===6)s.appendChild(d.stateNode);else if(d.tag!==4&&d.tag!==27&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===a)break e;for(;d.sibling===null;){if(d.return===null||d.return===a)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}a.stateNode=s;e:switch(mt(s,l,u),l){case"button":case"input":case"select":case"textarea":s=!!u.autoFocus;break e;case"img":s=!0;break e;default:s=!1}s&&ji(a)}}return qe(a),a.flags&=-16777217,null;case 6:if(s&&a.stateNode!=null)s.memoizedProps!==u&&ji(a);else{if(typeof u!="string"&&a.stateNode===null)throw Error(n(166));if(s=ni.current,Jr(a)){if(s=a.stateNode,l=a.memoizedProps,u=null,d=xt,d!==null)switch(d.tag){case 27:case 5:u=d.memoizedProps}s[St]=a,s=!!(s.nodeValue===l||u!==null&&u.suppressHydrationWarning===!0||uy(s.nodeValue,l)),s||$n(a)}else s=vl(s).createTextNode(u),s[St]=a,a.stateNode=s}return qe(a),null;case 13:if(u=a.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(d=Jr(a),u!==null&&u.dehydrated!==null){if(s===null){if(!d)throw Error(n(318));if(d=a.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(n(317));d[St]=a}else ea(),!(a.flags&128)&&(a.memoizedState=null),a.flags|=4;qe(a),d=!1}else ri!==null&&(ih(ri),ri=null),d=!0;if(!d)return a.flags&256?(ki(a),a):(ki(a),null)}if(ki(a),a.flags&128)return a.lanes=l,a;if(l=u!==null,s=s!==null&&s.memoizedState!==null,l){u=a.child,d=null,u.alternate!==null&&u.alternate.memoizedState!==null&&u.alternate.memoizedState.cachePool!==null&&(d=u.alternate.memoizedState.cachePool.pool);var p=null;u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(p=u.memoizedState.cachePool.pool),p!==d&&(u.flags|=2048)}return l!==s&&l&&(a.child.flags|=8192),cl(a,a.updateQueue),qe(a),null;case 4:return Ce(),s===null&&dh(a.stateNode.containerInfo),qe(a),null;case 10:return Li(a.type),qe(a),null;case 19:if(xe(ot),d=a.memoizedState,d===null)return qe(a),null;if(u=(a.flags&128)!==0,p=d.rendering,p===null)if(u)va(d,!1);else{if(Qe!==0||s!==null&&s.flags&128)for(s=a.child;s!==null;){if(p=$o(s),p!==null){for(a.flags|=128,va(d,!1),s=p.updateQueue,a.updateQueue=s,cl(a,s),a.subtreeFlags=0,s=l,l=a.child;l!==null;)Fm(l,s),l=l.sibling;return ye(ot,ot.current&1|2),a.child}s=s.sibling}d.tail!==null&&pi()>ul&&(a.flags|=128,u=!0,va(d,!1),a.lanes=4194304)}else{if(!u)if(s=$o(p),s!==null){if(a.flags|=128,u=!0,s=s.updateQueue,a.updateQueue=s,cl(a,s),va(d,!0),d.tail===null&&d.tailMode==="hidden"&&!p.alternate&&!ke)return qe(a),null}else 2*pi()-d.renderingStartTime>ul&&l!==536870912&&(a.flags|=128,u=!0,va(d,!1),a.lanes=4194304);d.isBackwards?(p.sibling=a.child,a.child=p):(s=d.last,s!==null?s.sibling=p:a.child=p,d.last=p)}return d.tail!==null?(a=d.tail,d.rendering=a,d.tail=a.sibling,d.renderingStartTime=pi(),a.sibling=null,s=ot.current,ye(ot,u?s&1|2:s&1),a):(qe(a),null);case 22:case 23:return ki(a),ef(),u=a.memoizedState!==null,s!==null?s.memoizedState!==null!==u&&(a.flags|=8192):u&&(a.flags|=8192),u?l&536870912&&!(a.flags&128)&&(qe(a),a.subtreeFlags&6&&(a.flags|=8192)):qe(a),l=a.updateQueue,l!==null&&cl(a,l.retryQueue),l=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(l=s.memoizedState.cachePool.pool),u=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(u=a.memoizedState.cachePool.pool),u!==l&&(a.flags|=2048),s!==null&&xe(qn),null;case 24:return l=null,s!==null&&(l=s.memoizedState.cache),a.memoizedState.cache!==l&&(a.flags|=2048),Li(lt),qe(a),null;case 25:return null}throw Error(n(156,a.tag))}function l1(s,a){switch(Zu(a),a.tag){case 1:return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 3:return Li(lt),Ce(),s=a.flags,s&65536&&!(s&128)?(a.flags=s&-65537|128,a):null;case 26:case 27:case 5:return To(a),null;case 13:if(ki(a),s=a.memoizedState,s!==null&&s.dehydrated!==null){if(a.alternate===null)throw Error(n(340));ea()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 19:return xe(ot),null;case 4:return Ce(),null;case 10:return Li(a.type),null;case 22:case 23:return ki(a),ef(),s!==null&&xe(qn),s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 24:return Li(lt),null;case 25:return null;default:return null}}function Vm(s,a){switch(Zu(a),a.tag){case 3:Li(lt),Ce();break;case 26:case 27:case 5:To(a);break;case 4:Ce();break;case 13:ki(a);break;case 19:xe(ot);break;case 10:Li(a.type);break;case 22:case 23:ki(a),ef(),s!==null&&xe(qn);break;case 24:Li(lt)}}var c1={getCacheForType:function(s){var a=At(lt),l=a.data.get(s);return l===void 0&&(l=s(),a.data.set(s,l)),l}},u1=typeof WeakMap=="function"?WeakMap:Map,Ke=0,We=null,Me=null,De=0,Xe=0,Ft=null,Wi=!1,Qs=!1,Kf=!1,Xi=0,Qe=0,_n=0,ns=0,Zf=0,Gt=0,Gs=0,Ta=null,bi=null,Qf=!1,Gf=0,ul=1/0,fl=null,mn=null,hl=!1,ss=null,Sa=0,Jf=0,eh=null,Aa=0,th=null;function Lt(){if(Ke&2&&De!==0)return De&-De;if(G.T!==null){var s=js;return s!==0?s:ch()}return lp()}function Hm(){Gt===0&&(Gt=!(De&536870912)||ke?np():536870912);var s=qt.current;return s!==null&&(s.flags|=32),Gt}function Ct(s,a,l){(s===We&&Xe===2||s.cancelPendingCommit!==null)&&(Js(s,0),$i(s,De,Gt,!1)),Vr(s,l),(!(Ke&2)||s!==We)&&(s===We&&(!(Ke&2)&&(ns|=l),Qe===4&&$i(s,De,Gt,!1)),vi(s))}function jm(s,a,l){if(Ke&6)throw Error(n(327));var u=!l&&(a&60)===0&&(a&s.expiredLanes)===0||zr(s,a),d=u?d1(s,a):rh(s,a,!0),p=u;do{if(d===0){Qs&&!u&&$i(s,a,0,!1);break}else if(d===6)$i(s,a,0,!Wi);else{if(l=s.current.alternate,p&&!f1(l)){d=rh(s,a,!1),p=!1;continue}if(d===2){if(p=a,s.errorRecoveryDisabledLanes&p)var b=0;else b=s.pendingLanes&-536870913,b=b!==0?b:b&536870912?536870912:0;if(b!==0){a=b;e:{var S=s;d=Ta;var C=S.current.memoizedState.isDehydrated;if(C&&(Js(S,b).flags|=256),b=rh(S,b,!1),b!==2){if(Kf&&!C){S.errorRecoveryDisabledLanes|=p,ns|=p,d=4;break e}p=bi,bi=d,p!==null&&ih(p)}d=b}if(p=!1,d!==2)continue}}if(d===1){Js(s,0),$i(s,a,0,!0);break}e:{switch(u=s,d){case 0:case 1:throw Error(n(345));case 4:if((a&4194176)===a){$i(u,a,Gt,!Wi);break e}break;case 2:bi=null;break;case 3:case 5:break;default:throw Error(n(329))}if(u.finishedWork=l,u.finishedLanes=a,(a&62914560)===a&&(p=Gf+300-pi(),10<p)){if($i(u,a,Gt,!Wi),wo(u,0)!==0)break e;u.timeoutHandle=dy(Wm.bind(null,u,l,bi,fl,Qf,a,Gt,ns,Gs,Wi,2,-0,0),p);break e}Wm(u,l,bi,fl,Qf,a,Gt,ns,Gs,Wi,0,-0,0)}}break}while(!0);vi(s)}function ih(s){bi===null?bi=s:bi.push.apply(bi,s)}function Wm(s,a,l,u,d,p,b,S,C,U,Q,ne,$){var Z=a.subtreeFlags;if((Z&8192||(Z&16785408)===16785408)&&(Ma={stylesheets:null,count:0,unsuspend:$1},Dm(a),a=q1(),a!==null)){s.cancelPendingCommit=a(Qm.bind(null,s,l,u,d,b,S,C,1,ne,$)),$i(s,p,b,!U);return}Qm(s,l,u,d,b,S,C,Q,ne,$)}function f1(s){for(var a=s;;){var l=a.tag;if((l===0||l===11||l===15)&&a.flags&16384&&(l=a.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var u=0;u<l.length;u++){var d=l[u],p=d.getSnapshot;d=d.value;try{if(!kt(p(),d))return!1}catch{return!1}}if(l=a.child,a.subtreeFlags&16384&&l!==null)l.return=a,a=l;else{if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function $i(s,a,l,u){a&=~Zf,a&=~ns,s.suspendedLanes|=a,s.pingedLanes&=~a,u&&(s.warmLanes|=a),u=s.expirationTimes;for(var d=a;0<d;){var p=31-Dt(d),b=1<<p;u[p]=-1,d&=~b}l!==0&&rp(s,l,a)}function dl(){return Ke&6?!0:(Ea(0),!1)}function nh(){if(Me!==null){if(Xe===0)var s=Me.return;else s=Me,Fi=Jn=null,cf(s),Vs=null,sa=0,s=Me;for(;s!==null;)Vm(s.alternate,s),s=s.return;Me=null}}function Js(s,a){s.finishedWork=null,s.finishedLanes=0;var l=s.timeoutHandle;l!==-1&&(s.timeoutHandle=-1,O1(l)),l=s.cancelPendingCommit,l!==null&&(s.cancelPendingCommit=null,l()),nh(),We=s,Me=l=pn(s.current,null),De=a,Xe=0,Ft=null,Wi=!1,Qs=zr(s,a),Kf=!1,Gs=Gt=Zf=ns=_n=Qe=0,bi=Ta=null,Qf=!1,a&8&&(a|=a&32);var u=s.entangledLanes;if(u!==0)for(s=s.entanglements,u&=a;0<u;){var d=31-Dt(u),p=1<<d;a|=s[d],u&=~p}return Xi=a,Uo(),l}function Xm(s,a){we=null,G.H=yi,a===ia?(a=a_(),Xe=3):a===n_?(a=a_(),Xe=4):Xe=a===sm?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,Ft=a,Me===null&&(Qe=1,nl(s,Xt(a,s.current)))}function $m(){var s=G.H;return G.H=yi,s===null?yi:s}function Ym(){var s=G.A;return G.A=c1,s}function sh(){Qe=4,Wi||(De&4194176)!==De&&qt.current!==null||(Qs=!0),!(_n&134217727)&&!(ns&134217727)||We===null||$i(We,De,Gt,!1)}function rh(s,a,l){var u=Ke;Ke|=2;var d=$m(),p=Ym();(We!==s||De!==a)&&(fl=null,Js(s,a)),a=!1;var b=Qe;e:do try{if(Xe!==0&&Me!==null){var S=Me,C=Ft;switch(Xe){case 8:nh(),b=6;break e;case 3:case 2:case 6:qt.current===null&&(a=!0);var U=Xe;if(Xe=0,Ft=null,er(s,S,C,U),l&&Qs){b=0;break e}break;default:U=Xe,Xe=0,Ft=null,er(s,S,C,U)}}h1(),b=Qe;break}catch(Q){Xm(s,Q)}while(!0);return a&&s.shellSuspendCounter++,Fi=Jn=null,Ke=u,G.H=d,G.A=p,Me===null&&(We=null,De=0,Uo()),b}function h1(){for(;Me!==null;)qm(Me)}function d1(s,a){var l=Ke;Ke|=2;var u=$m(),d=Ym();We!==s||De!==a?(fl=null,ul=pi()+500,Js(s,a)):Qs=zr(s,a);e:do try{if(Xe!==0&&Me!==null){a=Me;var p=Ft;t:switch(Xe){case 1:Xe=0,Ft=null,er(s,a,p,1);break;case 2:if(s_(p)){Xe=0,Ft=null,Km(a);break}a=function(){Xe===2&&We===s&&(Xe=7),vi(s)},p.then(a,a);break e;case 3:Xe=7;break e;case 4:Xe=5;break e;case 7:s_(p)?(Xe=0,Ft=null,Km(a)):(Xe=0,Ft=null,er(s,a,p,7));break;case 5:var b=null;switch(Me.tag){case 26:b=Me.memoizedState;case 5:case 27:var S=Me;if(!b||Ey(b)){Xe=0,Ft=null;var C=S.sibling;if(C!==null)Me=C;else{var U=S.return;U!==null?(Me=U,gl(U)):Me=null}break t}}Xe=0,Ft=null,er(s,a,p,5);break;case 6:Xe=0,Ft=null,er(s,a,p,6);break;case 8:nh(),Qe=6;break e;default:throw Error(n(462))}}g1();break}catch(Q){Xm(s,Q)}while(!0);return Fi=Jn=null,G.H=u,G.A=d,Ke=l,Me!==null?0:(We=null,De=0,Uo(),Qe)}function g1(){for(;Me!==null&&!BA();)qm(Me)}function qm(s){var a=_m(s.alternate,s,Xi);s.memoizedProps=s.pendingProps,a===null?gl(s):Me=a}function Km(s){var a=s,l=a.alternate;switch(a.tag){case 15:case 0:a=um(l,a,a.pendingProps,a.type,void 0,De);break;case 11:a=um(l,a,a.pendingProps,a.type.render,a.ref,De);break;case 5:cf(a);default:Vm(l,a),a=Me=Fm(a,Xi),a=_m(l,a,Xi)}s.memoizedProps=s.pendingProps,a===null?gl(s):Me=a}function er(s,a,l,u){Fi=Jn=null,cf(a),Vs=null,sa=0;var d=a.return;try{if(i1(s,d,a,l,De)){Qe=1,nl(s,Xt(l,s.current)),Me=null;return}}catch(p){if(d!==null)throw Me=d,p;Qe=1,nl(s,Xt(l,s.current)),Me=null;return}a.flags&32768?(ke||u===1?s=!0:Qs||De&536870912?s=!1:(Wi=s=!0,(u===2||u===3||u===6)&&(u=qt.current,u!==null&&u.tag===13&&(u.flags|=16384))),Zm(a,s)):gl(a)}function gl(s){var a=s;do{if(a.flags&32768){Zm(a,Wi);return}s=a.return;var l=o1(a.alternate,a,Xi);if(l!==null){Me=l;return}if(a=a.sibling,a!==null){Me=a;return}Me=a=s}while(a!==null);Qe===0&&(Qe=5)}function Zm(s,a){do{var l=l1(s.alternate,s);if(l!==null){l.flags&=32767,Me=l;return}if(l=s.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!a&&(s=s.sibling,s!==null)){Me=s;return}Me=s=l}while(s!==null);Qe=6,Me=null}function Qm(s,a,l,u,d,p,b,S,C,U){var Q=G.T,ne=J.p;try{J.p=2,G.T=null,p1(s,a,l,u,ne,d,p,b,S,C,U)}finally{G.T=Q,J.p=ne}}function p1(s,a,l,u,d,p,b,S){do tr();while(ss!==null);if(Ke&6)throw Error(n(327));var C=s.finishedWork;if(u=s.finishedLanes,C===null)return null;if(s.finishedWork=null,s.finishedLanes=0,C===s.current)throw Error(n(177));s.callbackNode=null,s.callbackPriority=0,s.cancelPendingCommit=null;var U=C.lanes|C.childLanes;if(U|=Yu,YA(s,u,U,p,b,S),s===We&&(Me=We=null,De=0),!(C.subtreeFlags&10256)&&!(C.flags&10256)||hl||(hl=!0,Jf=U,eh=l,b1(So,function(){return tr(),null})),l=(C.flags&15990)!==0,C.subtreeFlags&15990||l?(l=G.T,G.T=null,p=J.p,J.p=2,b=Ke,Ke|=4,s1(s,C),Pm(C,s),LE(mh,s.containerInfo),Rl=!!_h,mh=_h=null,s.current=C,xm(s,C.alternate,C),UA(),Ke=b,J.p=p,G.T=l):s.current=C,hl?(hl=!1,ss=s,Sa=u):Gm(s,U),U=s.pendingLanes,U===0&&(mn=null),HA(C.stateNode),vi(s),a!==null)for(d=s.onRecoverableError,C=0;C<a.length;C++)U=a[C],d(U.value,{componentStack:U.stack});return Sa&3&&tr(),U=s.pendingLanes,u&4194218&&U&42?s===th?Aa++:(Aa=0,th=s):Aa=0,Ea(0),null}function Gm(s,a){(s.pooledCacheLanes&=a)===0&&(a=s.pooledCache,a!=null&&(s.pooledCache=null,aa(a)))}function tr(){if(ss!==null){var s=ss,a=Jf;Jf=0;var l=op(Sa),u=G.T,d=J.p;try{if(J.p=32>l?32:l,G.T=null,ss===null)var p=!1;else{l=eh,eh=null;var b=ss,S=Sa;if(ss=null,Sa=0,Ke&6)throw Error(n(331));var C=Ke;if(Ke|=4,Bm(b.current),Im(b,b.current,S,l),Ke=C,Ea(0,!1),It&&typeof It.onPostCommitFiberRoot=="function")try{It.onPostCommitFiberRoot(Lr,b)}catch{}p=!0}return p}finally{J.p=d,G.T=u,Gm(s,a)}}return!1}function Jm(s,a,l){a=Xt(l,a),a=Af(s.stateNode,a,2),s=fn(s,a,2),s!==null&&(Vr(s,2),vi(s))}function He(s,a,l){if(s.tag===3)Jm(s,s,l);else for(;a!==null;){if(a.tag===3){Jm(a,s,l);break}else if(a.tag===1){var u=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof u.componentDidCatch=="function"&&(mn===null||!mn.has(u))){s=Xt(l,s),l=im(2),u=fn(a,l,2),u!==null&&(nm(l,u,a,s),Vr(u,2),vi(u));break}}a=a.return}}function ah(s,a,l){var u=s.pingCache;if(u===null){u=s.pingCache=new u1;var d=new Set;u.set(a,d)}else d=u.get(a),d===void 0&&(d=new Set,u.set(a,d));d.has(l)||(Kf=!0,d.add(l),s=_1.bind(null,s,a,l),a.then(s,s))}function _1(s,a,l){var u=s.pingCache;u!==null&&u.delete(a),s.pingedLanes|=s.suspendedLanes&l,s.warmLanes&=~l,We===s&&(De&l)===l&&(Qe===4||Qe===3&&(De&62914560)===De&&300>pi()-Gf?!(Ke&2)&&Js(s,0):Zf|=l,Gs===De&&(Gs=0)),vi(s)}function ey(s,a){a===0&&(a=sp()),s=nn(s,a),s!==null&&(Vr(s,a),vi(s))}function m1(s){var a=s.memoizedState,l=0;a!==null&&(l=a.retryLane),ey(s,l)}function y1(s,a){var l=0;switch(s.tag){case 13:var u=s.stateNode,d=s.memoizedState;d!==null&&(l=d.retryLane);break;case 19:u=s.stateNode;break;case 22:u=s.stateNode._retryCache;break;default:throw Error(n(314))}u!==null&&u.delete(a),ey(s,l)}function b1(s,a){return Au(s,a)}var pl=null,ir=null,oh=!1,_l=!1,lh=!1,rs=0;function vi(s){s!==ir&&s.next===null&&(ir===null?pl=ir=s:ir=ir.next=s),_l=!0,oh||(oh=!0,T1(v1))}function Ea(s,a){if(!lh&&_l){lh=!0;do for(var l=!1,u=pl;u!==null;){if(s!==0){var d=u.pendingLanes;if(d===0)var p=0;else{var b=u.suspendedLanes,S=u.pingedLanes;p=(1<<31-Dt(42|s)+1)-1,p&=d&~(b&~S),p=p&201326677?p&201326677|1:p?p|2:0}p!==0&&(l=!0,ny(u,p))}else p=De,p=wo(u,u===We?p:0),!(p&3)||zr(u,p)||(l=!0,ny(u,p));u=u.next}while(l);lh=!1}}function v1(){_l=oh=!1;var s=0;rs!==0&&(M1()&&(s=rs),rs=0);for(var a=pi(),l=null,u=pl;u!==null;){var d=u.next,p=ty(u,a);p===0?(u.next=null,l===null?pl=d:l.next=d,d===null&&(ir=l)):(l=u,(s!==0||p&3)&&(_l=!0)),u=d}Ea(s)}function ty(s,a){for(var l=s.suspendedLanes,u=s.pingedLanes,d=s.expirationTimes,p=s.pendingLanes&-62914561;0<p;){var b=31-Dt(p),S=1<<b,C=d[b];C===-1?(!(S&l)||S&u)&&(d[b]=$A(S,a)):C<=a&&(s.expiredLanes|=S),p&=~S}if(a=We,l=De,l=wo(s,s===a?l:0),u=s.callbackNode,l===0||s===a&&Xe===2||s.cancelPendingCommit!==null)return u!==null&&u!==null&&Eu(u),s.callbackNode=null,s.callbackPriority=0;if(!(l&3)||zr(s,l)){if(a=l&-l,a===s.callbackPriority)return a;switch(u!==null&&Eu(u),op(l)){case 2:case 8:l=tp;break;case 32:l=So;break;case 268435456:l=ip;break;default:l=So}return u=iy.bind(null,s),l=Au(l,u),s.callbackPriority=a,s.callbackNode=l,a}return u!==null&&u!==null&&Eu(u),s.callbackPriority=2,s.callbackNode=null,2}function iy(s,a){var l=s.callbackNode;if(tr()&&s.callbackNode!==l)return null;var u=De;return u=wo(s,s===We?u:0),u===0?null:(jm(s,u,a),ty(s,pi()),s.callbackNode!=null&&s.callbackNode===l?iy.bind(null,s):null)}function ny(s,a){if(tr())return null;jm(s,a,!0)}function T1(s){P1(function(){Ke&6?Au(ep,s):s()})}function ch(){return rs===0&&(rs=np()),rs}function sy(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:Oo(""+s)}function ry(s,a){var l=a.ownerDocument.createElement("input");return l.name=a.name,l.value=a.value,s.id&&l.setAttribute("form",s.id),a.parentNode.insertBefore(l,a),s=new FormData(s),l.parentNode.removeChild(l),s}function S1(s,a,l,u,d){if(a==="submit"&&l&&l.stateNode===d){var p=sy((d[Mt]||null).action),b=u.submitter;b&&(a=(a=b[Mt]||null)?sy(a.formAction):b.getAttribute("formAction"),a!==null&&(p=a,b=null));var S=new Do("action","action",null,u,d);s.push({event:S,listeners:[{instance:null,listener:function(){if(u.defaultPrevented){if(rs!==0){var C=b?ry(d,b):new FormData(d);yf(l,{pending:!0,data:C,method:d.method,action:p},null,C)}}else typeof p=="function"&&(S.preventDefault(),C=b?ry(d,b):new FormData(d),yf(l,{pending:!0,data:C,method:d.method,action:p},p,C))},currentTarget:d}]})}}for(var uh=0;uh<Qp.length;uh++){var fh=Qp[uh],A1=fh.toLowerCase(),E1=fh[0].toUpperCase()+fh.slice(1);si(A1,"on"+E1)}si($p,"onAnimationEnd"),si(Yp,"onAnimationIteration"),si(qp,"onAnimationStart"),si("dblclick","onDoubleClick"),si("focusin","onFocus"),si("focusout","onBlur"),si(VE,"onTransitionRun"),si(HE,"onTransitionStart"),si(jE,"onTransitionCancel"),si(Kp,"onTransitionEnd"),Ms("onMouseEnter",["mouseout","mouseover"]),Ms("onMouseLeave",["mouseout","mouseover"]),Ms("onPointerEnter",["pointerout","pointerover"]),Ms("onPointerLeave",["pointerout","pointerover"]),zn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),zn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),zn("onBeforeInput",["compositionend","keypress","textInput","paste"]),zn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),zn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),zn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var wa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),w1=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(wa));function ay(s,a){a=(a&4)!==0;for(var l=0;l<s.length;l++){var u=s[l],d=u.event;u=u.listeners;e:{var p=void 0;if(a)for(var b=u.length-1;0<=b;b--){var S=u[b],C=S.instance,U=S.currentTarget;if(S=S.listener,C!==p&&d.isPropagationStopped())break e;p=S,d.currentTarget=U;try{p(d)}catch(Q){il(Q)}d.currentTarget=null,p=C}else for(b=0;b<u.length;b++){if(S=u[b],C=S.instance,U=S.currentTarget,S=S.listener,C!==p&&d.isPropagationStopped())break e;p=S,d.currentTarget=U;try{p(d)}catch(Q){il(Q)}d.currentTarget=null,p=C}}}}function Ie(s,a){var l=a[Ru];l===void 0&&(l=a[Ru]=new Set);var u=s+"__bubble";l.has(u)||(oy(a,s,2,!1),l.add(u))}function hh(s,a,l){var u=0;a&&(u|=4),oy(l,s,u,a)}var ml="_reactListening"+Math.random().toString(36).slice(2);function dh(s){if(!s[ml]){s[ml]=!0,up.forEach(function(l){l!=="selectionchange"&&(w1.has(l)||hh(l,!1,s),hh(l,!0,s))});var a=s.nodeType===9?s:s.ownerDocument;a===null||a[ml]||(a[ml]=!0,hh("selectionchange",!1,a))}}function oy(s,a,l,u){switch(Oy(a)){case 2:var d=Q1;break;case 8:d=G1;break;default:d=Rh}l=d.bind(null,a,l,s),d=void 0,!Du||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(d=!0),u?d!==void 0?s.addEventListener(a,l,{capture:!0,passive:d}):s.addEventListener(a,l,!0):d!==void 0?s.addEventListener(a,l,{passive:d}):s.addEventListener(a,l,!1)}function gh(s,a,l,u,d){var p=u;if(!(a&1)&&!(a&2)&&u!==null)e:for(;;){if(u===null)return;var b=u.tag;if(b===3||b===4){var S=u.stateNode.containerInfo;if(S===d||S.nodeType===8&&S.parentNode===d)break;if(b===4)for(b=u.return;b!==null;){var C=b.tag;if((C===3||C===4)&&(C=b.stateNode.containerInfo,C===d||C.nodeType===8&&C.parentNode===d))return;b=b.return}for(;S!==null;){if(b=Ln(S),b===null)return;if(C=b.tag,C===5||C===6||C===26||C===27){u=p=b;continue e}S=S.parentNode}}u=u.return}Sp(function(){var U=p,Q=Nu(l),ne=[];e:{var $=Zp.get(s);if($!==void 0){var Z=Do,pe=s;switch(s){case"keypress":if(No(l)===0)break e;case"keydown":case"keyup":Z=yE;break;case"focusin":pe="focus",Z=Fu;break;case"focusout":pe="blur",Z=Fu;break;case"beforeblur":case"afterblur":Z=Fu;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Z=wp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Z=aE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Z=TE;break;case $p:case Yp:case qp:Z=cE;break;case Kp:Z=AE;break;case"scroll":case"scrollend":Z=sE;break;case"wheel":Z=wE;break;case"copy":case"cut":case"paste":Z=fE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Z=xp;break;case"toggle":case"beforetoggle":Z=xE}var Se=(a&4)!==0,Ge=!Se&&(s==="scroll"||s==="scrollend"),V=Se?$!==null?$+"Capture":null:$;Se=[];for(var k=U,W;k!==null;){var ie=k;if(W=ie.stateNode,ie=ie.tag,ie!==5&&ie!==26&&ie!==27||W===null||V===null||(ie=Wr(k,V),ie!=null&&Se.push(Ra(k,ie,W))),Ge)break;k=k.return}0<Se.length&&($=new Z($,pe,null,l,Q),ne.push({event:$,listeners:Se}))}}if(!(a&7)){e:{if($=s==="mouseover"||s==="pointerover",Z=s==="mouseout"||s==="pointerout",$&&l!==Pu&&(pe=l.relatedTarget||l.fromElement)&&(Ln(pe)||pe[Rs]))break e;if((Z||$)&&($=Q.window===Q?Q:($=Q.ownerDocument)?$.defaultView||$.parentWindow:window,Z?(pe=l.relatedTarget||l.toElement,Z=U,pe=pe?Ln(pe):null,pe!==null&&(Ge=M(pe),Se=pe.tag,pe!==Ge||Se!==5&&Se!==27&&Se!==6)&&(pe=null)):(Z=null,pe=U),Z!==pe)){if(Se=wp,ie="onMouseLeave",V="onMouseEnter",k="mouse",(s==="pointerout"||s==="pointerover")&&(Se=xp,ie="onPointerLeave",V="onPointerEnter",k="pointer"),Ge=Z==null?$:jr(Z),W=pe==null?$:jr(pe),$=new Se(ie,k+"leave",Z,l,Q),$.target=Ge,$.relatedTarget=W,ie=null,Ln(Q)===U&&(Se=new Se(V,k+"enter",pe,l,Q),Se.target=W,Se.relatedTarget=Ge,ie=Se),Ge=ie,Z&&pe)t:{for(Se=Z,V=pe,k=0,W=Se;W;W=nr(W))k++;for(W=0,ie=V;ie;ie=nr(ie))W++;for(;0<k-W;)Se=nr(Se),k--;for(;0<W-k;)V=nr(V),W--;for(;k--;){if(Se===V||V!==null&&Se===V.alternate)break t;Se=nr(Se),V=nr(V)}Se=null}else Se=null;Z!==null&&ly(ne,$,Z,Se,!1),pe!==null&&Ge!==null&&ly(ne,Ge,pe,Se,!0)}}e:{if($=U?jr(U):window,Z=$.nodeName&&$.nodeName.toLowerCase(),Z==="select"||Z==="input"&&$.type==="file")var de=kp;else if(Ip($))if(Bp)de=UE;else{de=kE;var Re=DE}else Z=$.nodeName,!Z||Z.toLowerCase()!=="input"||$.type!=="checkbox"&&$.type!=="radio"?U&&Ou(U.elementType)&&(de=kp):de=BE;if(de&&(de=de(s,U))){Dp(ne,de,l,Q);break e}Re&&Re(s,$,U),s==="focusout"&&U&&$.type==="number"&&U.memoizedProps.value!=null&&Mu($,"number",$.value)}switch(Re=U?jr(U):window,s){case"focusin":(Ip(Re)||Re.contentEditable==="true")&&(ks=Re,Wu=U,Gr=null);break;case"focusout":Gr=Wu=ks=null;break;case"mousedown":Xu=!0;break;case"contextmenu":case"mouseup":case"dragend":Xu=!1,Wp(ne,l,Q);break;case"selectionchange":if(zE)break;case"keydown":case"keyup":Wp(ne,l,Q)}var me;if(zu)e:{switch(s){case"compositionstart":var be="onCompositionStart";break e;case"compositionend":be="onCompositionEnd";break e;case"compositionupdate":be="onCompositionUpdate";break e}be=void 0}else Ds?Pp(s,l)&&(be="onCompositionEnd"):s==="keydown"&&l.keyCode===229&&(be="onCompositionStart");be&&(Cp&&l.locale!=="ko"&&(Ds||be!=="onCompositionStart"?be==="onCompositionEnd"&&Ds&&(me=Ap()):(tn=Q,ku="value"in tn?tn.value:tn.textContent,Ds=!0)),Re=yl(U,be),0<Re.length&&(be=new Rp(be,s,null,l,Q),ne.push({event:be,listeners:Re}),me?be.data=me:(me=Np(l),me!==null&&(be.data=me)))),(me=ME?OE(s,l):PE(s,l))&&(be=yl(U,"onBeforeInput"),0<be.length&&(Re=new Rp("onBeforeInput","beforeinput",null,l,Q),ne.push({event:Re,listeners:be}),Re.data=me)),S1(ne,s,U,l,Q)}ay(ne,a)})}function Ra(s,a,l){return{instance:s,listener:a,currentTarget:l}}function yl(s,a){for(var l=a+"Capture",u=[];s!==null;){var d=s,p=d.stateNode;d=d.tag,d!==5&&d!==26&&d!==27||p===null||(d=Wr(s,l),d!=null&&u.unshift(Ra(s,d,p)),d=Wr(s,a),d!=null&&u.push(Ra(s,d,p))),s=s.return}return u}function nr(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function ly(s,a,l,u,d){for(var p=a._reactName,b=[];l!==null&&l!==u;){var S=l,C=S.alternate,U=S.stateNode;if(S=S.tag,C!==null&&C===u)break;S!==5&&S!==26&&S!==27||U===null||(C=U,d?(U=Wr(l,p),U!=null&&b.unshift(Ra(l,U,C))):d||(U=Wr(l,p),U!=null&&b.push(Ra(l,U,C)))),l=l.return}b.length!==0&&s.push({event:a,listeners:b})}var R1=/\r\n?/g,x1=/\u0000|\uFFFD/g;function cy(s){return(typeof s=="string"?s:""+s).replace(R1,`
`).replace(x1,"")}function uy(s,a){return a=cy(a),cy(s)===a}function bl(){}function Le(s,a,l,u,d,p){switch(l){case"children":typeof u=="string"?a==="body"||a==="textarea"&&u===""||Ps(s,u):(typeof u=="number"||typeof u=="bigint")&&a!=="body"&&Ps(s,""+u);break;case"className":xo(s,"class",u);break;case"tabIndex":xo(s,"tabindex",u);break;case"dir":case"role":case"viewBox":case"width":case"height":xo(s,l,u);break;case"style":vp(s,u,p);break;case"data":if(a!=="object"){xo(s,"data",u);break}case"src":case"href":if(u===""&&(a!=="a"||l!=="href")){s.removeAttribute(l);break}if(u==null||typeof u=="function"||typeof u=="symbol"||typeof u=="boolean"){s.removeAttribute(l);break}u=Oo(""+u),s.setAttribute(l,u);break;case"action":case"formAction":if(typeof u=="function"){s.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof p=="function"&&(l==="formAction"?(a!=="input"&&Le(s,a,"name",d.name,d,null),Le(s,a,"formEncType",d.formEncType,d,null),Le(s,a,"formMethod",d.formMethod,d,null),Le(s,a,"formTarget",d.formTarget,d,null)):(Le(s,a,"encType",d.encType,d,null),Le(s,a,"method",d.method,d,null),Le(s,a,"target",d.target,d,null)));if(u==null||typeof u=="symbol"||typeof u=="boolean"){s.removeAttribute(l);break}u=Oo(""+u),s.setAttribute(l,u);break;case"onClick":u!=null&&(s.onclick=bl);break;case"onScroll":u!=null&&Ie("scroll",s);break;case"onScrollEnd":u!=null&&Ie("scrollend",s);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(n(61));if(l=u.__html,l!=null){if(d.children!=null)throw Error(n(60));s.innerHTML=l}}break;case"multiple":s.multiple=u&&typeof u!="function"&&typeof u!="symbol";break;case"muted":s.muted=u&&typeof u!="function"&&typeof u!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(u==null||typeof u=="function"||typeof u=="boolean"||typeof u=="symbol"){s.removeAttribute("xlink:href");break}l=Oo(""+u),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":u!=null&&typeof u!="function"&&typeof u!="symbol"?s.setAttribute(l,""+u):s.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":u&&typeof u!="function"&&typeof u!="symbol"?s.setAttribute(l,""):s.removeAttribute(l);break;case"capture":case"download":u===!0?s.setAttribute(l,""):u!==!1&&u!=null&&typeof u!="function"&&typeof u!="symbol"?s.setAttribute(l,u):s.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":u!=null&&typeof u!="function"&&typeof u!="symbol"&&!isNaN(u)&&1<=u?s.setAttribute(l,u):s.removeAttribute(l);break;case"rowSpan":case"start":u==null||typeof u=="function"||typeof u=="symbol"||isNaN(u)?s.removeAttribute(l):s.setAttribute(l,u);break;case"popover":Ie("beforetoggle",s),Ie("toggle",s),Ro(s,"popover",u);break;case"xlinkActuate":Ni(s,"http://www.w3.org/1999/xlink","xlink:actuate",u);break;case"xlinkArcrole":Ni(s,"http://www.w3.org/1999/xlink","xlink:arcrole",u);break;case"xlinkRole":Ni(s,"http://www.w3.org/1999/xlink","xlink:role",u);break;case"xlinkShow":Ni(s,"http://www.w3.org/1999/xlink","xlink:show",u);break;case"xlinkTitle":Ni(s,"http://www.w3.org/1999/xlink","xlink:title",u);break;case"xlinkType":Ni(s,"http://www.w3.org/1999/xlink","xlink:type",u);break;case"xmlBase":Ni(s,"http://www.w3.org/XML/1998/namespace","xml:base",u);break;case"xmlLang":Ni(s,"http://www.w3.org/XML/1998/namespace","xml:lang",u);break;case"xmlSpace":Ni(s,"http://www.w3.org/XML/1998/namespace","xml:space",u);break;case"is":Ro(s,"is",u);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=iE.get(l)||l,Ro(s,l,u))}}function ph(s,a,l,u,d,p){switch(l){case"style":vp(s,u,p);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(n(61));if(l=u.__html,l!=null){if(d.children!=null)throw Error(n(60));s.innerHTML=l}}break;case"children":typeof u=="string"?Ps(s,u):(typeof u=="number"||typeof u=="bigint")&&Ps(s,""+u);break;case"onScroll":u!=null&&Ie("scroll",s);break;case"onScrollEnd":u!=null&&Ie("scrollend",s);break;case"onClick":u!=null&&(s.onclick=bl);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!fp.hasOwnProperty(l))e:{if(l[0]==="o"&&l[1]==="n"&&(d=l.endsWith("Capture"),a=l.slice(2,d?l.length-7:void 0),p=s[Mt]||null,p=p!=null?p[l]:null,typeof p=="function"&&s.removeEventListener(a,p,d),typeof u=="function")){typeof p!="function"&&p!==null&&(l in s?s[l]=null:s.hasAttribute(l)&&s.removeAttribute(l)),s.addEventListener(a,u,d);break e}l in s?s[l]=u:u===!0?s.setAttribute(l,""):Ro(s,l,u)}}}function mt(s,a,l){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ie("error",s),Ie("load",s);var u=!1,d=!1,p;for(p in l)if(l.hasOwnProperty(p)){var b=l[p];if(b!=null)switch(p){case"src":u=!0;break;case"srcSet":d=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,a));default:Le(s,a,p,b,l,null)}}d&&Le(s,a,"srcSet",l.srcSet,l,null),u&&Le(s,a,"src",l.src,l,null);return;case"input":Ie("invalid",s);var S=p=b=d=null,C=null,U=null;for(u in l)if(l.hasOwnProperty(u)){var Q=l[u];if(Q!=null)switch(u){case"name":d=Q;break;case"type":b=Q;break;case"checked":C=Q;break;case"defaultChecked":U=Q;break;case"value":p=Q;break;case"defaultValue":S=Q;break;case"children":case"dangerouslySetInnerHTML":if(Q!=null)throw Error(n(137,a));break;default:Le(s,a,u,Q,l,null)}}_p(s,p,S,C,U,b,d,!1),Co(s);return;case"select":Ie("invalid",s),u=b=p=null;for(d in l)if(l.hasOwnProperty(d)&&(S=l[d],S!=null))switch(d){case"value":p=S;break;case"defaultValue":b=S;break;case"multiple":u=S;default:Le(s,a,d,S,l,null)}a=p,l=b,s.multiple=!!u,a!=null?Os(s,!!u,a,!1):l!=null&&Os(s,!!u,l,!0);return;case"textarea":Ie("invalid",s),p=d=u=null;for(b in l)if(l.hasOwnProperty(b)&&(S=l[b],S!=null))switch(b){case"value":u=S;break;case"defaultValue":d=S;break;case"children":p=S;break;case"dangerouslySetInnerHTML":if(S!=null)throw Error(n(91));break;default:Le(s,a,b,S,l,null)}yp(s,u,d,p),Co(s);return;case"option":for(C in l)if(l.hasOwnProperty(C)&&(u=l[C],u!=null))switch(C){case"selected":s.selected=u&&typeof u!="function"&&typeof u!="symbol";break;default:Le(s,a,C,u,l,null)}return;case"dialog":Ie("cancel",s),Ie("close",s);break;case"iframe":case"object":Ie("load",s);break;case"video":case"audio":for(u=0;u<wa.length;u++)Ie(wa[u],s);break;case"image":Ie("error",s),Ie("load",s);break;case"details":Ie("toggle",s);break;case"embed":case"source":case"link":Ie("error",s),Ie("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(U in l)if(l.hasOwnProperty(U)&&(u=l[U],u!=null))switch(U){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,a));default:Le(s,a,U,u,l,null)}return;default:if(Ou(a)){for(Q in l)l.hasOwnProperty(Q)&&(u=l[Q],u!==void 0&&ph(s,a,Q,u,l,void 0));return}}for(S in l)l.hasOwnProperty(S)&&(u=l[S],u!=null&&Le(s,a,S,u,l,null))}function C1(s,a,l,u){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var d=null,p=null,b=null,S=null,C=null,U=null,Q=null;for(Z in l){var ne=l[Z];if(l.hasOwnProperty(Z)&&ne!=null)switch(Z){case"checked":break;case"value":break;case"defaultValue":C=ne;default:u.hasOwnProperty(Z)||Le(s,a,Z,null,u,ne)}}for(var $ in u){var Z=u[$];if(ne=l[$],u.hasOwnProperty($)&&(Z!=null||ne!=null))switch($){case"type":p=Z;break;case"name":d=Z;break;case"checked":U=Z;break;case"defaultChecked":Q=Z;break;case"value":b=Z;break;case"defaultValue":S=Z;break;case"children":case"dangerouslySetInnerHTML":if(Z!=null)throw Error(n(137,a));break;default:Z!==ne&&Le(s,a,$,Z,u,ne)}}Cu(s,b,S,C,U,Q,p,d);return;case"select":Z=b=S=$=null;for(p in l)if(C=l[p],l.hasOwnProperty(p)&&C!=null)switch(p){case"value":break;case"multiple":Z=C;default:u.hasOwnProperty(p)||Le(s,a,p,null,u,C)}for(d in u)if(p=u[d],C=l[d],u.hasOwnProperty(d)&&(p!=null||C!=null))switch(d){case"value":$=p;break;case"defaultValue":S=p;break;case"multiple":b=p;default:p!==C&&Le(s,a,d,p,u,C)}a=S,l=b,u=Z,$!=null?Os(s,!!l,$,!1):!!u!=!!l&&(a!=null?Os(s,!!l,a,!0):Os(s,!!l,l?[]:"",!1));return;case"textarea":Z=$=null;for(S in l)if(d=l[S],l.hasOwnProperty(S)&&d!=null&&!u.hasOwnProperty(S))switch(S){case"value":break;case"children":break;default:Le(s,a,S,null,u,d)}for(b in u)if(d=u[b],p=l[b],u.hasOwnProperty(b)&&(d!=null||p!=null))switch(b){case"value":$=d;break;case"defaultValue":Z=d;break;case"children":break;case"dangerouslySetInnerHTML":if(d!=null)throw Error(n(91));break;default:d!==p&&Le(s,a,b,d,u,p)}mp(s,$,Z);return;case"option":for(var pe in l)if($=l[pe],l.hasOwnProperty(pe)&&$!=null&&!u.hasOwnProperty(pe))switch(pe){case"selected":s.selected=!1;break;default:Le(s,a,pe,null,u,$)}for(C in u)if($=u[C],Z=l[C],u.hasOwnProperty(C)&&$!==Z&&($!=null||Z!=null))switch(C){case"selected":s.selected=$&&typeof $!="function"&&typeof $!="symbol";break;default:Le(s,a,C,$,u,Z)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Se in l)$=l[Se],l.hasOwnProperty(Se)&&$!=null&&!u.hasOwnProperty(Se)&&Le(s,a,Se,null,u,$);for(U in u)if($=u[U],Z=l[U],u.hasOwnProperty(U)&&$!==Z&&($!=null||Z!=null))switch(U){case"children":case"dangerouslySetInnerHTML":if($!=null)throw Error(n(137,a));break;default:Le(s,a,U,$,u,Z)}return;default:if(Ou(a)){for(var Ge in l)$=l[Ge],l.hasOwnProperty(Ge)&&$!==void 0&&!u.hasOwnProperty(Ge)&&ph(s,a,Ge,void 0,u,$);for(Q in u)$=u[Q],Z=l[Q],!u.hasOwnProperty(Q)||$===Z||$===void 0&&Z===void 0||ph(s,a,Q,$,u,Z);return}}for(var V in l)$=l[V],l.hasOwnProperty(V)&&$!=null&&!u.hasOwnProperty(V)&&Le(s,a,V,null,u,$);for(ne in u)$=u[ne],Z=l[ne],!u.hasOwnProperty(ne)||$===Z||$==null&&Z==null||Le(s,a,ne,$,u,Z)}var _h=null,mh=null;function vl(s){return s.nodeType===9?s:s.ownerDocument}function fy(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function hy(s,a){if(s===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&a==="foreignObject"?0:s}function yh(s,a){return s==="textarea"||s==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var bh=null;function M1(){var s=window.event;return s&&s.type==="popstate"?s===bh?!1:(bh=s,!0):(bh=null,!1)}var dy=typeof setTimeout=="function"?setTimeout:void 0,O1=typeof clearTimeout=="function"?clearTimeout:void 0,gy=typeof Promise=="function"?Promise:void 0,P1=typeof queueMicrotask=="function"?queueMicrotask:typeof gy<"u"?function(s){return gy.resolve(null).then(s).catch(N1)}:dy;function N1(s){setTimeout(function(){throw s})}function vh(s,a){var l=a,u=0;do{var d=l.nextSibling;if(s.removeChild(l),d&&d.nodeType===8)if(l=d.data,l==="/$"){if(u===0){s.removeChild(d),Da(a);return}u--}else l!=="$"&&l!=="$?"&&l!=="$!"||u++;l=d}while(l);Da(a)}function Th(s){var a=s.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var l=a;switch(a=a.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":Th(l),xu(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}s.removeChild(l)}}function I1(s,a,l,u){for(;s.nodeType===1;){var d=l;if(s.nodeName.toLowerCase()!==a.toLowerCase()){if(!u&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(u){if(!s[Hr])switch(a){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(p=s.getAttribute("rel"),p==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(p!==d.rel||s.getAttribute("href")!==(d.href==null?null:d.href)||s.getAttribute("crossorigin")!==(d.crossOrigin==null?null:d.crossOrigin)||s.getAttribute("title")!==(d.title==null?null:d.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(p=s.getAttribute("src"),(p!==(d.src==null?null:d.src)||s.getAttribute("type")!==(d.type==null?null:d.type)||s.getAttribute("crossorigin")!==(d.crossOrigin==null?null:d.crossOrigin))&&p&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(a==="input"&&s.type==="hidden"){var p=d.name==null?null:""+d.name;if(d.type==="hidden"&&s.getAttribute("name")===p)return s}else return s;if(s=oi(s.nextSibling),s===null)break}return null}function D1(s,a,l){if(a==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!l||(s=oi(s.nextSibling),s===null))return null;return s}function oi(s){for(;s!=null;s=s.nextSibling){var a=s.nodeType;if(a===1||a===3)break;if(a===8){if(a=s.data,a==="$"||a==="$!"||a==="$?"||a==="F!"||a==="F")break;if(a==="/$")return null}}return s}function py(s){s=s.previousSibling;for(var a=0;s;){if(s.nodeType===8){var l=s.data;if(l==="$"||l==="$!"||l==="$?"){if(a===0)return s;a--}else l==="/$"&&a++}s=s.previousSibling}return null}function _y(s,a,l){switch(a=vl(l),s){case"html":if(s=a.documentElement,!s)throw Error(n(452));return s;case"head":if(s=a.head,!s)throw Error(n(453));return s;case"body":if(s=a.body,!s)throw Error(n(454));return s;default:throw Error(n(451))}}var Jt=new Map,my=new Set;function Tl(s){return typeof s.getRootNode=="function"?s.getRootNode():s.ownerDocument}var Yi=J.d;J.d={f:k1,r:B1,D:U1,C:F1,L:L1,m:z1,X:H1,S:V1,M:j1};function k1(){var s=Yi.f(),a=dl();return s||a}function B1(s){var a=xs(s);a!==null&&a.tag===5&&a.type==="form"?W_(a):Yi.r(s)}var sr=typeof document>"u"?null:document;function yy(s,a,l){var u=sr;if(u&&typeof a=="string"&&a){var d=jt(a);d='link[rel="'+s+'"][href="'+d+'"]',typeof l=="string"&&(d+='[crossorigin="'+l+'"]'),my.has(d)||(my.add(d),s={rel:s,crossOrigin:l,href:a},u.querySelector(d)===null&&(a=u.createElement("link"),mt(a,"link",s),ut(a),u.head.appendChild(a)))}}function U1(s){Yi.D(s),yy("dns-prefetch",s,null)}function F1(s,a){Yi.C(s,a),yy("preconnect",s,a)}function L1(s,a,l){Yi.L(s,a,l);var u=sr;if(u&&s&&a){var d='link[rel="preload"][as="'+jt(a)+'"]';a==="image"&&l&&l.imageSrcSet?(d+='[imagesrcset="'+jt(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(d+='[imagesizes="'+jt(l.imageSizes)+'"]')):d+='[href="'+jt(s)+'"]';var p=d;switch(a){case"style":p=rr(s);break;case"script":p=ar(s)}Jt.has(p)||(s=ae({rel:"preload",href:a==="image"&&l&&l.imageSrcSet?void 0:s,as:a},l),Jt.set(p,s),u.querySelector(d)!==null||a==="style"&&u.querySelector(xa(p))||a==="script"&&u.querySelector(Ca(p))||(a=u.createElement("link"),mt(a,"link",s),ut(a),u.head.appendChild(a)))}}function z1(s,a){Yi.m(s,a);var l=sr;if(l&&s){var u=a&&typeof a.as=="string"?a.as:"script",d='link[rel="modulepreload"][as="'+jt(u)+'"][href="'+jt(s)+'"]',p=d;switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":p=ar(s)}if(!Jt.has(p)&&(s=ae({rel:"modulepreload",href:s},a),Jt.set(p,s),l.querySelector(d)===null)){switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector(Ca(p)))return}u=l.createElement("link"),mt(u,"link",s),ut(u),l.head.appendChild(u)}}}function V1(s,a,l){Yi.S(s,a,l);var u=sr;if(u&&s){var d=Cs(u).hoistableStyles,p=rr(s);a=a||"default";var b=d.get(p);if(!b){var S={loading:0,preload:null};if(b=u.querySelector(xa(p)))S.loading=5;else{s=ae({rel:"stylesheet",href:s,"data-precedence":a},l),(l=Jt.get(p))&&Sh(s,l);var C=b=u.createElement("link");ut(C),mt(C,"link",s),C._p=new Promise(function(U,Q){C.onload=U,C.onerror=Q}),C.addEventListener("load",function(){S.loading|=1}),C.addEventListener("error",function(){S.loading|=2}),S.loading|=4,Sl(b,a,u)}b={type:"stylesheet",instance:b,count:1,state:S},d.set(p,b)}}}function H1(s,a){Yi.X(s,a);var l=sr;if(l&&s){var u=Cs(l).hoistableScripts,d=ar(s),p=u.get(d);p||(p=l.querySelector(Ca(d)),p||(s=ae({src:s,async:!0},a),(a=Jt.get(d))&&Ah(s,a),p=l.createElement("script"),ut(p),mt(p,"link",s),l.head.appendChild(p)),p={type:"script",instance:p,count:1,state:null},u.set(d,p))}}function j1(s,a){Yi.M(s,a);var l=sr;if(l&&s){var u=Cs(l).hoistableScripts,d=ar(s),p=u.get(d);p||(p=l.querySelector(Ca(d)),p||(s=ae({src:s,async:!0,type:"module"},a),(a=Jt.get(d))&&Ah(s,a),p=l.createElement("script"),ut(p),mt(p,"link",s),l.head.appendChild(p)),p={type:"script",instance:p,count:1,state:null},u.set(d,p))}}function by(s,a,l,u){var d=(d=ni.current)?Tl(d):null;if(!d)throw Error(n(446));switch(s){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(a=rr(l.href),l=Cs(d).hoistableStyles,u=l.get(a),u||(u={type:"style",instance:null,count:0,state:null},l.set(a,u)),u):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){s=rr(l.href);var p=Cs(d).hoistableStyles,b=p.get(s);if(b||(d=d.ownerDocument||d,b={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},p.set(s,b),(p=d.querySelector(xa(s)))&&!p._p&&(b.instance=p,b.state.loading=5),Jt.has(s)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},Jt.set(s,l),p||W1(d,s,l,b.state))),a&&u===null)throw Error(n(528,""));return b}if(a&&u!==null)throw Error(n(529,""));return null;case"script":return a=l.async,l=l.src,typeof l=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=ar(l),l=Cs(d).hoistableScripts,u=l.get(a),u||(u={type:"script",instance:null,count:0,state:null},l.set(a,u)),u):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,s))}}function rr(s){return'href="'+jt(s)+'"'}function xa(s){return'link[rel="stylesheet"]['+s+"]"}function vy(s){return ae({},s,{"data-precedence":s.precedence,precedence:null})}function W1(s,a,l,u){s.querySelector('link[rel="preload"][as="style"]['+a+"]")?u.loading=1:(a=s.createElement("link"),u.preload=a,a.addEventListener("load",function(){return u.loading|=1}),a.addEventListener("error",function(){return u.loading|=2}),mt(a,"link",l),ut(a),s.head.appendChild(a))}function ar(s){return'[src="'+jt(s)+'"]'}function Ca(s){return"script[async]"+s}function Ty(s,a,l){if(a.count++,a.instance===null)switch(a.type){case"style":var u=s.querySelector('style[data-href~="'+jt(l.href)+'"]');if(u)return a.instance=u,ut(u),u;var d=ae({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return u=(s.ownerDocument||s).createElement("style"),ut(u),mt(u,"style",d),Sl(u,l.precedence,s),a.instance=u;case"stylesheet":d=rr(l.href);var p=s.querySelector(xa(d));if(p)return a.state.loading|=4,a.instance=p,ut(p),p;u=vy(l),(d=Jt.get(d))&&Sh(u,d),p=(s.ownerDocument||s).createElement("link"),ut(p);var b=p;return b._p=new Promise(function(S,C){b.onload=S,b.onerror=C}),mt(p,"link",u),a.state.loading|=4,Sl(p,l.precedence,s),a.instance=p;case"script":return p=ar(l.src),(d=s.querySelector(Ca(p)))?(a.instance=d,ut(d),d):(u=l,(d=Jt.get(p))&&(u=ae({},l),Ah(u,d)),s=s.ownerDocument||s,d=s.createElement("script"),ut(d),mt(d,"link",u),s.head.appendChild(d),a.instance=d);case"void":return null;default:throw Error(n(443,a.type))}else a.type==="stylesheet"&&!(a.state.loading&4)&&(u=a.instance,a.state.loading|=4,Sl(u,l.precedence,s));return a.instance}function Sl(s,a,l){for(var u=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),d=u.length?u[u.length-1]:null,p=d,b=0;b<u.length;b++){var S=u[b];if(S.dataset.precedence===a)p=S;else if(p!==d)break}p?p.parentNode.insertBefore(s,p.nextSibling):(a=l.nodeType===9?l.head:l,a.insertBefore(s,a.firstChild))}function Sh(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.title==null&&(s.title=a.title)}function Ah(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.integrity==null&&(s.integrity=a.integrity)}var Al=null;function Sy(s,a,l){if(Al===null){var u=new Map,d=Al=new Map;d.set(l,u)}else d=Al,u=d.get(l),u||(u=new Map,d.set(l,u));if(u.has(s))return u;for(u.set(s,null),l=l.getElementsByTagName(s),d=0;d<l.length;d++){var p=l[d];if(!(p[Hr]||p[St]||s==="link"&&p.getAttribute("rel")==="stylesheet")&&p.namespaceURI!=="http://www.w3.org/2000/svg"){var b=p.getAttribute(a)||"";b=s+b;var S=u.get(b);S?S.push(p):u.set(b,[p])}}return u}function Ay(s,a,l){s=s.ownerDocument||s,s.head.insertBefore(l,a==="title"?s.querySelector("head > title"):null)}function X1(s,a,l){if(l===1||a.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return s=a.disabled,typeof a.precedence=="string"&&s==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function Ey(s){return!(s.type==="stylesheet"&&!(s.state.loading&3))}var Ma=null;function $1(){}function Y1(s,a,l){if(Ma===null)throw Error(n(475));var u=Ma;if(a.type==="stylesheet"&&(typeof l.media!="string"||matchMedia(l.media).matches!==!1)&&!(a.state.loading&4)){if(a.instance===null){var d=rr(l.href),p=s.querySelector(xa(d));if(p){s=p._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(u.count++,u=El.bind(u),s.then(u,u)),a.state.loading|=4,a.instance=p,ut(p);return}p=s.ownerDocument||s,l=vy(l),(d=Jt.get(d))&&Sh(l,d),p=p.createElement("link"),ut(p);var b=p;b._p=new Promise(function(S,C){b.onload=S,b.onerror=C}),mt(p,"link",l),a.instance=p}u.stylesheets===null&&(u.stylesheets=new Map),u.stylesheets.set(a,s),(s=a.state.preload)&&!(a.state.loading&3)&&(u.count++,a=El.bind(u),s.addEventListener("load",a),s.addEventListener("error",a))}}function q1(){if(Ma===null)throw Error(n(475));var s=Ma;return s.stylesheets&&s.count===0&&Eh(s,s.stylesheets),0<s.count?function(a){var l=setTimeout(function(){if(s.stylesheets&&Eh(s,s.stylesheets),s.unsuspend){var u=s.unsuspend;s.unsuspend=null,u()}},6e4);return s.unsuspend=a,function(){s.unsuspend=null,clearTimeout(l)}}:null}function El(){if(this.count--,this.count===0){if(this.stylesheets)Eh(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var wl=null;function Eh(s,a){s.stylesheets=null,s.unsuspend!==null&&(s.count++,wl=new Map,a.forEach(K1,s),wl=null,El.call(s))}function K1(s,a){if(!(a.state.loading&4)){var l=wl.get(s);if(l)var u=l.get(null);else{l=new Map,wl.set(s,l);for(var d=s.querySelectorAll("link[data-precedence],style[data-precedence]"),p=0;p<d.length;p++){var b=d[p];(b.nodeName==="LINK"||b.getAttribute("media")!=="not all")&&(l.set(b.dataset.precedence,b),u=b)}u&&l.set(null,u)}d=a.instance,b=d.getAttribute("data-precedence"),p=l.get(b)||u,p===u&&l.set(null,d),l.set(b,d),this.count++,u=El.bind(this),d.addEventListener("load",u),d.addEventListener("error",u),p?p.parentNode.insertBefore(d,p.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(d,s.firstChild)),a.state.loading|=4}}var Oa={$$typeof:T,Provider:null,Consumer:null,_currentValue:re,_currentValue2:re,_threadCount:0};function Z1(s,a,l,u,d,p,b,S){this.tag=1,this.containerInfo=s,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=wu(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=wu(0),this.hiddenUpdates=wu(null),this.identifierPrefix=u,this.onUncaughtError=d,this.onCaughtError=p,this.onRecoverableError=b,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=S,this.incompleteTransitions=new Map}function wy(s,a,l,u,d,p,b,S,C,U,Q,ne){return s=new Z1(s,a,l,b,S,C,U,ne),a=1,p===!0&&(a|=24),p=Qt(3,null,null,a),s.current=p,p.stateNode=s,a=tf(),a.refCount++,s.pooledCache=a,a.refCount++,p.memoizedState={element:u,isDehydrated:l,cache:a},Bf(p),s}function Ry(s){return s?(s=Fs,s):Fs}function xy(s,a,l,u,d,p){d=Ry(d),u.context===null?u.context=d:u.pendingContext=d,u=un(a),u.payload={element:l},p=p===void 0?null:p,p!==null&&(u.callback=p),l=fn(s,u,a),l!==null&&(Ct(l,s,a),da(l,s,a))}function Cy(s,a){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var l=s.retryLane;s.retryLane=l!==0&&l<a?l:a}}function wh(s,a){Cy(s,a),(s=s.alternate)&&Cy(s,a)}function My(s){if(s.tag===13){var a=nn(s,67108864);a!==null&&Ct(a,s,67108864),wh(s,67108864)}}var Rl=!0;function Q1(s,a,l,u){var d=G.T;G.T=null;var p=J.p;try{J.p=2,Rh(s,a,l,u)}finally{J.p=p,G.T=d}}function G1(s,a,l,u){var d=G.T;G.T=null;var p=J.p;try{J.p=8,Rh(s,a,l,u)}finally{J.p=p,G.T=d}}function Rh(s,a,l,u){if(Rl){var d=xh(u);if(d===null)gh(s,a,u,xl,l),Py(s,u);else if(ew(d,s,a,l,u))u.stopPropagation();else if(Py(s,u),a&4&&-1<J1.indexOf(s)){for(;d!==null;){var p=xs(d);if(p!==null)switch(p.tag){case 3:if(p=p.stateNode,p.current.memoizedState.isDehydrated){var b=Fn(p.pendingLanes);if(b!==0){var S=p;for(S.pendingLanes|=2,S.entangledLanes|=2;b;){var C=1<<31-Dt(b);S.entanglements[1]|=C,b&=~C}vi(p),!(Ke&6)&&(ul=pi()+500,Ea(0))}}break;case 13:S=nn(p,2),S!==null&&Ct(S,p,2),dl(),wh(p,2)}if(p=xh(u),p===null&&gh(s,a,u,xl,l),p===d)break;d=p}d!==null&&u.stopPropagation()}else gh(s,a,u,null,l)}}function xh(s){return s=Nu(s),Ch(s)}var xl=null;function Ch(s){if(xl=null,s=Ln(s),s!==null){var a=M(s);if(a===null)s=null;else{var l=a.tag;if(l===13){if(s=X(a),s!==null)return s;s=null}else if(l===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;s=null}else a!==s&&(s=null)}}return xl=s,null}function Oy(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(FA()){case ep:return 2;case tp:return 8;case So:case LA:return 32;case ip:return 268435456;default:return 32}default:return 32}}var Mh=!1,yn=null,bn=null,vn=null,Pa=new Map,Na=new Map,Tn=[],J1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Py(s,a){switch(s){case"focusin":case"focusout":yn=null;break;case"dragenter":case"dragleave":bn=null;break;case"mouseover":case"mouseout":vn=null;break;case"pointerover":case"pointerout":Pa.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":Na.delete(a.pointerId)}}function Ia(s,a,l,u,d,p){return s===null||s.nativeEvent!==p?(s={blockedOn:a,domEventName:l,eventSystemFlags:u,nativeEvent:p,targetContainers:[d]},a!==null&&(a=xs(a),a!==null&&My(a)),s):(s.eventSystemFlags|=u,a=s.targetContainers,d!==null&&a.indexOf(d)===-1&&a.push(d),s)}function ew(s,a,l,u,d){switch(a){case"focusin":return yn=Ia(yn,s,a,l,u,d),!0;case"dragenter":return bn=Ia(bn,s,a,l,u,d),!0;case"mouseover":return vn=Ia(vn,s,a,l,u,d),!0;case"pointerover":var p=d.pointerId;return Pa.set(p,Ia(Pa.get(p)||null,s,a,l,u,d)),!0;case"gotpointercapture":return p=d.pointerId,Na.set(p,Ia(Na.get(p)||null,s,a,l,u,d)),!0}return!1}function Ny(s){var a=Ln(s.target);if(a!==null){var l=M(a);if(l!==null){if(a=l.tag,a===13){if(a=X(l),a!==null){s.blockedOn=a,qA(s.priority,function(){if(l.tag===13){var u=Lt(),d=nn(l,u);d!==null&&Ct(d,l,u),wh(l,u)}});return}}else if(a===3&&l.stateNode.current.memoizedState.isDehydrated){s.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}s.blockedOn=null}function Cl(s){if(s.blockedOn!==null)return!1;for(var a=s.targetContainers;0<a.length;){var l=xh(s.nativeEvent);if(l===null){l=s.nativeEvent;var u=new l.constructor(l.type,l);Pu=u,l.target.dispatchEvent(u),Pu=null}else return a=xs(l),a!==null&&My(a),s.blockedOn=l,!1;a.shift()}return!0}function Iy(s,a,l){Cl(s)&&l.delete(a)}function tw(){Mh=!1,yn!==null&&Cl(yn)&&(yn=null),bn!==null&&Cl(bn)&&(bn=null),vn!==null&&Cl(vn)&&(vn=null),Pa.forEach(Iy),Na.forEach(Iy)}function Ml(s,a){s.blockedOn===a&&(s.blockedOn=null,Mh||(Mh=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,tw)))}var Ol=null;function Dy(s){Ol!==s&&(Ol=s,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Ol===s&&(Ol=null);for(var a=0;a<s.length;a+=3){var l=s[a],u=s[a+1],d=s[a+2];if(typeof u!="function"){if(Ch(u||l)===null)continue;break}var p=xs(l);p!==null&&(s.splice(a,3),a-=3,yf(p,{pending:!0,data:d,method:l.method,action:u},u,d))}}))}function Da(s){function a(C){return Ml(C,s)}yn!==null&&Ml(yn,s),bn!==null&&Ml(bn,s),vn!==null&&Ml(vn,s),Pa.forEach(a),Na.forEach(a);for(var l=0;l<Tn.length;l++){var u=Tn[l];u.blockedOn===s&&(u.blockedOn=null)}for(;0<Tn.length&&(l=Tn[0],l.blockedOn===null);)Ny(l),l.blockedOn===null&&Tn.shift();if(l=(s.ownerDocument||s).$$reactFormReplay,l!=null)for(u=0;u<l.length;u+=3){var d=l[u],p=l[u+1],b=d[Mt]||null;if(typeof p=="function")b||Dy(l);else if(b){var S=null;if(p&&p.hasAttribute("formAction")){if(d=p,b=p[Mt]||null)S=b.formAction;else if(Ch(d)!==null)continue}else S=b.action;typeof S=="function"?l[u+1]=S:(l.splice(u,3),u-=3),Dy(l)}}}function Oh(s){this._internalRoot=s}Pl.prototype.render=Oh.prototype.render=function(s){var a=this._internalRoot;if(a===null)throw Error(n(409));var l=a.current,u=Lt();xy(l,u,s,a,null,null)},Pl.prototype.unmount=Oh.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var a=s.containerInfo;s.tag===0&&tr(),xy(s.current,2,null,s,null,null),dl(),a[Rs]=null}};function Pl(s){this._internalRoot=s}Pl.prototype.unstable_scheduleHydration=function(s){if(s){var a=lp();s={blockedOn:null,target:s,priority:a};for(var l=0;l<Tn.length&&a!==0&&a<Tn[l].priority;l++);Tn.splice(l,0,s),l===0&&Ny(s)}};var ky=e.version;if(ky!=="19.0.0")throw Error(n(527,ky,"19.0.0"));J.findDOMNode=function(s){var a=s._reactInternals;if(a===void 0)throw typeof s.render=="function"?Error(n(188)):(s=Object.keys(s).join(","),Error(n(268,s)));return s=D(a),s=s!==null?Y(s):null,s=s===null?null:s.stateNode,s};var iw={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:G,findFiberByHostInstance:Ln,reconcilerVersion:"19.0.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Nl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Nl.isDisabled&&Nl.supportsFiber)try{Lr=Nl.inject(iw),It=Nl}catch{}}return ka.createRoot=function(s,a){if(!r(s))throw Error(n(299));var l=!1,u="",d=G_,p=J_,b=em,S=null;return a!=null&&(a.unstable_strictMode===!0&&(l=!0),a.identifierPrefix!==void 0&&(u=a.identifierPrefix),a.onUncaughtError!==void 0&&(d=a.onUncaughtError),a.onCaughtError!==void 0&&(p=a.onCaughtError),a.onRecoverableError!==void 0&&(b=a.onRecoverableError),a.unstable_transitionCallbacks!==void 0&&(S=a.unstable_transitionCallbacks)),a=wy(s,1,!1,null,null,l,u,d,p,b,S,null),s[Rs]=a.current,dh(s.nodeType===8?s.parentNode:s),new Oh(a)},ka.hydrateRoot=function(s,a,l){if(!r(s))throw Error(n(299));var u=!1,d="",p=G_,b=J_,S=em,C=null,U=null;return l!=null&&(l.unstable_strictMode===!0&&(u=!0),l.identifierPrefix!==void 0&&(d=l.identifierPrefix),l.onUncaughtError!==void 0&&(p=l.onUncaughtError),l.onCaughtError!==void 0&&(b=l.onCaughtError),l.onRecoverableError!==void 0&&(S=l.onRecoverableError),l.unstable_transitionCallbacks!==void 0&&(C=l.unstable_transitionCallbacks),l.formState!==void 0&&(U=l.formState)),a=wy(s,1,!0,a,l??null,u,d,p,b,S,C,U),a.context=Ry(null),l=a.current,u=Lt(),d=un(u),d.callback=null,fn(l,d,u),a.current.lanes=u,Vr(a,u),vi(a),s[Rs]=a.current,dh(s),new Pl(a)},ka.version="19.0.0",ka}var jy;function hw(){if(jy)return Nh.exports;jy=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Nh.exports=fw(),Nh.exports}var dw=hw();const gw="modulepreload",pw=function(t){return"/bayern/"+t},Wy={},_w=function(e,i,n){let r=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),f=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));r=Promise.allSettled(i.map(h=>{if(h=pw(h),h in Wy)return;Wy[h]=!0;const g=h.endsWith(".css"),_=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${_}`))return;const m=document.createElement("link");if(m.rel=g?"stylesheet":gw,g||(m.as="script"),m.crossOrigin="",m.href=h,f&&m.setAttribute("nonce",f),document.head.appendChild(m),g)return new Promise((y,T)=>{m.addEventListener("load",y),m.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${h}`)))})}))}function o(c){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=c,window.dispatchEvent(f),!f.defaultPrevented)throw c}return r.then(c=>{for(const f of c||[])f.status==="rejected"&&o(f.reason);return e().catch(o)})},mw=ee.createContext(null);function yw(t,e){const i=Array.isArray(t)?t[0]:t?t.x:0,n=Array.isArray(t)?t[1]:t?t.y:0,r=Array.isArray(e)?e[0]:e?e.x:0,o=Array.isArray(e)?e[1]:e?e.y:0;return i===r&&n===o}function Ei(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!Ei(t[i],e[i]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(const r of i)if(!e.hasOwnProperty(r)||!Ei(t[r],e[r]))return!1;return!0}return!1}function Xy(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function $y(t,e){const i=e.viewState||e,n={};if("longitude"in i&&"latitude"in i&&(i.longitude!==t.center.lng||i.latitude!==t.center.lat)){const r=t.center.constructor;n.center=new r(i.longitude,i.latitude)}return"zoom"in i&&i.zoom!==t.zoom&&(n.zoom=i.zoom),"bearing"in i&&i.bearing!==t.bearing&&(n.bearing=i.bearing),"pitch"in i&&i.pitch!==t.pitch&&(n.pitch=i.pitch),i.padding&&t.padding&&!Ei(i.padding,t.padding)&&(n.padding=i.padding),n}const bw=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Yy(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const n of t.layers)e[n.id]=n;const i=t.layers.map(n=>{let r=null;"interactive"in n&&(r=Object.assign({},n),delete r.interactive);const o=e[n.ref];if(o){r=r||Object.assign({},n),delete r.ref;for(const c of bw)c in o&&(r[c]=o[c])}return r||n});return{...t,layers:i}}const qy={version:8,sources:{},layers:[]},Ky={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Zy={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},Qy={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},vw=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],Tw=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class wr{constructor(e,i,n){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=r=>{const o=this.props[Qy[r.type]];o?o(r):r.type==="error"&&console.error(r.error)},this._onCameraEvent=r=>{if(this._internalUpdate)return;r.viewState=this._propsedCameraUpdate||Xy(this._map.transform);const o=this.props[Zy[r.type]];o&&o(r)},this._onCameraUpdate=r=>this._internalUpdate?r:(this._propsedCameraUpdate=Xy(r),$y(r,this.props)),this._onPointerEvent=r=>{(r.type==="mousemove"||r.type==="mouseout")&&this._updateHover(r);const o=this.props[Ky[r.type]];o&&(this.props.interactiveLayerIds&&r.type!=="mouseover"&&r.type!=="mouseout"&&(r.features=this._hoveredFeatures||this._queryRenderedFeatures(r.point)),o(r),delete r.features)},this._MapClass=e,this.props=i,this._initialize(n)}get map(){return this._map}setProps(e){const i=this.props;this.props=e;const n=this._updateSettings(e,i),r=this._updateSize(e),o=this._updateViewState(e);this._updateStyle(e,i),this._updateStyleComponents(e),this._updateHandlers(e,i),(n||r||o&&!this._map.isMoving())&&this.redraw()}static reuse(e,i){const n=wr.savedMaps.pop();if(!n)return null;const r=n.map,o=r.getContainer();for(i.className=o.className;o.childNodes.length>0;)i.appendChild(o.childNodes[0]);r._container=i;const c=r._resizeObserver;c&&(c.disconnect(),c.observe(i)),n.setProps({...e,styleDiffing:!1}),r.resize();const{initialViewState:f}=e;return f&&(f.bounds?r.fitBounds(f.bounds,{...f.fitBoundsOptions,duration:0}):n._updateViewState(f)),r.isStyleLoaded()?r.fire("load"):r.once("style.load",()=>r.fire("load")),r._update(),n}_initialize(e){const{props:i}=this,{mapStyle:n=qy}=i,r={...i,...i.initialViewState,container:e,style:Yy(n)},o=r.initialViewState||r.viewState||r;if(Object.assign(r,{center:[o.longitude||0,o.latitude||0],zoom:o.zoom||0,pitch:o.pitch||0,bearing:o.bearing||0}),i.gl){const f=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=f,i.gl)}const c=new this._MapClass(r);o.padding&&c.setPadding(o.padding),i.cursor&&(c.getCanvas().style.cursor=i.cursor),c.transformCameraUpdate=this._onCameraUpdate,c.on("style.load",()=>{var f;this._styleComponents={light:c.getLight(),sky:c.getSky(),projection:(f=c.getProjection)==null?void 0:f.call(c),terrain:c.getTerrain()},this._updateStyleComponents(this.props)}),c.on("sourcedata",()=>{this._updateStyleComponents(this.props)});for(const f in Ky)c.on(f,this._onPointerEvent);for(const f in Zy)c.on(f,this._onCameraEvent);for(const f in Qy)c.on(f,this._onEvent);this._map=c}recycle(){const i=this.map.getContainer().querySelector("[mapboxgl-children]");i==null||i.remove(),wr.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_updateSize(e){const{viewState:i}=e;if(i){const n=this._map;if(i.width!==n.transform.width||i.height!==n.transform.height)return n.resize(),!0}return!1}_updateViewState(e){const i=this._map,n=i.transform;if(!i.isMoving()){const o=$y(n,e);if(Object.keys(o).length>0)return this._internalUpdate=!0,i.jumpTo(o),this._internalUpdate=!1,!0}return!1}_updateSettings(e,i){const n=this._map;let r=!1;for(const o of vw)if(o in e&&!Ei(e[o],i[o])){r=!0;const c=n[`set${o[0].toUpperCase()}${o.slice(1)}`];c==null||c.call(n,e[o])}return r}_updateStyle(e,i){if(e.cursor!==i.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==i.mapStyle){const{mapStyle:n=qy,styleDiffing:r=!0}=e,o={diff:r};"localIdeographFontFamily"in e&&(o.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(Yy(n),o)}}_updateStyleComponents({light:e,projection:i,sky:n,terrain:r}){var f,h;const o=this._map,c=this._styleComponents;o.style._loaded&&(e&&!Ei(e,c.light)&&(c.light=e,o.setLight(e)),i&&!Ei(i,c.projection)&&i!==((f=c.projection)==null?void 0:f.type)&&(c.projection=typeof i=="string"?{type:i}:i,(h=o.setProjection)==null||h.call(o,c.projection)),n&&!Ei(n,c.sky)&&(c.sky=n,o.setSky(n)),r!==void 0&&!Ei(r,c.terrain)&&(!r||o.getSource(r.source))&&(c.terrain=r,o.setTerrain(r)))}_updateHandlers(e,i){const n=this._map;for(const r of Tw){const o=e[r]??!0,c=i[r]??!0;Ei(o,c)||(o?n[r].enable(o):n[r].disable())}}_queryRenderedFeatures(e){const i=this._map,{interactiveLayerIds:n=[]}=this.props;try{return i.queryRenderedFeatures(e,{layers:n.filter(i.getLayer.bind(i))})}catch{return[]}}_updateHover(e){var r;const{props:i}=this;if(i.interactiveLayerIds&&(i.onMouseMove||i.onMouseEnter||i.onMouseLeave)){const o=e.type,c=((r=this._hoveredFeatures)==null?void 0:r.length)>0,f=this._queryRenderedFeatures(e.point),h=f.length>0;!h&&c&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=f,h&&!c&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=o}else this._hoveredFeatures=null}}wr.savedMaps=[];const Sw=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function Aw(t){if(!t)return null;const e=t.map,i={getMap:()=>e};for(const n of Ew(e))!(n in i)&&!Sw.includes(n)&&(i[n]=e[n].bind(e));return i}function Ew(t){const e=new Set;let i=t;for(;i;){for(const n of Object.getOwnPropertyNames(i))n[0]!=="_"&&typeof t[n]=="function"&&n!=="fire"&&n!=="setEventedParent"&&e.add(n);i=Object.getPrototypeOf(i)}return Array.from(e)}const ww=typeof document<"u"?ee.useLayoutEffect:ee.useEffect;function Rw(t,e){const{RTLTextPlugin:i,maxParallelImageRequests:n,workerCount:r,workerUrl:o}=e;if(i&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"){const{pluginUrl:c,lazy:f=!0}=typeof i=="string"?{pluginUrl:i}:i;t.setRTLTextPlugin(c,h=>{h&&console.error(h)},f)}n!==void 0&&t.setMaxParallelImageRequests(n),r!==void 0&&t.setWorkerCount(r),o!==void 0&&t.setWorkerUrl(o)}const lu=ee.createContext(null);function xw(t,e){const i=ee.useContext(mw),[n,r]=ee.useState(null),o=ee.useRef(),{current:c}=ee.useRef({mapLib:null,map:null});ee.useEffect(()=>{const g=t.mapLib;let _=!0,m;return Promise.resolve(g||_w(()=>import("./maplibre-gl-Dn__tbzo.js").then(y=>y.m),[])).then(y=>{if(!_)return;if(!y)throw new Error("Invalid mapLib");const T="Map"in y?y:y.default;if(!T.Map)throw new Error("Invalid mapLib");if(Rw(T,t),!T.supported||T.supported(t))t.reuseMaps&&(m=wr.reuse(t,o.current)),m||(m=new wr(T.Map,t,o.current)),c.map=Aw(m),c.mapLib=T,r(m),i==null||i.onMapMount(c.map,t.id);else throw new Error("Map is not supported by this browser")}).catch(y=>{const{onError:T}=t;T?T({type:"error",target:null,originalEvent:null,error:y}):console.error(y)}),()=>{_=!1,m&&(i==null||i.onMapUnmount(t.id),t.reuseMaps?m.recycle():m.destroy())}},[]),ww(()=>{n&&n.setProps(t)}),ee.useImperativeHandle(e,()=>c.map,[n]);const f=ee.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),h={height:"100%"};return ee.createElement("div",{id:t.id,ref:o,style:f},n&&ee.createElement(lu.Provider,{value:c},ee.createElement("div",{"mapboxgl-children":"",style:h},t.children)))}const Cw=ee.forwardRef(xw);var Jv=Gv();const Mw=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Zi(t,e){if(!t||!e)return;const i=t.style;for(const n in e){const r=e[n];Number.isFinite(r)&&!Mw.test(n)?i[n]=`${r}px`:i[n]=r}}ee.memo(ee.forwardRef((t,e)=>{const{map:i,mapLib:n}=ee.useContext(lu),r=ee.useRef({props:t});r.current.props=t;const o=ee.useMemo(()=>{let x=!1;ee.Children.forEach(t.children,B=>{B&&(x=!0)});const O={...t,element:x?document.createElement("div"):null},N=new n.Marker(O);return N.setLngLat([t.longitude,t.latitude]),N.getElement().addEventListener("click",B=>{var P,j;(j=(P=r.current.props).onClick)==null||j.call(P,{type:"click",target:N,originalEvent:B})}),N.on("dragstart",B=>{var j,z;const P=B;P.lngLat=o.getLngLat(),(z=(j=r.current.props).onDragStart)==null||z.call(j,P)}),N.on("drag",B=>{var j,z;const P=B;P.lngLat=o.getLngLat(),(z=(j=r.current.props).onDrag)==null||z.call(j,P)}),N.on("dragend",B=>{var j,z;const P=B;P.lngLat=o.getLngLat(),(z=(j=r.current.props).onDragEnd)==null||z.call(j,P)}),N},[]);ee.useEffect(()=>(o.addTo(i.getMap()),()=>{o.remove()}),[]);const{longitude:c,latitude:f,offset:h,style:g,draggable:_=!1,popup:m=null,rotation:y=0,rotationAlignment:T="auto",pitchAlignment:R="auto"}=t;return ee.useEffect(()=>{Zi(o.getElement(),g)},[g]),ee.useImperativeHandle(e,()=>o,[]),(o.getLngLat().lng!==c||o.getLngLat().lat!==f)&&o.setLngLat([c,f]),h&&!yw(o.getOffset(),h)&&o.setOffset(h),o.isDraggable()!==_&&o.setDraggable(_),o.getRotation()!==y&&o.setRotation(y),o.getRotationAlignment()!==T&&o.setRotationAlignment(T),o.getPitchAlignment()!==R&&o.setPitchAlignment(R),o.getPopup()!==m&&o.setPopup(m),Jv.createPortal(t.children,o.getElement())}));function Gy(t){return new Set(t?t.trim().split(/\s+/):[])}ee.memo(ee.forwardRef((t,e)=>{const{map:i,mapLib:n}=ee.useContext(lu),r=ee.useMemo(()=>document.createElement("div"),[]),o=ee.useRef({props:t});o.current.props=t;const c=ee.useMemo(()=>{const f={...t},h=new n.Popup(f);return h.setLngLat([t.longitude,t.latitude]),h.once("open",g=>{var _,m;(m=(_=o.current.props).onOpen)==null||m.call(_,g)}),h},[]);if(ee.useEffect(()=>{const f=h=>{var g,_;(_=(g=o.current.props).onClose)==null||_.call(g,h)};return c.on("close",f),c.setDOMContent(r).addTo(i.getMap()),()=>{c.off("close",f),c.isOpen()&&c.remove()}},[]),ee.useEffect(()=>{Zi(c.getElement(),t.style)},[t.style]),ee.useImperativeHandle(e,()=>c,[]),c.isOpen()&&((c.getLngLat().lng!==t.longitude||c.getLngLat().lat!==t.latitude)&&c.setLngLat([t.longitude,t.latitude]),t.offset&&!Ei(c.options.offset,t.offset)&&c.setOffset(t.offset),(c.options.anchor!==t.anchor||c.options.maxWidth!==t.maxWidth)&&(c.options.anchor=t.anchor,c.setMaxWidth(t.maxWidth)),c.options.className!==t.className)){const f=Gy(c.options.className),h=Gy(t.className);for(const g of f)h.has(g)||c.removeClassName(g);for(const g of h)f.has(g)||c.addClassName(g);c.options.className=t.className}return Jv.createPortal(t.children,r)}));function Ts(t,e,i,n){const r=ee.useContext(lu),o=ee.useMemo(()=>t(r),[]);return ee.useEffect(()=>{const c=e,f=null,h=typeof e=="function"?e:null,{map:g}=r;return g.hasControl(o)||(g.addControl(o,c==null?void 0:c.position),f&&f(r)),()=>{h&&h(r),g.hasControl(o)&&g.removeControl(o)}},[]),o}function Ow(t){const e=Ts(({mapLib:i})=>new i.AttributionControl(t),{position:t.position});return ee.useEffect(()=>{Zi(e._container,t.style)},[t.style]),null}ee.memo(Ow);function Pw(t){const e=Ts(({mapLib:i})=>new i.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return ee.useEffect(()=>{Zi(e._controlContainer,t.style)},[t.style]),null}ee.memo(Pw);function Nw(t,e){const i=ee.useRef({props:t}),n=Ts(({mapLib:r})=>{const o=new r.GeolocateControl(t),c=o._setupUI;return o._setupUI=()=>{o._container.hasChildNodes()||c()},o.on("geolocate",f=>{var h,g;(g=(h=i.current.props).onGeolocate)==null||g.call(h,f)}),o.on("error",f=>{var h,g;(g=(h=i.current.props).onError)==null||g.call(h,f)}),o.on("outofmaxbounds",f=>{var h,g;(g=(h=i.current.props).onOutOfMaxBounds)==null||g.call(h,f)}),o.on("trackuserlocationstart",f=>{var h,g;(g=(h=i.current.props).onTrackUserLocationStart)==null||g.call(h,f)}),o.on("trackuserlocationend",f=>{var h,g;(g=(h=i.current.props).onTrackUserLocationEnd)==null||g.call(h,f)}),o},{position:t.position});return i.current.props=t,ee.useImperativeHandle(e,()=>n,[]),ee.useEffect(()=>{Zi(n._container,t.style)},[t.style]),null}ee.memo(ee.forwardRef(Nw));function Iw(t){const e=Ts(({mapLib:i})=>new i.NavigationControl(t),{position:t.position});return ee.useEffect(()=>{Zi(e._container,t.style)},[t.style]),null}ee.memo(Iw);function Dw(t){const e=Ts(({mapLib:o})=>new o.ScaleControl(t),{position:t.position}),i=ee.useRef(t),n=i.current;i.current=t;const{style:r}=t;return t.maxWidth!==void 0&&t.maxWidth!==n.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==n.unit&&e.setUnit(t.unit),ee.useEffect(()=>{Zi(e._container,r)},[r]),null}ee.memo(Dw);function kw(t){const e=Ts(({mapLib:i})=>new i.TerrainControl(t),{position:t.position});return ee.useEffect(()=>{Zi(e._container,t.style)},[t.style]),null}ee.memo(kw);function Bw(t){const e=Ts(({mapLib:i})=>new i.LogoControl(t),{position:t.position});return ee.useEffect(()=>{Zi(e._container,t.style)},[t.style]),null}ee.memo(Bw);function hc(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const Sg=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),Jy=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Jy&&parseFloat(Jy[1]);const Il=globalThis,or=globalThis.process||{},Uw=globalThis.navigator||{};function eT(t){var n,r;if(typeof window<"u"&&((n=window.process)==null?void 0:n.type)==="renderer"||typeof process<"u"&&((r=process.versions)!=null&&r.electron))return!0;const i=typeof navigator<"u"&&navigator.userAgent;return!!(i&&i.indexOf("Electron")>=0)}function Ss(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||eT()}function Fw(t){return Ss()?eT()?"Electron":(Uw.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const tT="4.1.0";function Lw(t){try{const e=window[t],i="__storage_test__";return e.setItem(i,i),e.removeItem(i),e}catch{return null}}class zw{constructor(e,i,n="sessionStorage"){this.storage=Lw(n),this.id=e,this.config=i,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const i=JSON.stringify(this.config);this.storage.setItem(this.id,i)}}_loadConfiguration(){let e={};if(this.storage){const i=this.storage.getItem(this.id);e=i?JSON.parse(i):{}}return Object.assign(this.config,e),this}}function Vw(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function Hw(t,e=8){const i=Math.max(e-t.length,0);return`${" ".repeat(i)}${t}`}var dc;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(dc||(dc={}));const jw=10;function e0(t){return typeof t!="string"?t:(t=t.toUpperCase(),dc[t]||dc.WHITE)}function Ww(t,e,i){return!Ss&&typeof t=="string"&&(e&&(t=`\x1B[${e0(e)}m${t}\x1B[39m`),i&&(t=`\x1B[${e0(i)+jw}m${t}\x1B[49m`)),t}function Xw(t,e=["constructor"]){const i=Object.getPrototypeOf(t),n=Object.getOwnPropertyNames(i),r=t;for(const o of n){const c=r[o];typeof c=="function"&&(e.find(f=>o===f)||(r[o]=c.bind(t)))}}function Ag(t,e){if(!t)throw new Error("Assertion failed")}function lr(){var e,i,n;let t;if(Ss()&&Il.performance)t=(i=(e=Il==null?void 0:Il.performance)==null?void 0:e.now)==null?void 0:i.call(e);else if("hrtime"in or){const r=(n=or==null?void 0:or.hrtime)==null?void 0:n.call(or);t=r[0]*1e3+r[1]/1e6}else t=Date.now();return t}const cr={debug:Ss()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},$w={enabled:!0,level:0};function ur(){}const t0={},i0={once:!0};class co{constructor({id:e}={id:""}){this.VERSION=tT,this._startTs=lr(),this._deltaTs=lr(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new zw(`__probe-${this.id}__`,$w),this.timeStamp(`${this.id} started`),Xw(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((lr()-this._startTs).toPrecision(10))}getDelta(){return Number((lr()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,i){this._storage.setConfiguration({[e]:i})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,i){if(!e)throw new Error(i||"Assertion failed")}warn(e){return this._getLogFunction(0,e,cr.warn,arguments,i0)}error(e){return this._getLogFunction(0,e,cr.error,arguments)}deprecated(e,i){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${i}\` instead`)}removed(e,i){return this.error(`\`${e}\` has been removed. Use \`${i}\` instead`)}probe(e,i){return this._getLogFunction(e,i,cr.log,arguments,{time:!0,once:!0})}log(e,i){return this._getLogFunction(e,i,cr.debug,arguments)}info(e,i){return this._getLogFunction(e,i,console.info,arguments)}once(e,i){return this._getLogFunction(e,i,cr.debug||cr.info,arguments,i0)}table(e,i,n){return i?this._getLogFunction(e,i,console.table||ur,n&&[n],{tag:qw(i)}):ur}time(e,i){return this._getLogFunction(e,i,console.time?console.time:console.info)}timeEnd(e,i){return this._getLogFunction(e,i,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,i){return this._getLogFunction(e,i,console.timeStamp||ur)}group(e,i,n={collapsed:!1}){const r=n0({logLevel:e,message:i,opts:n}),{collapsed:o}=n;return r.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(e,i,n={}){return this.group(e,i,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||ur)}withGroup(e,i,n){this.group(e,i)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=iT(e)}_getLogFunction(e,i,n,r,o){if(this._shouldLog(e)){o=n0({logLevel:e,message:i,args:r,opts:o}),n=n||o.method,Ag(n),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=lr();const c=o.tag||o.message;if(o.once&&c)if(!t0[c])t0[c]=lr();else return ur;return i=Yw(this.id,o.message,o),n.bind(console,i,...o.args)}return ur}}co.VERSION=tT;function iT(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return Ag(Number.isFinite(e)&&e>=0),e}function n0(t){const{logLevel:e,message:i}=t;t.logLevel=iT(e);const n=t.args?Array.from(t.args):[];for(;n.length&&n.shift()!==i;);switch(typeof e){case"string":case"function":i!==void 0&&n.unshift(i),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const r=typeof t.message;return Ag(r==="string"||r==="object"),Object.assign(t,{args:n},t.opts)}function Yw(t,e,i){if(typeof e=="string"){const n=i.time?Hw(Vw(i.total)):"";e=i.time?`${t}: ${n}  ${e}`:`${t}: ${e}`,e=Ww(e,i.color,i.background)}return e}function qw(t){for(const e in t)for(const i in t[e])return i||"untitled";return"empty"}const Bh="4.3.2",Kw=Bh[0]>="0"&&Bh[0]<="9"?`v${Bh}`:"";function Zw(){const t=new co({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=Kw,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}const Qw=Zw();function Gw(t,e){return nT(t||{},e)}function nT(t,e,i=0){if(i>3)return e;const n={...t};for(const[r,o]of Object.entries(e))o&&typeof o=="object"&&!Array.isArray(o)?n[r]=nT(n[r]||{},e[r],i+1):n[r]=e[r];return n}const Jw="latest";function e3(){var t;return(t=globalThis._loadersgl_)!=null&&t.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const t3=e3();function Bn(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const gs=typeof process!="object"||String(process)!=="[object process]"||process.browser,i3=typeof window<"u"&&typeof window.orientation<"u",s0=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);s0&&parseFloat(s0[1]);class n3{constructor(e,i){v(this,"name");v(this,"workerThread");v(this,"isRunning",!0);v(this,"result");v(this,"_resolve",()=>{});v(this,"_reject",()=>{});this.name=e,this.workerThread=i,this.result=new Promise((n,r)=>{this._resolve=n,this._reject=r})}postMessage(e,i){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:i})}done(e){Bn(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Bn(this.isRunning),this.isRunning=!1,this._reject(e)}}class Uh{terminate(){}}const Fh=new Map;function s3(t){Bn(t.source&&!t.url||!t.source&&t.url);let e=Fh.get(t.source||t.url);return e||(t.url&&(e=r3(t.url),Fh.set(t.url,e)),t.source&&(e=sT(t.source),Fh.set(t.source,e))),Bn(e),e}function r3(t){if(!t.startsWith("http"))return t;const e=a3(t);return sT(e)}function sT(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function a3(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function rT(t,e=!0,i){const n=i||new Set;if(t){if(r0(t))n.add(t);else if(r0(t.buffer))n.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const r in t)rT(t[r],e,n)}}return i===void 0?Array.from(n):[]}function r0(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const Lh=()=>{};class Ed{constructor(e){v(this,"name");v(this,"source");v(this,"url");v(this,"terminated",!1);v(this,"worker");v(this,"onMessage");v(this,"onError");v(this,"_loadableURL","");const{name:i,source:n,url:r}=e;Bn(n||r),this.name=i,this.source=n,this.url=r,this.onMessage=Lh,this.onError=o=>console.log(o),this.worker=gs?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&gs||typeof Uh<"u"&&!gs}destroy(){this.onMessage=Lh,this.onError=Lh,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,i){i=i||rT(e),this.worker.postMessage(e,i)}_getErrorFromErrorEvent(e){let i="Failed to load ";return i+=`worker ${this.name} from ${this.url}. `,e.message&&(i+=`${e.message} in `),e.lineno&&(i+=`:${e.lineno}:${e.colno}`),new Error(i)}_createBrowserWorker(){this._loadableURL=s3({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=i=>{i.data?this.onMessage(i.data):this.onError(new Error("No data received"))},e.onerror=i=>{this.onError(this._getErrorFromErrorEvent(i)),this.terminated=!0},e.onmessageerror=i=>console.error(i),e}_createNodeWorker(){let e;if(this.url){const n=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Uh(n,{eval:!1})}else if(this.source)e=new Uh(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",i=>{this.onMessage(i)}),e.on("error",i=>{this.onError(i)}),e.on("exit",i=>{}),e}}class o3{constructor(e){v(this,"name","unnamed");v(this,"source");v(this,"url");v(this,"maxConcurrency",1);v(this,"maxMobileConcurrency",1);v(this,"onDebug",()=>{});v(this,"reuseWorkers",!0);v(this,"props",{});v(this,"jobQueue",[]);v(this,"idleQueue",[]);v(this,"count",0);v(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return Ed.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,i=(r,o,c)=>r.done(c),n=(r,o)=>r.error(o)){const r=new Promise(o=>(this.jobQueue.push({name:e,onMessage:i,onError:n,onStart:o}),this));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const i=this.jobQueue.shift();if(i){this.onDebug({message:"Starting job",name:i.name,workerThread:e,backlog:this.jobQueue.length});const n=new n3(i.name,e);e.onMessage=r=>i.onMessage(n,r.type,r.payload),e.onError=r=>i.onError(n,r),i.onStart(n);try{await n.result}catch(r){console.error(`Worker exception: ${r}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!gs||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Ed({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return i3?this.maxMobileConcurrency:this.maxConcurrency}}const l3={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},Cn=class Cn{constructor(e){v(this,"props");v(this,"workerPools",new Map);this.props={...l3},this.setProps(e),this.workerPools=new Map}static isSupported(){return Ed.isSupported()}static getWorkerFarm(e={}){return Cn._workerFarm=Cn._workerFarm||new Cn({}),Cn._workerFarm.setProps(e),Cn._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const i of this.workerPools.values())i.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:i,source:n,url:r}=e;let o=this.workerPools.get(i);return o||(o=new o3({name:i,source:n,url:r}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(i,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};v(Cn,"_workerFarm");let gc=Cn;function c3(t,e={}){const i=e[t.id]||{},n=gs?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let r=i.workerUrl;if(!r&&t.id==="compression"&&(r=e.workerUrl),e._workerType==="test"&&(gs?r=`modules/${t.module}/dist/${n}`:r=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!r){let o=t.version;o==="latest"&&(o=Jw);const c=o?`@${o}`:"";r=`https://unpkg.com/@loaders.gl/${t.module}${c}/dist/${n}`}return Bn(r),r}function u3(t,e=t3){Bn(t,"no worker provided");const i=t.version;return!(!e||!i)}function f3(t,e){return!gc.isSupported()||!gs&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function h3(t,e,i,n,r){const o=t.id,c=c3(t,i),h=gc.getWorkerFarm(i).getWorkerPool({name:o,url:c});i=JSON.parse(JSON.stringify(i)),n=JSON.parse(JSON.stringify(n||{}));const g=await h.startJob("process-on-worker",d3.bind(null,r));return g.postMessage("process",{input:e,options:i,context:n}),await(await g.result).result}async function d3(t,e,i,n){switch(i){case"done":e.done(n);break;case"error":e.error(new Error(n.error));break;case"process":const{id:r,input:o,options:c}=n;try{const f=await t(o,c);e.postMessage("done",{id:r,result:f})}catch(f){const h=f instanceof Error?f.message:"unknown error";e.postMessage("error",{id:r,error:h})}break;default:console.warn(`parse-with-worker unknown message ${i}`)}}function g3(t,e,i){if(i=i||t.byteLength,t.byteLength<i||e.byteLength<i)return!1;const n=new Uint8Array(t),r=new Uint8Array(e);for(let o=0;o<n.length;++o)if(n[o]!==r[o])return!1;return!0}function p3(...t){return _3(t)}function _3(t){const e=t.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),i=e.reduce((o,c)=>o+c.byteLength,0),n=new Uint8Array(i);let r=0;for(const o of e)n.set(o,r),r+=o.byteLength;return n.buffer}async function m3(t){const e=[];for await(const i of t)e.push(i);return p3(...e)}function a0(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class o0{constructor(e,i){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=i,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=a0(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(a0()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class cu{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,i="count"){return this._getOrCreate({name:e,type:i})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const i of Object.values(this.stats))e(i)}getTable(){const e={};return this.forEach(i=>{e[i.name]={time:i.time||0,count:i.count||0,average:i.getAverageTime()||0,hz:i.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(i=>this._getOrCreate(i))}_getOrCreate(e){const{name:i,type:n}=e;let r=this.stats[i];return r||(e instanceof o0?r=e:r=new o0(i,n),this.stats[i]=r),r}}let y3="";const l0={};function b3(t){for(const e in l0)if(t.startsWith(e)){const i=l0[e];t=t.replace(e,i)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${y3}${t}`),t}function v3(t){return t&&typeof t=="object"&&t.isBuffer}function aT(t){if(v3(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function oT(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function T3(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const S3=t=>typeof t=="boolean",Ya=t=>typeof t=="function",uo=t=>t!==null&&typeof t=="object",c0=t=>uo(t)&&t.constructor==={}.constructor,A3=t=>!!t&&typeof t[Symbol.iterator]=="function",E3=t=>t&&typeof t[Symbol.asyncIterator]=="function",As=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Es=t=>typeof Blob<"u"&&t instanceof Blob,w3=t=>t&&typeof t=="object"&&t.isBuffer,R3=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||uo(t)&&Ya(t.tee)&&Ya(t.cancel)&&Ya(t.getReader),x3=t=>uo(t)&&Ya(t.read)&&Ya(t.pipe)&&S3(t.readable),lT=t=>R3(t)||x3(t);class C3 extends Error{constructor(i,n){super(i);v(this,"reason");v(this,"url");v(this,"response");this.reason=n.reason,this.url=n.url,this.response=n.response}}const M3=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,O3=/^([-\w.]+\/[-\w.+]+)/;function u0(t,e){return t.toLowerCase()===e.toLowerCase()}function P3(t){const e=O3.exec(t);return e?e[1]:t}function f0(t){const e=M3.exec(t);return e?e[1]:""}const cT=/\?.*/;function N3(t){const e=t.match(cT);return e&&e[0]}function Eg(t){return t.replace(cT,"")}function I3(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function uu(t){return As(t)?t.url:Es(t)?t.name||"":typeof t=="string"?t:""}function wg(t){if(As(t)){const e=t,i=e.headers.get("content-type")||"",n=Eg(e.url);return P3(i)||f0(n)}return Es(t)?t.type||"":typeof t=="string"?f0(t):""}function D3(t){return As(t)?t.headers["content-length"]||-1:Es(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function uT(t){if(As(t))return t;const e={},i=D3(t);i>=0&&(e["content-length"]=String(i));const n=uu(t),r=wg(t);r&&(e["content-type"]=r);const o=await U3(t);o&&(e["x-first-bytes"]=o),typeof t=="string"&&(t=new TextEncoder().encode(t));const c=new Response(t,{headers:e});return Object.defineProperty(c,"url",{value:n}),c}async function k3(t){if(!t.ok)throw await B3(t)}async function B3(t){const e=I3(t.url);let i=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;i=i.length>100?`${i.slice(0,100)}...`:i;const n={reason:t.statusText,url:t.url,response:t};try{const r=t.headers.get("Content-Type");n.reason=!t.bodyUsed&&(r!=null&&r.includes("application/json"))?await t.json():await t.text()}catch{}return new C3(i,n)}async function U3(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const i=t.slice(0,5);return await new Promise(n=>{const r=new FileReader;r.onload=o=>{var c;return n((c=o==null?void 0:o.target)==null?void 0:c.result)},r.readAsDataURL(i)})}if(t instanceof ArrayBuffer){const i=t.slice(0,5);return`data:base64,${F3(i)}`}return null}function F3(t){let e="";const i=new Uint8Array(t);for(let n=0;n<i.byteLength;n++)e+=String.fromCharCode(i[n]);return btoa(e)}function L3(t){return!z3(t)&&!V3(t)}function z3(t){return t.startsWith("http:")||t.startsWith("https:")}function V3(t){return t.startsWith("data:")}async function h0(t,e){var i,n;if(typeof t=="string"){const r=b3(t);return L3(r)&&(i=globalThis.loaders)!=null&&i.fetchNode?(n=globalThis.loaders)==null?void 0:n.fetchNode(r,e):await fetch(r,e)}return await uT(t)}const d0=new co({id:"loaders.gl"});class H3{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class j3{constructor(){v(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const fT={fetch:null,mimeType:void 0,nothrow:!1,log:new j3,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Sg,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},W3={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function hT(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function dT(){const t=hT();return t.globalOptions=t.globalOptions||{...fT},t.globalOptions}function X3(t,e,i,n){return i=i||[],i=Array.isArray(i)?i:[i],$3(t,i),q3(e,t,n)}function $3(t,e){g0(t,null,fT,W3,e);for(const i of e){const n=t&&t[i.id]||{},r=i.options&&i.options[i.id]||{},o=i.deprecatedOptions&&i.deprecatedOptions[i.id]||{};g0(n,i.id,r,o,e)}}function g0(t,e,i,n,r){const o=e||"Top level",c=e?`${e}.`:"";for(const f in t){const h=!e&&uo(t[f]),g=f==="baseUri"&&!e,_=f==="workerUrl"&&e;if(!(f in i)&&!g&&!_){if(f in n)d0.warn(`${o} loader option '${c}${f}' no longer supported, use '${n[f]}'`)();else if(!h){const m=Y3(f,r);d0.warn(`${o} loader option '${c}${f}' not recognized. ${m}`)()}}}}function Y3(t,e){const i=t.toLowerCase();let n="";for(const r of e)for(const o in r.options){if(t===o)return`Did you mean '${r.id}.${o}'?`;const c=o.toLowerCase();(i.startsWith(c)||c.startsWith(i))&&(n=n||`Did you mean '${r.id}.${o}'?`)}return n}function q3(t,e,i){const r={...t.options||{}};return K3(r,i),r.log===null&&(r.log=new H3),p0(r,dT()),p0(r,e),r}function p0(t,e){for(const i in e)if(i in e){const n=e[i];c0(n)&&c0(t[i])?t[i]={...t[i],...e[i]}:t[i]=e[i]}}function K3(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function Rg(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t==null?void 0:t.extensions)):!1}function xg(t){hc(t,"null loader"),hc(Rg(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t!=null&&t.parseTextSync||t!=null&&t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const gT=()=>{const t=hT();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function Z3(t){const e=gT();t=Array.isArray(t)?t:[t];for(const i of t){const n=xg(i);e.find(r=>n===r)||e.unshift(n)}}function Q3(){return gT()}const G3=/\.([^.]+)$/;async function J3(t,e=[],i,n){if(!pT(t))return null;let r=_0(t,e,{...i,nothrow:!0},n);if(r)return r;if(Es(t)&&(t=await t.slice(0,10).arrayBuffer(),r=_0(t,e,i,n)),!r&&!(i!=null&&i.nothrow))throw new Error(_T(t));return r}function _0(t,e=[],i,n){if(!pT(t))return null;if(e&&!Array.isArray(e))return xg(e);let r=[];e&&(r=r.concat(e)),i!=null&&i.ignoreRegisteredLoaders||r.push(...Q3()),tR(r);const o=eR(t,r,i,n);if(!o&&!(i!=null&&i.nothrow))throw new Error(_T(t));return o}function eR(t,e,i,n){const r=uu(t),o=wg(t),c=Eg(r)||(n==null?void 0:n.url);let f=null,h="";return i!=null&&i.mimeType&&(f=zh(e,i==null?void 0:i.mimeType),h=`match forced by supplied MIME type ${i==null?void 0:i.mimeType}`),f=f||iR(e,c),h=h||(f?`matched url ${c}`:""),f=f||zh(e,o),h=h||(f?`matched MIME type ${o}`:""),f=f||sR(e,t),h=h||(f?`matched initial data ${mT(t)}`:""),i!=null&&i.fallbackMimeType&&(f=f||zh(e,i==null?void 0:i.fallbackMimeType),h=h||(f?`matched fallback MIME type ${o}`:"")),h&&Qw.log(1,`selectLoader selected ${f==null?void 0:f.name}: ${h}.`),f}function pT(t){return!(t instanceof Response&&t.status===204)}function _T(t){const e=uu(t),i=wg(t);let n="No valid loader found (";n+=e?`${oT(e)}, `:"no url provided, ",n+=`MIME type: ${i?`"${i}"`:"not provided"}, `;const r=t?mT(t):"";return n+=r?` first bytes: "${r}"`:"first bytes: not available",n+=")",n}function tR(t){for(const e of t)xg(e)}function iR(t,e){const i=e&&G3.exec(e),n=i&&i[1];return n?nR(t,n):null}function nR(t,e){e=e.toLowerCase();for(const i of t)for(const n of i.extensions)if(n.toLowerCase()===e)return i;return null}function zh(t,e){var i;for(const n of t)if((i=n.mimeTypes)!=null&&i.some(r=>u0(e,r))||u0(e,`application/x.${n.id}`))return n;return null}function sR(t,e){if(!e)return null;for(const i of t)if(typeof e=="string"){if(rR(e,i))return i}else if(ArrayBuffer.isView(e)){if(m0(e.buffer,e.byteOffset,i))return i}else if(e instanceof ArrayBuffer&&m0(e,0,i))return i;return null}function rR(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(n=>t.startsWith(n))}function m0(t,e,i){return(Array.isArray(i.tests)?i.tests:[i.tests]).some(r=>aR(t,e,i,r))}function aR(t,e,i,n){if(n instanceof ArrayBuffer)return g3(n,t,n.byteLength);switch(typeof n){case"function":return n(t);case"string":const r=wd(t,e,n.length);return n===r;default:return!1}}function mT(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?wd(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?wd(t,0,e):""}function wd(t,e,i){if(t.byteLength<e+i)return"";const n=new DataView(t);let r="";for(let o=0;o<i;o++)r+=String.fromCharCode(n.getUint8(e+o));return r}const oR=256*1024;function*lR(t,e){const i=(e==null?void 0:e.chunkSize)||oR;let n=0;const r=new TextEncoder;for(;n<t.length;){const o=Math.min(t.length-n,i),c=t.slice(n,n+o);n+=o,yield r.encode(c)}}const cR=256*1024;function*uR(t,e={}){const{chunkSize:i=cR}=e;let n=0;for(;n<t.byteLength;){const r=Math.min(t.byteLength-n,i),o=new ArrayBuffer(r),c=new Uint8Array(t,n,r);new Uint8Array(o).set(c),n+=r,yield o}}const fR=1024*1024;async function*hR(t,e){const i=(e==null?void 0:e.chunkSize)||fR;let n=0;for(;n<t.size;){const r=n+i,o=await t.slice(n,r).arrayBuffer();n=r,yield o}}function y0(t,e){return Sg?dR(t,e):gR(t)}async function*dR(t,e){const i=t.getReader();let n;try{for(;;){const r=n||i.read();e!=null&&e._streamReadAhead&&(n=i.read());const{done:o,value:c}=await r;if(o)return;yield aT(c)}}catch{i.releaseLock()}}async function*gR(t,e){for await(const i of t)yield aT(i)}function pR(t,e){if(typeof t=="string")return lR(t,e);if(t instanceof ArrayBuffer)return uR(t,e);if(Es(t))return hR(t,e);if(lT(t))return y0(t,e);if(As(t))return y0(t.body,e);throw new Error("makeIterator")}const yT="Cannot convert supplied data type";function _R(t,e,i){if(e.text&&typeof t=="string")return t;if(w3(t)&&(t=t.buffer),t instanceof ArrayBuffer){const n=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let n=t.buffer;const r=t.byteLength||t.length;return(t.byteOffset!==0||r!==n.byteLength)&&(n=n.slice(t.byteOffset,t.byteOffset+r)),n}throw new Error(yT)}async function mR(t,e,i){const n=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||n)return _R(t,e);if(Es(t)&&(t=await uT(t)),As(t)){const r=t;return await k3(r),e.binary?await r.arrayBuffer():await r.text()}if(lT(t)&&(t=pR(t,i)),A3(t)||E3(t))return m3(t);throw new Error(yT)}function bT(t,e){const i=dT(),n=t||i;return typeof n.fetch=="function"?n.fetch:uo(n.fetch)?r=>h0(r,n.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:h0}function yR(t,e,i){if(i)return i;const n={fetch:bT(e,t),...t};if(n.url){const r=Eg(n.url);n.baseUrl=r,n.queryString=N3(n.url),n.filename=oT(r),n.baseUrl=T3(r)}return Array.isArray(n.loaders)||(n.loaders=null),n}function bR(t,e){if(t&&!Array.isArray(t))return t;let i;if(t&&(i=Array.isArray(t)?t:[t]),e&&e.loaders){const n=Array.isArray(e.loaders)?e.loaders:[e.loaders];i=i?[...i,...n]:n}return i&&i.length?i:void 0}async function pc(t,e,i,n){e&&!Array.isArray(e)&&!Rg(e)&&(n=void 0,i=e,e=void 0),t=await t,i=i||{};const r=uu(t),c=bR(e,n),f=await J3(t,c,i);return f?(i=X3(i,f,c,r),n=yR({url:r,_parse:pc,loaders:c},i,n||null),await vR(f,t,i,n)):null}async function vR(t,e,i,n){if(u3(t),i=Gw(t.options,i),As(e)){const o=e,{ok:c,redirected:f,status:h,statusText:g,type:_,url:m}=o,y=Object.fromEntries(o.headers.entries());n.response={headers:y,ok:c,redirected:f,status:h,statusText:g,type:_,url:m}}e=await mR(e,t,i);const r=t;if(r.parseTextSync&&typeof e=="string")return r.parseTextSync(e,i,n);if(f3(t,i))return await h3(t,e,i,n,pc);if(r.parseText&&typeof e=="string")return await r.parseText(e,i,n);if(r.parse)return await r.parse(e,i,n);throw Bn(!r.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}async function _c(t,e,i,n){let r,o;!Array.isArray(e)&&!Rg(e)?(r=[],o=e):(r=e,o=i);const c=bT(o);let f=t;return typeof t=="string"&&(f=await c(t)),Es(t)&&(f=await c(t)),Array.isArray(r)?await pc(f,r,o):await pc(f,r,o)}const TR="4.3.2";var Zv;const SR=(Zv=globalThis.loaders)==null?void 0:Zv.parseImageNode,Rd=typeof Image<"u",xd=typeof ImageBitmap<"u",AR=!!SR,Cd=Sg?!0:AR;function ER(t){switch(t){case"auto":return xd||Rd||Cd;case"imagebitmap":return xd;case"image":return Rd;case"data":return Cd;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function wR(){if(xd)return"imagebitmap";if(Rd)return"image";if(Cd)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function RR(t){const e=CR(t);if(!e)throw new Error("Not an image");return e}function xR(t){switch(RR(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),i=e.getContext("2d");if(!i)throw new Error("getImageData");return e.width=t.width,e.height=t.height,i.drawImage(t,0,0),i.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function CR(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const MR=/^data:image\/svg\+xml/,OR=/\.svg((\?|#).*)?$/;function Cg(t){return t&&(MR.test(t)||OR.test(t))}function PR(t,e){if(Cg(e)){let n=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(o){throw new Error(o.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return vT(t,e)}function vT(t,e){if(Cg(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function TT(t,e,i){const n=PR(t,i),r=self.URL||self.webkitURL,o=typeof n!="string"&&r.createObjectURL(n);try{return await NR(o||n,e)}finally{o&&r.revokeObjectURL(o)}}async function NR(t,e){const i=new Image;return i.src=t,e.image&&e.image.decode&&i.decode?(await i.decode(),i):await new Promise((n,r)=>{try{i.onload=()=>n(i),i.onerror=o=>{const c=o instanceof Error?o.message:"error";r(new Error(c))}}catch(o){r(o)}})}const IR={};let b0=!0;async function DR(t,e,i){let n;Cg(i)?n=await TT(t,e,i):n=vT(t,i);const r=e&&e.imagebitmap;return await kR(n,r)}async function kR(t,e=null){if((BR(e)||!b0)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(i){console.warn(i),b0=!1}return await createImageBitmap(t)}function BR(t){for(const e in t||IR)return!1;return!0}function UR(t){return!VR(t,"ftyp",4)||!(t[8]&96)?null:FR(t)}function FR(t){switch(LR(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function LR(t,e,i){return String.fromCharCode(...t.slice(e,i))}function zR(t){return[...t].map(e=>e.charCodeAt(0))}function VR(t,e,i=0){const n=zR(e);for(let r=0;r<n.length;++r)if(n[r]!==t[r+i])return!1;return!0}const wi=!1,qa=!0;function ST(t){const e=fo(t);return jR(e)||$R(e)||WR(e)||XR(e)||HR(e)}function HR(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),i=UR(e);return i?{mimeType:i.mimeType,width:0,height:0}:null}function jR(t){const e=fo(t);return e.byteLength>=24&&e.getUint32(0,wi)===2303741511?{mimeType:"image/png",width:e.getUint32(16,wi),height:e.getUint32(20,wi)}:null}function WR(t){const e=fo(t);return e.byteLength>=10&&e.getUint32(0,wi)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,qa),height:e.getUint16(8,qa)}:null}function XR(t){const e=fo(t);return e.byteLength>=14&&e.getUint16(0,wi)===16973&&e.getUint32(2,qa)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,qa),height:e.getUint32(22,qa)}:null}function $R(t){const e=fo(t);if(!(e.byteLength>=3&&e.getUint16(0,wi)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:r}=YR();let o=2;for(;o+9<e.byteLength;){const c=e.getUint16(o,wi);if(r.has(c))return{mimeType:"image/jpeg",height:e.getUint16(o+5,wi),width:e.getUint16(o+7,wi)};if(!n.has(c))return null;o+=2,o+=e.getUint16(o,wi)}return null}function YR(){const t=new Set([65499,65476,65484,65501,65534]);for(let i=65504;i<65520;++i)t.add(i);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function fo(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function qR(t,e){var r;const{mimeType:i}=ST(t)||{},n=(r=globalThis.loaders)==null?void 0:r.parseImageNode;return hc(n),await n(t,i)}async function KR(t,e,i){e=e||{};const r=(e.image||{}).type||"auto",{url:o}=i||{},c=ZR(r);let f;switch(c){case"imagebitmap":f=await DR(t,e,o);break;case"image":f=await TT(t,e,o);break;case"data":f=await qR(t);break;default:hc(!1)}return r==="data"&&(f=xR(f)),f}function ZR(t){switch(t){case"auto":case"data":return wR();default:return ER(t),t}}const QR=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],GR=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],JR={image:{type:"auto",decode:!0}},ex={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:TR,mimeTypes:GR,extensions:QR,parse:KR,tests:[t=>!!ST(new DataView(t))],options:JR},Oe=new co({id:"deck"});let Md={};function tx(t){Md=t}function Rt(t,e,i,n){Oe.level>0&&Md[t]&&Md[t].call(null,e,i,n)}function ix(t){const e=t[0],i=t[t.length-1];return e==="{"&&i==="}"||e==="["&&i==="]"}const nx={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:ix,parseTextSync:JSON.parse};function sx(){const t="9.1.1",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(Oe.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:Oe,_registerLoggers:tx},Z3([nx,[ex,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const rx=sx();function Mg(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const Vh={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function ax(t){const e={};for(const[i,n]of Object.entries(t))e[i]=ox(n);return e}function ox(t){let e=v0(t);if(e!=="object")return{value:t,...Vh[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...Vh[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=v0(t.value),{...t,...Vh[e],type:e}):{type:"object",value:null};throw new Error("props")}function v0(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const lx=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,cx=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,ux={vertex:lx,fragment:cx},T0=/void\s+main\s*\([^)]*\)\s*\{\n?/,S0=/}\n?[^{}]*$/,Hh=[],ic="__LUMA_INJECT_DECLARATIONS__";function fx(t){const e={vertex:{},fragment:{}};for(const i in t){let n=t[i];const r=hx(i);typeof n=="string"&&(n={order:0,injection:n}),e[r][i]=n}return e}function hx(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function mc(t,e,i,n=!1){const r=e==="vertex";for(const o in i){const c=i[o];c.sort((h,g)=>h.order-g.order),Hh.length=c.length;for(let h=0,g=c.length;h<g;++h)Hh[h]=c[h].injection;const f=`${Hh.join(`
`)}
`;switch(o){case"vs:#decl":r&&(t=t.replace(ic,f));break;case"vs:#main-start":r&&(t=t.replace(T0,h=>h+f));break;case"vs:#main-end":r&&(t=t.replace(S0,h=>f+h));break;case"fs:#decl":r||(t=t.replace(ic,f));break;case"fs:#main-start":r||(t=t.replace(T0,h=>h+f));break;case"fs:#main-end":r||(t=t.replace(S0,h=>f+h));break;default:t=t.replace(o,h=>h+f)}}return t=t.replace(ic,""),n&&(t=t.replace(/\}\s*$/,o=>o+ux[e])),t}function yc(t){t.map(e=>dx(e))}function dx(t){if(t.instance)return;yc(t.dependencies||[]);const{propTypes:e={},deprecations:i=[],inject:n={}}=t,r={normalizedInjections:fx(n),parsedDeprecations:gx(i)};e&&(r.propValidators=ax(e)),t.instance=r;let o={};e&&(o=Object.entries(e).reduce((c,[f,h])=>{const g=h==null?void 0:h.value;return g&&(c[f]=g),c},{})),t.defaultUniforms={...t.defaultUniforms,...o}}function AT(t,e,i){var n;(n=t.deprecations)==null||n.forEach(r=>{var o;(o=r.regex)!=null&&o.test(e)&&(r.deprecated?i.deprecated(r.old,r.new)():i.removed(r.old,r.new)())})}function gx(t){return t.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),t}function Og(t){yc(t);const e={},i={};ET({modules:t,level:0,moduleMap:e,moduleDepth:i});const n=Object.keys(i).sort((r,o)=>i[o]-i[r]).map(r=>e[r]);return yc(n),n}function ET(t){const{modules:e,level:i,moduleMap:n,moduleDepth:r}=t;if(i>=5)throw new Error("Possible loop in shader dependency graph");for(const o of e)n[o.name]=o,(r[o.name]===void 0||r[o.name]<i)&&(r[o.name]=i);for(const o of e)o.dependencies&&ET({modules:o.dependencies,level:i+1,moduleMap:n,moduleDepth:r})}function px(t){switch(t==null?void 0:t.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function _x(t,e){var n;if(Number(((n=t.match(/^#version[ \t]+(\d+)/m))==null?void 0:n[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=A0(t,mx),t;case"fragment":return t=A0(t,yx),t;default:throw new Error(e)}}const wT=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],mx=[...wT,[Od("attribute"),"in $1"],[Od("varying"),"out $1"]],yx=[...wT,[Od("varying"),"in $1"]];function A0(t,e){for(const[i,n]of e)t=t.replace(i,n);return t}function Od(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function RT(t,e){let i="";for(const n in t){const r=t[n];if(i+=`void ${r.signature} {
`,r.header&&(i+=`  ${r.header}`),e[n]){const o=e[n];o.sort((c,f)=>c.order-f.order);for(const c of o)i+=`  ${c.injection}
`}r.footer&&(i+=`  ${r.footer}`),i+=`}
`}return i}function xT(t){const e={vertex:{},fragment:{}};for(const i of t){let n,r;typeof i!="string"?(n=i,r=n.hook):(n={},r=i),r=r.trim();const[o,c]=r.split(":"),f=r.replace(/\(.+/,""),h=Object.assign(n,{signature:c});switch(o){case"vs":e.vertex[f]=h;break;case"fs":e.fragment[f]=h;break;default:throw new Error(o)}}return e}function bx(t,e){return{name:vx(t,e),language:"glsl",version:Tx(t)}}function vx(t,e="unnamed"){const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return n?n[1]:e}function Tx(t){let e=100;const i=t.match(/[^\s]+/g);if(i&&i.length>=2&&i[0]==="#version"){const n=parseInt(i[1],10);Number.isFinite(n)&&(e=n)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const CT=`

${ic}
`,Sx=`precision highp float;
`;function Ax(t){const e=Og(t.modules||[]);return{source:wx(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:MT(e)}}function Ex(t){const{vs:e,fs:i}=t,n=Og(t.modules||[]);return{vs:E0(t.platformInfo,{...t,source:e,stage:"vertex",modules:n}),fs:E0(t.platformInfo,{...t,source:i,stage:"fragment",modules:n}),getUniforms:MT(n)}}function wx(t,e){var x;const{source:i,stage:n,modules:r,hookFunctions:o=[],inject:c={},log:f}=e;Mg(typeof i=="string","shader source must be a string");const h=i;let g="";const _=xT(o),m={},y={},T={};for(const O in c){const N=typeof c[O]=="string"?{injection:c[O],order:0}:c[O],B=/^(v|f)s:(#)?([\w-]+)$/.exec(O);if(B){const P=B[2],j=B[3];P?j==="decl"?y[O]=[N]:T[O]=[N]:m[O]=[N]}else T[O]=[N]}const R=r;for(const O of R){f&&AT(O,h,f);const N=OT(O,"wgsl");g+=N;const B=((x=O.injections)==null?void 0:x[n])||{};for(const P in B){const j=/^(v|f)s:#([\w-]+)$/.exec(P);if(j){const q=j[2]==="decl"?y:T;q[P]=q[P]||[],q[P].push(B[P])}else m[P]=m[P]||[],m[P].push(B[P])}}return g+=CT,g=mc(g,n,y),g+=RT(_[n],m),g+=h,g=mc(g,n,T),g}function E0(t,e){var ue;const{id:i,source:n,stage:r,language:o="glsl",modules:c,defines:f={},hookFunctions:h=[],inject:g={},prologue:_=!0,log:m}=e;Mg(typeof n=="string","shader source must be a string");const y=o==="glsl"?bx(n).version:-1,T=t.shaderLanguageVersion,R=y===100?"#version 100":"#version 300 es",O=n.split(`
`).slice(1).join(`
`),N={};c.forEach(oe=>{Object.assign(N,oe.defines)}),Object.assign(N,f);let B="";switch(o){case"wgsl":break;case"glsl":B=_?`${R}

// ----- PROLOGUE -------------------------
${Rx({id:i,source:n,stage:r})}
${`#define SHADER_TYPE_${r.toUpperCase()}`}

${px(t)}
${r==="fragment"?Sx:""}

// ----- APPLICATION DEFINES -------------------------

${xx(N)}

`:`${R}
`;break}const P=xT(h),j={},z={},q={};for(const oe in g){const G=typeof g[oe]=="string"?{injection:g[oe],order:0}:g[oe],ae=/^(v|f)s:(#)?([\w-]+)$/.exec(oe);if(ae){const te=ae[2],ge=ae[3];te?ge==="decl"?z[oe]=[G]:q[oe]=[G]:j[oe]=[G]}else q[oe]=[G]}for(const oe of c){m&&AT(oe,O,m);const G=OT(oe,r);B+=G;const ae=((ue=oe.instance)==null?void 0:ue.normalizedInjections[r])||{};for(const te in ae){const ge=/^(v|f)s:#([\w-]+)$/.exec(te);if(ge){const _e=ge[2]==="decl"?z:q;_e[te]=_e[te]||[],_e[te].push(ae[te])}else j[te]=j[te]||[],j[te].push(ae[te])}}return B+="// ----- MAIN SHADER SOURCE -------------------------",B+=CT,B=mc(B,r,z),B+=RT(P[r],j),B+=O,B=mc(B,r,q),o==="glsl"&&y!==T&&(B=_x(B,r)),B.trim()}function MT(t){return function(i){var r;const n={};for(const o of t){const c=(r=o.getUniforms)==null?void 0:r.call(o,i,n);Object.assign(n,c)}return n}}function Rx(t){const{id:e,source:i,stage:n}=t;return e&&i.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${n}`:""}function xx(t={}){let e="";for(const i in t){const n=t[i];(n||Number.isFinite(n))&&(e+=`#define ${i.toUpperCase()} ${t[i]}
`)}return e}function OT(t,e){let i;switch(e){case"vertex":i=t.vs||"";break;case"fragment":i=t.fs||"";break;case"wgsl":i=t.source||"";break;default:Mg(!1)}if(!t.name)throw new Error("Shader module must have a name");const n=t.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let r=`// ----- MODULE ${t.name} ---------------

`;return e!=="wgsl"&&(r+=`#define MODULE_${n}
`),r+=`${i}
`,r}const Cx=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,Mx=/^\s*\#\s*endif\s*$/;function Ox(t,e){var c;const i=t.split(`
`),n=[];let r=!0,o=null;for(const f of i){const h=f.match(Cx),g=f.match(Mx);h?(o=h[1],r=!!((c=e==null?void 0:e.defines)!=null&&c[o])):g?r=!0:r&&n.push(f)}return n.join(`
`)}const fs=class fs{constructor(){v(this,"_hookFunctions",[]);v(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return fs.defaultShaderAssembler=fs.defaultShaderAssembler||new fs,fs.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(i=>i.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const i=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==i)}addShaderHook(e,i){i&&(e=Object.assign(i,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const i=this._getModuleList(e.modules),n=this._hookFunctions,{source:r,getUniforms:o}=Ax({...e,source:e.source,modules:i,hookFunctions:n});return{source:e.platformInfo.shaderLanguage==="wgsl"?Ox(r):r,getUniforms:o,modules:i}}assembleGLSLShaderPair(e){const i=this._getModuleList(e.modules),n=this._hookFunctions;return{...Ex({...e,vs:e.vs,fs:e.fs,modules:i,hookFunctions:n}),modules:i}}_getModuleList(e=[]){const i=new Array(this._defaultModules.length+e.length),n={};let r=0;for(let o=0,c=this._defaultModules.length;o<c;++o){const f=this._defaultModules[o],h=f.name;i[r++]=f,n[h]=!0}for(let o=0,c=e.length;o<c;++o){const f=e[o],h=f.name;n[h]||(i[r++]=f,n[h]=!0)}return i.length=r,yc(i),i}};v(fs,"defaultShaderAssembler");let bc=fs;const Px=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,Nx=`#version 300 es
${Px}`;function Ix(t){const{input:e,inputChannels:i,output:n}={};if(!e)return Nx;if(!i)throw new Error("inputChannels");const r=Dx(i),o=kx(e,i);return`#version 300 es
in ${r} ${e};
out vec4 ${n};
void main() {
  ${n} = ${o};
}`}function Dx(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function kx(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}class Bx{constructor(){v(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new cu({id:e})),this.stats.get(e)}}const PT=new Bx,se=new co({id:"luma.gl"}),jh={};function fu(t="id"){jh[t]=jh[t]||1;const e=jh[t]++;return`${t}-${e}`}var Ad;let Ve=(Ad=class{constructor(e,i,n){v(this,"id");v(this,"props");v(this,"userData",{});v(this,"_device");v(this,"destroyed",!1);v(this,"allocatedBytes",0);v(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=Ux(i,n);const r=this.props.id!=="undefined"?this.props.id:fu(this[Symbol.toStringTag]);this.props.id=r,this.id=r,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),i=this[Symbol.toStringTag];e.get(`${i}s Active`).decrementCount()}trackAllocatedMemory(e,i=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(e),n.get(`${i} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").subtractCount(this.allocatedBytes),i.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),i=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${i}s Created`).incrementCount(),e.get(`${i}s Active`).incrementCount()}},v(Ad,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),Ad);function Ux(t,e){const i={...e};for(const n in t)t[n]!==void 0&&(i[n]=t[n]);return i}const yt=class yt extends Ve{constructor(i,n){const r={...n};(n.usage||0)&yt.INDEX&&!n.indexType&&(n.data instanceof Uint32Array?r.indexType="uint32":n.data instanceof Uint16Array&&(r.indexType="uint16")),delete r.data;super(i,r,yt.defaultProps);v(this,"usage");v(this,"indexType");v(this,"updateTimestamp");v(this,"debugData",new ArrayBuffer(0));this.usage=r.usage||0,this.indexType=r.indexType,this.updateTimestamp=i.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(i){return this.device.createBuffer({...this.props,...i})}readSyncWebGL(i,n){throw new Error("not implemented")}_setDebugData(i,n,r){const o=ArrayBuffer.isView(i)?i.buffer:i,c=Math.min(i?i.byteLength:r,yt.DEBUG_DATA_MAX_LENGTH);o===null?this.debugData=new ArrayBuffer(c):n===0&&r===o.byteLength?this.debugData=o.slice(0,c):this.debugData=o.slice(n,n+c)}};v(yt,"defaultProps",{...Ve.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),v(yt,"MAP_READ",1),v(yt,"MAP_WRITE",2),v(yt,"COPY_SRC",4),v(yt,"COPY_DST",8),v(yt,"INDEX",16),v(yt,"VERTEX",32),v(yt,"UNIFORM",64),v(yt,"STORAGE",128),v(yt,"INDIRECT",256),v(yt,"QUERY_RESOLVE",512),v(yt,"DEBUG_DATA_MAX_LENGTH",32);let $e=yt;function NT(t){const e=w0[t],i=Fx(e),n=t.includes("norm"),r=!n&&!t.startsWith("float"),o=t.startsWith("s");return{dataType:w0[t],byteLength:i,integer:r,signed:o,normalized:n}}function Fx(t){return Lx[t]}const w0={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},Lx={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},wt="texture-compression-bc",ze="texture-compression-astc",Ti="texture-compression-etc2",zx="texture-compression-etc1-webgl",Dl="texture-compression-pvrtc-webgl",Wh="texture-compression-atc-webgl",kl="float32-renderable-webgl",Xh="float16-renderable-webgl",Vx="rgb9e5ufloat-renderable-webgl",$h="snorm8-renderable-webgl",Ba="norm16-renderable-webgl",Yh="snorm16-renderable-webgl",Bl="float32-filterable",R0="float16-filterable-webgl";function IT(t){const e=Hx[t];if(!e)throw new Error(`Unsupported texture format ${t}`);return e}const Hx={r8unorm:{},r8snorm:{render:$h},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:$h},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:Xh,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:Ba},"r16snorm-webgl":{f:Yh},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:$h},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:Xh,filter:R0},"rg16unorm-webgl":{render:Ba},"rg16snorm-webgl":{render:Yh},r32uint:{},r32sint:{},r32float:{render:kl,filter:Bl},rgb9e5ufloat:{channels:"rgb",packed:!0,render:Vx},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:kl},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:Ba},"rgb16snorm-webgl":{f:Ba},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:Bl},rgba16uint:{},rgba16sint:{},rgba16float:{render:Xh,filter:R0},"rgba16unorm-webgl":{render:Ba},"rgba16snorm-webgl":{render:Yh},"rgb32float-webgl":{render:kl,filter:Bl},rgba32uint:{},rgba32sint:{},rgba32float:{render:kl,filter:Bl},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:wt},"bc1-rgb-unorm-srgb-webgl":{f:wt},"bc1-rgba-unorm":{f:wt},"bc1-rgba-unorm-srgb":{f:wt},"bc2-rgba-unorm":{f:wt},"bc2-rgba-unorm-srgb":{f:wt},"bc3-rgba-unorm":{f:wt},"bc3-rgba-unorm-srgb":{f:wt},"bc4-r-unorm":{f:wt},"bc4-r-snorm":{f:wt},"bc5-rg-unorm":{f:wt},"bc5-rg-snorm":{f:wt},"bc6h-rgb-ufloat":{f:wt},"bc6h-rgb-float":{f:wt},"bc7-rgba-unorm":{f:wt},"bc7-rgba-unorm-srgb":{f:wt},"etc2-rgb8unorm":{f:Ti},"etc2-rgb8unorm-srgb":{f:Ti},"etc2-rgb8a1unorm":{f:Ti},"etc2-rgb8a1unorm-srgb":{f:Ti},"etc2-rgba8unorm":{f:Ti},"etc2-rgba8unorm-srgb":{f:Ti},"eac-r11unorm":{f:Ti},"eac-r11snorm":{f:Ti},"eac-rg11unorm":{f:Ti},"eac-rg11snorm":{f:Ti},"astc-4x4-unorm":{f:ze},"astc-4x4-unorm-srgb":{f:ze},"astc-5x4-unorm":{f:ze},"astc-5x4-unorm-srgb":{f:ze},"astc-5x5-unorm":{f:ze},"astc-5x5-unorm-srgb":{f:ze},"astc-6x5-unorm":{f:ze},"astc-6x5-unorm-srgb":{f:ze},"astc-6x6-unorm":{f:ze},"astc-6x6-unorm-srgb":{f:ze},"astc-8x5-unorm":{f:ze},"astc-8x5-unorm-srgb":{f:ze},"astc-8x6-unorm":{f:ze},"astc-8x6-unorm-srgb":{f:ze},"astc-8x8-unorm":{f:ze},"astc-8x8-unorm-srgb":{f:ze},"astc-10x5-unorm":{f:ze},"astc-10x5-unorm-srgb":{f:ze},"astc-10x6-unorm":{f:ze},"astc-10x6-unorm-srgb":{f:ze},"astc-10x8-unorm":{f:ze},"astc-10x8-unorm-srgb":{f:ze},"astc-10x10-unorm":{f:ze},"astc-10x10-unorm-srgb":{f:ze},"astc-12x10-unorm":{f:ze},"astc-12x10-unorm-srgb":{f:ze},"astc-12x12-unorm":{f:ze},"astc-12x12-unorm-srgb":{f:ze},"pvrtc-rgb4unorm-webgl":{f:Dl},"pvrtc-rgba4unorm-webgl":{f:Dl},"pvrtc-rbg2unorm-webgl":{f:Dl},"pvrtc-rgba2unorm-webgl":{f:Dl},"etc1-rbg-unorm-webgl":{f:zx},"atc-rgb-unorm-webgl":{f:Wh},"atc-rgba-unorm-webgl":{f:Wh},"atc-rgbai-unorm-webgl":{f:Wh}},jx=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],Wx=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function DT(t){return jx.some(e=>t.startsWith(e))}function Pg(t){let e=Xx(t);if(DT(t)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const n=$x(t);n&&(e.blockWidth=n.blockWidth,e.blockHeight=n.blockHeight)}const i=Wx.exec(t);if(i){const[,n,r,o,c,f]=i,h=`${o}${r}`,g=NT(h),_=g.byteLength*8,m=n.length,y=[_,m>=2?_:0,m>=3?_:0,m>=4?_:0];e={format:t,attachment:e.attachment,dataType:g.dataType,components:m,channels:n,integer:g.integer,signed:g.signed,normalized:g.normalized,bitsPerChannel:y,bytesPerPixel:g.byteLength*n.length,packed:e.packed,srgb:e.srgb},f==="-webgl"&&(e.webgl=!0),c==="-srgb"&&(e.srgb=!0)}return t.endsWith("-webgl")&&(e.webgl=!0),t.endsWith("-srgb")&&(e.srgb=!0),e}function Xx(t){var o;const e=IT(t),i=e.bytesPerPixel||1,n=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:t,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||((o=e.channels)==null?void 0:o.length)||1,bytesPerPixel:i,bitsPerChannel:n,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function $x(t){const i=/.*-(\d+)x(\d+)-.*/.exec(t);if(i){const[,n,r]=i;return{blockWidth:Number(n),blockHeight:Number(r)}}return null}function Yx(t){const e=IT(t),i={format:t,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},n=Pg(t),r=t.startsWith("depth")||t.startsWith("stencil"),o=n==null?void 0:n.signed,c=n==null?void 0:n.integer,f=n==null?void 0:n.webgl;return i.render&&(i.render=!o),i.filter&&(i.filter=!r&&!o&&!c&&!f),i}class qx{}class Kx{constructor(e=[],i){v(this,"features");v(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=i||{}}*[Symbol.iterator](){yield*this.features}has(e){var i;return!((i=this.disabledFeatures)!=null&&i[e])&&this.features.has(e)}}const Yc=class Yc{constructor(e){v(this,"id");v(this,"props");v(this,"userData",{});v(this,"statsManager",PT);v(this,"timestamp",0);v(this,"_reused",!1);v(this,"_lumaData",{});this.props={...Yc.defaultProps,...e},this.id=this.props.id||fu(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}getTextureFormatCapabilities(e){const i=Yx(e),n=c=>(typeof c=="string"?this.features.has(c):c)??!0,r=n(i.create),o={format:e,create:r,render:r&&n(i.render),filter:r&&n(i.filter),blend:r&&n(i.blend),store:r&&n(i.store)};return this._getDeviceSpecificTextureFormatCapabilities(o)}isTextureFormatSupported(e,i){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return DT(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,i){throw new Error("not implemented")}readPixelsToBufferWebGL(e,i){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,i){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const i={...e};return(e.usage||0)&$e.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?i.indexType="uint32":e.data instanceof Uint16Array?i.indexType="uint16":se.warn("indices buffer content must be of integer type")()),i}};v(Yc,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>se.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:se.get("debug")||void 0,debugShaders:se.get("debug-shaders")||void 0,debugFramebuffers:!!se.get("debug-framebuffers"),debugWebGL:!!se.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0});let Dn=Yc;const Zx=Ss()&&typeof document<"u",Qx=()=>Zx&&document.readyState==="complete",Gx="set luma.log.level=1 (or higher) to trace rendering",x0="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",Mn=class Mn{constructor(){v(this,"stats",PT);v(this,"log",se);v(this,"VERSION","9.1.2");v(this,"spector");v(this,"preregisteredAdapters",new Map);if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw se.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),se.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");se.error("This version of luma.gl has already been initialized")()}se.log(1,`${this.VERSION} - ${Gx}`)(),globalThis.luma=this}registerAdapters(e){for(const i of e)this.preregisteredAdapters.set(i.type,i)}getSupportedAdapters(e=[]){const i=this.getAdapterMap(e);return Array.from(i).map(([,n])=>n).filter(n=>{var r;return(r=n.isSupported)==null?void 0:r.call(n)}).map(n=>n.type)}getBestAvailableAdapter(e=[]){var n,r,o,c;const i=this.getAdapterMap(e);return(r=(n=i.get("webgpu"))==null?void 0:n.isSupported)!=null&&r.call(n)?"webgpu":(c=(o=i.get("webgl"))==null?void 0:o.isSupported)!=null&&c.call(o)?"webgl":null}setDefaultDeviceProps(e){Object.assign(Mn.defaultProps,e)}async createDevice(e={}){var f;e={...Mn.defaultProps,...e},e.waitForPageLoad&&await Mn.pageLoaded;const i=this.getAdapterMap(e.adapters);let n=e.type||"";n==="best-available"&&(n=this.getBestAvailableAdapter(e.adapters)||n);const o=(this.getAdapterMap(e.adapters)||i).get(n),c=await((f=o==null?void 0:o.create)==null?void 0:f.call(o,e));if(c)return c;throw new Error(x0)}async attachDevice(e){var c;const i=this.getAdapterMap(e.adapters);let n="";e.handle instanceof WebGL2RenderingContext&&(n="webgl"),e.createCanvasContext&&await Mn.pageLoaded,e.handle===null&&(n="unknown");const r=i.get(n),o=await((c=r==null?void 0:r.attach)==null?void 0:c.call(r,null));if(o)return o;throw new Error(x0)}enforceWebGL2(e=!0,i=[]){var o;const r=this.getAdapterMap(i).get("webgl");r||se.warn("enforceWebGL2: webgl adapter not found")(),(o=r==null?void 0:r.enforceWebGL2)==null||o.call(r,e)}getAdapterMap(e=[]){const i=new Map(this.preregisteredAdapters);for(const n of e)i.set(n.type,n);return i}registerDevices(e){se.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const i of e){const n=i.adapter;n&&this.preregisteredAdapters.set(n.type,n)}}};v(Mn,"defaultProps",{...Dn.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0}),v(Mn,"pageLoaded",Jx().then(()=>{se.probe(2,"DOM is loaded")()}));let Pd=Mn;const Nd=new Pd;function Jx(){return Qx()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}class e2{}const qc=class qc{constructor(e){v(this,"id");v(this,"props");v(this,"canvas");v(this,"htmlCanvas");v(this,"offscreenCanvas");v(this,"type");v(this,"width",1);v(this,"height",1);v(this,"resizeObserver");v(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...qc.defaultProps,...e},e=this.props,!Ss()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=i2(e.canvas):this.canvas=e.canvas;else{const i=n2(e),n=t2((e==null?void 0:e.container)||null);n.insertBefore(i,n.firstChild),this.canvas=i,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(i=>{for(const n of i)n.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),i=this.canvas;return i.parentElement?[i.clientWidth*e,i.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,i]=this.getPixelSize();return e/i}cssToDeviceRatio(){var e;try{const[i]=this.getDrawingBufferSize(),n=this._canvasSizeInfo.clientWidth||((e=this.htmlCanvas)==null?void 0:e.clientWidth);return n?i/n:1}catch{return 1}}cssToDevicePixels(e,i=!0){const n=this.cssToDeviceRatio(),[r,o]=this.getDrawingBufferSize();return s2(e,n,r,o,i)}setDevicePixelRatio(e,i={}){if(!this.htmlCanvas)return;let n="width"in i?i.width:this.htmlCanvas.clientWidth,r="height"in i?i.height:this.htmlCanvas.clientHeight;(!n||!r)&&(se.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,n=this.htmlCanvas.width||1,r=this.htmlCanvas.height||1);const o=this._canvasSizeInfo;if(o.clientWidth!==n||o.clientHeight!==r||o.devicePixelRatio!==e){let c=e;const f=Math.floor(n*c),h=Math.floor(r*c);if(this.htmlCanvas.width=f,this.htmlCanvas.height=h,this.device.gl){const[_,m]=this.getDrawingBufferSize();(_!==f||m!==h)&&(c=Math.min(_/n,m/r),this.htmlCanvas.width=Math.floor(n*c),this.htmlCanvas.height=Math.floor(r*c),se.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=n,this._canvasSizeInfo.clientHeight=r,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;if(!e)throw new Error("canvas size");return[e.drawingBufferWidth,e.drawingBufferHeight]}_setAutoCreatedCanvasId(e){var i;((i=this.htmlCanvas)==null?void 0:i.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}};v(qc,"defaultProps",{canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"});let Id=qc;function t2(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function i2(t){const e=document.getElementById(t);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function n2(t){const{width:e,height:i}=t,n=document.createElement("canvas");return n.id=fu("lumagl-auto-created-canvas"),n.width=e||1,n.height=i||1,n.style.width=Number.isFinite(e)?`${e}px`:"100%",n.style.height=Number.isFinite(i)?`${i}px`:"100%",n}function s2(t,e,i,n,r){const o=t,c=C0(o[0],e,i);let f=M0(o[1],e,n,r),h=C0(o[0]+1,e,i);const g=h===i-1?h:h-1;h=M0(o[1]+1,e,n,r);let _;return r?(h=h===0?h:h+1,_=f,f=h):_=h===n-1?h:h-1,{x:c,y:f,width:Math.max(g-c+1,1),height:Math.max(_-f+1,1)}}function C0(t,e,i){return Math.min(Math.round(t*e),i-1)}function M0(t,e,i,n){return n?Math.max(0,i-1-Math.round(t*e)):Math.min(Math.round(t*e),i-1)}const bt=class bt extends Ve{constructor(i,n){n=bt.normalizeProps(i,n);super(i,n,bt.defaultProps);v(this,"dimension");v(this,"format");v(this,"width");v(this,"height");v(this,"depth");v(this,"mipLevels");v(this,"updateTimestamp");if(this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const r=bt.getTextureDataSize(this.props.data);this.width=(r==null?void 0:r.width)||1,this.height=(r==null?void 0:r.height)||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?bt.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=i.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}clone(i){return this.device.createTexture({...this.props,...i})}static isExternalImage(i){return typeof ImageData<"u"&&i instanceof ImageData||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement||typeof VideoFrame<"u"&&i instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas}static getExternalImageSize(i){if(typeof ImageData<"u"&&i instanceof ImageData||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas)return{width:i.width,height:i.height};if(typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement)return{width:i.naturalWidth,height:i.naturalHeight};if(typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement)return{width:i.videoWidth,height:i.videoHeight};if(typeof VideoFrame<"u"&&i instanceof VideoFrame)return{width:i.displayWidth,height:i.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(i){const n=i==null?void 0:i.data;return ArrayBuffer.isView(n)}static getTextureDataSize(i){if(!i||ArrayBuffer.isView(i))return null;if(Array.isArray(i))return bt.getTextureDataSize(i[0]);if(bt.isExternalImage(i))return bt.getExternalImageSize(i);if(i&&typeof i=="object"&&i.constructor===Object){const r=Object.values(i)[0];return{width:r.width,height:r.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(i,n){let r;return ArrayBuffer.isView(i)?r=[{data:i,width:n.width,height:n.height}]:Array.isArray(i)?r=i:r=[i],r}static getMipLevelCount(i,n){return Math.floor(Math.log2(Math.max(i,n)))+1}static getCubeFaceDepth(i){switch(i){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(i)}}static normalizeProps(i,n){var h,g;const r={...n},o=((g=(h=i==null?void 0:i.props)==null?void 0:h._resourceDefaults)==null?void 0:g.texture)||{};Object.assign(r,o);const{width:c,height:f}=r;return typeof c=="number"&&(r.width=Math.max(1,Math.ceil(c))),typeof f=="number"&&(r.height=Math.max(1,Math.ceil(f))),r}};v(bt,"COPY_SRC",1),v(bt,"COPY_DST",2),v(bt,"TEXTURE",4),v(bt,"STORAGE",8),v(bt,"RENDER_ATTACHMENT",16),v(bt,"CubeFaces",["+X","-X","+Y","-Y","+Z","-Z"]),v(bt,"defaultProps",{...Ve.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0}),v(bt,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let et=bt;const Kc=class Kc extends Ve{get[Symbol.toStringTag](){return"TextureView"}constructor(e,i){super(e,i,Kc.defaultProps)}};v(Kc,"defaultProps",{...Ve.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let vc=Kc;function r2(t,e,i){let n="";const r=e.split(/\r?\n/),o=t.slice().sort((c,f)=>c.lineNum-f.lineNum);switch((i==null?void 0:i.showSourceCode)||"no"){case"all":let c=0;for(let f=1;f<=r.length;f++)for(n+=kT(r[f-1],f,i);o.length>c&&o[c].lineNum===f;){const h=o[c++];n+=O0(h,r,h.lineNum,{...i,inlineSource:!1})}return n;case"issues":case"no":for(const f of t)n+=O0(f,r,f.lineNum,{inlineSource:(i==null?void 0:i.showSourceCode)!=="no"});return n}}function O0(t,e,i,n){if(n!=null&&n.inlineSource){const o=a2(e,i),c=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${o}${c}${t.type.toUpperCase()}: ${t.message}

`}const r=t.type==="error"?"red":"#8B4000";return n!=null&&n.html?`<div class='luma-compiler-log-error' style="color:${r};"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function a2(t,e,i){let n="";for(let r=e-2;r<=e;r++){const o=t[r-1];o!==void 0&&(n+=kT(o,e,i))}return n}function kT(t,e,i){const n=i!=null&&i.html?l2(t):t;return`${o2(String(e),4)}: ${n}${i!=null&&i.html?"<br/>":`
`}`}function o2(t,e){let i="";for(let n=t.length;n<e;++n)i+=" ";return i+t}function l2(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const Zc=class Zc extends Ve{constructor(i,n){n={...n,debugShaders:n.debugShaders||i.props.debugShaders||"errors"};super(i,{id:c2(n),...n},Zc.defaultProps);v(this,"stage");v(this,"source");v(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const i=this.props.debugShaders;switch(i){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const n=await this.getCompilationInfo();i==="warnings"&&(n==null?void 0:n.length)===0||this._displayShaderLog(n)}_displayShaderLog(i){var g;if(typeof document>"u"||!(document!=null&&document.createElement))return;const n=BT(this.source),r=`${this.stage} ${n}`;let o=r2(i,this.source,{showSourceCode:"all",html:!0});const c=this.getTranslatedSource();c&&(o+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${c}</pre></code>`);const f=document.createElement("Button");f.innerHTML=`
<h1>Shader Compilation Error in ${r}</h1><br /><br />
<code style="user-select:text;"><pre>
${o}
</pre></code>`,f.style.top="10px",f.style.left="10px",f.style.position="absolute",f.style.zIndex="9999",f.style.width="100%",f.style.textAlign="left",document.body.appendChild(f),(g=document.getElementsByClassName("luma-compiler-log-error")[0])==null||g.scrollIntoView(),f.onclick=()=>{const _=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(_)}}};v(Zc,"defaultProps",{...Ve.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let Tc=Zc;function c2(t){return BT(t.source)||t.id||fu(`unnamed ${t.stage}-shader`)}function BT(t,e="unnamed"){const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return n?n[1]:e}const Ga=class Ga extends Ve{get[Symbol.toStringTag](){return"Sampler"}constructor(e,i){i=Ga.normalizeProps(e,i),super(e,i,Ga.defaultProps)}static normalizeProps(e,i){var o,c;const n=((c=(o=e==null?void 0:e.props)==null?void 0:o._resourceDefaults)==null?void 0:c.sampler)||{};return{...i,...n}}};v(Ga,"defaultProps",{...Ve.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let Sc=Ga;const Qc=class Qc extends Ve{constructor(i,n={}){super(i,n,Qc.defaultProps);v(this,"width");v(this,"height");this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(i){const n=this.colorAttachments.map(o=>o.texture.clone(i)),r=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(i);return this.device.createFramebuffer({...this.props,colorAttachments:n,depthStencilAttachment:r})}resize(i){let n=!i;if(i){const[r,o]=Array.isArray(i)?i:[i.width,i.height];n=n||o!==this.height||r!==this.width,this.width=r,this.height=o}n&&(se.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((n,r)=>{if(typeof n=="string"){const o=this.createColorTexture(n,r);return this.attachResource(o),o.view}return n instanceof et?n.view:n});const i=this.props.depthStencilAttachment;if(i)if(typeof i=="string"){const n=this.createDepthStencilTexture(i);this.attachResource(n),this.depthStencilAttachment=n.view}else i instanceof et?this.depthStencilAttachment=i.view:this.depthStencilAttachment=i}createColorTexture(i,n){return this.device.createTexture({id:`${this.id}-color-attachment-${n}`,usage:et.RENDER_ATTACHMENT,format:i,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(i){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:et.RENDER_ATTACHMENT,format:i,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(i,n){for(let r=0;r<this.colorAttachments.length;++r)if(this.colorAttachments[r]){const o=this.colorAttachments[r].texture.clone({width:i,height:n});this.destroyAttachedResource(this.colorAttachments[r]),this.colorAttachments[r]=o.view,this.attachResource(o.view)}if(this.depthStencilAttachment){const r=this.depthStencilAttachment.texture.clone({width:i,height:n});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=r.view,this.attachResource(r)}this.updateAttachments()}};v(Qc,"defaultProps",{...Ve.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let Ac=Qc;const Gc=class Gc extends Ve{constructor(i,n){super(i,n,Gc.defaultProps);v(this,"shaderLayout");v(this,"bufferLayout");v(this,"linkStatus","pending");v(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(i){throw new Error("Use uniform blocks")}};v(Gc,"defaultProps",{...Ve.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let Rr=Gc;const ci=class ci extends Ve{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,i){i=ci.normalizeProps(e,i),super(e,i,ci.defaultProps)}static normalizeProps(e,i){var o;return{...(o=e.props._resourceDefaults)==null?void 0:o.renderPass,...i}}};v(ci,"defaultClearColor",[0,0,0,1]),v(ci,"defaultClearDepth",1),v(ci,"defaultClearStencil",0),v(ci,"defaultProps",{...Ve.defaultProps,framebuffer:null,parameters:void 0,clearColor:ci.defaultClearColor,clearColors:void 0,clearDepth:ci.defaultClearDepth,clearStencil:ci.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let Dd=ci;const Jc=class Jc extends Ve{constructor(i,n){super(i,n,Jc.defaultProps);v(this,"hash","");v(this,"shaderLayout");this.shaderLayout=n.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};v(Jc,"defaultProps",{...Ve.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let Ec=Jc;const eu=class eu extends Ve{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,i){super(e,i,eu.defaultProps)}};v(eu,"defaultProps",{...Ve.defaultProps,measureExecutionTime:void 0});let kd=eu;const tu=class tu extends Ve{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,i){super(e,i,tu.defaultProps)}};v(tu,"defaultProps",{...Ve.defaultProps});let Bd=tu;function u2(t){const[e,i]=h2[t],n=e==="i32"||e==="u32",r=e!=="u32",o=d2[e]*i,c=f2(e,i);return{dataType:e,components:i,defaultVertexFormat:c,byteLength:o,integer:n,signed:r}}function f2(t,e){let i;switch(t){case"f32":i="float32";break;case"i32":i="sint32";break;case"u32":i="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?i:`${i}x${e}`}const h2={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},d2={f32:4,f16:2,i32:4,u32:4};function UT(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[i,n]=t.split("x"),r=i,o=n?parseInt(n):1,c=NT(r),f={type:r,components:o,byteLength:c.byteLength*o,integer:c.integer,signed:c.signed,normalized:c.normalized};return e&&(f.webglOnly=!0),f}function FT(t,e){const i={};for(const n of t.attributes){const r=p2(t,e,n.name);r&&(i[n.name]=r)}return i}function g2(t,e,i=16){const n=FT(t,e),r=new Array(i).fill(null);for(const o of Object.values(n))r[o.location]=o;return r}function p2(t,e,i){const n=_2(t,i),r=m2(e,i);if(!n)return null;const o=u2(n.type),c=(r==null?void 0:r.vertexFormat)||o.defaultVertexFormat,f=UT(c);return{attributeName:(r==null?void 0:r.attributeName)||n.name,bufferName:(r==null?void 0:r.bufferName)||n.name,location:n.location,shaderType:n.type,shaderDataType:o.dataType,shaderComponents:o.components,vertexFormat:c,bufferDataType:f.type,bufferComponents:f.components,normalized:f.normalized,integer:o.integer,stepMode:(r==null?void 0:r.stepMode)||n.stepMode||"vertex",byteOffset:(r==null?void 0:r.byteOffset)||0,byteStride:(r==null?void 0:r.byteStride)||0}}function _2(t,e){const i=t.attributes.find(n=>n.name===e);return i||se.warn(`shader layout attribute "${e}" not present in shader`),i||null}function m2(t,e){y2(t);let i=b2(t,e);return i||(i=v2(t,e),i)?i:(se.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function y2(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&se.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function b2(t,e){for(const i of t)if(i.format&&i.name===e)return{attributeName:i.name,bufferName:e,stepMode:i.stepMode,vertexFormat:i.format,byteOffset:0,byteStride:i.byteStride||0};return null}function v2(t,e){var i;for(const n of t){let r=n.byteStride;if(typeof n.byteStride!="number")for(const c of n.attributes||[]){const f=UT(c.format);r+=f.byteLength}const o=(i=n.attributes)==null?void 0:i.find(c=>c.attribute===e);if(o)return{attributeName:o.attribute,bufferName:n.name,stepMode:n.stepMode,vertexFormat:o.format,byteOffset:o.byteOffset,byteStride:r}}return null}const iu=class iu extends Ve{constructor(i,n){super(i,n,iu.defaultProps);v(this,"maxVertexAttributes");v(this,"attributeInfos");v(this,"indexBuffer",null);v(this,"attributes");this.maxVertexAttributes=i.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:r,bufferLayout:o}=n.renderPipeline||{};if(!r||!o)throw new Error("VertexArray");this.attributeInfos=g2(r,o,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(i,n){throw new Error("constant attributes not supported")}};v(iu,"defaultProps",{...Ve.defaultProps,renderPipeline:null});let Ud=iu;const nu=class nu extends Ve{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,i){super(e,i,nu.defaultProps)}};v(nu,"defaultProps",{...Ve.defaultProps,layout:void 0,buffers:{}});let Fd=nu;const su=class su extends Ve{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,i){super(e,i,su.defaultProps)}};v(su,"defaultProps",{...Ve.defaultProps,type:void 0,count:void 0});let Ld=su;const T2={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function S2(t){return T2[t]}function A2(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let Ul;function LT(t){return(!Ul||Ul.byteLength<t)&&(Ul=new ArrayBuffer(t)),Ul}function E2(t,e){const i=LT(t.BYTES_PER_ELEMENT*e);return new t(i,0,e)}function w2(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function wc(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":w2(t)}const P0=1024;class R2{constructor(e){v(this,"layout",{});v(this,"byteLength");let i=0;for(const[r,o]of Object.entries(e)){const c=S2(o),{type:f,components:h}=c;i=A2(i,h);const g=i;i+=h,this.layout[r]={type:f,size:h,offset:g}}i+=(4-i%4)%4;const n=i*4;this.byteLength=Math.max(n,P0)}getData(e){const i=Math.max(this.byteLength,P0),n=LT(i),r={i32:new Int32Array(n),u32:new Uint32Array(n),f32:new Float32Array(n),f16:new Uint16Array(n)};for(const[o,c]of Object.entries(e)){const f=this.layout[o];if(!f){se.warn(`Supplied uniform value ${o} not present in uniform block layout`)();continue}const{type:h,size:g,offset:_}=f,m=r[h];if(g===1){if(typeof c!="number"&&typeof c!="boolean"){se.warn(`Supplied value for single component uniform ${o} is not a number: ${c}`)();continue}m[_]=Number(c)}else{if(!wc(c)){se.warn(`Supplied value for multi component / array uniform ${o} is not a numeric array: ${c}`)();continue}m.set(c,_)}}return new Uint8Array(n)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function x2(t,e,i=16){if(t!==e)return!1;const n=t,r=e;if(!wc(n))return!1;if(wc(r)&&n.length===r.length){for(let o=0;o<n.length;++o)if(r[o]!==n[o])return!1}return!0}function C2(t){return wc(t)?t.slice():t}class M2{constructor(e){v(this,"name");v(this,"uniforms",{});v(this,"modifiedUniforms",{});v(this,"modified",!0);v(this,"bindingLayout",{});v(this,"needsRedraw","initialized");var i;if(this.name=(e==null?void 0:e.name)||"unnamed",e!=null&&e.name&&(e!=null&&e.shaderLayout)){const n=(i=e==null?void 0:e.shaderLayout.bindings)==null?void 0:i.find(o=>o.type==="uniform"&&o.name===(e==null?void 0:e.name));if(!n)throw new Error(e==null?void 0:e.name);const r=n;for(const o of r.uniforms||[])this.bindingLayout[o.name]=o}}setUniforms(e){for(const[i,n]of Object.entries(e))this._setUniform(i,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${i}=${n}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,i){x2(this.uniforms[e],i)||(this.uniforms[e]=C2(i),this.modifiedUniforms[e]=!0,this.modified=!0)}}class O2{constructor(e){v(this,"uniformBlocks",new Map);v(this,"uniformBufferLayouts",new Map);v(this,"uniformBuffers",new Map);for(const[i,n]of Object.entries(e)){const r=i,o=new R2(n.uniformTypes||{});this.uniformBufferLayouts.set(r,o);const c=new M2({name:i});c.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(r,c)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){var i;for(const[n,r]of Object.entries(e))(i=this.uniformBlocks.get(n))==null||i.setUniforms(r);this.updateUniformBuffers()}getUniformBufferByteLength(e){var i;return((i=this.uniformBufferLayouts.get(e))==null?void 0:i.byteLength)||0}getUniformBufferData(e){var n,r;const i=((n=this.uniformBlocks.get(e))==null?void 0:n.getAllUniforms())||{};return(r=this.uniformBufferLayouts.get(e))==null?void 0:r.getData(i)}createUniformBuffer(e,i,n){n&&this.setUniforms(n);const r=this.getUniformBufferByteLength(i),o=e.createBuffer({usage:$e.UNIFORM|$e.COPY_DST,byteLength:r}),c=this.getUniformBufferData(i);return o.write(c),o}getManagedUniformBuffer(e,i){if(!this.uniformBuffers.get(i)){const n=this.getUniformBufferByteLength(i),r=e.createBuffer({usage:$e.UNIFORM|$e.COPY_DST,byteLength:n});this.uniformBuffers.set(i,r)}return this.uniformBuffers.get(i)}updateUniformBuffers(){let e=!1;for(const i of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(i);e||(e=n)}return e&&se.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){var o;const i=this.uniformBlocks.get(e);let n=this.uniformBuffers.get(e),r=!1;if(n&&(i!=null&&i.needsRedraw)){r||(r=i.needsRedraw);const c=this.getUniformBufferData(e);n=this.uniformBuffers.get(e),n==null||n.write(c);const f=(o=this.uniformBlocks.get(e))==null?void 0:o.getAllUniforms();se.log(4,`Writing to uniform buffer ${String(e)}`,c,f)()}return r}}function zT(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function VT(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function P2(t,e,i){if(!e||e>4)throw new Error(`size ${e}`);const n=e;let r=zT(t);if(r==="uint8"&&i&&n===1)return"unorm8-webgl";if(r==="uint8"&&i&&n===3)return"unorm8x3-webgl";if(r==="uint8"||r==="sint8"){if(n===1||n===3)throw new Error(`size: ${e}`);return i&&(r=r.replace("int","norm")),`${r}x${n}`}if(r==="uint16"||r==="sint16"){if(n===1||n===3)throw new Error(`size: ${e}`);return i&&(r=r.replace("int","norm")),`${r}x${n}`}return n===1?r:`${r}x${n}`}class qh{constructor(e){v(this,"bufferLayouts");this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(i=>i.name===e)||null}getAttributeNamesForBuffer(e){var i;return e.attributes?(i=e.attributes)==null?void 0:i.map(n=>n.attribute):[e.name]}mergeBufferLayouts(e,i){const n=[...e];for(const r of i){const o=n.findIndex(c=>c.name===r.name);o<0?n.push(r):n[o]=r}return n}}class N2{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class Qi{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}search(e){}searchBlock(e,i){if(e){i(Rc.instance);for(const n of e)n instanceof Array?this.searchBlock(n,i):n.search(i);i(xc.instance)}}}class Rc extends Qi{}Rc.instance=new Rc;class xc extends Qi{}xc.instance=new xc;class Ye extends Qi{constructor(){super()}}class zd extends Ye{constructor(e,i,n,r,o,c){super(),this.calls=new Set,this.name=e,this.args=i,this.returnType=n,this.body=r,this.startLine=o,this.endLine=c}get astNodeType(){return"function"}search(e){this.searchBlock(this.body,e)}}class I2 extends Ye{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class D2 extends Ye{constructor(e,i){super(),this.condition=e,this.body=i}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class k2 extends Ye{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class B2 extends Ye{constructor(e,i,n,r){super(),this.init=e,this.condition=i,this.increment=n,this.body=r}get astNodeType(){return"for"}search(e){var i,n,r;(i=this.init)===null||i===void 0||i.search(e),(n=this.condition)===null||n===void 0||n.search(e),(r=this.increment)===null||r===void 0||r.search(e),this.searchBlock(this.body,e)}}class us extends Ye{constructor(e,i,n,r,o){super(),this.name=e,this.type=i,this.storage=n,this.access=r,this.value=o}get astNodeType(){return"var"}search(e){var i;e(this),(i=this.value)===null||i===void 0||i.search(e)}}class HT extends Ye{constructor(e,i,n){super(),this.name=e,this.type=i,this.value=n}get astNodeType(){return"override"}search(e){var i;(i=this.value)===null||i===void 0||i.search(e)}}class Vd extends Ye{constructor(e,i,n,r,o){super(),this.name=e,this.type=i,this.storage=n,this.access=r,this.value=o}get astNodeType(){return"let"}search(e){var i;e(this),(i=this.value)===null||i===void 0||i.search(e)}}class N0 extends Ye{constructor(e,i,n,r,o){super(),this.name=e,this.type=i,this.storage=n,this.access=r,this.value=o}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}search(e){var i;e(this),(i=this.value)===null||i===void 0||i.search(e)}}var xr;(function(t){t.increment="++",t.decrement="--"})(xr||(xr={}));(function(t){function e(i){const n=i;if(n=="parse")throw new Error("Invalid value for IncrementOperator");return t[n]}t.parse=e})(xr||(xr={}));class U2 extends Ye{constructor(e,i){super(),this.operator=e,this.variable=i}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}var eo;(function(t){t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(eo||(eo={}));(function(t){function e(i){const n=i;if(n=="parse")throw new Error("Invalid value for AssignOperator");return n}t.parse=e})(eo||(eo={}));class F2 extends Ye{constructor(e,i,n){super(),this.operator=e,this.variable=i,this.value=n}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class jT extends Ye{constructor(e,i){super(),this.name=e,this.args=i}get astNodeType(){return"call"}search(e){for(const i of this.args)i.search(e);e(this)}}class L2 extends Ye{constructor(e,i){super(),this.body=e,this.continuing=i}get astNodeType(){return"loop"}}class z2 extends Ye{constructor(e,i){super(),this.condition=e,this.body=i}get astNodeType(){return"body"}}class V2 extends Ye{constructor(e,i,n,r){super(),this.condition=e,this.body=i,this.elseif=n,this.else=r}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class H2 extends Ye{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var i;(i=this.value)===null||i===void 0||i.search(e)}}class j2 extends Ye{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class W2 extends Ye{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class X2 extends Ye{constructor(e,i){super(),this.severity=e,this.rule=i}get astNodeType(){return"diagnostic"}}class WT extends Ye{constructor(e,i){super(),this.name=e,this.type=i}get astNodeType(){return"alias"}}class $2 extends Ye{constructor(){super()}get astNodeType(){return"discard"}}class Y2 extends Ye{constructor(){super()}get astNodeType(){return"break"}}class q2 extends Ye{constructor(){super()}get astNodeType(){return"continue"}}class ws extends Ye{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class cs extends ws{constructor(e,i,n,r){super(e),this.members=i,this.startLine=n,this.endLine=r}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let i=0;i<this.members.length;i++)if(this.members[i].name==e)return i;return-1}}class XT extends ws{constructor(e,i,n){super(e),this.format=i,this.access=n}get astNodeType(){return"template"}}class K2 extends ws{constructor(e,i,n,r){super(e),this.storage=i,this.type=n,this.access=r}get astNodeType(){return"pointer"}}class $T extends ws{constructor(e,i,n,r){super(e),this.attributes=i,this.format=n,this.count=r}get astNodeType(){return"array"}get isArray(){return!0}}class Ha extends ws{constructor(e,i,n){super(e),this.format=i,this.access=n}get astNodeType(){return"sampler"}}class Oi extends Qi{constructor(){super()}}class Z2 extends Oi{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class gr extends Oi{constructor(e,i){super(),this.type=e,this.args=i}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const i of this.args)i.search(e)}evaluate(e){return this.args[0].evaluate(e)}}class YT extends Oi{constructor(e,i){super(),this.name=e,this.args=i}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return this.args[0].evaluate(e)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}search(e){for(const i of this.args)i.search(e);e(this)}}class Hd extends Oi{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}evaluate(e){const i=e.constants.get(this.name);if(!i)throw new Error("Cannot evaluate node");return i.evaluate(e)}}class I0 extends Oi{constructor(e,i){super(),this.name=e,this.initializer=i}get astNodeType(){return"constExpr"}evaluate(e){var i,n;if(this.initializer instanceof gr){const r=(i=this.postfix)===null||i===void 0?void 0:i.evaluateString(e),o=(n=this.initializer.type)===null||n===void 0?void 0:n.name,c=e.structs.get(o),f=c==null?void 0:c.getMemberIndex(r);return f!==void 0&&f!=-1?this.initializer.args[f].evaluate(e):this.initializer.evaluate(e)}return this.initializer.evaluate(e)}search(e){this.initializer.search(e)}}class D0 extends Oi{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class Q2 extends Oi{constructor(e,i){super(),this.type=e,this.value=i}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class k0 extends Oi{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}search(e){this.searchBlock(this.contents,e)}}class G2 extends Oi{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class qT extends Oi{constructor(){super()}}class J2 extends qT{constructor(e,i){super(),this.operator=e,this.right=i}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}search(e){this.right.search(e)}}class Si extends qT{constructor(e,i,n){super(),this.operator=e,this.left=i,this.right=n}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}search(e){this.left.search(e),this.right.search(e)}}class KT extends Qi{constructor(){super()}}class eC extends KT{constructor(e,i){super(),this.selector=e,this.body=i}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class tC extends KT{constructor(e){super(),this.body=e}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class iC extends Qi{constructor(e,i,n){super(),this.name=e,this.type=i,this.attributes=n}get astNodeType(){return"argument"}}class nC extends Qi{constructor(e,i){super(),this.condition=e,this.body=i}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class sC extends Qi{constructor(e,i,n){super(),this.name=e,this.type=i,this.attributes=n}get astNodeType(){return"member"}}let rC=class extends Qi{constructor(e,i){super(),this.name=e,this.value=i}get astNodeType(){return"attribute"}};var H,F;(function(t){t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(F||(F={}));class L{constructor(e,i,n){this.name=e,this.type=i,this.rule=n}toString(){return this.name}}class E{}H=E;E.none=new L("",F.reserved,"");E.eof=new L("EOF",F.token,"");E.reserved={asm:new L("asm",F.reserved,"asm"),bf16:new L("bf16",F.reserved,"bf16"),do:new L("do",F.reserved,"do"),enum:new L("enum",F.reserved,"enum"),f16:new L("f16",F.reserved,"f16"),f64:new L("f64",F.reserved,"f64"),handle:new L("handle",F.reserved,"handle"),i8:new L("i8",F.reserved,"i8"),i16:new L("i16",F.reserved,"i16"),i64:new L("i64",F.reserved,"i64"),mat:new L("mat",F.reserved,"mat"),premerge:new L("premerge",F.reserved,"premerge"),regardless:new L("regardless",F.reserved,"regardless"),typedef:new L("typedef",F.reserved,"typedef"),u8:new L("u8",F.reserved,"u8"),u16:new L("u16",F.reserved,"u16"),u64:new L("u64",F.reserved,"u64"),unless:new L("unless",F.reserved,"unless"),using:new L("using",F.reserved,"using"),vec:new L("vec",F.reserved,"vec"),void:new L("void",F.reserved,"void")};E.keywords={array:new L("array",F.keyword,"array"),atomic:new L("atomic",F.keyword,"atomic"),bool:new L("bool",F.keyword,"bool"),f32:new L("f32",F.keyword,"f32"),i32:new L("i32",F.keyword,"i32"),mat2x2:new L("mat2x2",F.keyword,"mat2x2"),mat2x3:new L("mat2x3",F.keyword,"mat2x3"),mat2x4:new L("mat2x4",F.keyword,"mat2x4"),mat3x2:new L("mat3x2",F.keyword,"mat3x2"),mat3x3:new L("mat3x3",F.keyword,"mat3x3"),mat3x4:new L("mat3x4",F.keyword,"mat3x4"),mat4x2:new L("mat4x2",F.keyword,"mat4x2"),mat4x3:new L("mat4x3",F.keyword,"mat4x3"),mat4x4:new L("mat4x4",F.keyword,"mat4x4"),ptr:new L("ptr",F.keyword,"ptr"),sampler:new L("sampler",F.keyword,"sampler"),sampler_comparison:new L("sampler_comparison",F.keyword,"sampler_comparison"),struct:new L("struct",F.keyword,"struct"),texture_1d:new L("texture_1d",F.keyword,"texture_1d"),texture_2d:new L("texture_2d",F.keyword,"texture_2d"),texture_2d_array:new L("texture_2d_array",F.keyword,"texture_2d_array"),texture_3d:new L("texture_3d",F.keyword,"texture_3d"),texture_cube:new L("texture_cube",F.keyword,"texture_cube"),texture_cube_array:new L("texture_cube_array",F.keyword,"texture_cube_array"),texture_multisampled_2d:new L("texture_multisampled_2d",F.keyword,"texture_multisampled_2d"),texture_storage_1d:new L("texture_storage_1d",F.keyword,"texture_storage_1d"),texture_storage_2d:new L("texture_storage_2d",F.keyword,"texture_storage_2d"),texture_storage_2d_array:new L("texture_storage_2d_array",F.keyword,"texture_storage_2d_array"),texture_storage_3d:new L("texture_storage_3d",F.keyword,"texture_storage_3d"),texture_depth_2d:new L("texture_depth_2d",F.keyword,"texture_depth_2d"),texture_depth_2d_array:new L("texture_depth_2d_array",F.keyword,"texture_depth_2d_array"),texture_depth_cube:new L("texture_depth_cube",F.keyword,"texture_depth_cube"),texture_depth_cube_array:new L("texture_depth_cube_array",F.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new L("texture_depth_multisampled_2d",F.keyword,"texture_depth_multisampled_2d"),texture_external:new L("texture_external",F.keyword,"texture_external"),u32:new L("u32",F.keyword,"u32"),vec2:new L("vec2",F.keyword,"vec2"),vec3:new L("vec3",F.keyword,"vec3"),vec4:new L("vec4",F.keyword,"vec4"),bitcast:new L("bitcast",F.keyword,"bitcast"),block:new L("block",F.keyword,"block"),break:new L("break",F.keyword,"break"),case:new L("case",F.keyword,"case"),continue:new L("continue",F.keyword,"continue"),continuing:new L("continuing",F.keyword,"continuing"),default:new L("default",F.keyword,"default"),diagnostic:new L("diagnostic",F.keyword,"diagnostic"),discard:new L("discard",F.keyword,"discard"),else:new L("else",F.keyword,"else"),enable:new L("enable",F.keyword,"enable"),fallthrough:new L("fallthrough",F.keyword,"fallthrough"),false:new L("false",F.keyword,"false"),fn:new L("fn",F.keyword,"fn"),for:new L("for",F.keyword,"for"),function:new L("function",F.keyword,"function"),if:new L("if",F.keyword,"if"),let:new L("let",F.keyword,"let"),const:new L("const",F.keyword,"const"),loop:new L("loop",F.keyword,"loop"),while:new L("while",F.keyword,"while"),private:new L("private",F.keyword,"private"),read:new L("read",F.keyword,"read"),read_write:new L("read_write",F.keyword,"read_write"),return:new L("return",F.keyword,"return"),requires:new L("requires",F.keyword,"requires"),storage:new L("storage",F.keyword,"storage"),switch:new L("switch",F.keyword,"switch"),true:new L("true",F.keyword,"true"),alias:new L("alias",F.keyword,"alias"),type:new L("type",F.keyword,"type"),uniform:new L("uniform",F.keyword,"uniform"),var:new L("var",F.keyword,"var"),override:new L("override",F.keyword,"override"),workgroup:new L("workgroup",F.keyword,"workgroup"),write:new L("write",F.keyword,"write"),r8unorm:new L("r8unorm",F.keyword,"r8unorm"),r8snorm:new L("r8snorm",F.keyword,"r8snorm"),r8uint:new L("r8uint",F.keyword,"r8uint"),r8sint:new L("r8sint",F.keyword,"r8sint"),r16uint:new L("r16uint",F.keyword,"r16uint"),r16sint:new L("r16sint",F.keyword,"r16sint"),r16float:new L("r16float",F.keyword,"r16float"),rg8unorm:new L("rg8unorm",F.keyword,"rg8unorm"),rg8snorm:new L("rg8snorm",F.keyword,"rg8snorm"),rg8uint:new L("rg8uint",F.keyword,"rg8uint"),rg8sint:new L("rg8sint",F.keyword,"rg8sint"),r32uint:new L("r32uint",F.keyword,"r32uint"),r32sint:new L("r32sint",F.keyword,"r32sint"),r32float:new L("r32float",F.keyword,"r32float"),rg16uint:new L("rg16uint",F.keyword,"rg16uint"),rg16sint:new L("rg16sint",F.keyword,"rg16sint"),rg16float:new L("rg16float",F.keyword,"rg16float"),rgba8unorm:new L("rgba8unorm",F.keyword,"rgba8unorm"),rgba8unorm_srgb:new L("rgba8unorm_srgb",F.keyword,"rgba8unorm_srgb"),rgba8snorm:new L("rgba8snorm",F.keyword,"rgba8snorm"),rgba8uint:new L("rgba8uint",F.keyword,"rgba8uint"),rgba8sint:new L("rgba8sint",F.keyword,"rgba8sint"),bgra8unorm:new L("bgra8unorm",F.keyword,"bgra8unorm"),bgra8unorm_srgb:new L("bgra8unorm_srgb",F.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new L("rgb10a2unorm",F.keyword,"rgb10a2unorm"),rg11b10float:new L("rg11b10float",F.keyword,"rg11b10float"),rg32uint:new L("rg32uint",F.keyword,"rg32uint"),rg32sint:new L("rg32sint",F.keyword,"rg32sint"),rg32float:new L("rg32float",F.keyword,"rg32float"),rgba16uint:new L("rgba16uint",F.keyword,"rgba16uint"),rgba16sint:new L("rgba16sint",F.keyword,"rgba16sint"),rgba16float:new L("rgba16float",F.keyword,"rgba16float"),rgba32uint:new L("rgba32uint",F.keyword,"rgba32uint"),rgba32sint:new L("rgba32sint",F.keyword,"rgba32sint"),rgba32float:new L("rgba32float",F.keyword,"rgba32float"),static_assert:new L("static_assert",F.keyword,"static_assert")};E.tokens={decimal_float_literal:new L("decimal_float_literal",F.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|(-?[0-9]+f)/),hex_float_literal:new L("hex_float_literal",F.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new L("int_literal",F.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new L("uint_literal",F.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new L("ident",F.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new L("and",F.token,"&"),and_and:new L("and_and",F.token,"&&"),arrow:new L("arrow ",F.token,"->"),attr:new L("attr",F.token,"@"),forward_slash:new L("forward_slash",F.token,"/"),bang:new L("bang",F.token,"!"),bracket_left:new L("bracket_left",F.token,"["),bracket_right:new L("bracket_right",F.token,"]"),brace_left:new L("brace_left",F.token,"{"),brace_right:new L("brace_right",F.token,"}"),colon:new L("colon",F.token,":"),comma:new L("comma",F.token,","),equal:new L("equal",F.token,"="),equal_equal:new L("equal_equal",F.token,"=="),not_equal:new L("not_equal",F.token,"!="),greater_than:new L("greater_than",F.token,">"),greater_than_equal:new L("greater_than_equal",F.token,">="),shift_right:new L("shift_right",F.token,">>"),less_than:new L("less_than",F.token,"<"),less_than_equal:new L("less_than_equal",F.token,"<="),shift_left:new L("shift_left",F.token,"<<"),modulo:new L("modulo",F.token,"%"),minus:new L("minus",F.token,"-"),minus_minus:new L("minus_minus",F.token,"--"),period:new L("period",F.token,"."),plus:new L("plus",F.token,"+"),plus_plus:new L("plus_plus",F.token,"++"),or:new L("or",F.token,"|"),or_or:new L("or_or",F.token,"||"),paren_left:new L("paren_left",F.token,"("),paren_right:new L("paren_right",F.token,")"),semicolon:new L("semicolon",F.token,";"),star:new L("star",F.token,"*"),tilde:new L("tilde",F.token,"~"),underscore:new L("underscore",F.token,"_"),xor:new L("xor",F.token,"^"),plus_equal:new L("plus_equal",F.token,"+="),minus_equal:new L("minus_equal",F.token,"-="),times_equal:new L("times_equal",F.token,"*="),division_equal:new L("division_equal",F.token,"/="),modulo_equal:new L("modulo_equal",F.token,"%="),and_equal:new L("and_equal",F.token,"&="),or_equal:new L("or_equal",F.token,"|="),xor_equal:new L("xor_equal",F.token,"^="),shift_right_equal:new L("shift_right_equal",F.token,">>="),shift_left_equal:new L("shift_left_equal",F.token,"<<=")};E.simpleTokens={"@":H.tokens.attr,"{":H.tokens.brace_left,"}":H.tokens.brace_right,":":H.tokens.colon,",":H.tokens.comma,"(":H.tokens.paren_left,")":H.tokens.paren_right,";":H.tokens.semicolon};E.literalTokens={"&":H.tokens.and,"&&":H.tokens.and_and,"->":H.tokens.arrow,"/":H.tokens.forward_slash,"!":H.tokens.bang,"[":H.tokens.bracket_left,"]":H.tokens.bracket_right,"=":H.tokens.equal,"==":H.tokens.equal_equal,"!=":H.tokens.not_equal,">":H.tokens.greater_than,">=":H.tokens.greater_than_equal,">>":H.tokens.shift_right,"<":H.tokens.less_than,"<=":H.tokens.less_than_equal,"<<":H.tokens.shift_left,"%":H.tokens.modulo,"-":H.tokens.minus,"--":H.tokens.minus_minus,".":H.tokens.period,"+":H.tokens.plus,"++":H.tokens.plus_plus,"|":H.tokens.or,"||":H.tokens.or_or,"*":H.tokens.star,"~":H.tokens.tilde,_:H.tokens.underscore,"^":H.tokens.xor,"+=":H.tokens.plus_equal,"-=":H.tokens.minus_equal,"*=":H.tokens.times_equal,"/=":H.tokens.division_equal,"%=":H.tokens.modulo_equal,"&=":H.tokens.and_equal,"|=":H.tokens.or_equal,"^=":H.tokens.xor_equal,">>=":H.tokens.shift_right_equal,"<<=":H.tokens.shift_left_equal};E.regexTokens={decimal_float_literal:H.tokens.decimal_float_literal,hex_float_literal:H.tokens.hex_float_literal,int_literal:H.tokens.int_literal,uint_literal:H.tokens.uint_literal,ident:H.tokens.ident};E.storage_class=[H.keywords.function,H.keywords.private,H.keywords.workgroup,H.keywords.uniform,H.keywords.storage];E.access_mode=[H.keywords.read,H.keywords.write,H.keywords.read_write];E.sampler_type=[H.keywords.sampler,H.keywords.sampler_comparison];E.sampled_texture_type=[H.keywords.texture_1d,H.keywords.texture_2d,H.keywords.texture_2d_array,H.keywords.texture_3d,H.keywords.texture_cube,H.keywords.texture_cube_array];E.multisampled_texture_type=[H.keywords.texture_multisampled_2d];E.storage_texture_type=[H.keywords.texture_storage_1d,H.keywords.texture_storage_2d,H.keywords.texture_storage_2d_array,H.keywords.texture_storage_3d];E.depth_texture_type=[H.keywords.texture_depth_2d,H.keywords.texture_depth_2d_array,H.keywords.texture_depth_cube,H.keywords.texture_depth_cube_array,H.keywords.texture_depth_multisampled_2d];E.texture_external_type=[H.keywords.texture_external];E.any_texture_type=[...H.sampled_texture_type,...H.multisampled_texture_type,...H.storage_texture_type,...H.depth_texture_type,...H.texture_external_type];E.texel_format=[H.keywords.r8unorm,H.keywords.r8snorm,H.keywords.r8uint,H.keywords.r8sint,H.keywords.r16uint,H.keywords.r16sint,H.keywords.r16float,H.keywords.rg8unorm,H.keywords.rg8snorm,H.keywords.rg8uint,H.keywords.rg8sint,H.keywords.r32uint,H.keywords.r32sint,H.keywords.r32float,H.keywords.rg16uint,H.keywords.rg16sint,H.keywords.rg16float,H.keywords.rgba8unorm,H.keywords.rgba8unorm_srgb,H.keywords.rgba8snorm,H.keywords.rgba8uint,H.keywords.rgba8sint,H.keywords.bgra8unorm,H.keywords.bgra8unorm_srgb,H.keywords.rgb10a2unorm,H.keywords.rg11b10float,H.keywords.rg32uint,H.keywords.rg32sint,H.keywords.rg32float,H.keywords.rgba16uint,H.keywords.rgba16sint,H.keywords.rgba16float,H.keywords.rgba32uint,H.keywords.rgba32sint,H.keywords.rgba32float];E.const_literal=[H.tokens.int_literal,H.tokens.uint_literal,H.tokens.decimal_float_literal,H.tokens.hex_float_literal,H.keywords.true,H.keywords.false];E.literal_or_ident=[H.tokens.ident,H.tokens.int_literal,H.tokens.uint_literal,H.tokens.decimal_float_literal,H.tokens.hex_float_literal];E.element_count_expression=[H.tokens.int_literal,H.tokens.uint_literal,H.tokens.ident];E.template_types=[H.keywords.vec2,H.keywords.vec3,H.keywords.vec4,H.keywords.mat2x2,H.keywords.mat2x3,H.keywords.mat2x4,H.keywords.mat3x2,H.keywords.mat3x3,H.keywords.mat3x4,H.keywords.mat4x2,H.keywords.mat4x3,H.keywords.mat4x4,H.keywords.atomic,H.keywords.bitcast,...H.any_texture_type];E.attribute_name=[H.tokens.ident,H.keywords.block,H.keywords.diagnostic];E.assignment_operators=[H.tokens.equal,H.tokens.plus_equal,H.tokens.minus_equal,H.tokens.times_equal,H.tokens.division_equal,H.tokens.modulo_equal,H.tokens.and_equal,H.tokens.or_equal,H.tokens.xor_equal,H.tokens.shift_right_equal,H.tokens.shift_left_equal];E.increment_operators=[H.tokens.plus_plus,H.tokens.minus_minus];class B0{constructor(e,i,n){this.type=e,this.lexeme=i,this.line=n}toString(){return this.lexeme}isTemplateType(){return E.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==E.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class aC{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new B0(E.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let c=1;for(;c>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),c--,c==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),c++)}return!0}}const i=E.simpleTokens[e];if(i)return this._addToken(i),!0;let n=E.none;const r=this._isAlpha(e),o=e==="_";if(this._isAlphaNumeric(e)){let c=this._peekAhead();for(;this._isAlphaNumeric(c);)e+=this._advance(),c=this._peekAhead()}if(r){const c=E.keywords[e];if(c)return this._addToken(c),!0}if(r||o)return this._addToken(E.tokens.ident),!0;for(;;){let c=this._findType(e);const f=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(f=="=")return this._current++,e+=f,this._addToken(E.tokens.minus_equal),!0;if(f=="-")return this._current++,e+=f,this._addToken(E.tokens.minus_minus),!0;const h=this._tokens.length-1;if((E.literal_or_ident.indexOf(this._tokens[h].type)!=-1||this._tokens[h].type==E.tokens.paren_right)&&f!=">")return this._addToken(c),!0}if(e==">"&&(f==">"||f=="=")){let h=!1,g=this._tokens.length-1;for(let _=0;_<5&&g>=0&&E.assignment_operators.indexOf(this._tokens[g].type)===-1;++_,--g)if(this._tokens[g].type===E.tokens.less_than){g>0&&this._tokens[g-1].isArrayOrTemplateType()&&(h=!0);break}if(h)return this._addToken(c),!0}if(c===E.none){let h=e,g=0;const _=2;for(let m=0;m<_;++m)if(h+=this._peekAhead(m),c=this._findType(h),c!==E.none){g=m;break}if(c===E.none)return n===E.none?!1:(this._current--,this._addToken(n),!0);e=h,this._current+=g+1}if(n=c,this._isAtEnd())break;e+=this._advance()}return n===E.none?!1:(this._addToken(n),!0)}_findType(e){for(const n in E.regexTokens){const r=E.regexTokens[n];if(this._match(e,r.rule))return r}const i=E.literalTokens[e];return i||E.none}_match(e,i){const n=i.exec(e);return n&&n.index==0&&n[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}_isAlphaNumeric(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e=="_"||e>="0"&&e<="9"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let i=this._source[this._current];return e=e||0,e++,this._current+=e,i}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const i=this._source.substring(this._start,this._current);this._tokens.push(new B0(e,i,this._line))}}class oC{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._context=new N2,this._deferArrayCountEval=[]}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const i=[];for(;!this._isAtEnd();){const n=this._global_decl_or_directive();if(!n)break;i.push(n)}if(this._deferArrayCountEval.length>0){for(const n of this._deferArrayCountEval){const r=n.arrayType,o=n.countNode;if(o instanceof Hd){const f=o.name,h=this._context.constants.get(f);if(h)try{const g=h.evaluate(this._context);r.count=g}catch{}}}this._deferArrayCountEval.length=0}return i}_initialize(e){if(e)if(typeof e=="string"){const i=new aC(e);this._tokens=i.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,i){return{token:e,message:i,toString:function(){return`${i}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==E.eof}_match(e){if(e instanceof L)return this._check(e)?(this._advance(),!0):!1;for(let i=0,n=e.length;i<n;++i){const r=e[i];if(this._check(r))return this._advance(),!0}return!1}_consume(e,i){if(this._check(e))return this._advance();throw this._error(this._peek(),i)}_check(e){if(this._isAtEnd())return!1;const i=this._peek();if(e instanceof Array){const n=i.type;return e.indexOf(n)!=-1}return i.type==e}_advance(){var e,i;return this._currentLine=(i=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&i!==void 0?i:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(E.tokens.semicolon)&&!this._isAtEnd(););if(this._match(E.keywords.alias)){const i=this._type_alias();return this._consume(E.tokens.semicolon,"Expected ';'"),i}if(this._match(E.keywords.diagnostic)){const i=this._diagnostic();return this._consume(E.tokens.semicolon,"Expected ';'"),i}if(this._match(E.keywords.requires)){const i=this._requires_directive();return this._consume(E.tokens.semicolon,"Expected ';'"),i}if(this._match(E.keywords.enable)){const i=this._enable_directive();return this._consume(E.tokens.semicolon,"Expected ';'"),i}const e=this._attribute();if(this._check(E.keywords.var)){const i=this._global_variable_decl();return i!=null&&(i.attributes=e),this._consume(E.tokens.semicolon,"Expected ';'."),i}if(this._check(E.keywords.override)){const i=this._override_variable_decl();return i!=null&&(i.attributes=e),this._consume(E.tokens.semicolon,"Expected ';'."),i}if(this._check(E.keywords.let)){const i=this._global_let_decl();return i!=null&&(i.attributes=e),this._consume(E.tokens.semicolon,"Expected ';'."),i}if(this._check(E.keywords.const)){const i=this._global_const_decl();return i!=null&&(i.attributes=e),this._consume(E.tokens.semicolon,"Expected ';'."),i}if(this._check(E.keywords.struct)){const i=this._struct_decl();return i!=null&&(i.attributes=e),i}if(this._check(E.keywords.fn)){const i=this._function_decl();return i!=null&&(i.attributes=e),i}return null}_function_decl(){if(!this._match(E.keywords.fn))return null;const e=this._currentLine,i=this._consume(E.tokens.ident,"Expected function name.").toString();this._consume(E.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(E.tokens.paren_right))do{if(this._check(E.tokens.paren_right))break;const f=this._attribute(),h=this._consume(E.tokens.ident,"Expected argument name.").toString();this._consume(E.tokens.colon,"Expected ':' for argument type.");const g=this._attribute(),_=this._type_decl();_!=null&&(_.attributes=g,n.push(new iC(h,_,f)))}while(this._match(E.tokens.comma));this._consume(E.tokens.paren_right,"Expected ')' after function arguments.");let r=null;if(this._match(E.tokens.arrow)){const f=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=f)}const o=this._compound_statement(),c=this._currentLine;return new zd(i,n,r,o,e,c)}_compound_statement(){const e=[];for(this._consume(E.tokens.brace_left,"Expected '{' for block.");!this._check(E.tokens.brace_right);){const i=this._statement();i!==null&&e.push(i)}return this._consume(E.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(E.tokens.semicolon)&&!this._isAtEnd(););if(this._check(E.tokens.attr)&&this._attribute(),this._check(E.keywords.if))return this._if_statement();if(this._check(E.keywords.switch))return this._switch_statement();if(this._check(E.keywords.loop))return this._loop_statement();if(this._check(E.keywords.for))return this._for_statement();if(this._check(E.keywords.while))return this._while_statement();if(this._check(E.keywords.continuing))return this._continuing_statement();if(this._check(E.keywords.static_assert))return this._static_assert_statement();if(this._check(E.tokens.brace_left))return this._compound_statement();let e=null;return this._check(E.keywords.return)?e=this._return_statement():this._check([E.keywords.var,E.keywords.let,E.keywords.const])?e=this._variable_statement():this._match(E.keywords.discard)?e=new $2:this._match(E.keywords.break)?e=new Y2:this._match(E.keywords.continue)?e=new q2:e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),e!=null&&this._consume(E.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(E.keywords.static_assert))return null;const e=this._optional_paren_expression();return new I2(e)}_while_statement(){if(!this._match(E.keywords.while))return null;const e=this._optional_paren_expression();this._check(E.tokens.attr)&&this._attribute();const i=this._compound_statement();return new D2(e,i)}_continuing_statement(){if(!this._match(E.keywords.continuing))return null;const e=this._compound_statement();return new k2(e)}_for_statement(){if(!this._match(E.keywords.for))return null;this._consume(E.tokens.paren_left,"Expected '('.");const e=this._check(E.tokens.semicolon)?null:this._for_init();this._consume(E.tokens.semicolon,"Expected ';'.");const i=this._check(E.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(E.tokens.semicolon,"Expected ';'.");const n=this._check(E.tokens.paren_right)?null:this._for_increment();this._consume(E.tokens.paren_right,"Expected ')'."),this._check(E.tokens.attr)&&this._attribute();const r=this._compound_statement();return new B2(e,i,n,r)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(E.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let i=null;return this._match(E.tokens.equal)&&(i=this._short_circuit_or_expression()),new us(e.name,e.type,e.storage,e.access,i)}if(this._match(E.keywords.let)){const e=this._consume(E.tokens.ident,"Expected name for let.").toString();let i=null;if(this._match(E.tokens.colon)){const r=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=r)}this._consume(E.tokens.equal,"Expected '=' for let.");const n=this._short_circuit_or_expression();return new Vd(e,i,null,null,n)}if(this._match(E.keywords.const)){const e=this._consume(E.tokens.ident,"Expected name for const.").toString();let i=null;if(this._match(E.tokens.colon)){const r=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=r)}this._consume(E.tokens.equal,"Expected '=' for const.");const n=this._short_circuit_or_expression();return new N0(e,i,null,null,n)}return null}_increment_decrement_statement(){const e=this._current,i=this._unary_expression();if(i==null)return null;if(!this._check(E.increment_operators))return this._current=e,null;const n=this._consume(E.increment_operators,"Expected increment operator");return new U2(n.type===E.tokens.plus_plus?xr.increment:xr.decrement,i)}_assignment_statement(){let e=null;if(this._check(E.tokens.brace_right))return null;let i=this._match(E.tokens.underscore);if(i||(e=this._unary_expression()),!i&&e==null)return null;const n=this._consume(E.assignment_operators,"Expected assignment operator."),r=this._short_circuit_or_expression();return new F2(eo.parse(n.lexeme),e,r)}_func_call_statement(){if(!this._check(E.tokens.ident))return null;const e=this._current,i=this._consume(E.tokens.ident,"Expected function name."),n=this._argument_expression_list();return n===null?(this._current=e,null):new jT(i.lexeme,n)}_loop_statement(){if(!this._match(E.keywords.loop))return null;this._check(E.tokens.attr)&&this._attribute(),this._consume(E.tokens.brace_left,"Expected '{' for loop.");const e=[];let i=this._statement();for(;i!==null;){if(Array.isArray(i))for(let r of i)e.push(r);else e.push(i);i=this._statement()}let n=null;return this._match(E.keywords.continuing)&&(n=this._compound_statement()),this._consume(E.tokens.brace_right,"Expected '}' for loop."),new L2(e,n)}_switch_statement(){if(!this._match(E.keywords.switch))return null;const e=this._optional_paren_expression();this._check(E.tokens.attr)&&this._attribute(),this._consume(E.tokens.brace_left,"Expected '{' for switch.");const i=this._switch_body();if(i==null||i.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(E.tokens.brace_right,"Expected '}' for switch."),new z2(e,i)}_switch_body(){const e=[];if(this._match(E.keywords.case)){const i=this._case_selectors();this._match(E.tokens.colon),this._check(E.tokens.attr)&&this._attribute(),this._consume(E.tokens.brace_left,"Exected '{' for switch case.");const n=this._case_body();this._consume(E.tokens.brace_right,"Exected '}' for switch case."),e.push(new eC(i,n))}if(this._match(E.keywords.default)){this._match(E.tokens.colon),this._check(E.tokens.attr)&&this._attribute(),this._consume(E.tokens.brace_left,"Exected '{' for switch default.");const i=this._case_body();this._consume(E.tokens.brace_right,"Exected '}' for switch default."),e.push(new tC(i))}if(this._check([E.keywords.default,E.keywords.case])){const i=this._switch_body();e.push(i[0])}return e}_case_selectors(){const e=[this._shift_expression()];for(;this._match(E.tokens.comma);)e.push(this._shift_expression());return e}_case_body(){if(this._match(E.keywords.fallthrough))return this._consume(E.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const i=this._case_body();return i.length==0?e:[...e,i[0]]}_if_statement(){if(!this._match(E.keywords.if))return null;const e=this._optional_paren_expression();this._check(E.tokens.attr)&&this._attribute();const i=this._compound_statement();let n=[];this._match_elseif()&&(this._check(E.tokens.attr)&&this._attribute(),n=this._elseif_statement(n));let r=null;return this._match(E.keywords.else)&&(this._check(E.tokens.attr)&&this._attribute(),r=this._compound_statement()),new V2(e,i,n,r)}_match_elseif(){return this._tokens[this._current].type===E.keywords.else&&this._tokens[this._current+1].type===E.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(e=[]){const i=this._optional_paren_expression(),n=this._compound_statement();return e.push(new nC(i,n)),this._match_elseif()&&(this._check(E.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(E.keywords.return))return null;const e=this._short_circuit_or_expression();return new H2(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(E.tokens.or_or);)e=new Si(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(E.tokens.and_and);)e=new Si(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(E.tokens.or);)e=new Si(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(E.tokens.xor);)e=new Si(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(E.tokens.and);)e=new Si(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){const e=this._relational_expression();return this._match([E.tokens.equal_equal,E.tokens.not_equal])?new Si(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([E.tokens.less_than,E.tokens.greater_than,E.tokens.less_than_equal,E.tokens.greater_than_equal]);)e=new Si(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([E.tokens.shift_left,E.tokens.shift_right]);)e=new Si(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([E.tokens.plus,E.tokens.minus]);)e=new Si(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([E.tokens.star,E.tokens.forward_slash,E.tokens.modulo]);)e=new Si(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([E.tokens.minus,E.tokens.bang,E.tokens.tilde,E.tokens.star,E.tokens.and])?new J2(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),i=this._postfix_expression();return i&&(e.postfix=i),e}_postfix_expression(){if(this._match(E.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(E.tokens.bracket_right,"Expected ']'.");const i=new G2(e),n=this._postfix_expression();return n&&(i.postfix=n),i}if(this._match(E.tokens.period)){const e=this._consume(E.tokens.ident,"Expected member name."),i=this._postfix_expression(),n=new Z2(e.lexeme);return i&&(n.postfix=i),n}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_primary_expression(){if(this._match(E.tokens.ident)){const n=this._previous().toString();if(this._check(E.tokens.paren_left)){const r=this._argument_expression_list(),o=this._getStruct(n);return o!=null?new gr(o,r):new YT(n,r)}if(this._context.constants.has(n)){const r=this._context.constants.get(n);return new I0(n,r.value)}return new Hd(n)}if(this._match(E.const_literal))return new D0(parseFloat(this._previous().toString()));if(this._check(E.tokens.paren_left))return this._paren_expression();if(this._match(E.keywords.bitcast)){this._consume(E.tokens.less_than,"Expected '<'.");const n=this._type_decl();this._consume(E.tokens.greater_than,"Expected '>'.");const r=this._paren_expression();return new Q2(n,r)}const e=this._type_decl(),i=this._argument_expression_list();return new gr(e,i)}_argument_expression_list(){if(!this._match(E.tokens.paren_left))return null;const e=[];do{if(this._check(E.tokens.paren_right))break;const i=this._short_circuit_or_expression();e.push(i)}while(this._match(E.tokens.comma));return this._consume(E.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(E.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(E.tokens.paren_right),new k0([e])}_paren_expression(){this._consume(E.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(E.tokens.paren_right,"Expected ')'."),new k0([e])}_struct_decl(){if(!this._match(E.keywords.struct))return null;const e=this._currentLine,i=this._consume(E.tokens.ident,"Expected name for struct.").toString();this._consume(E.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(E.tokens.brace_right);){const c=this._attribute(),f=this._consume(E.tokens.ident,"Expected variable name.").toString();this._consume(E.tokens.colon,"Expected ':' for struct member type.");const h=this._attribute(),g=this._type_decl();g!=null&&(g.attributes=h),this._check(E.tokens.brace_right)?this._match(E.tokens.comma):this._consume(E.tokens.comma,"Expected ',' for struct member."),n.push(new sC(f,g,c))}this._consume(E.tokens.brace_right,"Expected '}' after struct body.");const r=this._currentLine,o=new cs(i,n,e,r);return this._context.structs.set(i,o),o}_global_variable_decl(){const e=this._variable_decl();return e&&this._match(E.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(E.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(E.keywords.const))return null;const e=this._consume(E.tokens.ident,"Expected variable name");let i=null;if(this._match(E.tokens.colon)){const o=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=o)}let n=null;if(this._match(E.tokens.equal)){const o=this._short_circuit_or_expression();if(o instanceof gr)n=o;else if(o instanceof I0&&o.initializer instanceof gr)n=o.initializer;else try{const c=o.evaluate(this._context);n=new D0(c)}catch{n=o}}const r=new N0(e.toString(),i,"","",n);return this._context.constants.set(r.name,r),r}_global_let_decl(){if(!this._match(E.keywords.let))return null;const e=this._consume(E.tokens.ident,"Expected variable name");let i=null;if(this._match(E.tokens.colon)){const r=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=r)}let n=null;return this._match(E.tokens.equal)&&(n=this._const_expression()),new Vd(e.toString(),i,"","",n)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(E.keywords.var))return null;let e="",i="";this._match(E.tokens.less_than)&&(e=this._consume(E.storage_class,"Expected storage_class.").toString(),this._match(E.tokens.comma)&&(i=this._consume(E.access_mode,"Expected access_mode.").toString()),this._consume(E.tokens.greater_than,"Expected '>'."));const n=this._consume(E.tokens.ident,"Expected variable name");let r=null;if(this._match(E.tokens.colon)){const o=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=o)}return new us(n.toString(),r,e,i,null)}_override_decl(){if(!this._match(E.keywords.override))return null;const e=this._consume(E.tokens.ident,"Expected variable name");let i=null;if(this._match(E.tokens.colon)){const n=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=n)}return new HT(e.toString(),i,null)}_diagnostic(){this._consume(E.tokens.paren_left,"Expected '('");const e=this._consume(E.tokens.ident,"Expected severity control name.");this._consume(E.tokens.comma,"Expected ','");const i=this._consume(E.tokens.ident,"Expected diagnostic rule name.");return this._consume(E.tokens.paren_right,"Expected ')'"),new X2(e.toString(),i.toString())}_enable_directive(){const e=this._consume(E.tokens.ident,"identity expected.");return new j2(e.toString())}_requires_directive(){const e=[this._consume(E.tokens.ident,"identity expected.").toString()];for(;this._match(E.tokens.comma);){const i=this._consume(E.tokens.ident,"identity expected.");e.push(i.toString())}return new W2(e)}_type_alias(){const e=this._consume(E.tokens.ident,"identity expected.");this._consume(E.tokens.equal,"Expected '=' for type alias.");let i=this._type_decl();if(i===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);const n=new WT(e.toString(),i);return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([E.tokens.ident,...E.texel_format,E.keywords.bool,E.keywords.f32,E.keywords.i32,E.keywords.u32])){const n=this._advance(),r=n.toString();return this._context.structs.has(r)?this._context.structs.get(r):this._context.aliases.has(r)?this._context.aliases.get(r).type:new ws(n.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(E.template_types)){let n=this._advance().toString(),r=null,o=null;return this._match(E.tokens.less_than)&&(r=this._type_decl(),o=null,this._match(E.tokens.comma)&&(o=this._consume(E.access_mode,"Expected access_mode for pointer").toString()),this._consume(E.tokens.greater_than,"Expected '>' for type.")),new XT(n,r,o)}if(this._match(E.keywords.ptr)){let n=this._previous().toString();this._consume(E.tokens.less_than,"Expected '<' for pointer.");const r=this._consume(E.storage_class,"Expected storage_class for pointer");this._consume(E.tokens.comma,"Expected ',' for pointer.");const o=this._type_decl();let c=null;return this._match(E.tokens.comma)&&(c=this._consume(E.access_mode,"Expected access_mode for pointer").toString()),this._consume(E.tokens.greater_than,"Expected '>' for pointer."),new K2(n,r.toString(),o,c)}const i=this._attribute();if(this._match(E.keywords.array)){let n=null,r=-1;const o=this._previous();let c=null;if(this._match(E.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let h="";if(this._match(E.tokens.comma)){c=this._shift_expression();try{h=c.evaluate(this._context).toString(),c=null}catch{h="1"}}this._consume(E.tokens.greater_than,"Expected '>' for array."),r=h?parseInt(h):0}const f=new $T(o.toString(),i,n,r);return c&&this._deferArrayCountEval.push({arrayType:f,countNode:c}),f}return null}_texture_sampler_types(){if(this._match(E.sampler_type))return new Ha(this._previous().toString(),null,null);if(this._match(E.depth_texture_type))return new Ha(this._previous().toString(),null,null);if(this._match(E.sampled_texture_type)||this._match(E.multisampled_texture_type)){const e=this._previous();this._consume(E.tokens.less_than,"Expected '<' for sampler type.");const i=this._type_decl();return this._consume(E.tokens.greater_than,"Expected '>' for sampler type."),new Ha(e.toString(),i,null)}if(this._match(E.storage_texture_type)){const e=this._previous();this._consume(E.tokens.less_than,"Expected '<' for sampler type.");const i=this._consume(E.texel_format,"Invalid texel format.").toString();this._consume(E.tokens.comma,"Expected ',' after texel format.");const n=this._consume(E.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(E.tokens.greater_than,"Expected '>' for sampler type."),new Ha(e.toString(),i,n)}return null}_attribute(){let e=[];for(;this._match(E.tokens.attr);){const i=this._consume(E.attribute_name,"Expected attribute name"),n=new rC(i.toString(),null);if(this._match(E.tokens.paren_left)){if(n.value=this._consume(E.literal_or_ident,"Expected attribute value").toString(),this._check(E.tokens.comma)){this._advance();do{const r=this._consume(E.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(r)}while(this._match(E.tokens.comma))}this._consume(E.tokens.paren_right,"Expected ')'")}e.push(n)}return e.length==0?null:e}}class vr{constructor(e,i){this.name=e,this.attributes=i,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class U0{constructor(e,i,n){this.name=e,this.type=i,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Fl extends vr{constructor(e,i){super(e,i),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Kh extends vr{constructor(e,i){super(e,i),this.count=0,this.stride=0}get isArray(){return!0}}class F0 extends vr{constructor(e,i,n,r){super(e,n),this.format=i,this.access=r}get isTemplate(){return!0}}var xn;(function(t){t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(xn||(xn={}));class Ll{constructor(e,i,n,r,o,c,f){this.name=e,this.type=i,this.group=n,this.binding=r,this.attributes=o,this.resourceType=c,this.access=f}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class lC{constructor(e,i){this.name=e,this.type=i}}class zl{constructor(e,i){this.align=e,this.size=i}}class cC{constructor(e,i,n,r){this.name=e,this.type=i,this.locationType=n,this.location=r,this.interpolation=null}}class L0{constructor(e,i,n,r){this.name=e,this.type=i,this.locationType=n,this.location=r}}class uC{constructor(e,i,n,r){this.name=e,this.type=i,this.attributes=n,this.id=r}}class fC{constructor(e,i){this.name=e,this.type=i}}class hC{constructor(e,i=null){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=i}}class dC{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class gC{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class qi{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new dC,this.functions=[],this._types=new Map,this._functions=new Map,e&&this.update(e)}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}update(e){const n=new oC().parse(e);for(const r of n)r instanceof zd&&this._functions.set(r.name,new gC(r));for(const r of n)if(r instanceof cs){const o=this._getTypeInfo(r,null);o instanceof Fl&&this.structs.push(o)}for(const r of n){if(r instanceof WT){this.aliases.push(this._getAliasInfo(r));continue}if(r instanceof HT){const o=r,c=this._getAttributeNum(o.attributes,"id",0),f=o.type!=null?this._getTypeInfo(o.type,o.attributes):null;this.overrides.push(new uC(o.name,f,o.attributes,c));continue}if(this._isUniformVar(r)){const o=r,c=this._getAttributeNum(o.attributes,"group",0),f=this._getAttributeNum(o.attributes,"binding",0),h=this._getTypeInfo(o.type,o.attributes),g=new Ll(o.name,h,c,f,o.attributes,xn.Uniform,o.access);this.uniforms.push(g);continue}if(this._isStorageVar(r)){const o=r,c=this._getAttributeNum(o.attributes,"group",0),f=this._getAttributeNum(o.attributes,"binding",0),h=this._getTypeInfo(o.type,o.attributes),g=this._isStorageTexture(h),_=new Ll(o.name,h,c,f,o.attributes,g?xn.StorageTexture:xn.Storage,o.access);this.storage.push(_);continue}if(this._isTextureVar(r)){const o=r,c=this._getAttributeNum(o.attributes,"group",0),f=this._getAttributeNum(o.attributes,"binding",0),h=this._getTypeInfo(o.type,o.attributes),g=this._isStorageTexture(h),_=new Ll(o.name,h,c,f,o.attributes,g?xn.StorageTexture:xn.Texture,o.access);g?this.storage.push(_):this.textures.push(_);continue}if(this._isSamplerVar(r)){const o=r,c=this._getAttributeNum(o.attributes,"group",0),f=this._getAttributeNum(o.attributes,"binding",0),h=this._getTypeInfo(o.type,o.attributes),g=new Ll(o.name,h,c,f,o.attributes,xn.Sampler,o.access);this.samplers.push(g);continue}if(r instanceof zd){const o=this._getAttribute(r,"vertex"),c=this._getAttribute(r,"fragment"),f=this._getAttribute(r,"compute"),h=o||c||f,g=new hC(r.name,h==null?void 0:h.name);g.startLine=r.startLine,g.endLine=r.endLine,this.functions.push(g),this._functions.get(r.name).info=g,h&&(this._functions.get(r.name).inUse=!0,g.inUse=!0,g.resources=this._findResources(r,!!h),g.inputs=this._getInputs(r.args),g.outputs=this._getOutputs(r.returnType),this.entry[h.name].push(g)),g.arguments=r.args.map(_=>new fC(_.name,this._getTypeInfo(_.type,_.attributes))),g.returnType=r.returnType?this._getTypeInfo(r.returnType,r.attributes):null;continue}}for(const r of this._functions.values())r.info&&(r.info.inUse=r.inUse,this._addCalls(r.node,r.info.calls));for(const r of this._functions.values())r.node.search(o=>{var c;if(o.astNodeType==="varExpr"){const f=o;for(const h of this.overrides)f.name==h.name&&((c=r.info)===null||c===void 0||c.overrides.push(h))}});for(const r of this.uniforms)this._markStructsInUse(r.type);for(const r of this.storage)this._markStructsInUse(r.type)}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const i of e.members)this._markStructsInUse(i.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const i=this._getAlias(e.name);i&&this._markStructsInUse(i)}}_addCalls(e,i){var n;for(const r of e.calls){const o=(n=this._functions.get(r.name))===null||n===void 0?void 0:n.info;o&&i.add(o)}}findResource(e,i){for(const n of this.uniforms)if(n.group==e&&n.binding==i)return n;for(const n of this.storage)if(n.group==e&&n.binding==i)return n;for(const n of this.textures)if(n.group==e&&n.binding==i)return n;for(const n of this.samplers)if(n.group==e&&n.binding==i)return n;return null}_findResource(e){for(const i of this.uniforms)if(i.name==e)return i;for(const i of this.storage)if(i.name==e)return i;for(const i of this.textures)if(i.name==e)return i;for(const i of this.samplers)if(i.name==e)return i;return null}_markStructsFromAST(e){const i=this._getTypeInfo(e,null);this._markStructsInUse(i)}_findResources(e,i){const n=[],r=this,o=[];return e.search(c=>{if(c instanceof Rc)o.push({});else if(c instanceof xc)o.pop();else if(c instanceof us){const f=c;i&&f.type!==null&&this._markStructsFromAST(f.type),o.length>0&&(o[o.length-1][f.name]=f)}else if(c instanceof gr){const f=c;i&&f.type!==null&&this._markStructsFromAST(f.type)}else if(c instanceof Vd){const f=c;i&&f.type!==null&&this._markStructsFromAST(f.type),o.length>0&&(o[o.length-1][f.name]=f)}else if(c instanceof Hd){const f=c;if(o.length>0&&o[o.length-1][f.name])return;const h=r._findResource(f.name);h&&n.push(h)}else if(c instanceof YT){const f=c,h=r._functions.get(f.name);h&&(i&&(h.inUse=!0),e.calls.add(h.node),h.resources===null&&(h.resources=r._findResources(h.node,i)),n.push(...h.resources))}else if(c instanceof jT){const f=c,h=r._functions.get(f.name);h&&(i&&(h.inUse=!0),e.calls.add(h.node),h.resources===null&&(h.resources=r._findResources(h.node,i)),n.push(...h.resources))}}),[...new Map(n.map(c=>[c.name,c])).values()]}getBindGroups(){const e=[];function i(n,r){n>=e.length&&(e.length=n+1),e[n]===void 0&&(e[n]=[]),r>=e[n].length&&(e[n].length=r+1)}for(const n of this.uniforms){i(n.group,n.binding);const r=e[n.group];r[n.binding]=n}for(const n of this.storage){i(n.group,n.binding);const r=e[n.group];r[n.binding]=n}for(const n of this.textures){i(n.group,n.binding);const r=e[n.group];r[n.binding]=n}for(const n of this.samplers){i(n.group,n.binding);const r=e[n.group];r[n.binding]=n}return e}_getOutputs(e,i=void 0){if(i===void 0&&(i=[]),e instanceof cs)this._getStructOutputs(e,i);else{const n=this._getOutputInfo(e);n!==null&&i.push(n)}return i}_getStructOutputs(e,i){for(const n of e.members)if(n.type instanceof cs)this._getStructOutputs(n.type,i);else{const r=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(r!==null){const o=this._getTypeInfo(n.type,n.type.attributes),c=this._parseInt(r.value),f=new L0(n.name,o,r.name,c);i.push(f)}}}_getOutputInfo(e){const i=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(i!==null){const n=this._getTypeInfo(e,e.attributes),r=this._parseInt(i.value);return new L0("",n,i.name,r)}return null}_getInputs(e,i=void 0){i===void 0&&(i=[]);for(const n of e)if(n.type instanceof cs)this._getStructInputs(n.type,i);else{const r=this._getInputInfo(n);r!==null&&i.push(r)}return i}_getStructInputs(e,i){for(const n of e.members)if(n.type instanceof cs)this._getStructInputs(n.type,i);else{const r=this._getInputInfo(n);r!==null&&i.push(r)}}_getInputInfo(e){const i=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(i!==null){const n=this._getAttribute(e,"interpolation"),r=this._getTypeInfo(e.type,e.attributes),o=this._parseInt(i.value),c=new cC(e.name,r,i.name,o);return n!==null&&(c.interpolation=this._parseString(n.value)),c}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const i=parseInt(e);return isNaN(i)?e:i}_getAlias(e){for(const i of this.aliases)if(i.name==e)return i.type;return null}_getAliasInfo(e){return new lC(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,i){if(this._types.has(e))return this._types.get(e);if(e instanceof $T){const r=e,o=r.format?this._getTypeInfo(r.format,r.attributes):null,c=new Kh(r.name,i);return c.format=o,c.count=r.count,this._types.set(e,c),this._updateTypeInfo(c),c}if(e instanceof cs){const r=e,o=new Fl(r.name,i);o.startLine=r.startLine,o.endLine=r.endLine;for(const c of r.members){const f=this._getTypeInfo(c.type,c.attributes);o.members.push(new U0(c.name,f,c.attributes))}return this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof Ha){const r=e,o=r.format instanceof ws,c=r.format?o?this._getTypeInfo(r.format,null):new vr(r.format,null):null,f=new F0(r.name,c,i,r.access);return this._types.set(e,f),this._updateTypeInfo(f),f}if(e instanceof XT){const r=e,o=r.format?this._getTypeInfo(r.format,null):null,c=new F0(r.name,o,i,r.access);return this._types.set(e,c),this._updateTypeInfo(c),c}const n=new vr(e.name,i);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var i,n;const r=this._getTypeSize(e);if(e.size=(i=r==null?void 0:r.size)!==null&&i!==void 0?i:0,e instanceof Kh&&e.format){const o=this._getTypeSize(e.format);e.stride=(n=o==null?void 0:o.size)!==null&&n!==void 0?n:0,this._updateTypeInfo(e.format)}e instanceof Fl&&this._updateStructInfo(e)}_updateStructInfo(e){var i;let n=0,r=0,o=0,c=0;for(let f=0,h=e.members.length;f<h;++f){const g=e.members[f],_=this._getTypeSize(g);if(!_)continue;(i=this._getAlias(g.type.name))!==null&&i!==void 0||g.type;const m=_.align,y=_.size;n=this._roundUp(m,n+r),r=y,o=n,c=Math.max(c,m),g.offset=n,g.size=y,this._updateTypeInfo(g.type)}e.size=this._roundUp(c,o+r),e.align=c}_getTypeSize(e){var i,n;if(e==null)return null;const r=this._getAttributeNum(e.attributes,"size",0),o=this._getAttributeNum(e.attributes,"align",0);if(e instanceof U0&&(e=e.type),e instanceof vr){const c=this._getAlias(e.name);c!==null&&(e=c)}{const c=qi._typeInfo[e.name];if(c!==void 0){const f=((i=e.format)===null||i===void 0?void 0:i.name)==="f16"?2:1;return new zl(Math.max(o,c.align/f),Math.max(r,c.size/f))}}{const c=qi._typeInfo[e.name.substring(0,e.name.length-1)];if(c){const f=e.name[e.name.length-1]==="h"?2:1;return new zl(Math.max(o,c.align/f),Math.max(r,c.size/f))}}if(e instanceof Kh){let c=e,f=8,h=8;const g=this._getTypeSize(c.format);g!==null&&(h=g.size,f=g.align);const _=c.count,m=this._getAttributeNum((n=e==null?void 0:e.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(f,h));return h=_*m,r&&(h=r),new zl(Math.max(o,f),Math.max(r,h))}if(e instanceof Fl){let c=0,f=0,h=0,g=0,_=0;for(const m of e.members){const y=this._getTypeSize(m.type);y!==null&&(c=Math.max(y.align,c),h=this._roundUp(y.align,h+g),g=y.size,_=h)}return f=this._roundUp(c,_+g),new zl(Math.max(o,c),Math.max(r,f))}return null}_isUniformVar(e){return e instanceof us&&e.storage=="uniform"}_isStorageVar(e){return e instanceof us&&e.storage=="storage"}_isTextureVar(e){return e instanceof us&&e.type!==null&&qi._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof us&&e.type!==null&&qi._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,i){const n=e;if(!n||!n.attributes)return null;const r=n.attributes;for(let o of r)if(o.name==i)return o;return null}_getAttributeNum(e,i,n){if(e===null)return n;for(let r of e)if(r.name==i){let o=r!==null&&r.value!==null?r.value:n;return o instanceof Array&&(o=o[0]),typeof o=="number"?o:typeof o=="string"?parseInt(o):n}return n}_roundUp(e,i){return Math.ceil(i/e)*e}}qi._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};qi._textureTypes=E.any_texture_type.map(t=>t.name);qi._samplerTypes=E.sampler_type.map(t=>t.name);function pC(t){var o;const e={attributes:[],bindings:[]};let i;try{i=_C(t)}catch(c){return se.error(c.message)(),e}for(const c of i.uniforms){const f=[];for(const h of((o=c.type)==null?void 0:o.members)||[])f.push({name:h.name,type:z0(h.type)});e.bindings.push({type:"uniform",name:c.name,group:c.group,location:c.binding,members:f})}for(const c of i.textures)e.bindings.push({type:"texture",name:c.name,group:c.group,location:c.binding});for(const c of i.samplers)e.bindings.push({type:"sampler",name:c.name,group:c.group,location:c.binding});const n=i.entry.vertex[0],r=(n==null?void 0:n.inputs.length)||0;for(let c=0;c<r;c++){const f=n.inputs[c];if(f.locationType==="location"){const h=z0(f.type);e.attributes.push({name:f.name,location:Number(f.location),type:h})}}return e}function z0(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function _C(t){try{return new qi(t)}catch(e){if(e instanceof Error)throw e;let i="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(i+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(i+=e.token.line||""),new Error(i,{cause:e})}}const mC={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...mC}};const ei=globalThis.mathgl.config;function yC(t,{precision:e=ei.precision}={}){return t=bC(t),`${parseFloat(t.toPrecision(e))}`}function Cr(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function On(t,e,i){return TC(t,n=>Math.max(e,Math.min(i,n)))}function Cc(t,e,i){return Cr(t)?t.map((n,r)=>Cc(n,e[r],i)):i*e+(1-i)*t}function to(t,e,i){const n=ei.EPSILON;try{if(t===e)return!0;if(Cr(t)&&Cr(e)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(!to(t[r],e[r]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=ei.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{ei.EPSILON=n}}function bC(t){return Math.round(t/ei.EPSILON)*ei.EPSILON}function vC(t){return t.clone?t.clone():new Array(t.length)}function TC(t,e,i){if(Cr(t)){const n=t;i=i||vC(n);for(let r=0;r<i.length&&r<n.length;++r){const o=typeof t=="number"?t:t[r];i[r]=e(o,r,i)}return i}return e(t)}class ZT extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,i=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+i];return this.check()}toArray(e=[],i=0){for(let n=0;n<this.ELEMENTS;++n)e[i+n]=this[n];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Cr(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(ei)}formatString(e){let i="";for(let n=0;n<this.ELEMENTS;++n)i+=(n>0?", ":"")+yC(this[n],e);return`${e.printTypes?this.constructor.name:""}[${i}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let i=0;i<this.ELEMENTS;++i)if(!to(this[i],e[i]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let i=0;i<this.ELEMENTS;++i)if(this[i]!==e[i])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,i,n){if(n===void 0)return this.lerp(this,e,i);for(let r=0;r<this.ELEMENTS;++r){const o=e[r],c=typeof i=="number"?i:i[r];this[r]=o+n*(c-o)}return this.check()}min(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(e[i],this[i]);return this.check()}max(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.max(e[i],this[i]);return this.check()}clamp(e,i){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),i[n]);return this.check()}add(...e){for(const i of e)for(let n=0;n<this.ELEMENTS;++n)this[n]+=i[n];return this.check()}subtract(...e){for(const i of e)for(let n=0;n<this.ELEMENTS;++n)this[n]-=i[n];return this.check()}scale(e){if(typeof e=="number")for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;else for(let i=0;i<this.ELEMENTS&&i<e.length;++i)this[i]*=e[i];return this.check()}multiplyByScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;return this.check()}check(){if(ei.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let i=0;i<this.ELEMENTS;++i)e=e&&Number.isFinite(this[i]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=e;return this.check()}addScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,i){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),i);return this.check()}get elements(){return this}}function SC(t,e){if(t.length!==e)return!1;for(let i=0;i<t.length;++i)if(!Number.isFinite(t[i]))return!1;return!0}function Vt(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function Zh(t,e,i=""){if(ei.debug&&!SC(t,e))throw new Error(`math.gl: ${i} some fields set to invalid numbers'`);return t}function V0(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class AC extends ZT{get x(){return this[0]}set x(e){this[0]=Vt(e)}get y(){return this[1]}set y(e){this[1]=Vt(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let i=0;i<this.ELEMENTS;++i)e+=this[i]*this[i];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let i=0;for(let n=0;n<this.ELEMENTS;++n){const r=this[n]-e[n];i+=r*r}return Vt(i)}dot(e){let i=0;for(let n=0;n<this.ELEMENTS;++n)i+=this[n]*e[n];return Vt(i)}normalize(){const e=this.magnitude();if(e!==0)for(let i=0;i<this.ELEMENTS;++i)this[i]/=e;return this.check()}multiply(...e){for(const i of e)for(let n=0;n<this.ELEMENTS;++n)this[n]*=i[n];return this.check()}divide(...e){for(const i of e)for(let n=0;n<this.ELEMENTS;++n)this[n]/=i[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return V0(e>=0&&e<this.ELEMENTS,"index is out of range"),Vt(this[e])}setComponent(e,i){return V0(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=i,this.check()}addVectors(e,i){return this.copy(e).add(i)}subVectors(e,i){return this.copy(e).subtract(i)}multiplyVectors(e,i){return this.copy(e).multiply(i)}addScaledVector(e,i){return this.add(new this.constructor(e).multiplyScalar(i))}}const nc=1e-6;let Mr=typeof Float32Array<"u"?Float32Array:Array;function EC(){const t=new Mr(2);return Mr!=Float32Array&&(t[0]=0,t[1]=0),t}function H0(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function wC(t,e){return t[0]=-e[0],t[1]=-e[1],t}function QT(t,e,i,n){const r=e[0],o=e[1];return t[0]=r+n*(i[0]-r),t[1]=o+n*(i[1]-o),t}function RC(t,e,i){const n=e[0],r=e[1];return t[0]=i[0]*n+i[4]*r+i[12],t[1]=i[1]*n+i[5]*r+i[13],t}(function(){const t=EC();return function(e,i,n,r,o,c){let f,h;for(i||(i=2),n||(n=0),r?h=Math.min(r*i+n,e.length):h=e.length,f=n;f<h;f+=i)t[0]=e[f],t[1]=e[f+1],o(t,t,c),e[f]=t[0],e[f+1]=t[1];return e}})();function xC(t,e,i){const n=e[0],r=e[1],o=i[3]*n+i[7]*r||1;return t[0]=(i[0]*n+i[4]*r)/o,t[1]=(i[1]*n+i[5]*r)/o,t}function GT(t,e,i){const n=e[0],r=e[1],o=e[2],c=i[3]*n+i[7]*r+i[11]*o||1;return t[0]=(i[0]*n+i[4]*r+i[8]*o)/c,t[1]=(i[1]*n+i[5]*r+i[9]*o)/c,t[2]=(i[2]*n+i[6]*r+i[10]*o)/c,t}function CC(t,e,i){const n=e[0],r=e[1];return t[0]=i[0]*n+i[2]*r,t[1]=i[1]*n+i[3]*r,t[2]=e[2],t}function MC(){const t=new Mr(3);return Mr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function OC(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function PC(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function NC(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function IC(t,e,i){const n=e[0],r=e[1],o=e[2],c=i[0],f=i[1],h=i[2];return t[0]=r*h-o*f,t[1]=o*c-n*h,t[2]=n*f-r*c,t}function JT(t,e,i){const n=e[0],r=e[1],o=e[2];let c=i[3]*n+i[7]*r+i[11]*o+i[15];return c=c||1,t[0]=(i[0]*n+i[4]*r+i[8]*o+i[12])/c,t[1]=(i[1]*n+i[5]*r+i[9]*o+i[13])/c,t[2]=(i[2]*n+i[6]*r+i[10]*o+i[14])/c,t}function DC(t,e,i){const n=e[0],r=e[1],o=e[2];return t[0]=n*i[0]+r*i[3]+o*i[6],t[1]=n*i[1]+r*i[4]+o*i[7],t[2]=n*i[2]+r*i[5]+o*i[8],t}function kC(t,e,i){const n=i[0],r=i[1],o=i[2],c=i[3],f=e[0],h=e[1],g=e[2];let _=r*g-o*h,m=o*f-n*g,y=n*h-r*f,T=r*y-o*m,R=o*_-n*y,x=n*m-r*_;const O=c*2;return _*=O,m*=O,y*=O,T*=2,R*=2,x*=2,t[0]=f+_+T,t[1]=h+m+R,t[2]=g+y+x,t}function BC(t,e,i,n){const r=[],o=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],o[0]=r[0],o[1]=r[1]*Math.cos(n)-r[2]*Math.sin(n),o[2]=r[1]*Math.sin(n)+r[2]*Math.cos(n),t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t}function UC(t,e,i,n){const r=[],o=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],o[0]=r[2]*Math.sin(n)+r[0]*Math.cos(n),o[1]=r[1],o[2]=r[2]*Math.cos(n)-r[0]*Math.sin(n),t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t}function FC(t,e,i,n){const r=[],o=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],o[0]=r[0]*Math.cos(n)-r[1]*Math.sin(n),o[1]=r[0]*Math.sin(n)+r[1]*Math.cos(n),o[2]=r[2],t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t}function LC(t,e){const i=t[0],n=t[1],r=t[2],o=e[0],c=e[1],f=e[2],h=Math.sqrt((i*i+n*n+r*r)*(o*o+c*c+f*f)),g=h&&NC(t,e)/h;return Math.acos(Math.min(Math.max(g,-1),1))}const zC=OC;(function(){const t=MC();return function(e,i,n,r,o,c){let f,h;for(i||(i=3),n||(n=0),r?h=Math.min(r*i+n,e.length):h=e.length,f=n;f<h;f+=i)t[0]=e[f],t[1]=e[f+1],t[2]=e[f+2],o(t,t,c),e[f]=t[0],e[f+1]=t[1],e[f+2]=t[2];return e}})();const Qh=[0,0,0];let Vl;class Ci extends AC{static get ZERO(){return Vl||(Vl=new Ci(0,0,0),Object.freeze(Vl)),Vl}constructor(e=0,i=0,n=0){super(-0,-0,-0),arguments.length===1&&Cr(e)?this.copy(e):(ei.debug&&(Vt(e),Vt(i),Vt(n)),this[0]=e,this[1]=i,this[2]=n)}set(e,i,n){return this[0]=e,this[1]=i,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return ei.debug&&(Vt(e.x),Vt(e.y),Vt(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Vt(e)}angle(e){return LC(this,e)}cross(e){return IC(this,this,e),this.check()}rotateX({radians:e,origin:i=Qh}){return BC(this,this,i,e),this.check()}rotateY({radians:e,origin:i=Qh}){return UC(this,this,i,e),this.check()}rotateZ({radians:e,origin:i=Qh}){return FC(this,this,i,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return JT(this,this,e),this.check()}transformAsVector(e){return GT(this,this,e),this.check()}transformByMatrix3(e){return DC(this,this,e),this.check()}transformByMatrix2(e){return CC(this,this,e),this.check()}transformByQuaternion(e){return kC(this,this,e),this.check()}}class VC extends ZT{toString(){let e="[";if(ei.printRowMajor){e+="row-major:";for(let i=0;i<this.RANK;++i)for(let n=0;n<this.RANK;++n)e+=` ${this[n*this.RANK+i]}`}else{e+="column-major:";for(let i=0;i<this.ELEMENTS;++i)e+=` ${this[i]}`}return e+="]",e}getElementIndex(e,i){return i*this.RANK+e}getElement(e,i){return this[i*this.RANK+e]}setElement(e,i,n){return this[i*this.RANK+e]=Vt(n),this}getColumn(e,i=new Array(this.RANK).fill(-0)){const n=e*this.RANK;for(let r=0;r<this.RANK;++r)i[r]=this[n+r];return i}setColumn(e,i){const n=e*this.RANK;for(let r=0;r<this.RANK;++r)this[n+r]=i[r];return this}}function HC(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function jC(t,e){if(t===e){const i=e[1],n=e[2],r=e[3],o=e[6],c=e[7],f=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=o,t[11]=e[14],t[12]=r,t[13]=c,t[14]=f}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function jd(t,e){const i=e[0],n=e[1],r=e[2],o=e[3],c=e[4],f=e[5],h=e[6],g=e[7],_=e[8],m=e[9],y=e[10],T=e[11],R=e[12],x=e[13],O=e[14],N=e[15],B=i*f-n*c,P=i*h-r*c,j=i*g-o*c,z=n*h-r*f,q=n*g-o*f,ue=r*g-o*h,oe=_*x-m*R,G=_*O-y*R,ae=_*N-T*R,te=m*O-y*x,ge=m*N-T*x,ce=y*N-T*O;let _e=B*ce-P*ge+j*te+z*ae-q*G+ue*oe;return _e?(_e=1/_e,t[0]=(f*ce-h*ge+g*te)*_e,t[1]=(r*ge-n*ce-o*te)*_e,t[2]=(x*ue-O*q+N*z)*_e,t[3]=(y*q-m*ue-T*z)*_e,t[4]=(h*ae-c*ce-g*G)*_e,t[5]=(i*ce-r*ae+o*G)*_e,t[6]=(O*j-R*ue-N*P)*_e,t[7]=(_*ue-y*j+T*P)*_e,t[8]=(c*ge-f*ae+g*oe)*_e,t[9]=(n*ae-i*ge-o*oe)*_e,t[10]=(R*q-x*j+N*B)*_e,t[11]=(m*j-_*q-T*B)*_e,t[12]=(f*G-c*te-h*oe)*_e,t[13]=(i*te-n*G+r*oe)*_e,t[14]=(x*P-R*z-O*B)*_e,t[15]=(_*z-m*P+y*B)*_e,t):null}function WC(t){const e=t[0],i=t[1],n=t[2],r=t[3],o=t[4],c=t[5],f=t[6],h=t[7],g=t[8],_=t[9],m=t[10],y=t[11],T=t[12],R=t[13],x=t[14],O=t[15],N=e*c-i*o,B=e*f-n*o,P=i*f-n*c,j=g*R-_*T,z=g*x-m*T,q=_*x-m*R,ue=e*q-i*z+n*j,oe=o*q-c*z+f*j,G=g*P-_*B+m*N,ae=T*P-R*B+x*N;return h*ue-r*oe+O*G-y*ae}function ps(t,e,i){const n=e[0],r=e[1],o=e[2],c=e[3],f=e[4],h=e[5],g=e[6],_=e[7],m=e[8],y=e[9],T=e[10],R=e[11],x=e[12],O=e[13],N=e[14],B=e[15];let P=i[0],j=i[1],z=i[2],q=i[3];return t[0]=P*n+j*f+z*m+q*x,t[1]=P*r+j*h+z*y+q*O,t[2]=P*o+j*g+z*T+q*N,t[3]=P*c+j*_+z*R+q*B,P=i[4],j=i[5],z=i[6],q=i[7],t[4]=P*n+j*f+z*m+q*x,t[5]=P*r+j*h+z*y+q*O,t[6]=P*o+j*g+z*T+q*N,t[7]=P*c+j*_+z*R+q*B,P=i[8],j=i[9],z=i[10],q=i[11],t[8]=P*n+j*f+z*m+q*x,t[9]=P*r+j*h+z*y+q*O,t[10]=P*o+j*g+z*T+q*N,t[11]=P*c+j*_+z*R+q*B,P=i[12],j=i[13],z=i[14],q=i[15],t[12]=P*n+j*f+z*m+q*x,t[13]=P*r+j*h+z*y+q*O,t[14]=P*o+j*g+z*T+q*N,t[15]=P*c+j*_+z*R+q*B,t}function Mc(t,e,i){const n=i[0],r=i[1],o=i[2];let c,f,h,g,_,m,y,T,R,x,O,N;return e===t?(t[12]=e[0]*n+e[4]*r+e[8]*o+e[12],t[13]=e[1]*n+e[5]*r+e[9]*o+e[13],t[14]=e[2]*n+e[6]*r+e[10]*o+e[14],t[15]=e[3]*n+e[7]*r+e[11]*o+e[15]):(c=e[0],f=e[1],h=e[2],g=e[3],_=e[4],m=e[5],y=e[6],T=e[7],R=e[8],x=e[9],O=e[10],N=e[11],t[0]=c,t[1]=f,t[2]=h,t[3]=g,t[4]=_,t[5]=m,t[6]=y,t[7]=T,t[8]=R,t[9]=x,t[10]=O,t[11]=N,t[12]=c*n+_*r+R*o+e[12],t[13]=f*n+m*r+x*o+e[13],t[14]=h*n+y*r+O*o+e[14],t[15]=g*n+T*r+N*o+e[15]),t}function Ng(t,e,i){const n=i[0],r=i[1],o=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function XC(t,e,i,n){let r=n[0],o=n[1],c=n[2],f=Math.sqrt(r*r+o*o+c*c),h,g,_,m,y,T,R,x,O,N,B,P,j,z,q,ue,oe,G,ae,te,ge,ce,_e,Pe;return f<nc?null:(f=1/f,r*=f,o*=f,c*=f,g=Math.sin(i),h=Math.cos(i),_=1-h,m=e[0],y=e[1],T=e[2],R=e[3],x=e[4],O=e[5],N=e[6],B=e[7],P=e[8],j=e[9],z=e[10],q=e[11],ue=r*r*_+h,oe=o*r*_+c*g,G=c*r*_-o*g,ae=r*o*_-c*g,te=o*o*_+h,ge=c*o*_+r*g,ce=r*c*_+o*g,_e=o*c*_-r*g,Pe=c*c*_+h,t[0]=m*ue+x*oe+P*G,t[1]=y*ue+O*oe+j*G,t[2]=T*ue+N*oe+z*G,t[3]=R*ue+B*oe+q*G,t[4]=m*ae+x*te+P*ge,t[5]=y*ae+O*te+j*ge,t[6]=T*ae+N*te+z*ge,t[7]=R*ae+B*te+q*ge,t[8]=m*ce+x*_e+P*Pe,t[9]=y*ce+O*_e+j*Pe,t[10]=T*ce+N*_e+z*Pe,t[11]=R*ce+B*_e+q*Pe,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function eS(t,e,i){const n=Math.sin(i),r=Math.cos(i),o=e[4],c=e[5],f=e[6],h=e[7],g=e[8],_=e[9],m=e[10],y=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+g*n,t[5]=c*r+_*n,t[6]=f*r+m*n,t[7]=h*r+y*n,t[8]=g*r-o*n,t[9]=_*r-c*n,t[10]=m*r-f*n,t[11]=y*r-h*n,t}function $C(t,e,i){const n=Math.sin(i),r=Math.cos(i),o=e[0],c=e[1],f=e[2],h=e[3],g=e[8],_=e[9],m=e[10],y=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r-g*n,t[1]=c*r-_*n,t[2]=f*r-m*n,t[3]=h*r-y*n,t[8]=o*n+g*r,t[9]=c*n+_*r,t[10]=f*n+m*r,t[11]=h*n+y*r,t}function tS(t,e,i){const n=Math.sin(i),r=Math.cos(i),o=e[0],c=e[1],f=e[2],h=e[3],g=e[4],_=e[5],m=e[6],y=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r+g*n,t[1]=c*r+_*n,t[2]=f*r+m*n,t[3]=h*r+y*n,t[4]=g*r-o*n,t[5]=_*r-c*n,t[6]=m*r-f*n,t[7]=y*r-h*n,t}function YC(t,e){const i=e[0],n=e[1],r=e[2],o=e[3],c=i+i,f=n+n,h=r+r,g=i*c,_=n*c,m=n*f,y=r*c,T=r*f,R=r*h,x=o*c,O=o*f,N=o*h;return t[0]=1-m-R,t[1]=_+N,t[2]=y-O,t[3]=0,t[4]=_-N,t[5]=1-g-R,t[6]=T+x,t[7]=0,t[8]=y+O,t[9]=T-x,t[10]=1-g-m,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function qC(t,e,i,n,r,o,c){const f=1/(i-e),h=1/(r-n),g=1/(o-c);return t[0]=o*2*f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o*2*h,t[6]=0,t[7]=0,t[8]=(i+e)*f,t[9]=(r+n)*h,t[10]=(c+o)*g,t[11]=-1,t[12]=0,t[13]=0,t[14]=c*o*2*g,t[15]=0,t}function KC(t,e,i,n,r){const o=1/Math.tan(e/2);if(t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,r!=null&&r!==1/0){const c=1/(n-r);t[10]=(r+n)*c,t[14]=2*r*n*c}else t[10]=-1,t[14]=-2*n;return t}const ZC=KC;function QC(t,e,i,n,r,o,c){const f=1/(e-i),h=1/(n-r),g=1/(o-c);return t[0]=-2*f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*g,t[11]=0,t[12]=(e+i)*f,t[13]=(r+n)*h,t[14]=(c+o)*g,t[15]=1,t}const GC=QC;function JC(t,e,i,n){let r,o,c,f,h,g,_,m,y,T;const R=e[0],x=e[1],O=e[2],N=n[0],B=n[1],P=n[2],j=i[0],z=i[1],q=i[2];return Math.abs(R-j)<nc&&Math.abs(x-z)<nc&&Math.abs(O-q)<nc?HC(t):(m=R-j,y=x-z,T=O-q,r=1/Math.sqrt(m*m+y*y+T*T),m*=r,y*=r,T*=r,o=B*T-P*y,c=P*m-N*T,f=N*y-B*m,r=Math.sqrt(o*o+c*c+f*f),r?(r=1/r,o*=r,c*=r,f*=r):(o=0,c=0,f=0),h=y*f-T*c,g=T*o-m*f,_=m*c-y*o,r=Math.sqrt(h*h+g*g+_*_),r?(r=1/r,h*=r,g*=r,_*=r):(h=0,g=0,_=0),t[0]=o,t[1]=h,t[2]=m,t[3]=0,t[4]=c,t[5]=g,t[6]=y,t[7]=0,t[8]=f,t[9]=_,t[10]=T,t[11]=0,t[12]=-(o*R+c*x+f*O),t[13]=-(h*R+g*x+_*O),t[14]=-(m*R+y*x+T*O),t[15]=1,t)}function eM(){const t=new Mr(4);return Mr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function tM(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function ho(t,e,i){const n=e[0],r=e[1],o=e[2],c=e[3];return t[0]=i[0]*n+i[4]*r+i[8]*o+i[12]*c,t[1]=i[1]*n+i[5]*r+i[9]*o+i[13]*c,t[2]=i[2]*n+i[6]*r+i[10]*o+i[14]*c,t[3]=i[3]*n+i[7]*r+i[11]*o+i[15]*c,t}(function(){const t=eM();return function(e,i,n,r,o,c){let f,h;for(i||(i=4),n||(n=0),r?h=Math.min(r*i+n,e.length):h=e.length,f=n;f<h;f+=i)t[0]=e[f],t[1]=e[f+1],t[2]=e[f+2],t[3]=e[f+3],o(t,t,c),e[f]=t[0],e[f+1]=t[1],e[f+2]=t[2],e[f+3]=t[3];return e}})();var Wd;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(Wd||(Wd={}));const iM=45*Math.PI/180,nM=1,Gh=.1,Jh=500,sM=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Mi extends VC{static get IDENTITY(){return aM()}static get ZERO(){return rM()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Wd}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,i,n,r,o,c,f,h,g,_,m,y,T,R,x,O){return this[0]=e,this[1]=i,this[2]=n,this[3]=r,this[4]=o,this[5]=c,this[6]=f,this[7]=h,this[8]=g,this[9]=_,this[10]=m,this[11]=y,this[12]=T,this[13]=R,this[14]=x,this[15]=O,this.check()}setRowMajor(e,i,n,r,o,c,f,h,g,_,m,y,T,R,x,O){return this[0]=e,this[1]=o,this[2]=g,this[3]=T,this[4]=i,this[5]=c,this[6]=_,this[7]=R,this[8]=n,this[9]=f,this[10]=m,this[11]=x,this[12]=r,this[13]=h,this[14]=y,this[15]=O,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(sM)}fromObject(e){return this.check()}fromQuaternion(e){return YC(this,e),this.check()}frustum(e){const{left:i,right:n,bottom:r,top:o,near:c=Gh,far:f=Jh}=e;return f===1/0?oM(this,i,n,r,o,c):qC(this,i,n,r,o,c,f),this.check()}lookAt(e){const{eye:i,center:n=[0,0,0],up:r=[0,1,0]}=e;return JC(this,i,n,r),this.check()}ortho(e){const{left:i,right:n,bottom:r,top:o,near:c=Gh,far:f=Jh}=e;return GC(this,i,n,r,o,c,f),this.check()}orthographic(e){const{fovy:i=iM,aspect:n=nM,focalDistance:r=1,near:o=Gh,far:c=Jh}=e;j0(i);const f=i/2,h=r*Math.tan(f),g=h*n;return this.ortho({left:-g,right:g,bottom:-h,top:h,near:o,far:c})}perspective(e){const{fovy:i=45*Math.PI/180,aspect:n=1,near:r=.1,far:o=500}=e;return j0(i),ZC(this,i,n,r,o),this.check()}determinant(){return WC(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,i){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],i=i||[-0,-0,-0];const n=this.getScale(i),r=1/n[0],o=1/n[1],c=1/n[2];return e[0]=this[0]*r,e[1]=this[1]*o,e[2]=this[2]*c,e[3]=0,e[4]=this[4]*r,e[5]=this[5]*o,e[6]=this[6]*c,e[7]=0,e[8]=this[8]*r,e[9]=this[9]*o,e[10]=this[10]*c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,i){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],i=i||[-0,-0,-0];const n=this.getScale(i),r=1/n[0],o=1/n[1],c=1/n[2];return e[0]=this[0]*r,e[1]=this[1]*o,e[2]=this[2]*c,e[3]=this[4]*r,e[4]=this[5]*o,e[5]=this[6]*c,e[6]=this[8]*r,e[7]=this[9]*o,e[8]=this[10]*c,e}transpose(){return jC(this,this),this.check()}invert(){return jd(this,this),this.check()}multiplyLeft(e){return ps(this,e,this),this.check()}multiplyRight(e){return ps(this,this,e),this.check()}rotateX(e){return eS(this,this,e),this.check()}rotateY(e){return $C(this,this,e),this.check()}rotateZ(e){return tS(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,i){return XC(this,this,e,i),this.check()}scale(e){return Ng(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Mc(this,this,e),this.check()}transform(e,i){return e.length===4?(i=ho(i||[-0,-0,-0,-0],e,this),Zh(i,4),i):this.transformAsPoint(e,i)}transformAsPoint(e,i){const{length:n}=e;let r;switch(n){case 2:r=RC(i||[-0,-0],e,this);break;case 3:r=JT(i||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Zh(r,e.length),r}transformAsVector(e,i){let n;switch(e.length){case 2:n=xC(i||[-0,-0],e,this);break;case 3:n=GT(i||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Zh(n,e.length),n}transformPoint(e,i){return this.transformAsPoint(e,i)}transformVector(e,i){return this.transformAsPoint(e,i)}transformDirection(e,i){return this.transformAsVector(e,i)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,i,n){return this.identity().translate([e,i,n])}}let Hl,jl;function rM(){return Hl||(Hl=new Mi([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Hl)),Hl}function aM(){return jl||(jl=new Mi,Object.freeze(jl)),jl}function j0(t){if(t>Math.PI*2)throw Error("expected radians")}function oM(t,e,i,n,r,o){const c=2*o/(i-e),f=2*o/(r-n),h=(i+e)/(i-e),g=(r+n)/(r-n),_=-1,m=-1,y=-2*o;return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=f,t[6]=0,t[7]=0,t[8]=h,t[9]=g,t[10]=_,t[11]=m,t[12]=0,t[13]=0,t[14]=y,t[15]=0,t}function iS(t,e=[],i=0){const n=Math.fround(t),r=t-n;return e[i]=n,e[i+1]=r,e}function lM(t){return t-Math.fround(t)}function cM(t){const e=new Float32Array(32);for(let i=0;i<4;++i)for(let n=0;n<4;++n){const r=i*4+n;iS(t[n*4+i],e,r*2)}return e}const uM=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,fM={name:"fp32",vs:uM},hM=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,dM={ONE:1},gM={name:"fp64arithmetic",vs:hM,defaultUniforms:dM,uniformTypes:{ONE:"f32"},fp64ify:iS,fp64LowPart:lM,fp64ifyMatrix4:cM},pM=[0,1,1,1],_M=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,mM=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,W0={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:pM},vs:_M,fs:mM,getUniforms:yM};function yM(t={},e){const i={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)i.isHighlightActive=!1;else{i.isHighlightActive=!0;const n=t.highlightedObjectColor.slice(0,3);i.highlightedObjectColor=n}if(t.highlightColor){const n=Array.from(t.highlightColor,r=>r/255);Number.isFinite(n[3])||(n[3]=1),i.highlightColor=n}return t.isActive!==void 0&&(i.isActive=!!t.isActive,i.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(i.useFloatColors=!!t.useFloatColors),i}const X0=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,bM=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  poightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,nS=3,vM=255;var io;(function(t){t[t.POINT=0]="POINT",t[t.DIRECTIONAL=1]="DIRECTIONAL"})(io||(io={}));const sc={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:nS},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:io.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:bM,vs:X0,fs:X0,getUniforms:TM};function TM(t,e={}){if(t=t&&{...t},!t)return{...sc.defaultUniforms};t.lights&&(t={...t,...AM(t.lights),lights:void 0});const{ambientLight:i,pointLights:n,directionalLights:r}=t||{};if(!(i||n&&n.length>0||r&&r.length>0))return{...sc.defaultUniforms,enabled:0};const c={...sc.defaultUniforms,...e,...SM({ambientLight:i,pointLights:n,directionalLights:r})};return t.enabled!==void 0&&(c.enabled=t.enabled?1:0),c}function SM({ambientLight:t,pointLights:e=[],directionalLights:i=[]}){const n={};n.ambientLightColor=ed(t);let r=0;for(const o of e){n.lightType=io.POINT;const c=r;n[`lightColor${c}`]=ed(o),n[`lightPosition${c}`]=o.position,n[`lightAttenuation${c}`]=o.attenuation||[1,0,0],r++}for(const o of i){n.lightType=io.DIRECTIONAL;const c=r;n[`lightColor${c}`]=ed(o),n[`lightDirection${c}`]=o.direction,r++}return r>nS&&se.warn("MAX_LIGHTS exceeded")(),n.directionalLightCount=i.length,n.pointLightCount=e.length,n}function AM(t){var i,n;const e={pointLights:[],directionalLights:[]};for(const r of t||[])switch(r.type){case"ambient":e.ambientLight=r;break;case"directional":(i=e.directionalLights)==null||i.push(r);break;case"point":(n=e.pointLights)==null||n.push(r);break}return e}function ed(t={}){const{color:e=[0,0,0],intensity:i=1}=t;return e.map(n=>n*i/vM)}const EM=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,wM=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,sS={props:{},name:"gouraudMaterial",vs:wM.replace("phongMaterial","gouraudMaterial"),fs:EM.replace("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[sc],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(t){const e={...t};return e.specularColor&&(e.specularColor=e.specularColor.map(i=>i/255)),{...sS.defaultUniforms,...e}}},$0=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,RM={name:"layer",vs:$0,fs:$0,getUniforms:t=>({opacity:Math.pow(t.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},rS="#define SMOOTH_EDGE_RADIUS 0.5",xM=`
${rS}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,CM=`
${rS}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,aS={name:"geometry",vs:xM,fs:CM},MM=25;var at;(function(t){t[t.Start=1]="Start",t[t.Move=2]="Move",t[t.End=4]="End",t[t.Cancel=8]="Cancel"})(at||(at={}));var ct;(function(t){t[t.None=0]="None",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.Up=4]="Up",t[t.Down=8]="Down",t[t.Horizontal=3]="Horizontal",t[t.Vertical=12]="Vertical",t[t.All=15]="All"})(ct||(ct={}));var Ae;(function(t){t[t.Possible=1]="Possible",t[t.Began=2]="Began",t[t.Changed=4]="Changed",t[t.Ended=8]="Ended",t[t.Recognized=8]="Recognized",t[t.Cancelled=16]="Cancelled",t[t.Failed=32]="Failed"})(Ae||(Ae={}));const OM="compute",PM="auto",Xd="manipulation",rc="none",$d="pan-x",Yd="pan-y";function NM(t){if(t.includes(rc))return rc;const e=t.includes($d),i=t.includes(Yd);return e&&i?rc:e||i?e?$d:Yd:t.includes(Xd)?Xd:PM}class IM{constructor(e,i){this.actions="",this.manager=e,this.set(i)}set(e){e===OM&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const i of this.manager.recognizers)i.options.enable&&(e=e.concat(i.getTouchAction()));return NM(e.join(" "))}}function Oc(t){return t.trim().split(/\s+/g)}function td(t,e,i){if(t)for(const n of Oc(e))t.addEventListener(n,i,!1)}function id(t,e,i){if(t)for(const n of Oc(e))t.removeEventListener(n,i,!1)}function Y0(t){return(t.ownerDocument||t).defaultView}function DM(t,e){let i=t;for(;i;){if(i===e)return!0;i=i.parentNode}return!1}function oS(t){const e=t.length;if(e===1)return{x:Math.round(t[0].clientX),y:Math.round(t[0].clientY)};let i=0,n=0,r=0;for(;r<e;)i+=t[r].clientX,n+=t[r].clientY,r++;return{x:Math.round(i/e),y:Math.round(n/e)}}function q0(t){const e=[];let i=0;for(;i<t.pointers.length;)e[i]={clientX:Math.round(t.pointers[i].clientX),clientY:Math.round(t.pointers[i].clientY)},i++;return{timeStamp:Date.now(),pointers:e,center:oS(e),deltaX:t.deltaX,deltaY:t.deltaY}}function lS(t,e){const i=e.x-t.x,n=e.y-t.y;return Math.sqrt(i*i+n*n)}function K0(t,e){const i=e.clientX-t.clientX,n=e.clientY-t.clientY;return Math.sqrt(i*i+n*n)}function kM(t,e){const i=e.x-t.x,n=e.y-t.y;return Math.atan2(n,i)*180/Math.PI}function Z0(t,e){const i=e.clientX-t.clientX,n=e.clientY-t.clientY;return Math.atan2(n,i)*180/Math.PI}function cS(t,e){return t===e?ct.None:Math.abs(t)>=Math.abs(e)?t<0?ct.Left:ct.Right:e<0?ct.Up:ct.Down}function BM(t,e){const i=e.center;let n=t.offsetDelta,r=t.prevDelta;const o=t.prevInput;return(e.eventType===at.Start||(o==null?void 0:o.eventType)===at.End)&&(r=t.prevDelta={x:(o==null?void 0:o.deltaX)||0,y:(o==null?void 0:o.deltaY)||0},n=t.offsetDelta={x:i.x,y:i.y}),{deltaX:r.x+(i.x-n.x),deltaY:r.y+(i.y-n.y)}}function uS(t,e,i){return{x:e/t||0,y:i/t||0}}function UM(t,e){return K0(e[0],e[1])/K0(t[0],t[1])}function FM(t,e){return Z0(e[1],e[0])-Z0(t[1],t[0])}function LM(t,e){const i=t.lastInterval||e,n=e.timeStamp-i.timeStamp;let r,o,c,f;if(e.eventType!==at.Cancel&&(n>MM||i.velocity===void 0)){const h=e.deltaX-i.deltaX,g=e.deltaY-i.deltaY,_=uS(n,h,g);o=_.x,c=_.y,r=Math.abs(_.x)>Math.abs(_.y)?_.x:_.y,f=cS(h,g),t.lastInterval=e}else r=i.velocity,o=i.velocityX,c=i.velocityY,f=i.direction;e.velocity=r,e.velocityX=o,e.velocityY=c,e.direction=f}function zM(t,e){const{session:i}=t,{pointers:n}=e,{length:r}=n;i.firstInput||(i.firstInput=q0(e)),r>1&&!i.firstMultiple?i.firstMultiple=q0(e):r===1&&(i.firstMultiple=!1);const{firstInput:o,firstMultiple:c}=i,f=c?c.center:o.center,h=e.center=oS(n);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-o.timeStamp,e.angle=kM(f,h),e.distance=lS(f,h);const{deltaX:g,deltaY:_}=BM(i,e);e.deltaX=g,e.deltaY=_,e.offsetDirection=cS(e.deltaX,e.deltaY);const m=uS(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=m.x,e.overallVelocityY=m.y,e.overallVelocity=Math.abs(m.x)>Math.abs(m.y)?m.x:m.y,e.scale=c?UM(c.pointers,n):1,e.rotation=c?FM(c.pointers,n):0,e.maxPointers=i.prevInput?e.pointers.length>i.prevInput.maxPointers?e.pointers.length:i.prevInput.maxPointers:e.pointers.length;let y=t.element;return DM(e.srcEvent.target,y)&&(y=e.srcEvent.target),e.target=y,LM(i,e),e}function VM(t,e,i){const n=i.pointers.length,r=i.changedPointers.length,o=e&at.Start&&n-r===0,c=e&(at.End|at.Cancel)&&n-r===0;i.isFirst=!!o,i.isFinal=!!c,o&&(t.session={}),i.eventType=e;const f=zM(t,i);t.emit("hammer.input",f),t.recognize(f),t.session.prevInput=f}let HM=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=i=>{this.manager.options.enable&&this.handler(i)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,i){VM(this.manager,e,i)}init(){td(this.element,this.evEl,this.domHandler),td(this.target,this.evTarget,this.domHandler),td(Y0(this.element),this.evWin,this.domHandler)}destroy(){id(this.element,this.evEl,this.domHandler),id(this.target,this.evTarget,this.domHandler),id(Y0(this.element),this.evWin,this.domHandler)}};const jM={pointerdown:at.Start,pointermove:at.Move,pointerup:at.End,pointercancel:at.Cancel,pointerout:at.Cancel},WM="pointerdown",XM="pointermove pointerup pointercancel";class $M extends HM{constructor(e){super(e),this.evEl=WM,this.evWin=XM,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:i}=this;let n=!1;const r=jM[e.type],o=e.pointerType,c=o==="touch";let f=i.findIndex(h=>h.pointerId===e.pointerId);r&at.Start&&(e.buttons||c)?f<0&&(i.push(e),f=i.length-1):r&(at.End|at.Cancel)&&(n=!0),!(f<0)&&(i[f]=e,this.callback(r,{pointers:i,changedPointers:[e],eventType:r,pointerType:o,srcEvent:e}),n&&i.splice(f,1))}}const YM=["","webkit","Moz","MS","ms","o"];function qM(t,e){const i=e[0].toUpperCase()+e.slice(1);for(const n of YM){const r=n?n+i:e;if(r in t)return r}}const KM=1,Q0=2,G0={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class ZM{constructor(e,i){this.options={...G0,...i,cssProps:{...G0.cssProps,...i.cssProps},inputTarget:i.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new $M(this),this.touchAction=new IM(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?Q0:KM}recognize(e){const{session:i}=this;if(i.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let n;const{recognizers:r}=this;let{curRecognizer:o}=i;(!o||o&&o.state&Ae.Recognized)&&(o=i.curRecognizer=null);let c=0;for(;c<r.length;)n=r[c],i.stopped!==Q0&&(!o||n===o||n.canRecognizeWith(o))?n.recognize(e):n.reset(),!o&&n.state&(Ae.Began|Ae.Changed|Ae.Ended)&&(o=i.curRecognizer=n),c++}get(e){const{recognizers:i}=this;for(let n=0;n<i.length;n++)if(i[n].options.event===e)return i[n];return null}add(e){if(Array.isArray(e)){for(const n of e)this.add(n);return this}const i=this.get(e.options.event);return i&&this.remove(i),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const n of e)this.remove(n);return this}const i=typeof e=="string"?this.get(e):e;if(i){const{recognizers:n}=this,r=n.indexOf(i);r!==-1&&(n.splice(r,1),this.touchAction.update())}return this}on(e,i){if(!e||!i)return;const{handlers:n}=this;for(const r of Oc(e))n[r]=n[r]||[],n[r].push(i)}off(e,i){if(!e)return;const{handlers:n}=this;for(const r of Oc(e))i?n[r]&&n[r].splice(n[r].indexOf(i),1):delete n[r]}emit(e,i){const n=this.handlers[e]&&this.handlers[e].slice();if(!n||!n.length)return;const r=i;r.type=e,r.preventDefault=function(){i.srcEvent.preventDefault()};let o=0;for(;o<n.length;)n[o](r),o++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:i}=this;if(i){for(const[n,r]of Object.entries(this.options.cssProps)){const o=qM(i.style,n);e?(this.oldCssProps[o]=i.style[o],i.style[o]=r):i.style[o]=this.oldCssProps[o]||""}e||(this.oldCssProps={})}}}let QM=1;function GM(){return QM++}function J0(t){return t&Ae.Cancelled?"cancel":t&Ae.Ended?"end":t&Ae.Changed?"move":t&Ae.Began?"start":""}class fS{constructor(e){this.options=e,this.id=GM(),this.state=Ae.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const r of e)this.recognizeWith(r);return this}let i;if(typeof e=="string"){if(i=this.manager.get(e),!i)throw new Error(`Cannot find recognizer ${e}`)}else i=e;const{simultaneous:n}=this;return n[i.id]||(n[i.id]=i,i.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const n of e)this.dropRecognizeWith(n);return this}let i;return typeof e=="string"?i=this.manager.get(e):i=e,i&&delete this.simultaneous[i.id],this}requireFailure(e){if(Array.isArray(e)){for(const r of e)this.requireFailure(r);return this}let i;if(typeof e=="string"){if(i=this.manager.get(e),!i)throw new Error(`Cannot find recognizer ${e}`)}else i=e;const{requireFail:n}=this;return n.indexOf(i)===-1&&(n.push(i),i.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const n of e)this.dropRequireFailure(n);return this}let i;if(typeof e=="string"?i=this.manager.get(e):i=e,i){const n=this.requireFail.indexOf(i);n>-1&&this.requireFail.splice(n,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:i}=this;i<Ae.Ended&&this.manager.emit(this.options.event+J0(i),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),i>=Ae.Ended&&this.manager.emit(this.options.event+J0(i),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=Ae.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Ae.Failed|Ae.Possible)))return!1;e++}return!0}recognize(e){const i={...e};if(!this.options.enable){this.reset(),this.state=Ae.Failed;return}this.state&(Ae.Recognized|Ae.Cancelled|Ae.Failed)&&(this.state=Ae.Possible),this.state=this.process(i),this.state&(Ae.Began|Ae.Changed|Ae.Ended|Ae.Cancelled)&&this.tryEmit(i)}getEventNames(){return[this.options.event]}reset(){}}class hS extends fS{attrTest(e){const i=this.options.pointers;return i===0||e.pointers.length===i}process(e){const{state:i}=this,{eventType:n}=e,r=i&(Ae.Began|Ae.Changed),o=this.attrTest(e);return r&&(n&at.Cancel||!o)?i|Ae.Cancelled:r||o?n&at.End?i|Ae.Ended:i&Ae.Began?i|Ae.Changed:Ae.Began:Ae.Failed}}class eb extends fS{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[Xd]}process(e){const{options:i}=this,n=e.pointers.length===i.pointers,r=e.distance<i.threshold,o=e.deltaTime<i.time;if(this.reset(),e.eventType&at.Start&&this.count===0)return this.failTimeout();if(r&&o&&n){if(e.eventType!==at.End)return this.failTimeout();const c=this.pTime?e.timeStamp-this.pTime<i.interval:!0,f=!this.pCenter||lS(this.pCenter,e.center)<i.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!f||!c?this.count=1:this.count+=1,this._input=e,this.count%i.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=Ae.Recognized,this.tryEmit(this._input)},i.interval),Ae.Began):Ae.Recognized}return Ae.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=Ae.Failed},this.options.interval),Ae.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===Ae.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const JM=["","start","move","end","cancel","up","down","left","right"];class tb extends hS{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:ct.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,i=[];return e&ct.Horizontal&&i.push(Yd),e&ct.Vertical&&i.push($d),i}getEventNames(){return JM.map(e=>this.options.event+e)}directionTest(e){const{options:i}=this;let n=!0,{distance:r}=e,{direction:o}=e;const c=e.deltaX,f=e.deltaY;return o&i.direction||(i.direction&ct.Horizontal?(o=c===0?ct.None:c<0?ct.Left:ct.Right,n=c!==this.pX,r=Math.abs(e.deltaX)):(o=f===0?ct.None:f<0?ct.Up:ct.Down,n=f!==this.pY,r=Math.abs(e.deltaY))),e.direction=o,n&&r>i.threshold&&!!(o&i.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&Ae.Began)||!(this.state&Ae.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const i=ct[e.direction].toLowerCase();i&&(e.additionalEvent=this.options.event+i),super.emit(e)}}const eO=["","start","move","end","cancel","in","out"];class tO extends hS{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[rc]}getEventNames(){return eO.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&Ae.Began))}emit(e){if(e.scale!==1){const i=e.scale<1?"in":"out";e.additionalEvent=this.options.event+i}super.emit(e)}}class hu{constructor(e,i,n){this.element=e,this.callback=i,this.options=n}}const iO=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",nO=iO.indexOf("firefox")!==-1,ib=4.000244140625,sO=40,rO=.25;class aO extends hu{constructor(e,i,n){super(e,i,{enable:!0,...n}),this.handleEvent=r=>{if(!this.options.enable)return;let o=r.deltaY;globalThis.WheelEvent&&(nO&&r.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(o/=globalThis.devicePixelRatio),r.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(o*=sO)),o!==0&&o%ib===0&&(o=Math.floor(o/ib)),r.shiftKey&&o&&(o=o*rO),this.callback({type:"wheel",center:{x:r.clientX,y:r.clientY},delta:-o,srcEvent:r,pointerType:"mouse",target:r.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,i){e==="wheel"&&(this.options.enable=i)}}const nb=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class oO extends hu{constructor(e,i,n){super(e,i,{enable:!0,...n}),this.handleEvent=o=>{this.handleOverEvent(o),this.handleOutEvent(o),this.handleEnterEvent(o),this.handleLeaveEvent(o),this.handleMoveEvent(o)},this.pressed=!1;const{enable:r}=this.options;this.enableMoveEvent=r,this.enableLeaveEvent=r,this.enableEnterEvent=r,this.enableOutEvent=r,this.enableOverEvent=r,nb.forEach(o=>e.addEventListener(o,this.handleEvent))}destroy(){nb.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,i){switch(e){case"pointermove":this.enableMoveEvent=i;break;case"pointerover":this.enableOverEvent=i;break;case"pointerout":this.enableOutEvent=i;break;case"pointerenter":this.enableEnterEvent=i;break;case"pointerleave":this.enableLeaveEvent=i;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,i){this.callback({type:e,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})}}const sb=["keydown","keyup"];class lO extends hu{constructor(e,i,n){super(e,i,{enable:!0,tabIndex:0,...n}),this.handleEvent=r=>{const o=r.target||r.srcElement;o.tagName==="INPUT"&&o.type==="text"||o.tagName==="TEXTAREA"||(this.enableDownEvent&&r.type==="keydown"&&this.callback({type:"keydown",srcEvent:r,key:r.key,target:r.target}),this.enableUpEvent&&r.type==="keyup"&&this.callback({type:"keyup",srcEvent:r,key:r.key,target:r.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",sb.forEach(r=>e.addEventListener(r,this.handleEvent))}destroy(){sb.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,i){e==="keydown"&&(this.enableDownEvent=i),e==="keyup"&&(this.enableUpEvent=i)}}class cO extends hu{constructor(e,i,n){super(e,i,n),this.handleEvent=r=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,i){e==="contextmenu"&&(this.options.enable=i)}}const rb=1,qd=2,ab=4,uO={pointerdown:rb,pointermove:qd,pointerup:ab,mousedown:rb,mousemove:qd,mouseup:ab},fO=0,hO=1,dO=2,gO=1,pO=2,_O=4;function mO(t){const e=uO[t.srcEvent.type];if(!e)return null;const{buttons:i,button:n}=t.srcEvent;let r=!1,o=!1,c=!1;return e===qd?(r=!!(i&gO),o=!!(i&_O),c=!!(i&pO)):(r=n===fO,o=n===hO,c=n===dO),{leftButton:r,middleButton:o,rightButton:c}}function yO(t,e){const i=t.center;if(!i)return null;const n=e.getBoundingClientRect(),r=n.width/e.offsetWidth||1,o=n.height/e.offsetHeight||1,c={x:(i.x-n.left-e.clientLeft)/r,y:(i.y-n.top-e.clientTop)/o};return{center:i,offsetCenter:c}}const bO={srcElement:"root",priority:0};class vO{constructor(e,i){this.handleEvent=n=>{if(this.isEmpty())return;const r=this._normalizeEvent(n);let o=n.srcEvent.target;for(;o&&o!==r.rootElement;){if(this._emit(r,o),r.handled)return;o=o.parentNode}this._emit(r,"root")},this.eventManager=e,this.recognizerName=i,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,i,n,r=!1,o=!1){const{handlers:c,handlersByElement:f}=this,h={...bO,...n};let g=f.get(h.srcElement);g||(g=[],f.set(h.srcElement,g));const _={type:e,handler:i,srcElement:h.srcElement,priority:h.priority};r&&(_.once=!0),o&&(_.passive=!0),c.push(_),this._active=this._active||!_.passive;let m=g.length-1;for(;m>=0&&!(g[m].priority>=_.priority);)m--;g.splice(m+1,0,_)}remove(e,i){const{handlers:n,handlersByElement:r}=this;for(let o=n.length-1;o>=0;o--){const c=n[o];if(c.type===e&&c.handler===i){n.splice(o,1);const f=r.get(c.srcElement);f.splice(f.indexOf(c),1),f.length===0&&r.delete(c.srcElement)}}this._active=n.some(o=>!o.passive)}_emit(e,i){const n=this.handlersByElement.get(i);if(n){let r=!1;const o=()=>{e.handled=!0},c=()=>{e.handled=!0,r=!0},f=[];for(let h=0;h<n.length;h++){const{type:g,handler:_,once:m}=n[h];if(_({...e,type:g,stopPropagation:o,stopImmediatePropagation:c}),m&&f.push(n[h]),r)break}for(let h=0;h<f.length;h++){const{type:g,handler:_}=f[h];this.remove(g,_)}}}_normalizeEvent(e){const i=this.eventManager.getElement();return{...e,...mO(e),...yO(e,i),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:i}}}function TO(t){if("recognizer"in t)return t;let e;const i=Array.isArray(t)?[...t]:[t];if(typeof i[0]=="function"){const n=i.shift(),r=i.shift()||{};e=new n(r)}else e=i.shift();return{recognizer:e,recognizeWith:typeof i[0]=="string"?[i[0]]:i[0],requireFailure:typeof i[1]=="string"?[i[1]]:i[1]}}class SO{constructor(e=null,i={}){if(this._onBasicInput=n=>{this.manager.emit(n.srcEvent.type,n)},this._onOtherEvent=n=>{this.manager.emit(n.type,n)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...i},this.events=new Map,this.element=e,!!e){this.manager=new ZM(e,this.options);for(const n of this.options.recognizers){const{recognizer:r,recognizeWith:o,requireFailure:c}=TO(n);this.manager.add(r),o&&r.recognizeWith(o),c&&r.requireFailure(c)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new aO(e,this._onOtherEvent,{enable:!1}),this.moveInput=new oO(e,this._onOtherEvent,{enable:!1}),this.keyInput=new lO(e,this._onOtherEvent,{enable:!1,tabIndex:i.tabIndex}),this.contextmenuInput=new cO(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,i,n){this._addEventHandler(e,i,n,!1)}once(e,i,n){this._addEventHandler(e,i,n,!0)}watch(e,i,n){this._addEventHandler(e,i,n,!1,!0)}off(e,i){this._removeEventHandler(e,i)}_toggleRecognizer(e,i){var o,c,f,h;const{manager:n}=this;if(!n)return;const r=n.get(e);r&&(r.set({enable:i}),n.touchAction.update()),(o=this.wheelInput)==null||o.enableEventType(e,i),(c=this.moveInput)==null||c.enableEventType(e,i),(f=this.keyInput)==null||f.enableEventType(e,i),(h=this.contextmenuInput)==null||h.enableEventType(e,i)}_addEventHandler(e,i,n,r,o){if(typeof e!="string"){n=i;for(const[g,_]of Object.entries(e))this._addEventHandler(g,_,n,r,o);return}const{manager:c,events:f}=this;if(!c)return;let h=f.get(e);if(!h){const g=this._getRecognizerName(e)||e;h=new vO(this,g),f.set(e,h),c&&c.on(e,h.handleEvent)}h.add(e,i,n,r,o),h.isEmpty()||this._toggleRecognizer(h.recognizerName,!0)}_removeEventHandler(e,i){if(typeof e!="string"){for(const[o,c]of Object.entries(e))this._removeEventHandler(o,c);return}const{events:n}=this,r=n.get(e);if(r&&(r.remove(e,i),r.isEmpty())){const{recognizerName:o}=r;let c=!1;for(const f of n.values())if(f.recognizerName===o&&!f.isEmpty()){c=!0;break}c||this._toggleRecognizer(o,!1)}}_getRecognizerName(e){var i;return(i=this.manager.recognizers.find(n=>n.getEventNames().includes(e)))==null?void 0:i.options.event}}const Ue={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Ue,"IDENTITY",{get:()=>(Oe.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Ri={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},bs={common:0,meters:1,pixels:2},Kd={click:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},ob={multipan:[tb,{threshold:10,direction:ct.Vertical,pointers:2}],pinch:[tO,{},null,["multipan"]],pan:[tb,{threshold:1},["pinch"],["multipan"]],dblclick:[eb,{event:"dblclick",taps:2}],click:[eb,{event:"click"},null,["dblclick"]]},AO=Object.keys(Ue).map(t=>`const int COORDINATE_SYSTEM_${t} = ${Ue[t]};`).join(""),EO=Object.keys(Ri).map(t=>`const int PROJECTION_MODE_${t} = ${Ri[t]};`).join(""),wO=Object.keys(bs).map(t=>`const int UNIT_${t.toUpperCase()} = ${bs[t]};`).join(""),RO=`${AO}
${EO}
${wO}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`;function xO(t,e){if(t===e)return!0;if(Array.isArray(t)){const i=t.length;if(!e||e.length!==i)return!1;for(let n=0;n<i;n++)if(t[n]!==e[n])return!1;return!0}return!1}function go(t){let e={},i;return n=>{for(const r in n)if(!xO(n[r],e[r])){i=t(n),e=n;break}return i}}const lb=[0,0,0,0],CO=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],dS=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],MO=[0,0,0],gS=[0,0,0],OO=go(IO);function pS(t,e,i=gS){i.length<3&&(i=[i[0],i[1],0]);let n=i,r,o=!0;switch(e===Ue.LNGLAT_OFFSETS||e===Ue.METER_OFFSETS?r=i:r=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case Ri.WEB_MERCATOR:(e===Ue.LNGLAT||e===Ue.CARTESIAN)&&(r=[0,0,0],o=!1);break;case Ri.WEB_MERCATOR_AUTO_OFFSET:e===Ue.LNGLAT?n=r:e===Ue.CARTESIAN&&(n=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],r=t.unprojectPosition(n),n[0]-=i[0],n[1]-=i[1],n[2]-=i[2]);break;case Ri.IDENTITY:n=t.position.map(Math.fround),n[2]=n[2]||0;break;case Ri.GLOBE:o=!1,r=null;break;default:o=!1}return{geospatialOrigin:r,shaderCoordinateOrigin:n,offsetMode:o}}function PO(t,e,i){const{viewMatrixUncentered:n,projectionMatrix:r}=t;let{viewMatrix:o,viewProjectionMatrix:c}=t,f=lb,h=lb,g=t.cameraPosition;const{geospatialOrigin:_,shaderCoordinateOrigin:m,offsetMode:y}=pS(t,e,i);return y&&(h=t.projectPosition(_||m),g=[g[0]-h[0],g[1]-h[1],g[2]-h[2]],h[3]=1,f=ho([],h,c),o=n||o,c=ps([],r,o),c=ps([],c,CO)),{viewMatrix:o,viewProjectionMatrix:c,projectionCenter:f,originCommon:h,cameraPosCommon:g,shaderCoordinateOrigin:m,geospatialOrigin:_}}function NO({viewport:t,devicePixelRatio:e=1,modelMatrix:i=null,coordinateSystem:n=Ue.DEFAULT,coordinateOrigin:r=gS,autoWrapLongitude:o=!1}){n===Ue.DEFAULT&&(n=t.isGeospatial?Ue.LNGLAT:Ue.CARTESIAN);const c=OO({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:r});return c.wrapLongitude=o,c.modelMatrix=i||dS,c}function IO({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:n}){const{projectionCenter:r,viewProjectionMatrix:o,originCommon:c,cameraPosCommon:f,shaderCoordinateOrigin:h,geospatialOrigin:g}=PO(t,i,n),_=t.getDistanceScales(),m=[t.width*e,t.height*e],y=ho([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,T={coordinateSystem:i,projectionMode:t.projectionMode,coordinateOrigin:h,commonOrigin:c.slice(0,3),center:r,pseudoMeters:!!t._pseudoMeters,viewportSize:m,devicePixelRatio:e,focalDistance:y,commonUnitsPerMeter:_.unitsPerMeter,commonUnitsPerWorldUnit:_.unitsPerMeter,commonUnitsPerWorldUnit2:MO,scale:t.scale,wrapLongitude:!1,viewProjectionMatrix:o,modelMatrix:dS,cameraPosition:f};if(g){const R=t.getDistanceScales(g);switch(i){case Ue.METER_OFFSETS:T.commonUnitsPerWorldUnit=R.unitsPerMeter,T.commonUnitsPerWorldUnit2=R.unitsPerMeter2;break;case Ue.LNGLAT:case Ue.LNGLAT_OFFSETS:t._pseudoMeters||(T.commonUnitsPerMeter=R.unitsPerMeter),T.commonUnitsPerWorldUnit=R.unitsPerDegree,T.commonUnitsPerWorldUnit2=R.unitsPerDegree2;break;case Ue.CARTESIAN:T.commonUnitsPerWorldUnit=[1,1,R.unitsPerMeter[2]],T.commonUnitsPerWorldUnit2=[0,0,R.unitsPerMeter2[2]];break}}return T}const DO={};function kO(t=DO){return"viewport"in t?NO(t):{}}const Ig={name:"project",dependencies:[fM,aS],vs:RO,getUniforms:kO,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},BO=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,po={name:"project32",dependencies:[Ig],vs:BO};function UO(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Tr(t,e){const i=ho([],e,t);return tM(i,i,1/i[3]),i}function cb(t,e){const i=t%e;return i<0?e+i:i}function Zd(t,e,i){return t<e?e:t>i?i:t}function FO(t){return Math.log(t)*Math.LOG2E}const Dg=Math.log2||FO;function Ki(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const fi=Math.PI,_S=fi/4,ti=fi/180,Qd=180/fi,Or=512,Pc=4003e4,ub=85.051129,LO=1.5;function zO(t){return Dg(t)}function Nc(t){const[e,i]=t;Ki(Number.isFinite(e)),Ki(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");const n=e*ti,r=i*ti,o=Or*(n+fi)/(2*fi),c=Or*(fi+Math.log(Math.tan(_S+r*.5)))/(2*fi);return[o,c]}function Pr(t){const[e,i]=t,n=e/Or*(2*fi)-fi,r=2*(Math.atan(Math.exp(i/Or*(2*fi)-fi))-_S);return[n*Qd,r*Qd]}function VO(t){const{latitude:e}=t;Ki(Number.isFinite(e));const i=Math.cos(e*ti);return zO(Pc*i)-9}function nd(t){const e=Math.cos(t*ti);return Or/Pc/e}function Gd(t){const{latitude:e,longitude:i,highPrecision:n=!1}=t;Ki(Number.isFinite(e)&&Number.isFinite(i));const r=Or,o=Math.cos(e*ti),c=r/360,f=c/o,h=r/Pc/o,g={unitsPerMeter:[h,h,h],metersPerUnit:[1/h,1/h,1/h],unitsPerDegree:[c,f,h],degreesPerUnit:[1/c,1/f,1/h]};if(n){const _=ti*Math.tan(e*ti)/o,m=c*_/2,y=r/Pc*_,T=y/f*h;g.unitsPerDegree2=[0,m,y],g.unitsPerMeter2=[T,0,T]}return g}function mS(t,e){const[i,n,r]=t,[o,c,f]=e,{unitsPerMeter:h,unitsPerMeter2:g}=Gd({longitude:i,latitude:n,highPrecision:!0}),_=Nc(t);_[0]+=o*(h[0]+g[0]*c),_[1]+=c*(h[1]+g[1]*c);const m=Pr(_),y=(r||0)+(f||0);return Number.isFinite(r)||Number.isFinite(f)?[m[0],m[1],y]:m}function HO(t){const{height:e,pitch:i,bearing:n,altitude:r,scale:o,center:c}=t,f=UO();Mc(f,f,[0,0,-r]),eS(f,f,-i*ti),tS(f,f,n*ti);const h=o/e;return Ng(f,f,[h,h,h]),c&&Mc(f,f,PC([],c)),f}function jO(t){const{width:e,height:i,altitude:n,pitch:r=0,offset:o,center:c,scale:f,nearZMultiplier:h=1,farZMultiplier:g=1}=t;let{fovy:_=Ic(LO)}=t;n!==void 0&&(_=Ic(n));const m=_*ti,y=r*ti,T=yS(_);let R=T;c&&(R+=c[2]*f/Math.cos(y)/i);const x=m*(.5+(o?o[1]:0)/i),O=Math.sin(x)*R/Math.sin(Zd(Math.PI/2-y-x,.01,Math.PI-.01)),N=Math.sin(y)*O+R,B=R*10,P=Math.min(N*g,B);return{fov:m,aspect:e/i,focalDistance:T,near:h,far:P}}function Ic(t){return 2*Math.atan(.5/t)*Qd}function yS(t){return .5/Math.tan(.5*t*ti)}function bS(t,e){const[i,n,r=0]=t;return Ki(Number.isFinite(i)&&Number.isFinite(n)&&Number.isFinite(r)),Tr(e,[i,n,r,1])}function kg(t,e,i=0){const[n,r,o]=t;if(Ki(Number.isFinite(n)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(o))return Tr(e,[n,r,o,1]);const c=Tr(e,[n,r,0,1]),f=Tr(e,[n,r,1,1]),h=c[2],g=f[2],_=h===g?0:((i||0)-h)/(g-h);return QT([],c,f,_)}function WO(t){const{width:e,height:i,bounds:n,minExtent:r=0,maxZoom:o=24,offset:c=[0,0]}=t,[[f,h],[g,_]]=n,m=XO(t.padding),y=Nc([f,Zd(_,-85.051129,ub)]),T=Nc([g,Zd(h,-85.051129,ub)]),R=[Math.max(Math.abs(T[0]-y[0]),r),Math.max(Math.abs(T[1]-y[1]),r)],x=[e-m.left-m.right-Math.abs(c[0])*2,i-m.top-m.bottom-Math.abs(c[1])*2];Ki(x[0]>0&&x[1]>0);const O=x[0]/R[0],N=x[1]/R[1],B=(m.right-m.left)/2/O,P=(m.top-m.bottom)/2/N,j=[(T[0]+y[0])/2+B,(T[1]+y[1])/2+P],z=Pr(j),q=Math.min(o,Dg(Math.abs(Math.min(O,N))));return Ki(Number.isFinite(q)),{longitude:z[0],latitude:z[1],zoom:q}}function XO(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Ki(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const fb=Math.PI/180;function $O(t,e=0){const{width:i,height:n,unproject:r}=t,o={targetZ:e},c=r([0,n],o),f=r([i,n],o);let h,g;const _=t.fovy?.5*t.fovy*fb:Math.atan(.5/t.altitude),m=(90-t.pitch)*fb;return _>m-.01?(h=hb(t,0,e),g=hb(t,i,e)):(h=r([0,0],o),g=r([i,0],o)),[c,f,g,h]}function hb(t,e,i){const{pixelUnprojectionMatrix:n}=t,r=Tr(n,[e,0,1,1]),o=Tr(n,[e,t.height,1,1]),f=(i*t.distanceScales.unitsPerMeter[2]-r[2])/(o[2]-r[2]),h=QT([],r,o,f),g=Pr(h);return g.push(i),g}const db=512;function YO(t){const{width:e,height:i,pitch:n=0}=t;let{longitude:r,latitude:o,zoom:c,bearing:f=0}=t;(r<-180||r>180)&&(r=cb(r+180,360)-180),(f<-180||f>180)&&(f=cb(f+180,360)-180);const h=Dg(i/db);if(c<=h)c=h,o=0;else{const g=i/2/Math.pow(2,c),_=Pr([0,g])[1];if(o<_)o=_;else{const m=Pr([0,db-g])[1];o>m&&(o=m)}}return{width:e,height:i,longitude:r,latitude:o,zoom:c,pitch:n,bearing:f}}const vS=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,qO=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,KO=`
${vS}
${qO}
`,ZO=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,QO=`
${vS}
${ZO}
`,GO=go(nP),JO=go(sP),eP=[0,0,0,1],tP=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function iP(t,e){const[i,n,r]=t,o=kg([i,n,r],e);return Number.isFinite(r)?o:[o[0],o[1],0]}function nP({viewport:t,center:e}){return new Mi(t.viewProjectionMatrix).invert().transform(e)}function sP({viewport:t,shadowMatrices:e}){const i=[],n=t.pixelUnprojectionMatrix,r=t.isGeospatial?void 0:1,o=[[0,0,r],[t.width,0,r],[0,t.height,r],[t.width,t.height,r],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(c=>iP(c,n));for(const c of e){const f=c.clone().translate(new Ci(t.center).negate()),h=o.map(_=>f.transform(_)),g=new Mi().ortho({left:Math.min(...h.map(_=>_[0])),right:Math.max(...h.map(_=>_[0])),bottom:Math.min(...h.map(_=>_[1])),top:Math.max(...h.map(_=>_[1])),near:Math.min(...h.map(_=>-_[2])),far:Math.max(...h.map(_=>-_[2]))});i.push(g.multiplyRight(c))}return i}function rP(t){const{shadowEnabled:e=!0,project:i}=t;if(!e||!i||!t.shadowMatrices||!t.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const n=Ig.getUniforms(i),r=GO({viewport:i.viewport,center:n.center}),o=[],c=JO({shadowMatrices:t.shadowMatrices,viewport:i.viewport}).slice();for(let h=0;h<t.shadowMatrices.length;h++){const g=c[h],_=g.clone().translate(new Ci(i.viewport.center).negate());n.coordinateSystem===Ue.LNGLAT&&n.projectionMode===Ri.WEB_MERCATOR?(c[h]=_,o[h]=r):(c[h]=g.clone().multiplyRight(tP),o[h]=_.transform(r))}const f={drawShadowMap:!!t.drawToShadowMap,useShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,color:t.shadowColor||eP,lightId:t.shadowLightId||0,lightCount:t.shadowMatrices.length,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};for(let h=0;h<c.length;h++)f[`viewProjectionMatrix${h}`]=c[h],f[`projectCenter${h}`]=o[h];for(let h=0;h<2;h++)f[`shadow_uShadowMap${h}`]=t.shadowMaps&&t.shadowMaps[h]||t.dummyShadowMap;return f}const gb={name:"shadow",dependencies:[Ig],vs:KO,fs:QO,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:rP,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},_o={...W0,defaultUniforms:{...W0.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},aP=[aS],oP=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function lP(){const t=bc.getDefaultShaderAssembler();for(const e of aP)t.addDefaultModule(e);for(const e of oP)t.addShaderHook(e);return t}const cP=[255,255,255],uP=1;let fP=0;class hP{constructor(e={}){this.type="ambient";const{color:i=cP}=e,{intensity:n=uP}=e;this.id=e.id||`ambient-${fP++}`,this.color=i,this.intensity=n}}const dP=[255,255,255],gP=1,pP=[0,0,-1];let _P=0;class pb{constructor(e={}){this.type="directional";const{color:i=dP}=e,{intensity:n=gP}=e,{direction:r=pP}=e,{_shadow:o=!1}=e;this.id=e.id||`directional-${_P++}`,this.color=i,this.intensity=n,this.type="directional",this.direction=new Ci(r).normalize().toArray(),this.shadow=o}getProjectedLight(e){return this}}class mP{constructor(e,i={id:"pass"}){const{id:n}=i;this.id=n,this.device=e,this.props={...i}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Bg extends mP{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[i,n]=this.device.canvasContext.getDrawingBufferSize(),r=e.clearCanvas??!0,o=e.clearColor??(r?[0,0,0,0]:!1),c=r?1:!1,f=r?0:!1,h=e.colorMask??15,g={viewport:[0,0,i,n]};e.colorMask&&(g.colorMask=h),e.scissorRect&&(g.scissorRect=e.scissorRect);const _=this.device.beginRenderPass({framebuffer:e.target,parameters:g,clearColor:o,clearDepth:c,clearStencil:f});try{return this._drawLayers(_,e)}finally{_.end()}}_drawLayers(e,i){const{target:n,shaderModuleProps:r,viewports:o,views:c,onViewportActive:f,clearStack:h=!0}=i;i.pass=i.pass||"unknown",h&&(this._lastRenderIndex=-1);const g=[];for(const _ of o){const m=c&&c[_.id];f==null||f(_);const y=this._getDrawLayerParams(_,i),T=_.subViewports||[_];for(const R of T){const x=this._drawLayersInViewport(e,{target:n,shaderModuleProps:r,viewport:R,view:m,pass:i.pass,layers:i.layers},y);g.push(x)}}return g}_getDrawLayerParams(e,{layers:i,pass:n,isPicking:r=!1,layerFilter:o,cullRect:c,effects:f,shaderModuleProps:h},g=!1){var R;const _=[],m=TS(this._lastRenderIndex+1),y={layer:i[0],viewport:e,isPicking:r,renderPass:n,cullRect:c},T={};for(let x=0;x<i.length;x++){const O=i[x],N=this._shouldDrawLayer(O,y,o,T),B={shouldDrawLayer:N};N&&!g&&(B.shouldDrawLayer=!0,B.layerRenderIndex=m(O,N),B.shaderModuleProps=this._getShaderModuleProps(O,f,n,h),B.layerParameters={...(R=O.context.deck)==null?void 0:R.props.parameters,...this.getLayerParameters(O,x,e)}),_[x]=B}return _}_drawLayersInViewport(e,{layers:i,shaderModuleProps:n,pass:r,target:o,viewport:c,view:f},h){const g=yP(this.device,{shaderModuleProps:n,target:o,viewport:c});if(f&&f.props.clear){const m=f.props.clear===!0?{color:!0,depth:!0}:f.props.clear;this.device.beginRenderPass({framebuffer:o,parameters:{viewport:g,scissorRect:g},clearColor:m.color?[0,0,0,0]:!1,clearDepth:m.depth?1:!1}).end()}const _={totalCount:i.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:g});for(let m=0;m<i.length;m++){const y=i[m],T=h[m],{shouldDrawLayer:R}=T;if(R&&y.props.pickable&&_.pickableCount++,y.isComposite&&_.compositeCount++,y.isDrawable&&T.shouldDrawLayer){const{layerRenderIndex:x,shaderModuleProps:O,layerParameters:N}=T;_.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,x),O.project&&(O.project.viewport=c),y.context.renderPass=e;try{y._drawLayer({renderPass:e,shaderModuleProps:O,uniforms:{layerIndex:x},parameters:N})}catch(B){y.raiseError(B,`drawing ${y} to ${r}`)}}}return _}shouldDrawLayer(e){return!0}getShaderModuleProps(e,i,n){return null}getLayerParameters(e,i,n){return e.props.parameters}_shouldDrawLayer(e,i,n,r){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;i.layer=e;let c=e.parent;for(;c;){if(!c.props.visible||!c.filterSubLayer(i))return!1;i.layer=c,c=c.parent}if(n){const f=i.layer.id;if(f in r||(r[f]=n(i)),!r[f])return!1}return e.activateViewport(i.viewport),!0}_getShaderModuleProps(e,i,n,r){var h,g;const o=this.device.canvasContext.cssToDeviceRatio(),c=((h=e.internalState)==null?void 0:h.propsInTransition)||e.props,f={layer:c,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:o,modelMatrix:c.modelMatrix,coordinateSystem:c.coordinateSystem,coordinateOrigin:c.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(i)for(const _ of i)_b(f,(g=_.getShaderModuleProps)==null?void 0:g.call(_,e,f));return _b(f,this.getShaderModuleProps(e,i,f),r)}}function TS(t=0,e={}){const i={},n=(r,o)=>{const c=r.props._offset,f=r.id,h=r.parent&&r.parent.id;let g;if(h&&!(h in e)&&n(r.parent,!1),h in i){const _=i[h]=i[h]||TS(e[h],e);g=_(r,o),i[f]=_}else Number.isFinite(c)?(g=c+(e[h]||0),i[f]=null):g=t;return o&&g>=t&&(t=g+1),e[f]=g,g};return n}function yP(t,{shaderModuleProps:e,target:i,viewport:n}){var h;const r=((h=e==null?void 0:e.project)==null?void 0:h.devicePixelRatio)??t.canvasContext.cssToDeviceRatio(),[,o]=t.canvasContext.getDrawingBufferSize(),c=i?i.height:o,f=n;return[f.x*r,c-(f.y+f.height)*r,f.width*r,f.height*r]}function _b(t,...e){for(const i of e)if(i)for(const n in i)t[n]?Object.assign(t[n],i[n]):t[n]=i[n];return t}class bP extends Bg{constructor(e,i){super(e,i);const n=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),r=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[n],depthStencilAttachment:r})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const i=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),r=e.viewports[0],o=r.width*n,c=r.height*n,f=[1,1,1,1];(o!==i.width||c!==i.height)&&i.resize({width:o,height:c}),super.render({...e,clearColor:f,target:i,pass:"shadow"})}getLayerParameters(e,i,n){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,i,n){return{shadow:{project:n.project,drawToShadowMap:!0}}}}const vP={color:[255,255,255],intensity:1},mb=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],TP=[0,0,0,200/255];class SS{constructor(e={}){this.id="lighting-effect",this.shadowColor=TP,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:i,deck:n}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(i),n._addDefaultShaderModule(gb),this.dummyShadowMap=i.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const i in e){const n=e[i];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(i=>i.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:i,viewports:n,onViewportActive:r,views:o}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let c=0;c<this.shadowPasses.length;c++)this.shadowPasses[c].render({layers:e,layerFilter:i,viewports:n,onViewportActive:r,views:o,shaderModuleProps:{shadow:{shadowLightId:c,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,i){const n=this.shadow?{project:i.project,shadowMaps:this.shadowPasses.map(c=>c.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},r={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(c=>c.getProjectedLight({layer:e})),pointLights:this.pointLights.map(c=>c.getProjectedLight({layer:e}))},o=e.props.material;return{shadow:n,lighting:r,phongMaterial:o,gouraudMaterial:o}}cleanup(e){for(const i of this.shadowPasses)i.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(gb))}_calculateMatrices(){const e=[];for(const i of this.directionalLights){const n=new Mi().lookAt({eye:new Ci(i.direction).negate()});e.push(n)}return e}_createShadowPasses(e){for(let i=0;i<this.directionalLights.length;i++){const n=new bP(e);this.shadowPasses[i]=n}}_applyDefaultLights(){const{ambientLight:e,pointLights:i,directionalLights:n}=this;!e&&i.length===0&&n.length===0&&(this.ambientLight=new hP(vP),this.directionalLights.push(new pb(mb[0]),new pb(mb[1])))}}class SP{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,i,{size:n=1,type:r,padding:o=0,copy:c=!1,initialize:f=!1,maxCount:h}){const g=r||e&&e.constructor||Float32Array,_=i*n+o;if(ArrayBuffer.isView(e)){if(_<=e.length)return e;if(_*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new g(e.buffer,0,_)}let m=1/0;h&&(m=h*n+o);const y=this._allocate(g,_,f,m);return e&&c?y.set(e):f||y.fill(0,0,4),this._release(e),y}release(e){this._release(e)}_allocate(e,i,n,r){let o=Math.max(Math.ceil(i*this.opts.overAlloc),1);o>r&&(o=r);const c=this._pool,f=e.BYTES_PER_ELEMENT*o,h=c.findIndex(g=>g.byteLength>=f);if(h>=0){const g=new e(c.splice(h,1)[0],0,o);return n&&g.fill(0),g}return new e(o)}_release(e){if(!ArrayBuffer.isView(e))return;const i=this._pool,{buffer:n}=e,{byteLength:r}=n,o=i.findIndex(c=>c.byteLength>=r);o<0?i.push(n):(o>0||i.length<this.opts.poolSize)&&i.splice(o,0,n),i.length>this.opts.poolSize&&i.shift()}}const Nr=new SP;function ja(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function AP(t){return[t[12],t[13],t[14]]}function EP(t){return{left:fr(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:fr(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:fr(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:fr(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:fr(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:fr(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const yb=new Ci;function fr(t,e,i,n){yb.set(t,e,i);const r=yb.len();return{distance:n/r,normal:new Ci(-t/r,-e/r,-i/r)}}function wP(t){return t-Math.fround(t)}let Ua;function sd(t,e){const{size:i=1,startIndex:n=0}=e,r=e.endIndex!==void 0?e.endIndex:t.length,o=(r-n)/i;Ua=Nr.allocate(Ua,o,{type:Float32Array,size:i*2});let c=n,f=0;for(;c<r;){for(let h=0;h<i;h++){const g=t[c++];Ua[f+h]=g,Ua[f+h+i]=wP(g)}f+=i*2}return Ua.subarray(0,o*i*2)}function RP(t){let e=null,i=!1;for(const n of t)n&&(e?(i||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],i=!0),e[0][0]=Math.min(e[0][0],n[0][0]),e[0][1]=Math.min(e[0][1],n[0][1]),e[1][0]=Math.max(e[1][0],n[1][0]),e[1][1]=Math.max(e[1][1],n[1][1])):e=n);return e}const xP=Math.PI/180,CP=ja(),bb=[0,0,0],MP={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function OP({width:t,height:e,orthographic:i,fovyRadians:n,focalDistance:r,padding:o,near:c,far:f}){const h=t/e,g=i?new Mi().orthographic({fovy:n,aspect:h,focalDistance:r,near:c,far:f}):new Mi().perspective({fovy:n,aspect:h,near:c,far:f});if(o){const{left:_=0,right:m=0,top:y=0,bottom:T=0}=o,R=On((_+t-m)/2,0,t)-t/2,x=On((y+e-T)/2,0,e)-e/2;g[8]-=R*2/t,g[9]+=x*2/e}return g}class mo{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||MP,this.focalDistance=e.focalDistance||1,this.position=e.position||bb,this.modelMatrix=e.modelMatrix||null;const{longitude:i,latitude:n}=e;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(i),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Ri.WEB_MERCATOR:Ri.WEB_MERCATOR_AUTO_OFFSET:Ri.IDENTITY}equals(e){return e instanceof mo?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&to(e.projectionMatrix,this.projectionMatrix)&&to(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:i=!0}={}){const n=this.projectPosition(e),r=bS(n,this.pixelProjectionMatrix),[o,c]=r,f=i?c:this.height-c;return e.length===2?[o,f]:[o,f,r[2]]}unproject(e,{topLeft:i=!0,targetZ:n}={}){const[r,o,c]=e,f=i?o:this.height-o,h=n&&n*this.distanceScales.unitsPerMeter[2],g=kg([r,f,c],this.pixelUnprojectionMatrix,h),[_,m,y]=this.unprojectPosition(g);return Number.isFinite(c)?[_,m,y]:Number.isFinite(n)?[_,m,n]:[_,m]}projectPosition(e){const[i,n]=this.projectFlat(e),r=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[i,n,r]}unprojectPosition(e){const[i,n]=this.unprojectFlat(e),r=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[i,n,r]}projectFlat(e){if(this.isGeospatial){const i=Nc(e);return i[1]=On(i[1],-318,830),i}return e}unprojectFlat(e){return this.isGeospatial?Pr(e):e}getBounds(e={}){const i={targetZ:e.z||0},n=this.unproject([0,0],i),r=this.unproject([this.width,0],i),o=this.unproject([0,this.height],i),c=this.unproject([this.width,this.height],i);return[Math.min(n[0],r[0],o[0],c[0]),Math.min(n[1],r[1],o[1],c[1]),Math.max(n[0],r[0],o[0],c[0]),Math.max(n[1],r[1],o[1],c[1])]}getDistanceScales(e){return e&&this.isGeospatial?Gd({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:i,width:n=1,height:r=1}){return e<this.x+this.width&&this.x<e+n&&i<this.y+this.height&&this.y<i+r}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,EP(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,i){return null}_initProps(e){const i=e.longitude,n=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=VO({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Gd({latitude:n,longitude:i}));const r=Math.pow(2,this.zoom);this.scale=r;const{position:o,modelMatrix:c}=e;let f=bb;if(o&&(f=c?new Mi(c).transformAsVector(o,[]):o),this.isGeospatial){const h=this.projectPosition([i,n,0]);this.center=new Ci(f).scale(this.distanceScales.unitsPerMeter).add(h)}else this.center=this.projectPosition(f)}_initMatrices(e){const{viewMatrix:i=CP,projectionMatrix:n=null,orthographic:r=!1,fovyRadians:o,fovy:c=75,near:f=.1,far:h=1e3,padding:g=null,focalDistance:_=1}=e;this.viewMatrixUncentered=i,this.viewMatrix=new Mi().multiplyRight(i).translate(new Ci(this.center).negate()),this.projectionMatrix=n||OP({width:this.width,height:this.height,orthographic:r,fovyRadians:o||c*xP,focalDistance:_,padding:g,near:f,far:h});const m=ja();ps(m,m,this.projectionMatrix),ps(m,m,this.viewMatrix),this.viewProjectionMatrix=m,this.viewMatrixInverse=jd([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=AP(this.viewMatrixInverse);const y=ja(),T=ja();Ng(y,y,[this.width/2,-this.height/2,1]),Mc(y,y,[1,-1,0]),ps(T,y,this.viewProjectionMatrix),this.pixelProjectionMatrix=T,this.pixelUnprojectionMatrix=jd(ja(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Oe.warn("Pixel project matrix not invertible")()}}mo.displayName="Viewport";class Ir extends mo{constructor(e={}){const{latitude:i=0,longitude:n=0,zoom:r=0,pitch:o=0,bearing:c=0,nearZMultiplier:f=.1,farZMultiplier:h=1.01,nearZ:g,farZ:_,orthographic:m=!1,projectionMatrix:y,repeat:T=!1,worldOffset:R=0,position:x,padding:O,legacyMeterSizes:N=!1}=e;let{width:B,height:P,altitude:j=1.5}=e;const z=Math.pow(2,r);B=B||1,P=P||1;let q,ue=null;if(y)j=y[5]/2,q=Ic(j);else{e.fovy?(q=e.fovy,j=yS(q)):q=Ic(j);let G;if(O){const{top:ae=0,bottom:te=0}=O;G=[0,On((ae+P-te)/2,0,P)-P/2]}ue=jO({width:B,height:P,scale:z,center:x&&[0,0,x[2]*nd(i)],offset:G,pitch:o,fovy:q,nearZMultiplier:f,farZMultiplier:h}),Number.isFinite(g)&&(ue.near=g),Number.isFinite(_)&&(ue.far=_)}let oe=HO({height:P,pitch:o,bearing:c,scale:z,altitude:j});R&&(oe=new Mi().translate([512*R,0,0]).multiplyLeft(oe)),super({...e,width:B,height:P,viewMatrix:oe,longitude:n,latitude:i,zoom:r,...ue,fovy:q,focalDistance:j}),this.latitude=i,this.longitude=n,this.zoom=r,this.pitch=o,this.bearing=c,this.altitude=j,this.fovy=q,this.orthographic=m,this._subViewports=T?[]:null,this._pseudoMeters=N,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),i=Math.floor((e[0]+180)/360),n=Math.ceil((e[2]-180)/360);for(let r=i;r<=n;r++){const o=r?new Ir({...this,worldOffset:r}):this;this._subViewports.push(o)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[i,n]=this.projectFlat(e),r=(e[2]||0)*nd(e[1]);return[i,n,r]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[i,n]=this.unprojectFlat(e),r=(e[2]||0)/nd(n);return[i,n,r]}addMetersToLngLat(e,i){return mS(e,i)}panByPosition(e,i){const n=kg(i,this.pixelUnprojectionMatrix),r=this.projectFlat(e),o=H0([],r,wC([],n)),c=H0([],this.center,o),[f,h]=this.unprojectFlat(c);return{longitude:f,latitude:h}}getBounds(e={}){const i=$O(this,e.z||0);return[Math.min(i[0][0],i[1][0],i[2][0],i[3][0]),Math.min(i[0][1],i[1][1],i[2][1],i[3][1]),Math.max(i[0][0],i[1][0],i[2][0],i[3][0]),Math.max(i[0][1],i[1][1],i[2][1],i[3][1])]}fitBounds(e,i={}){const{width:n,height:r}=this,{longitude:o,latitude:c,zoom:f}=WO({width:n,height:r,bounds:e,...i});return new Ir({width:n,height:r,longitude:o,latitude:c,zoom:f})}}Ir.displayName="WebMercatorViewport";const vb=[0,0,0];function rd(t,e,i=!1){const n=e.projectPosition(t);if(i&&e instanceof Ir){const[r,o,c=0]=t,f=e.getDistanceScales([r,o]);n[2]=c*f.unitsPerMeter[2]}return n}function PP(t){const{viewport:e,modelMatrix:i,coordinateOrigin:n}=t;let{coordinateSystem:r,fromCoordinateSystem:o,fromCoordinateOrigin:c}=t;return r===Ue.DEFAULT&&(r=e.isGeospatial?Ue.LNGLAT:Ue.CARTESIAN),o===void 0&&(o=r),c===void 0&&(c=n),{viewport:e,coordinateSystem:r,coordinateOrigin:n,modelMatrix:i,fromCoordinateSystem:o,fromCoordinateOrigin:c}}function AS(t,{viewport:e,modelMatrix:i,coordinateSystem:n,coordinateOrigin:r,offsetMode:o}){let[c,f,h=0]=t;switch(i&&([c,f,h]=ho([],[c,f,h,1],i)),n){case Ue.LNGLAT:return rd([c,f,h],e,o);case Ue.LNGLAT_OFFSETS:return rd([c+r[0],f+r[1],h+(r[2]||0)],e,o);case Ue.METER_OFFSETS:return rd(mS(r,[c,f,h]),e,o);case Ue.CARTESIAN:default:return e.isGeospatial?[c+r[0],f+r[1],h+r[2]]:e.projectPosition([c,f,h])}}function NP(t,e){const{viewport:i,coordinateSystem:n,coordinateOrigin:r,modelMatrix:o,fromCoordinateSystem:c,fromCoordinateOrigin:f}=PP(e),{autoOffset:h=!0}=e,{geospatialOrigin:g=vb,shaderCoordinateOrigin:_=vb,offsetMode:m=!1}=h?pS(i,n,r):{},y=AS(t,{viewport:i,modelMatrix:o,coordinateSystem:c,coordinateOrigin:f,offsetMode:m});if(m){const T=i.projectPosition(g||_);zC(y,y,T)}return y}let IP=1,DP=1;class ES{constructor(){v(this,"time",0);v(this,"channels",new Map);v(this,"animations",new Map);v(this,"playing",!1);v(this,"lastEngineTime",-1)}addChannel(e){const{delay:i=0,duration:n=Number.POSITIVE_INFINITY,rate:r=1,repeat:o=1}=e,c=IP++,f={time:0,delay:i,duration:n,rate:r,repeat:o};return this._setChannelTime(f,this.time),this.channels.set(c,f),c}removeChannel(e){this.channels.delete(e);for(const[i,n]of this.animations)n.channel===e&&this.detachAnimation(i)}isFinished(e){const i=this.channels.get(e);return i===void 0?!1:this.time>=i.delay+i.duration*i.repeat}getTime(e){if(e===void 0)return this.time;const i=this.channels.get(e);return i===void 0?-1:i.time}setTime(e){this.time=Math.max(0,e);const i=this.channels.values();for(const r of i)this._setChannelTime(r,this.time);const n=this.animations.values();for(const r of n){const{animation:o,channel:c}=r;o.setTime(this.getTime(c))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,i){const n=DP++;return this.animations.set(n,{animation:e,channel:i}),e.setTime(this.getTime(i)),n}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,i){const n=i-e.delay,r=e.duration*e.repeat;n>=r?e.time=e.duration*e.rate:(e.time=Math.max(0,n)%e.duration,e.time*=e.rate)}}function kP(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function BP(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}let UP=0;const FP={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:Nd.stats.get(`animation-loop-${UP++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class LP{constructor(e){v(this,"device",null);v(this,"canvas",null);v(this,"props");v(this,"animationProps",null);v(this,"timeline",null);v(this,"stats");v(this,"cpuTime");v(this,"gpuTime");v(this,"frameRate");v(this,"display");v(this,"needsRedraw","initialized");v(this,"_initialized",!1);v(this,"_running",!1);v(this,"_animationFrameId",null);v(this,"_nextFramePromise",null);v(this,"_resolveNextFrame",null);v(this,"_cpuStartTime",0);v(this,"_error",null);if(this.props={...FP,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:i=!0}=this.props;this.stats=e.stats||new cu({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:i}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){var n,r;if(this.props.onError(e),this._error=Error(),((r=(n=this.device)==null?void 0:n.canvasContext)==null?void 0:r.canvas)instanceof HTMLCanvasElement){const o=document.createElement("h1");o.innerHTML=e.message,o.style.position="absolute",o.style.top="20%",o.style.left="10px",o.style.color="black",o.style.backgroundColor="red",document.body.appendChild(o)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const i=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(i),i}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=kP(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(BP(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){var i;if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),(i=this.device)==null||i.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var i,n;const e=(n=(i=this.device)==null?void 0:i.canvasContext)==null?void 0:n.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:i,aspect:n}=this._getSizeAndAspect();(e!==this.animationProps.width||i!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=i,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const i=document.createElement("div");i.style.position="absolute",i.style.left="10px",i.style.bottom="10px",i.style.width="300px",i.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(i);const n=this.props.onAddHTML(i);n&&(i.innerHTML=n)}}_getSizeAndAspect(){var o,c,f,h;if(!this.device)return{width:1,height:1,aspect:1};const[e,i]=((c=(o=this.device)==null?void 0:o.canvasContext)==null?void 0:c.getPixelSize())||[1,1];let n=1;const r=(h=(f=this.device)==null?void 0:f.canvasContext)==null?void 0:h.canvas;return r&&r.clientHeight?n=r.clientWidth/r.clientHeight:e>0&&i>0&&(n=e/i),{width:e,height:i,aspect:n}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,i;this.props.autoResizeDrawingBuffer&&((i=(e=this.device)==null?void 0:e.canvasContext)==null||i.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const ad={};function du(t="id"){ad[t]=ad[t]||1;const e=ad[t]++;return`${t}-${e}`}class Tb{constructor(e){v(this,"id");v(this,"userData",{});v(this,"topology");v(this,"bufferLayout",[]);v(this,"vertexCount");v(this,"indices");v(this,"attributes");if(this.id=e.id||du("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&$e.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;(e=this.indices)==null||e.destroy();for(const i of Object.values(this.attributes))i.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function zP(t,e){if(e instanceof Tb)return e;const i=VP(t,e),{attributes:n,bufferLayout:r}=HP(t,e);return new Tb({topology:e.topology||"triangle-list",bufferLayout:r,vertexCount:e.vertexCount,indices:i,attributes:n})}function VP(t,e){if(!e.indices)return;const i=e.indices.value;return t.createBuffer({usage:$e.INDEX,data:i})}function HP(t,e){const i=[],n={};for(const[o,c]of Object.entries(e.attributes)){let f=o;switch(o){case"POSITION":f="positions";break;case"NORMAL":f="normals";break;case"TEXCOORD_0":f="texCoords";break;case"COLOR_0":f="colors";break}if(c){n[f]=t.createBuffer({data:c.value,id:`${o}-buffer`});const{value:h,size:g,normalized:_}=c;i.push({name:f,format:P2(h,g,_)})}}const r=e._calculateVertexCount(e.attributes,e.indices);return{attributes:n,bufferLayout:i,vertexCount:r}}const ru=class ru{constructor(e){v(this,"device");v(this,"destroyPolicy");v(this,"_hashCounter",0);v(this,"_hashes",{});v(this,"_renderPipelineCache",{});v(this,"_computePipelineCache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new ru(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const i={...Rr.defaultProps,...e},n=this._hashRenderPipeline(i);if(!this._renderPipelineCache[n]){const r=this.device.createRenderPipeline({...i,id:i.id?`${i.id}-cached`:void 0});r.hash=n,this._renderPipelineCache[n]={pipeline:r,useCount:0}}return this._renderPipelineCache[n].useCount++,this._renderPipelineCache[n].pipeline}createComputePipeline(e){const i={...Ec.defaultProps,...e},n=this._hashComputePipeline(i);if(!this._computePipelineCache[n]){const r=this.device.createComputePipeline({...i,id:i.id?`${i.id}-cached`:void 0});r.hash=n,this._computePipelineCache[n]={pipeline:r,useCount:0}}return this._computePipelineCache[n].useCount++,this._computePipelineCache[n].pipeline}release(e){const i=e.hash,n=e instanceof Ec?this._computePipelineCache:this._renderPipelineCache;n[i].useCount--,n[i].useCount===0&&this.destroyPolicy==="unused"&&(n[i].pipeline.destroy(),delete n[i])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const i=e.vs?this._getHash(e.vs.source):0,n=e.fs?this._getHash(e.fs.source):0,r="-",o=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${i}/${n}V${r}BL${o}`;default:const c=this._getHash(JSON.stringify(e.parameters));return`${i}/${n}V${r}T${e.topology}P${c}BL${o}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};v(ru,"defaultProps",{...Rr.defaultProps});let Jd=ru;const au=class au{constructor(e){v(this,"device");v(this,"destroyPolicy");v(this,"_cache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultShaderFactory(e){var i;return(i=e._lumaData).defaultShaderFactory||(i.defaultShaderFactory=new au(e)),e._lumaData.defaultShaderFactory}createShader(e){const i=this._hashShader(e);let n=this._cache[i];if(!n){const r=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[i]=n={shader:r,useCount:0}}return n.useCount++,n.shader}release(e){const i=this._hashShader(e),n=this._cache[i];n&&(n.useCount--,n.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[i],n.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};v(au,"defaultProps",{...Tc.defaultProps});let eg=au;function jP(t,e){var r;const i={},n="Values";if(t.attributes.length===0&&!((r=t.varyings)!=null&&r.length))return{"No attributes or varyings":{[n]:"N/A"}};for(const o of t.attributes)if(o){const c=`${o.location} ${o.name}: ${o.type}`;i[`in ${c}`]={[n]:o.stepMode||"vertex"}}for(const o of t.varyings||[]){const c=`${o.location} ${o.name}`;i[`out ${c}`]={[n]:JSON.stringify(o)}}return i}let gt=null,as=null;function WP(t,{id:e,minimap:i,opaque:n,top:r="0",left:o="0",rgbaScale:c=1}){gt||(gt=document.createElement("canvas"),gt.id=e,gt.title=e,gt.style.zIndex="100",gt.style.position="absolute",gt.style.top=r,gt.style.left=o,gt.style.border="blue 5px solid",gt.style.transform="scaleY(-1)",document.body.appendChild(gt),as=gt.getContext("2d")),(gt.width!==t.width||gt.height!==t.height)&&(gt.width=t.width/2,gt.height=t.height/2,gt.style.width="400px",gt.style.height="400px");const f=t.device.readPixelsToArrayWebGL(t),h=as==null?void 0:as.createImageData(t.width,t.height);if(h){for(let _=0;_<f.length;_+=4)h.data[0+_+0]=f[_+0]*c,h.data[0+_+1]=f[_+1]*c,h.data[0+_+2]=f[_+2]*c,h.data[0+_+3]=n?255:f[_+3]*c;as==null||as.putImageData(h,0,0)}}function tg(t,e,i){if(t===e)return!0;if(!i||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!tg(t[n],e[n],i-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(const o of n)if(!e.hasOwnProperty(o)||!tg(t[o],e[o],i-1))return!1;return!0}return!1}function XP(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function $P(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":!1}function wS(t){return XP(t)||$P(t)}function YP(t){return wS(t)||typeof t=="number"||typeof t=="boolean"}function RS(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(i=>{const n=t[i];YP(n)?e.uniforms[i]=n:e.bindings[i]=n}),e}class qP{constructor(e,i){v(this,"options",{disableWarnings:!1});v(this,"modules");v(this,"moduleUniforms");v(this,"moduleBindings");Object.assign(this.options,i);const n=Og(Object.values(e).filter(r=>r.dependencies));for(const r of n)e[r.name]=r;se.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[r,o]of Object.entries(e))this._addModule(o),o.name&&r!==o.name&&!this.options.disableWarnings&&se.warn(`Module name: ${r} vs ${o.name}`)()}destroy(){}setProps(e){var i;for(const n of Object.keys(e)){const r=n,o=e[r]||{},c=this.modules[r];if(!c){this.options.disableWarnings||se.warn(`Module ${n} not found`)();continue}const f=this.moduleUniforms[r],h=this.moduleBindings[r],g=((i=c.getUniforms)==null?void 0:i.call(c,o,f))||o,{uniforms:_,bindings:m}=RS(g);this.moduleUniforms[r]={...f,..._},this.moduleBindings[r]={...h,...m}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const i of Object.values(this.moduleBindings))Object.assign(e,i);return e}getDebugTable(){var i;const e={};for(const[n,r]of Object.entries(this.moduleUniforms))for(const[o,c]of Object.entries(r))e[`${n}.${o}`]={type:(i=this.modules[n].uniformTypes)==null?void 0:i[o],value:String(c)};return e}_addModule(e){const i=e.name;this.moduleUniforms[i]=e.defaultUniforms||{},this.moduleBindings[i]={}}}let KP="";async function ZP(t,e){const i=new Image;return i.crossOrigin="anonymous",i.src=t.startsWith("http")?t:KP+t,await i.decode(),e?await createImageBitmap(i,e):await createImageBitmap(i)}class od{constructor(e,i){v(this,"device");v(this,"id");v(this,"texture");v(this,"sampler");v(this,"view");v(this,"ready");v(this,"isReady",!1);v(this,"destroyed",!1);v(this,"resolveReady",()=>{});v(this,"rejectReady",()=>{});this.device=e,this.id=i.id||du("async-texture"),typeof(i==null?void 0:i.data)=="string"&&i.dimension==="2d"&&(i={...i,data:ZP(i.data)}),this.ready=new Promise((n,r)=>{this.resolveReady=()=>{this.isReady=!0,n()},this.rejectReady=r}),this.initAsync(i)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(e){let i,n;const r=e.data,o=await xS(r).then(i,n);if(this.destroyed)return;const c={...e,data:o};this.texture=this.device.createTexture(c),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const i=this.texture;this.texture=i.clone(e),i.destroy()}return!0}}async function xS(t){if(t=await t,Array.isArray(t))return await Promise.all(t.map(xS));if(t&&typeof t=="object"&&t.constructor===Object){const e=t,i=await Promise.all(Object.values(e)),n=Object.keys(e),r={};for(let o=0;o<n.length;o++)r[n[o]]=i[o];return r}return t}const os=2,QP=1e4,ou=class ou{constructor(e,i){v(this,"device");v(this,"id");v(this,"source");v(this,"vs");v(this,"fs");v(this,"pipelineFactory");v(this,"shaderFactory");v(this,"userData",{});v(this,"parameters");v(this,"topology");v(this,"bufferLayout");v(this,"isInstanced");v(this,"instanceCount",0);v(this,"vertexCount");v(this,"indexBuffer",null);v(this,"bufferAttributes",{});v(this,"constantAttributes",{});v(this,"bindings",{});v(this,"uniforms",{});v(this,"vertexArray");v(this,"transformFeedback",null);v(this,"pipeline");v(this,"shaderInputs");v(this,"_uniformStore");v(this,"_attributeInfos",{});v(this,"_gpuGeometry",null);v(this,"_getModuleUniforms");v(this,"props");v(this,"_pipelineNeedsUpdate","newly created");v(this,"_needsRedraw","initializing");v(this,"_destroyed",!1);v(this,"_lastDrawTimestamp",-1);v(this,"_lastLogTime",0);v(this,"_logOpen",!1);v(this,"_drawCount",0);var h,g,_,m;this.props={...ou.defaultProps,...i},i=this.props,this.id=i.id||du("model"),this.device=e,Object.assign(this.userData,i.userData);const n=Object.fromEntries(((h=this.props.modules)==null?void 0:h.map(y=>[y.name,y]))||[]),r=i.shaderInputs||new qP(n,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(r);const o=JP(e),c=(((g=this.props.modules)==null?void 0:g.length)>0?this.props.modules:(_=this.shaderInputs)==null?void 0:_.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){(m=this.props).shaderLayout||(m.shaderLayout=pC(this.props.source));const{source:y,getUniforms:T}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:o,...this.props,modules:c});this.source=y,this._getModuleUniforms=T}else{const{vs:y,fs:T,getUniforms:R}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:o,...this.props,modules:c});this.vs=y,this.fs=T,this._getModuleUniforms=R}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,i.geometry&&this.setGeometry(i.geometry),this.pipelineFactory=i.pipelineFactory||Jd.getDefaultPipelineFactory(this.device),this.shaderFactory=i.shaderFactory||eg.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in i&&(this.isInstanced=i.isInstanced),i.instanceCount&&this.setInstanceCount(i.instanceCount),i.vertexCount&&this.setVertexCount(i.vertexCount),i.indexBuffer&&this.setIndexBuffer(i.indexBuffer),i.attributes&&this.setAttributes(i.attributes),i.constantAttributes&&this.setConstantAttributes(i.constantAttributes),i.bindings&&this.setBindings(i.bindings),i.uniforms&&this.setUniformsWebGL(i.uniforms),i.moduleSettings&&this.updateModuleSettingsWebGL(i.moduleSettings),i.transformFeedback&&(this.transformFeedback=i.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const i=this._areBindingsLoading();if(i)return se.info(os,`>>> DRAWING ABORTED ${this.id}: ${i} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let n;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const r=this._getBindings();this.pipeline.setBindings(r,{disableWarnings:this.props.disableWarnings}),ig(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:o}=this.vertexArray,c=o?o.byteLength/(o.indexType==="uint32"?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:c,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){var n;(n=this._gpuGeometry)==null||n.destroy();const i=e&&zP(this.device,e);if(i){this.setTopology(i.topology||"triangle-list");const r=new qh(this.bufferLayout);this.bufferLayout=r.mergeBufferLayouts(i.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(i)}this._gpuGeometry=i}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const i=new qh(this.bufferLayout);this.bufferLayout=this._gpuGeometry?i.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){tg(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new O2(this.shaderInputs.modules);for(const[i,n]of Object.entries(this.shaderInputs.modules))if(GP(n)){const r=this._uniformStore.getManagedUniformBuffer(this.device,i);this.bindings[`${i}Uniforms`]=r}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,i){const n=(i==null?void 0:i.disableWarnings)??this.props.disableWarnings;e.indices&&se.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();const r=new qh(this.bufferLayout);for(const[o,c]of Object.entries(e)){const f=r.getBufferLayout(o);if(!f){n||se.warn(`Model(${this.id}): Missing layout for buffer "${o}".`)();continue}const h=r.getAttributeNamesForBuffer(f);let g=!1;for(const _ of h){const m=this._attributeInfos[_];m&&(this.vertexArray.setBuffer(m.location,c),g=!0)}!g&&!n&&se.warn(`Model(${this.id}): Ignoring buffer "${c.id}" for unknown attribute "${o}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,i){for(const[n,r]of Object.entries(e)){const o=this._attributeInfos[n];o?this.vertexArray.setConstantWebGL(o.location,r):((i==null?void 0:i.disableWarnings)??this.props.disableWarnings)||se.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){ig(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:i,uniforms:n}=RS(this._getModuleUniforms(e));Object.assign(this.bindings,i),Object.assign(this.uniforms,n),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof od&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[i,n]of Object.entries(this.bindings))n instanceof od?n.isReady&&(e[i]=n.texture):e[i]=n;return e}_getBindingsUpdateTimestamp(){let e=0;for(const i of Object.values(this.bindings))i instanceof vc?e=Math.max(e,i.texture.updateTimestamp):i instanceof $e||i instanceof et?e=Math.max(e,i.updateTimestamp):i instanceof od?e=i.texture?Math.max(e,i.texture.updateTimestamp):1/0:i instanceof Sc||(e=Math.max(e,i.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const i={...e.attributes};for(const[n]of Object.entries(i))!this.pipeline.shaderLayout.attributes.find(r=>r.name===n)&&n!=="positions"&&delete i[n];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(i,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,i=null;this.pipeline&&(se.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,i=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let r=null;this.source?r=n:this.fs&&(r=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:n,fs:r}),this._attributeInfos=FT(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),i&&this.shaderFactory.release(i)}return this.pipeline}_logDrawCallStart(){const e=se.level>3?0:QP;se.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,se.group(os,`>>> DRAWING MODEL ${this.id}`,{collapsed:se.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=jP(this.pipeline.shaderLayout,this.id);se.table(os,e)();const i=this.shaderInputs.getDebugTable();for(const[r,o]of Object.entries(this.uniforms))i[r]={value:o};se.table(os,i)();const n=this._getAttributeDebugTable();se.table(os,this._attributeInfos)(),se.table(os,n)(),se.groupEnd(os)(),this._logOpen=!1}}_logFramebuffer(e){const i=this.device.props.debugFramebuffers;if(this._drawCount++,!i)return;const n=e.props.framebuffer;n&&WP(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[i,n]of Object.entries(this._attributeInfos)){const r=this.vertexArray.attributes[n.location];e[n.location]={name:i,type:n.shaderType,values:r?this._getBufferOrConstantValues(r,n.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:i}=this.vertexArray,n=i.indexType==="uint32"?new Uint32Array(i.debugData):new Uint16Array(i.debugData);e.indices={name:"indices",type:i.indexType,values:n.toString()}}return e}_getBufferOrConstantValues(e,i){const n=VT(i);return(e instanceof $e?new n(e.debugData):e).toString()}};v(ou,"defaultProps",{...Rr.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:bc.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let gi=ou;function GP(t){return!!(t.uniformTypes&&!ig(t.uniformTypes))}function JP(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function ig(t){for(const e in t)return!1;return!0}const Ja=class Ja{constructor(e,i=Ja.defaultProps){v(this,"device");v(this,"model");v(this,"transformFeedback");if(!Ja.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new gi(this.device,{id:i.id||"buffer-transform-model",fs:i.fs||Ix(),topology:i.topology||"point-list",varyings:i.outputs||i.varyings,...i}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:i.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var i;return((i=e==null?void 0:e.info)==null?void 0:i.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e!=null&&e.inputBuffers&&this.model.setAttributes(e.inputBuffers),e!=null&&e.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const i=this.device.beginRenderPass(e);this.model.draw(i),i.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const i=this.getBuffer(e);if(!i)throw new Error("BufferTransform#getBuffer");if(i instanceof $e)return i.readAsync();const{buffer:n,byteOffset:r=0,byteLength:o=n.byteLength}=i;return n.readAsync(r,o)}};v(Ja,"defaultProps",{...gi.defaultProps,outputs:void 0,feedbackBuffers:void 0});let no=Ja;class Dr{constructor(e){v(this,"id");v(this,"topology");v(this,"vertexCount");v(this,"indices");v(this,"attributes");v(this,"userData",{});const{attributes:i={},indices:n=null,vertexCount:r=null}=e;this.id=e.id||du("geometry"),this.topology=e.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[o,c]of Object.entries(i)){const f=ArrayBuffer.isView(c)?{value:c}:c;if(!ArrayBuffer.isView(f.value))throw new Error(`${this._print(o)}: must be typed array or object with value as typed array`);if((o==="POSITION"||o==="positions")&&!f.size&&(f.size=3),o==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=f}else this.attributes[o]=f}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=r||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,i){return this}_calculateVertexCount(e,i){if(i)return i.value.length;let n=1/0;for(const r of Object.values(e)){const{value:o,size:c,constant:f}=r;!f&&o&&c!==void 0&&c>=1&&(n=Math.min(n,o.length/c))}return n}}const eN={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class CS extends Bg{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:i,views:n,viewports:r,onViewportActive:o,pickingFBO:c,deviceRect:{x:f,y:h,width:g,height:_},cullRect:m,effects:y,pass:T="picking",pickZ:R,shaderModuleProps:x}){this.pickZ=R;const O=this._resetColorEncoder(R),N=[f,h,g,_],B=super.render({target:c,layers:e,layerFilter:i,views:n,viewports:r,onViewportActive:o,cullRect:m,effects:y==null?void 0:y.filter(j=>j.useInPicking),pass:T,isPicking:!0,shaderModuleProps:x,clearColor:[0,0,0,0],colorMask:15,scissorRect:N});return this._colorEncoderState=null,{decodePickingColor:O&&iN.bind(null,O),stats:B}}shouldDrawLayer(e){const{pickable:i,operation:n}=e.props;return i&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getShaderModuleProps(e,i,n){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,i,n){const r={...e.props.parameters},{pickable:o,operation:c}=e.props;return!this._colorEncoderState||c.includes("terrain")?r.blend=!1:o&&c.includes("draw")&&(Object.assign(r,eN),r.blend=!0,r.blendColor=tN(this._colorEncoderState,e,n)),r}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function tN(t,e,i){const{byLayer:n,byAlpha:r}=t;let o,c=n.get(e);return c?(c.viewports.push(i),o=c.a):(o=n.size+1,o<=255?(c={a:o,layer:e,viewports:[i]},n.set(e,c),r[o]=c):(Oe.warn("Too many pickable layers, only picking the first 255")(),o=0)),[0,0,0,o/255]}function iN(t,e){const i=t.byAlpha[e[3]];return i&&{pickedLayer:i.layer,pickedViewports:i.viewports,pickedObjectIndex:i.layer.decodePickingColor(e)}}const dr={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Dc=Symbol.for("component"),kn=Symbol.for("propTypes"),ld=Symbol.for("deprecatedProps"),Sr=Symbol.for("asyncPropDefaults"),vs=Symbol.for("asyncPropOriginal"),Pn=Symbol.for("asyncPropResolved");function Ug(t,e=()=>!0){return Array.isArray(t)?MS(t,e,[]):e(t)?[t]:[]}function MS(t,e,i){let n=-1;for(;++n<t.length;){const r=t[n];Array.isArray(r)?MS(r,e,i):e(r)&&i.push(r)}return i}function nN({target:t,source:e,start:i=0,count:n=1}){const r=e.length,o=n*r;let c=0;for(let f=i;c<r;c++)t[f++]=e[c];for(;c<o;)c<o-c?(t.copyWithin(i+c,i,i+c),c*=2):(t.copyWithin(i+c,i,i+o-c),c=o);return t}class sN{constructor(e,i,n){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=n,this.setData(i)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,i){if(e===this._data&&!i)return;this._data=e;const n=++this._loadCount;let r=e;typeof e=="string"&&(r=_c(e)),r instanceof Promise?(this.isLoaded=!1,this._loader=r.then(o=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=o)}).catch(o=>{this._loadCount===n&&(this.isLoaded=!0,this._error=o||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const o of this._subscribers)o.onChange(this.getData())}}class rN{constructor(e){var i;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(i=e.device)==null?void 0:i.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:i,forceUpdate:n=!1,persistent:r=!0}){let o=this._resources[e];o?o.setData(i,n):(o=new sN(e,i,this._context),this._resources[e]=o),o.persistent=r}remove(e){const i=this._resources[e];i&&(i.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const i=this._consumers[e];if(i){for(const n in i){const r=i[n],o=this._resources[r.resourceId];o&&o.unsubscribe(r)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:i,consumerId:n,requestId:r="default"}){const{_resources:o,protocol:c}=this;e.startsWith(c)&&(e=e.replace(c,""),o[e]||this.add({resourceId:e,data:null,persistent:!1}));const f=o[e];if(this._track(n,r,f,i),f)return f.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,i,n,r){const o=this._consumers,c=o[e]=o[e]||{};let f=c[i];const h=f&&f.resourceId&&this._resources[f.resourceId];h&&(h.unsubscribe(f),this.prune()),n&&(f?(f.onChange=r,f.resourceId=n.id):f={onChange:r,resourceId:n.id},c[i]=f,n.subscribe(f))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const i=this._resources[e];!i.persistent&&!i.inUse()&&(i.delete(),delete this._resources[e])}}}const aN="layerManager.setLayers",oN="layerManager.activateViewport";class lN{constructor(e,i){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=f=>{Rt(oN,this,f),f&&(this.context.viewport=f)};const{deck:n,stats:r,viewport:o,timeline:c}=i||{};this.layers=[],this.resourceManager=new rN({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:n,shaderAssembler:lP(),defaultShaderModules:[RM],renderPass:void 0,stats:r||new cu({id:"deck.gl"}),viewport:o||new mo({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:c||new ES,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let i=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const r=n.getNeedsRedraw(e);i=i||r}return i}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(i=>e.find(n=>i.id.indexOf(n)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,i){Rt(aN,this,i,e),this._lastRenderedLayers=e;const n=Ug(e,Boolean);for(const r of n)r.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:i}=this.context;i.find(n=>n.name===e.name)||(i.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:i}=this.context,n=i.findIndex(r=>r.name===e.name);n>=0&&(i.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(e,i,n){n.raiseError(i,`${e} of ${n}`)}_updateLayers(e,i){const n={};for(const c of e)n[c.id]?Oe.warn(`Multiple old layers with same id ${c.id}`)():n[c.id]=c;if(this._defaultShaderModulesChanged){for(const c of e)c.setNeedsUpdate(),c.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const r=[];this._updateSublayersRecursively(i,n,r),this._finalizeOldLayers(n);let o=!1;for(const c of r)if(c.hasUniformTransition()){o=`Uniform transition in ${c}`;break}this._needsUpdate=o,this.layers=r}_updateSublayersRecursively(e,i,n){for(const r of e){r.context=this.context;const o=i[r.id];o===null&&Oe.warn(`Multiple new layers with same id ${r.id}`)(),i[r.id]=null;let c=null;try{this._debug&&o!==r&&r.validateProps(),o?(this._transferLayerState(o,r),this._updateLayer(r)):this._initializeLayer(r),n.push(r),c=r.isComposite?r.getSubLayers():null}catch(f){this._handleError("matching",f,r)}c&&this._updateSublayersRecursively(c,i,n)}}_finalizeOldLayers(e){for(const i in e){const n=e[i];n&&this._finalizeLayer(n)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=dr.INITIALIZED}catch(i){this._handleError("initialization",i,e)}}_transferLayerState(e,i){i._transferState(e),i.lifecycle=dr.MATCHED,i!==e&&(e.lifecycle=dr.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(i){this._handleError("update",i,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=dr.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=dr.FINALIZED}catch(i){this._handleError("finalization",i,e)}}}function hi(t,e,i){if(t===e)return!0;if(!i||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!hi(t[n],e[n],i-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(const o of n)if(!e.hasOwnProperty(o)||!hi(t[o],e[o],i-1))return!1;return!0}return!1}class cN{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const i=this.controllers[e];i&&i.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const i=this.controllers[e];i&&i.updateTransition()}}getViewports(e){return e?this._viewports.filter(i=>i.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(i=>{e[i.id]=i}),e}getView(e){return this.views.find(i=>i.id===e)}getViewState(e){const i=typeof e=="string"?this.getView(e):e,n=i&&this.viewState[i.getViewStateId()]||this.viewState;return i?i.filterViewState(n):n}getViewport(e){return this._viewportMap[e]}unproject(e,i){const n=this.getViewports(),r={x:e[0],y:e[1]};for(let o=n.length-1;o>=0;--o){const c=n[o];if(c.containsPixel(r)){const f=e.slice();return f[0]-=c.x,f[1]-=c.y,c.unproject(f,i)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,i){(e!==this.width||i!==this.height)&&(this.width=e,this.height=i,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Ug(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!hi(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Oe.warn("missing `viewState` or `initialViewState`")()}_createController(e,i){const n=i.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:o=>{var c;return(c=this.getView(e.id))==null?void 0:c.makeViewport({viewState:o,width:this.width,height:this.height})}})}_updateController(e,i,n,r){const o=e.controller;if(o&&n){const c={...i,...o,id:e.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!r||r.constructor!==o.type)&&(r=this._createController(e,c)),r&&r.setProps(c),r}return null}_rebuildViewports(){const{views:e}=this,i=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let r=e.length;r--;){const o=e[r],c=this.getViewState(o),f=o.makeViewport({viewState:c,width:this.width,height:this.height});let h=i[o.id];const g=!!o.controller;g&&!h&&(n=!0),(n||!g)&&h&&(h.finalize(),h=null),this.controllers[o.id]=this._updateController(o,c,f,h),f&&this._viewports.unshift(f)}for(const r in i){const o=i[r];o&&!this.controllers[r]&&o.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,i){return e.length!==i.length?!0:e.some((n,r)=>!e[r].equals(i[r]))}}const uN=/([0-9]+\.?[0-9]*)(%|px)/;function An(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=uN.exec(t);if(e&&e.length>=3){const i=e[2]==="%",n=parseFloat(e[1]);return{position:i?n/100:n,relative:i}}default:throw new Error(`Could not parse position string ${t}`)}}function En(t,e){return t.relative?Math.round(t.position*e):t.position}class kr{constructor(e){const{id:i,x:n=0,y:r=0,width:o="100%",height:c="100%",padding:f=null}=e;this.id=i||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=An(n),this._y=An(r),this._width=An(o),this._height=An(c),this._padding=f&&{left:An(f.left||0),right:An(f.right||0),top:An(f.top||0),bottom:An(f.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&hi(this.props,e.props,2)}makeViewport({width:e,height:i,viewState:n}){n=this.filterViewState(n);const r=this.getDimensions({width:e,height:i});if(!r.height||!r.width)return null;const o=this.getViewportType(n);return new o({...n,...this.props,...r})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const i={...e};for(const n in this.props.viewState)n!=="id"&&(i[n]=this.props.viewState[n]);return i}return e}getDimensions({width:e,height:i}){const n={x:En(this._x,e),y:En(this._y,i),width:En(this._width,e),height:En(this._height,i)};return this._padding&&(n.padding={left:En(this._padding.left,e),top:En(this._padding.top,i),right:En(this._padding.right,e),bottom:En(this._padding.bottom,i)}),n}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class gu{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var i,n;this.cancel(),this.settings=e,this._inProgress=!0,(n=(i=this.settings).onStart)==null||n.call(i,this)}end(){var e,i;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(i=(e=this.settings).onEnd)==null||i.call(e,this))}cancel(){var e,i;this._inProgress&&((i=(e=this.settings).onInterrupt)==null||i.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,i;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:n,settings:r}=this;this._handle=n.addChannel({delay:n.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(i=(e=this.settings).onUpdate)==null||i.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const Sb=()=>{},ng={BREAK:1,SNAP_TO_END:2,IGNORE:3},fN=t=>t,hN=ng.BREAK;class dN{constructor(e){this._onTransitionUpdate=i=>{const{time:n,settings:{interpolator:r,startProps:o,endProps:c,duration:f,easing:h}}=i,g=h(n/f),_=r.interpolateProps(o,c,g);this.propsInTransition=this.getControllerState({...this.props,..._}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new gu(e.timeline),this.onViewStateChange=e.onViewStateChange||Sb,this.onStateChange=e.onStateChange||Sb}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let i=!1;const n=this.props;if(this.props=e,!n||this._shouldIgnoreViewportChange(n,e))return!1;if(this._isTransitionEnabled(e)){let r=n;if(this.transition.inProgress){const{interruption:o,endProps:c}=this.transition.settings;r={...n,...o===ng.SNAP_TO_END?c:this.propsInTransition||n}}this._triggerTransition(r,e),i=!0}else this.transition.cancel();return i}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:i,transitionInterpolator:n}=e;return(i>0||i==="auto")&&!!n}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,i){return this.transition.inProgress?this.transition.settings.interruption===ng.IGNORE||this._isUpdateDueToCurrentTransition(i):this._isTransitionEnabled(i)?i.transitionInterpolator.arePropsEqual(e,i):!0}_triggerTransition(e,i){const n=this.getControllerState(e),r=this.getControllerState(i).shortestPathFrom(n),o=i.transitionInterpolator,c=o.getDuration?o.getDuration(e,i):i.transitionDuration;if(c===0)return;const f=o.initializeProps(e,r);this.propsInTransition={};const h={duration:c,easing:i.transitionEasing||fN,interpolator:o,interruption:i.transitionInterruption||hN,startProps:f.start,endProps:f.end,onStart:i.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(i.onTransitionInterrupt),onEnd:this._onTransitionEnd(i.onTransitionEnd)};this.transition.start(h),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return i=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(i)}}}function vt(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class gN{constructor(e){const{compare:i,extract:n,required:r}=e;this._propsToCompare=i,this._propsToExtract=n||i,this._requiredProps=r}arePropsEqual(e,i){for(const n of this._propsToCompare)if(!(n in e)||!(n in i)||!to(e[n],i[n]))return!1;return!0}initializeProps(e,i){const n={},r={};for(const o of this._propsToExtract)(o in e||o in i)&&(n[o]=e[o],r[o]=i[o]);return this._checkRequiredProps(n),this._checkRequiredProps(r),{start:n,end:r}}getDuration(e,i){return i.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(i=>{const n=e[i];vt(Number.isFinite(n)||Array.isArray(n),`${i} is required for transition`)})}}const pN=["longitude","latitude","zoom","bearing","pitch"],_N=["longitude","latitude","zoom"];class OS extends gN{constructor(e={}){const i=Array.isArray(e)?e:e.transitionProps,n=Array.isArray(e)?{}:e;n.transitionProps=Array.isArray(i)?{compare:i,required:i}:i||{compare:pN,required:_N},super(n.transitionProps),this.opts=n}initializeProps(e,i){const n=super.initializeProps(e,i),{makeViewport:r,around:o}=this.opts;if(r&&o){const c=r(e),f=r(i),h=c.unproject(o);n.start.around=o,Object.assign(n.end,{around:f.project(h),aroundPosition:h,width:i.width,height:i.height})}return n}interpolateProps(e,i,n){const r={};for(const o of this._propsToExtract)r[o]=Cc(e[o]||0,i[o]||0,n);if(i.aroundPosition&&this.opts.makeViewport){const o=this.opts.makeViewport({...i,...r});Object.assign(r,o.panByPosition(i.aroundPosition,Cc(e.around,i.around,n)))}return r}}const wn={transitionDuration:0},mN=300,Wl=t=>1-(1-t)*(1-t),hr={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},ls={};class yN{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new dN({...e,getControllerState:i=>new this.ControllerState(i),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const i in this._events)this._events[i]&&((e=this.eventManager)==null||e.off(i,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const i=this._eventStartBlocked;switch(e.type){case"panstart":return i?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return i?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return i?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:i,y:n}=this.props,{offsetCenter:r}=e;return[r.x-i,r.y-n]}isPointInBounds(e,i){const{width:n,height:r}=this.props;if(i&&i.handled)return!1;const o=e[0]>=0&&e[0]<=n&&e[1]>=0&&e[1]<=r;return o&&i&&i.stopPropagation(),o}isFunctionKeyPressed(e){const{srcEvent:i}=e;return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const i=setTimeout(()=>{this._eventStartBlocked===i&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=i}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:i}=e;this.inertia=Number.isFinite(i)?i:i===!0?mN:0;const{scrollZoom:n=!0,dragPan:r=!0,dragRotate:o=!0,doubleClickZoom:c=!0,touchZoom:f=!0,touchRotate:h=!1,keyboard:g=!0}=e,_=!!this.onViewStateChange;this.toggleEvents(hr.WHEEL,_&&n),this.toggleEvents(hr.PAN,_),this.toggleEvents(hr.PINCH,_&&(f||h)),this.toggleEvents(hr.MULTI_PAN,_&&h),this.toggleEvents(hr.DOUBLE_CLICK,_&&c),this.toggleEvents(hr.KEYBOARD,_&&g),this.scrollZoom=n,this.dragPan=r,this.dragRotate=o,this.doubleClickZoom=c,this.touchZoom=f,this.touchRotate=h,this.keyboard=g}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,i){this.eventManager&&e.forEach(n=>{this._events[n]!==i&&(this._events[n]=i,i?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(e,i=null,n={}){const r={...e.getViewportProps(),...i},o=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(n),o){const c=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:r,interactionState:this._interactionState,oldViewState:c,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;let n=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);const r=this.controllerState[n?"panStart":"rotateStart"]({pos:i});return this._panMove=n,this.updateViewport(r,wn,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const i=this.getCenter(e),n=this.controllerState.pan({pos:i});return this.updateViewport(n,wn,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:i}=this;if(this.dragPan&&i&&e.velocity){const n=this.getCenter(e),r=[n[0]+e.velocityX*i/2,n[1]+e.velocityY*i/2],o=this.controllerState.pan({pos:r}).panEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:Wl},{isDragging:!1,isPanning:!0})}else{const n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const i=this.getCenter(e),n=this.controllerState.rotate({pos:i});return this.updateViewport(n,wn,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:i}=this;if(this.dragRotate&&i&&e.velocity){const n=this.getCenter(e),r=[n[0]+e.velocityX*i/2,n[1]+e.velocityY*i/2],o=this.controllerState.rotate({pos:r}).rotateEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:Wl},{isDragging:!1,isRotating:!0})}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;e.srcEvent.preventDefault();const{speed:n=.01,smooth:r=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:o}=e;let c=2/(1+Math.exp(-Math.abs(o*n)));o<0&&c!==0&&(c=1/c);const f=this.controllerState.zoom({pos:i,scale:c});return this.updateViewport(f,{...this._getTransitionProps({around:i}),transitionDuration:r?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const n=this.controllerState.rotateStart({pos:i});return this.updateViewport(n,wn,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const i=this.getCenter(e);i[0]-=e.deltaX;const n=this.controllerState.rotate({pos:i});return this.updateViewport(n,wn,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:i}=this;if(this.touchRotate&&i&&e.velocityY){const n=this.getCenter(e),r=[n[0],n[1]+=e.velocityY*i/2],o=this.controllerState.rotate({pos:r});this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:Wl},{isDragging:!1,isRotating:!0}),this.blockEvents(i)}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const n=this.controllerState.zoomStart({pos:i}).rotateStart({pos:i});return ls._startPinchRotation=e.rotation,ls._lastPinchEvent=e,this.updateViewport(n,wn,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let i=this.controllerState;if(this.touchZoom){const{scale:n}=e,r=this.getCenter(e);i=i.zoom({pos:r,scale:n})}if(this.touchRotate){const{rotation:n}=e;i=i.rotate({deltaAngleX:ls._startPinchRotation-n})}return this.updateViewport(i,wn,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),ls._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:i}=this,{_lastPinchEvent:n}=ls;if(this.touchZoom&&i&&n&&e.scale!==n.scale){const r=this.getCenter(e);let o=this.controllerState.rotateEnd();const c=Math.log2(e.scale),f=(c-Math.log2(n.scale))/(e.deltaTime-n.deltaTime),h=Math.pow(2,c+f*i/2);o=o.zoom({pos:r,scale:h}).zoomEnd(),this.updateViewport(o,{...this._getTransitionProps({around:r}),transitionDuration:i,transitionEasing:Wl},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(i)}else{const r=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return ls._startPinchRotation=null,ls._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const n=this.isFunctionKeyPressed(e),r=this.controllerState.zoom({pos:i,scale:n?.5:2});return this.updateViewport(r,this._getTransitionProps({around:i}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const i=this.isFunctionKeyPressed(e),{zoomSpeed:n,moveSpeed:r,rotateSpeedX:o,rotateSpeedY:c}=this.keyboard===!0?{}:this.keyboard,{controllerState:f}=this;let h;const g={};switch(e.srcEvent.code){case"Minus":h=i?f.zoomOut(n).zoomOut(n):f.zoomOut(n),g.isZooming=!0;break;case"Equal":h=i?f.zoomIn(n).zoomIn(n):f.zoomIn(n),g.isZooming=!0;break;case"ArrowLeft":i?(h=f.rotateLeft(o),g.isRotating=!0):(h=f.moveLeft(r),g.isPanning=!0);break;case"ArrowRight":i?(h=f.rotateRight(o),g.isRotating=!0):(h=f.moveRight(r),g.isPanning=!0);break;case"ArrowUp":i?(h=f.rotateUp(c),g.isRotating=!0):(h=f.moveUp(r),g.isPanning=!0);break;case"ArrowDown":i?(h=f.rotateDown(c),g.isRotating=!0):(h=f.moveDown(r),g.isPanning=!0);break;default:return!1}return this.updateViewport(h,this._getTransitionProps(),g),!0}_getTransitionProps(e){const{transition:i}=this;return!i||!i.transitionInterpolator?wn:e?{...i,transitionInterpolator:new OS({...e,...i.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:i}}class bN{constructor(e,i){this._viewportProps=this.applyConstraints(e),this._state=i}getViewportProps(){return this._viewportProps}getState(){return this._state}}const Ab=5,vN=1.2;class TN extends bN{constructor(e){const{width:i,height:n,latitude:r,longitude:o,zoom:c,bearing:f=0,pitch:h=0,altitude:g=1.5,position:_=[0,0,0],maxZoom:m=20,minZoom:y=0,maxPitch:T=60,minPitch:R=0,startPanLngLat:x,startZoomLngLat:O,startRotatePos:N,startBearing:B,startPitch:P,startZoom:j,normalize:z=!0}=e;vt(Number.isFinite(o)),vt(Number.isFinite(r)),vt(Number.isFinite(c)),super({width:i,height:n,latitude:r,longitude:o,zoom:c,bearing:f,pitch:h,altitude:g,maxZoom:m,minZoom:y,maxPitch:T,minPitch:R,normalize:z,position:_},{startPanLngLat:x,startZoomLngLat:O,startRotatePos:N,startBearing:B,startPitch:P,startZoom:j}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:i}){const n=this.getState().startPanLngLat||this._unproject(i);if(!n)return this;const o=this.makeViewport(this.getViewportProps()).panByPosition(n,e);return this._getUpdatedState(o)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:i=0,deltaAngleY:n=0}){const{startRotatePos:r,startBearing:o,startPitch:c}=this.getState();if(!r||o===void 0||c===void 0)return this;let f;return e?f=this._getNewRotation(e,r,c,o):f={bearing:o+i,pitch:c+n},this._getUpdatedState(f)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:i,scale:n}){let{startZoom:r,startZoomLngLat:o}=this.getState();if(o||(r=this.getViewportProps().zoom,o=this._unproject(i)||this._unproject(e)),!o)return this;const{maxZoom:c,minZoom:f}=this.getViewportProps();let h=r+Math.log2(n);h=On(h,f,c);const g=this.makeViewport({...this.getViewportProps(),zoom:h});return this._getUpdatedState({zoom:h,...g.panByPosition(o,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const i=e.getViewportProps(),n={...this.getViewportProps()},{bearing:r,longitude:o}=n;return Math.abs(r-i.bearing)>180&&(n.bearing=r<0?r+360:r-360),Math.abs(o-i.longitude)>180&&(n.longitude=o<0?o+360:o-360),n}applyConstraints(e){const{maxZoom:i,minZoom:n,zoom:r}=e;e.zoom=On(r,n,i);const{maxPitch:o,minPitch:c,pitch:f}=e;e.pitch=On(f,c,o);const{normalize:h=!0}=e;return h&&Object.assign(e,YO(e)),e}_zoomFromCenter(e){const{width:i,height:n}=this.getViewportProps();return this.zoom({pos:[i/2,n/2],scale:e})}_panFromCenter(e){const{width:i,height:n}=this.getViewportProps();return this.pan({startPos:[i/2,n/2],pos:[i/2+e[0],n/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const i=this.makeViewport(this.getViewportProps());return e&&i.unproject(e)}_getNewRotation(e,i,n,r){const o=e[0]-i[0],c=e[1]-i[1],f=e[1],h=i[1],{width:g,height:_}=this.getViewportProps(),m=o/g;let y=0;c>0?Math.abs(_-h)>Ab&&(y=c/(h-_)*vN):c<0&&h>Ab&&(y=1-f/h),y=On(y,-1,1);const{minPitch:T,maxPitch:R}=this.getViewportProps(),x=r+180*m;let O=n;return y>0?O=n+y*(R-n):y<0&&(O=n-y*(T-n)),{pitch:O,bearing:x}}}class SN extends yN{constructor(){super(...arguments),this.ControllerState=TN,this.transition={transitionDuration:300,transitionInterpolator:new OS({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const i=this.props;super.setProps(e),(!i||i.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class PS extends kr{constructor(e={}){super(e)}getViewportType(){return Ir}get ControllerType(){return SN}}PS.displayName="MapView";const AN=new SS;function EN(t,e){const i=t.order??1/0,n=e.order??1/0;return i-n}class wN{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const i=this._defaultEffects;if(!i.find(n=>n.id===e.id)){const n=i.findIndex(r=>EN(r,e)>0);n<0?i.push(e):i.splice(n,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(hi(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}getEffects(){return this._resolvedEffects}_setEffects(e){const i={};for(const r of this.effects)i[r.id]=r;const n=[];for(const r of e){const o=i[r.id];let c=r;o&&o!==r?o.setProps?(o.setProps(r.props),c=o):o.cleanup(this._context):o||r.setup(this._context),n.push(c),delete i[r.id]}for(const r in i)i[r].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),e.some(r=>r instanceof SS)||this._resolvedEffects.push(AN),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class RN extends Bg{shouldDrawLayer(e){const{operation:i}=e.props;return i.includes("draw")||i.includes("terrain")}}const xN="deckRenderer.renderLayers";class CN{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new RN(e),this.pickLayersPass=new CS(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const i=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};n.effects&&this._preRender(n.effects,n);const r=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);const o=i.render({...n,target:r});n.effects&&this._postRender(n.effects,n),this.renderCount++,Rt(xN,this,o,e)}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}finalize(){const{renderBuffers:e}=this;for(const i of e)i.delete();e.length=0}_preRender(e,i){this.lastPostProcessEffect=null,i.preRenderStats=i.preRenderStats||{};for(const n of e)i.preRenderStats[n.id]=n.preRender(i),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,i=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(n=>{const r=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${n}`,colorAttachments:[r]}))});for(const n of e)n.resize(i)}_postRender(e,i){const{renderBuffers:n}=this,r={...i,inputBuffer:n[0],swapBuffer:n[1]};for(const o of e)if(o.postRender){r.target=o.id===this.lastPostProcessEffect?i.target:void 0;const c=o.postRender(r);r.inputBuffer=c,r.swapBuffer=c===n[0]?n[1]:n[0]}}}const MN={pickedColor:null,pickedObjectIndex:-1};function ON({pickedColors:t,decodePickingColor:e,deviceX:i,deviceY:n,deviceRadius:r,deviceRect:o}){const{x:c,y:f,width:h,height:g}=o;let _=r*r,m=-1,y=0;for(let T=0;T<g;T++){const R=T+f-n,x=R*R;if(x>_)y+=4*h;else for(let O=0;O<h;O++){if(t[y+3]-1>=0){const B=O+c-i,P=B*B+x;P<=_&&(_=P,m=y)}y+=4}}if(m>=0){const T=t.slice(m,m+4),R=e(T);if(R){const x=Math.floor(m/4/h),O=m/4-x*h;return{...R,pickedColor:T,pickedX:c+O,pickedY:f+x}}Oe.error("Picked non-existent layer. Is picking buffer corrupt?")()}return MN}function PN({pickedColors:t,decodePickingColor:e}){const i=new Map;if(t){for(let n=0;n<t.length;n+=4)if(t[n+3]-1>=0){const o=t.slice(n,n+4),c=o.join(",");if(!i.has(c)){const f=e(o);f?i.set(c,{...f,color:o}):Oe.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(i.values())}function NS({pickInfo:t,viewports:e,pixelRatio:i,x:n,y:r,z:o}){let c=e[0];e.length>1&&(c=IN((t==null?void 0:t.pickedViewports)||e,{x:n,y:r}));let f;if(c){const h=[n-c.x,r-c.y];o!==void 0&&(h[2]=o),f=c.unproject(h)}return{color:null,layer:null,viewport:c,index:-1,picked:!1,x:n,y:r,pixel:[n,r],coordinate:f,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:i}}function NN(t){const{pickInfo:e,lastPickedInfo:i,mode:n,layers:r}=t,{pickedColor:o,pickedLayer:c,pickedObjectIndex:f}=e,h=c?[c]:[];if(n==="hover"){const m=i.index,y=i.layerId,T=c?c.props.id:null;if(T!==y||f!==m){if(T!==y){const R=r.find(x=>x.props.id===y);R&&h.unshift(R)}i.layerId=T,i.index=f,i.info=null}}const g=NS(t),_=new Map;return _.set(null,g),h.forEach(m=>{let y={...g};m===c&&(y.color=o,y.index=f,y.picked=!0),y=IS({layer:m,info:y,mode:n});const T=y.layer;m===c&&n==="hover"&&(i.info=y),_.set(T.id,y),n==="hover"&&T.updateAutoHighlight(y)}),_}function IS({layer:t,info:e,mode:i}){for(;t&&e;){const n=e.layer||null;e.sourceLayer=n,e.layer=t,e=t.getPickingInfo({info:e,mode:i,sourceLayer:n}),t=t.parent}return e}function IN(t,e){for(let i=t.length-1;i>=0;i--){const n=t[i];if(n.containsPixel(e))return n}return t[0]}class DN{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new CS(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:i,layers:n,viewports:r},o=this.lastPickedInfo.info){const c=o&&o.layer&&o.layer.id,f=o&&o.viewport&&o.viewport.id,h=c?n.find(y=>y.id===c):null,g=f&&r.find(y=>y.id===f)||r[0],_=g&&g.unproject([e-g.x,i-g.y]);return{...o,...{x:e,y:i,viewport:g,coordinate:_,layer:h}}}_resizeBuffer(){var i,n;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const r=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=r}const{canvas:e}=this.device.getDefaultCanvasContext();(i=this.pickingFBO)==null||i.resize({width:e.width,height:e.height}),(n=this.depthFBO)==null||n.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const i=e.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return i.length?i:null}_pickClosestObject({layers:e,views:i,viewports:n,x:r,y:o,radius:c=0,depth:f=1,mode:h="query",unproject3D:g,onViewportActive:_,effects:m}){const y=this.device.canvasContext.cssToDeviceRatio(),T=this._getPickable(e);if(!T||n.length===0)return{result:[],emptyInfo:NS({viewports:n,x:r,y:o,pixelRatio:y})};this._resizeBuffer();const R=this.device.canvasContext.cssToDevicePixels([r,o],!0),x=[R.x+Math.floor(R.width/2),R.y+Math.floor(R.height/2)],O=Math.round(c*y),{width:N,height:B}=this.pickingFBO,P=this._getPickingRect({deviceX:x[0],deviceY:x[1],deviceRadius:O,deviceWidth:N,deviceHeight:B}),j={x:r-c,y:o-c,width:c*2+1,height:c*2+1};let z;const q=[],ue=new Set;for(let oe=0;oe<f;oe++){let G;if(P){const te=this._drawAndSample({layers:T,views:i,viewports:n,onViewportActive:_,deviceRect:P,cullRect:j,effects:m,pass:`picking:${h}`});G=ON({...te,deviceX:x[0],deviceY:x[1],deviceRadius:O,deviceRect:P})}else G={pickedColor:null,pickedObjectIndex:-1};let ae;if(G.pickedLayer&&g&&this.depthFBO){const{pickedColors:te}=this._drawAndSample({layers:[G.pickedLayer],views:i,viewports:n,onViewportActive:_,deviceRect:{x:G.pickedX,y:G.pickedY,width:1,height:1},cullRect:j,effects:m,pass:`picking:${h}:z`},!0);te[3]&&(ae=te[0])}G.pickedLayer&&oe+1<f&&(ue.add(G.pickedLayer),G.pickedLayer.disablePickingIndex(G.pickedObjectIndex)),z=NN({pickInfo:G,lastPickedInfo:this.lastPickedInfo,mode:h,layers:T,viewports:n,x:r,y:o,z:ae,pixelRatio:y});for(const te of z.values())te.layer&&q.push(te);if(!G.pickedColor)break}for(const oe of ue)oe.restorePickingColors();return{result:q,emptyInfo:z.get(null)}}_pickVisibleObjects({layers:e,views:i,viewports:n,x:r,y:o,width:c=1,height:f=1,mode:h="query",maxObjects:g=null,onViewportActive:_,effects:m}){const y=this._getPickable(e);if(!y||n.length===0)return[];this._resizeBuffer();const T=this.device.canvasContext.cssToDeviceRatio(),R=this.device.canvasContext.cssToDevicePixels([r,o],!0),x=R.x,O=R.y+R.height,N=this.device.canvasContext.cssToDevicePixels([r+c,o+f],!0),B=N.x+N.width,P=N.y,j={x,y:P,width:B-x,height:O-P},z=this._drawAndSample({layers:y,views:i,viewports:n,onViewportActive:_,deviceRect:j,cullRect:{x:r,y:o,width:c,height:f},effects:m,pass:`picking:${h}`}),q=PN(z),ue=new Map,oe=[],G=Number.isFinite(g);for(let ae=0;ae<q.length&&!(G&&oe.length>=g);ae++){const te=q[ae];let ge={color:te.pickedColor,layer:null,index:te.pickedObjectIndex,picked:!0,x:r,y:o,pixelRatio:T};ge=IS({layer:te.pickedLayer,info:ge,mode:h});const ce=ge.layer.id;ue.has(ce)||ue.set(ce,new Set);const _e=ue.get(ce),Pe=ge.object??ge.index;_e.has(Pe)||(_e.add(Pe),oe.push(ge))}return oe}_drawAndSample({layers:e,views:i,viewports:n,onViewportActive:r,deviceRect:o,cullRect:c,effects:f,pass:h},g=!1){const _=g?this.depthFBO:this.pickingFBO,m={layers:e,layerFilter:this.layerFilter,views:i,viewports:n,onViewportActive:r,pickingFBO:_,deviceRect:o,cullRect:c,effects:f,pass:h,pickZ:g,preRenderStats:{},isPicking:!0};for(const B of f)B.useInPicking&&(m.preRenderStats[B.id]=B.preRender(m));const{decodePickingColor:y}=this.pickLayersPass.render(m),{x:T,y:R,width:x,height:O}=o,N=new(g?Float32Array:Uint8Array)(x*O*4);return this.device.readPixelsToArrayWebGL(_,{sourceX:T,sourceY:R,sourceWidth:x,sourceHeight:O,target:N}),{pickedColors:N,decodePickingColor:y}}_getPickingRect({deviceX:e,deviceY:i,deviceRadius:n,deviceWidth:r,deviceHeight:o}){const c=Math.max(0,e-n),f=Math.max(0,i-n),h=Math.min(r,e+n+1)-c,g=Math.min(o,i+n+1)-f;return h<=0||g<=0?null:{x:c,y:f,width:h,height:g}}}const kN={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},BN="top-left",Eb="__root";class UN{constructor({deck:e,parentElement:i}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=i}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!hi(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(i=>i.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const i={};for(const n of this.resolvedWidgets)i[n.id]=n;this.resolvedWidgets.length=0;for(const n of this.defaultWidgets)i[n.id]=null,this.resolvedWidgets.push(n);for(let n of e){const r=i[n.id];r?r.viewId!==n.viewId||r.placement!==n.placement?(this._remove(r),this._add(n)):n!==r&&(r.setProps(n.props),n=r):this._add(n),i[n.id]=null,this.resolvedWidgets.push(n)}for(const n in i){const r=i[n];r&&this._remove(r)}this.widgets=e}_add(e){const{viewId:i=null,placement:n=BN}=e,r=e.onAdd({deck:this.deck,viewId:i});r&&this._getContainer(i,n).append(r),e._element=r}_remove(e){var i;(i=e.onRemove)==null||i.call(e),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,i){var c;const n=e||Eb;let r=this.containers[n];r||(r=document.createElement("div"),r.style.pointerEvents="none",r.style.position="absolute",r.style.overflow="hidden",(c=this.parentElement)==null||c.append(r),this.containers[n]=r);let o=r.querySelector(`.${i}`);return o||(o=document.createElement("div"),o.className=i,o.style.position="absolute",o.style.zIndex="2",Object.assign(o.style,kN[i]),r.append(o)),o}_updateContainers(){const e=this.deck.width,i=this.deck.height;for(const n in this.containers){const r=this.lastViewports[n]||null,o=n===Eb||r,c=this.containers[n];o?(c.style.display="block",c.style.left=`${r?r.x:0}px`,c.style.top=`${r?r.y:0}px`,c.style.width=`${r?r.width:e}px`,c.style.height=`${r?r.height:i}px`):c.style.display="none"}}onRedraw({viewports:e,layers:i}){var r,o;const n=e.reduce((c,f)=>(c[f.id]=f,c),{});for(const c of this.getWidgets()){const{viewId:f}=c;if(f){const h=n[f];h&&(c.onViewportChange&&c.onViewportChange(h),(r=c.onRedraw)==null||r.call(c,{viewports:[h],layers:i}))}else{if(c.onViewportChange)for(const h of e)c.onViewportChange(h);(o=c.onRedraw)==null||o.call(c,{viewports:e,layers:i})}}this.lastViewports=n,this._updateContainers()}onHover(e,i){var n,r;for(const o of this.getWidgets()){const{viewId:c}=o;(!c||c===((n=e.viewport)==null?void 0:n.id))&&((r=o.onHover)==null||r.call(o,e,i))}}onEvent(e,i){var r,o;const n=Kd[i.type];if(n)for(const c of this.getWidgets()){const{viewId:f}=c;(!f||f===((r=e.viewport)==null?void 0:r.id))&&((o=c[n])==null||o.call(c,e,i))}}}const FN={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class LN{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const i=document.createElement("div");return i.className="deck-tooltip",Object.assign(i.style,FN),this.deck=e,this.element=i,i}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var i;this.isVisible&&e.id===((i=this.lastViewport)==null?void 0:i.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:i}=this,n=i&&i.props.getTooltip;if(!n)return;const r=n(e);this.lastViewport=e.viewport,this.setTooltip(r,e.x,e.y)}setTooltip(e,i,n){const r=this.element;if(r){if(typeof e=="string")r.innerText=e;else if(e)e.text&&(r.innerText=e.text),e.html&&(r.innerHTML=e.html),e.className&&(r.className=e.className);else{this.isVisible=!1,r.style.display="none";return}this.isVisible=!0,r.style.display="block",r.style.transform=`translate(${i}px, ${n}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(r.style,e.style)}}}var pr;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(pr||(pr={}));const Fg={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},rt=(t,e,i)=>e?t.enable(i):t.disable(i),wb=(t,e,i)=>t.hint(i,e),zt=(t,e,i)=>t.pixelStorei(i,e),Rb=(t,e,i)=>{const n=i===36006?36009:36008;return t.bindFramebuffer(n,e)},Fa=(t,e,i)=>{const r={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[i];t.bindBuffer(r,e)};function cd(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const zN={3042:rt,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:rt,2885:(t,e)=>t.cullFace(e),2929:rt,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:rt,35723:wb,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>{var i;return(i=t.bindTransformFeedback)==null?void 0:i.call(t,36386,e)},34229:(t,e)=>t.bindVertexArray(e),36006:Rb,36010:Rb,34964:Fa,36662:Fa,36663:Fa,35053:Fa,35055:Fa,2886:(t,e)=>t.frontFace(e),33170:wb,2849:(t,e)=>t.lineWidth(e),32823:rt,32824:"polygonOffset",10752:"polygonOffset",35977:rt,32926:rt,32928:rt,32938:"sampleCoverage",32939:"sampleCoverage",3089:rt,3088:(t,e)=>t.scissor(...e),2960:rt,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:rt,10754:rt,12288:rt,12289:rt,12290:rt,12291:rt,12292:rt,12293:rt,12294:rt,12295:rt,3333:zt,3317:zt,37440:zt,37441:zt,37443:zt,3330:zt,3332:zt,3331:zt,3314:zt,32878:zt,3316:zt,3315:zt,32877:zt,framebuffer:(t,e)=>{const i=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,i)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const i=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...i)},blendFunc:(t,e)=>{const i=(e==null?void 0:e.length)===2?[...e,...e]:e;t.blendFuncSeparate(...i)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(e[0],e[1]||!1),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=cd(e)?e:[e,e];const[i,n]=e;t.stencilMaskSeparate(1028,i),t.stencilMaskSeparate(1029,n)},stencilFunc:(t,e)=>{e=cd(e)&&e.length===3?[...e,...e]:e;const[i,n,r,o,c,f]=e;t.stencilFuncSeparate(1028,i,n,r),t.stencilFuncSeparate(1029,o,c,f)},stencilOp:(t,e)=>{e=cd(e)&&e.length===3?[...e,...e]:e;const[i,n,r,o,c,f]=e;t.stencilOpSeparate(1028,i,n,r),t.stencilOpSeparate(1029,o,c,f)},viewport:(t,e)=>t.viewport(...e)};function Je(t,e,i){return e[t]!==void 0?e[t]:i[t]}const VN={blendEquation:(t,e,i)=>t.blendEquationSeparate(Je(32777,e,i),Je(34877,e,i)),blendFunc:(t,e,i)=>t.blendFuncSeparate(Je(32969,e,i),Je(32968,e,i),Je(32971,e,i),Je(32970,e,i)),polygonOffset:(t,e,i)=>t.polygonOffset(Je(32824,e,i),Je(10752,e,i)),sampleCoverage:(t,e,i)=>t.sampleCoverage(Je(32938,e,i),Je(32939,e,i)),stencilFuncFront:(t,e,i)=>t.stencilFuncSeparate(1028,Je(2962,e,i),Je(2967,e,i),Je(2963,e,i)),stencilFuncBack:(t,e,i)=>t.stencilFuncSeparate(1029,Je(34816,e,i),Je(36003,e,i),Je(36004,e,i)),stencilOpFront:(t,e,i)=>t.stencilOpSeparate(1028,Je(2964,e,i),Je(2965,e,i),Je(2966,e,i)),stencilOpBack:(t,e,i)=>t.stencilOpSeparate(1029,Je(34817,e,i),Je(34818,e,i),Je(34819,e,i))},xb={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,i)=>t({[e]:i}),hint:(t,e,i)=>t({[e]:i}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,i)=>t({36007:i}),bindTransformFeedback:(t,e,i)=>t({36389:i}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,i)=>{switch(e){case 36160:return t({36006:i,36010:i});case 36009:return t({36006:i});case 36008:return t({36010:i});default:return null}},bindBuffer:(t,e,i)=>{const n={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return n?t({[n]:i}):{valueChanged:!0}},blendColor:(t,e,i,n,r)=>t({32773:new Float32Array([e,i,n,r])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,i)=>t({32777:e,34877:i}),blendFunc:(t,e,i)=>t({32969:e,32968:i,32971:e,32970:i}),blendFuncSeparate:(t,e,i,n,r)=>t({32969:e,32968:i,32971:n,32970:r}),clearColor:(t,e,i,n,r)=>t({3106:new Float32Array([e,i,n,r])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,i,n,r)=>t({3107:[e,i,n,r]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,i)=>t({2928:new Float32Array([e,i])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,i)=>t({32824:e,10752:i}),sampleCoverage:(t,e,i)=>t({32938:e,32939:i}),scissor:(t,e,i,n,r)=>t({3088:new Int32Array([e,i,n,r])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,i)=>t({[e===1028?2968:36005]:i}),stencilFunc:(t,e,i,n)=>t({2962:e,2967:i,2963:n,34816:e,36003:i,36004:n}),stencilFuncSeparate:(t,e,i,n,r)=>t({[e===1028?2962:34816]:i,[e===1028?2967:36003]:n,[e===1028?2963:36004]:r}),stencilOp:(t,e,i,n)=>t({2964:e,2965:i,2966:n,34817:e,34818:i,34819:n}),stencilOpSeparate:(t,e,i,n,r)=>t({[e===1028?2964:34817]:i,[e===1028?2965:34818]:n,[e===1028?2966:34819]:r}),viewport:(t,e,i,n,r)=>t({2978:[e,i,n,r]})},Ai=(t,e)=>t.isEnabled(e),Cb={3042:Ai,2884:Ai,2929:Ai,3024:Ai,32823:Ai,32926:Ai,32928:Ai,3089:Ai,2960:Ai,35977:Ai},HN=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Fr(t,e){if(WN(e))return;const i={};for(const r in e){const o=Number(r),c=zN[r];c&&(typeof c=="string"?i[c]=!0:c(t,e[r],o))}const n=t.state&&t.state.cache;if(n)for(const r in i){const o=VN[r];o(t,e,n)}}function DS(t,e=Fg){if(typeof e=="number"){const r=e,o=Cb[r];return o?o(t,r):t.getParameter(r)}const i=Array.isArray(e)?e:Object.keys(e),n={};for(const r of i){const o=Cb[r];n[r]=o?o(t,Number(r)):t.getParameter(Number(r))}return n}function jN(t){Fr(t,Fg)}function WN(t){for(const e in t)return!1;return!0}function XN(t,e){if(t===e)return!0;const i=Array.isArray(t)||ArrayBuffer.isView(t),n=Array.isArray(e)||ArrayBuffer.isView(e);if(i&&n&&t.length===e.length){for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}return!1}class _s{constructor(e,i){v(this,"gl");v(this,"program",null);v(this,"stateStack",[]);v(this,"enable",!0);v(this,"cache",null);v(this,"log");v(this,"initialized",!1);this.gl=e,this.log=(i==null?void 0:i.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(e){return e.state}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];Fr(this.gl,e),this.stateStack.pop()}trackState(e,i){if(this.cache=i.copyState?DS(e):Object.assign({},Fg),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,YN(e);for(const n in xb){const r=xb[n];$N(e,n,r)}Mb(e,"getParameter"),Mb(e,"isEnabled")}_updateCache(e){let i=!1,n;const r=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const o in e){const c=e[o],f=this.cache[o];XN(c,f)||(i=!0,n=f,r&&!(o in r)&&(r[o]=f),this.cache[o]=c)}return{valueChanged:i,oldValue:n}}}function Mb(t,e){const i=t[e].bind(t);t[e]=function(r){if(r===void 0||HN.has(r))return i(r);const o=_s.get(t);return r in o.cache||(o.cache[r]=i(r)),o.enable?o.cache[r]:i(r)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function $N(t,e,i){if(!t[e])return;const n=t[e].bind(t);t[e]=function(...o){const c=_s.get(t),{valueChanged:f,oldValue:h}=i(c._updateCache,...o);return f&&n(...o),h},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function YN(t){const e=t.useProgram.bind(t);t.useProgram=function(n){const r=_s.get(t);r.program!==n&&(e(n),r.program=n)}}function qN(t,e,i){let n="";const r={preserveDrawingBuffer:!0,...i};let o=null;if(o||(o=t.getContext("webgl2",r)),r.failIfMajorPerformanceCaveat&&(n||(n="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),!o&&!i.failIfMajorPerformanceCaveat&&(r.failIfMajorPerformanceCaveat=!1,o=t.getContext("webgl2",r),o.luma||(o.luma={}),o.luma.softwareRenderer=!0),o||(o=t.getContext("webgl",{}),o&&(o=null,n||(n="Your browser only supports WebGL1"))),!o)throw n||(n="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${n}`);const{onContextLost:c,onContextRestored:f}=e;return t.addEventListener("webglcontextlost",h=>c(h),!1),t.addEventListener("webglcontextrestored",h=>f(h),!1),o.luma||(o.luma={}),o}function Br(t,e,i){return i[e]===void 0&&(i[e]=t.getExtension(e)||null),i[e]}function KN(t,e){const i=t.getParameter(7936),n=t.getParameter(7937);Br(t,"WEBGL_debug_renderer_info",e);const r=e.WEBGL_debug_renderer_info,o=t.getParameter(r?r.UNMASKED_VENDOR_WEBGL:7936),c=t.getParameter(r?r.UNMASKED_RENDERER_WEBGL:7937),f=o||i,h=c||n,g=t.getParameter(7938),_=kS(f,h),m=ZN(f,h),y=QN(f,h);return{type:"webgl",gpu:_,gpuType:y,gpuBackend:m,vendor:f,renderer:h,version:g,shadingLanguage:"glsl",shadingLanguageVersion:300}}function kS(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function ZN(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function QN(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(kS(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function BS(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const Wa="WEBGL_compressed_texture_s3tc",Xa="WEBGL_compressed_texture_s3tc_srgb",_r="EXT_texture_compression_rgtc",mr="EXT_texture_compression_bptc",GN="WEBGL_compressed_texture_etc",JN="WEBGL_compressed_texture_astc",eI="WEBGL_compressed_texture_etc1",tI="WEBGL_compressed_texture_pvrtc",iI="WEBGL_compressed_texture_atc",Ob="EXT_texture_norm16",Pb="EXT_render_snorm",nI="EXT_color_buffer_float",Lg={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[Pb],"norm16-renderable-webgl":[Ob],"snorm16-renderable-webgl":[Ob,Pb],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Wa,Xa,_r,mr],"texture-compression-bc5-webgl":[_r],"texture-compression-bc7-webgl":[mr],"texture-compression-etc2":[GN],"texture-compression-astc":[JN],"texture-compression-etc1-webgl":[eI],"texture-compression-pvrtc-webgl":[tI],"texture-compression-atc-webgl":[iI]};function sI(t){return t in Lg}function rI(t,e,i){return(Lg[e]||[]).every(r=>Br(t,r,i))}const zg={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:nI,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Wa},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Xa},"bc1-rgba-unorm":{gl:33777,x:Wa},"bc1-rgba-unorm-srgb":{gl:35916,x:Xa},"bc2-rgba-unorm":{gl:33778,x:Wa},"bc2-rgba-unorm-srgb":{gl:35918,x:Xa},"bc3-rgba-unorm":{gl:33779,x:Wa},"bc3-rgba-unorm-srgb":{gl:35919,x:Xa},"bc4-r-unorm":{gl:36283,x:_r},"bc4-r-snorm":{gl:36284,x:_r},"bc5-rg-unorm":{gl:36285,x:_r},"bc5-rg-snorm":{gl:36286,x:_r},"bc6h-rgb-ufloat":{gl:36495,x:mr},"bc6h-rgb-float":{gl:36494,x:mr},"bc7-rgba-unorm":{gl:36492,x:mr},"bc7-rgba-unorm-srgb":{gl:36493,x:mr},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function aI(t,e,i){let n=e.create;const r=zg[e.format];return(r==null?void 0:r.gl)===void 0&&(n=!1),r!=null&&r.x&&(n=n&&!!Br(t,r.x,i)),{format:e.format,create:n&&e.create,render:n&&e.render,filter:n&&e.filter,blend:n&&e.blend,store:n&&e.store}}function US(t){var r;const e=zg[t],i=cI(t),n=Pg(t);return{internalFormat:i,format:(e==null?void 0:e.dataFormat)||lI(n.channels,n.integer,n.normalized,i),type:n.dataType?BS(n.dataType):((r=e==null?void 0:e.types)==null?void 0:r[0])||5121,compressed:n.compressed||!1}}function oI(t){switch(Pg(t).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${t}`)}}function lI(t,e,i,n){if(n===6408||n===6407)return n;switch(t){case"r":return e&&!i?36244:6403;case"rg":return e&&!i?33320:33319;case"rgb":return e&&!i?36248:6407;case"rgba":return e&&!i?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function cI(t){const e=zg[t],i=e==null?void 0:e.gl;if(i===void 0)throw new Error(`Unsupported texture format ${t}`);return i}const Nb={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class uI extends Kx{constructor(i,n,r){super([],r);v(this,"gl");v(this,"extensions");v(this,"testedFeatures",new Set);this.gl=i,this.extensions=n,Br(i,"EXT_color_buffer_float",n)}*[Symbol.iterator](){const i=this.getFeatures();for(const n of i)this.has(n)&&(yield n);return[]}has(i){var n;return(n=this.disabledFeatures)!=null&&n[i]?!1:(this.testedFeatures.has(i)||(this.testedFeatures.add(i),sI(i)&&rI(this.gl,i,this.extensions)&&this.features.add(i),this.getWebGLFeature(i)&&this.features.add(i)),this.features.has(i))}initializeFeatures(){const i=this.getFeatures().filter(n=>n!=="polygon-mode-webgl");for(const n of i)this.has(n)}getFeatures(){return[...Object.keys(Nb),...Object.keys(Lg)]}getWebGLFeature(i){const n=Nb[i];return typeof n=="string"?!!Br(this.gl,n,this.extensions):!!n}}class fI extends qx{constructor(i){super();v(this,"gl");v(this,"limits",{});this.gl=i}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(i){return this.limits[i]===void 0&&(this.limits[i]=this.gl.getParameter(i)),this.limits[i]||0}}class Ka extends Ac{constructor(i,n){super(i,n);v(this,"device");v(this,"gl");v(this,"handle");v(this,"colorAttachments",[]);v(this,"depthStencilAttachment",null);const r=n.handle===null;this.device=i,this.gl=i.gl,this.handle=this.props.handle||r?this.props.handle:this.gl.createFramebuffer(),r||(i.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const i=this.gl.bindFramebuffer(36160,this.handle);for(let n=0;n<this.colorAttachments.length;++n){const r=this.colorAttachments[n];if(r){const o=36064+n;this._attachTextureView(o,r)}}if(this.depthStencilAttachment){const n=oI(this.depthStencilAttachment.props.format);this._attachTextureView(n,this.depthStencilAttachment)}if(this.device.props.debug){const n=this.gl.checkFramebufferStatus(36160);if(n!==36053)throw new Error(`Framebuffer ${dI(n)}`)}this.gl.bindFramebuffer(36160,i)}_attachTextureView(i,n){const{gl:r}=this.device,{texture:o}=n,c=n.props.baseMipLevel,f=n.props.baseArrayLayer;switch(r.bindTexture(o.glTarget,o.handle),o.glTarget){case 35866:case 32879:r.framebufferTextureLayer(36160,i,o.handle,c,f);break;case 34067:const h=hI(f);r.framebufferTexture2D(36160,i,h,o.handle,c);break;case 3553:r.framebufferTexture2D(36160,i,3553,o.handle,c);break;default:throw new Error("Illegal texture type")}r.bindTexture(o.glTarget,null)}}function hI(t){return t<34069?t+34069:t}function dI(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class gI extends Id{constructor(i,n){super(n);v(this,"device");v(this,"format","rgba8unorm");v(this,"depthStencilFormat","depth24plus");v(this,"presentationSize");v(this,"_framebuffer",null);this.device=i,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new Ka(this.device,{handle:null}),this._framebuffer}update(){const i=this.getPixelSize();(i[0]!==this.presentationSize[0]||i[1]!==this.presentationSize[1])&&(this.presentationSize=i,this.resize())}resize(i){if(this.device.gl&&this.canvas){const n=this.getDevicePixelRatio(i==null?void 0:i.useDevicePixels);this.setDevicePixelRatio(n,i);return}}commit(){}}async function FS(t,e){const i=document.getElementsByTagName("head")[0];if(!i)throw new Error("loadScript");const n=document.createElement("script");return n.setAttribute("type","text/javascript"),n.setAttribute("src",t),new Promise((r,o)=>{n.onload=r,n.onerror=c=>o(new Error(`Unable to load script '${t}': ${c}`)),i.appendChild(n)})}const pI=1;let je=null,Ib=!1;const Vg={debugSpectorJS:se.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function _I(t){if(!globalThis.SPECTOR)try{await FS(t.debugSpectorJSUrl||Vg.debugSpectorJSUrl)}catch(e){se.warn(String(e))}}function mI(t){var e;if(t={...Vg,...t},!t.debugSpectorJS)return null;if(!je&&globalThis.SPECTOR&&!((e=globalThis.luma)!=null&&e.spector)){se.probe(pI,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:i}=globalThis.SPECTOR;je=new i,globalThis.luma&&(globalThis.luma.spector=je)}if(!je)return null;if(Ib||(Ib=!0,je.spyCanvases(),je==null||je.onCaptureStarted.add(i=>se.info("Spector capture started:",i)()),je==null||je.onCapture.add(i=>{se.info("Spector capture complete:",i)(),je==null||je.getResultUI(),je==null||je.resultView.display(),je==null||je.resultView.addCapture(i)})),t.gl){const i=t.gl,n=i.device;je==null||je.startCapture(t.gl,500),i.device=n,new Promise(r=>setTimeout(r,2e3)).then(r=>{se.info("Spector capture stopped after 2 seconds")(),je==null||je.stopCapture()})}return je}const yI="https://unpkg.com/webgl-debug@2.0.1/index.js";function LS(t){return t.luma=t.luma||{},t.luma}async function bI(){Ss()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await FS(yI))}function vI(t,e={}){return e.debugWebGL||e.traceWebGL?SI(t,e):TI(t)}function TI(t){const e=LS(t);return e.realContext?e.realContext:t}function SI(t,e){if(!globalThis.WebGLDebugUtils)return se.warn("webgl-debug not loaded")(),t;const i=LS(t);if(i.debugContext)return i.debugContext;globalThis.WebGLDebugUtils.init({...pr,...t});const n=globalThis.WebGLDebugUtils.makeDebugContext(t,AI.bind(null,e),EI.bind(null,e));for(const c in pr)!(c in n)&&typeof pr[c]=="number"&&(n[c]=pr[c]);class r{}Object.setPrototypeOf(n,Object.getPrototypeOf(t)),Object.setPrototypeOf(r,n);const o=Object.create(r);return i.realContext=t,i.debugContext=o,o.debug=!0,o}function Db(t,e){e=Array.from(e).map(n=>n===void 0?"undefined":n);let i=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return i=`${i.slice(0,100)}${i.length>100?"...":""}`,`gl.${t}(${i})`}function AI(t,e,i,n){n=Array.from(n).map(f=>f===void 0?"undefined":f);const r=globalThis.WebGLDebugUtils.glEnumToString(e),o=globalThis.WebGLDebugUtils.glFunctionArgsToString(i,n),c=`${r} in gl.${i}(${o})`;se.error(c)();debugger}function EI(t,e,i){let n="";se.level>=1&&(n=Db(e,i),t.traceWebGL&&se.log(1,n)());for(const r of i)if(r===void 0){n=n||Db(e,i);debugger}}const ud={};function wI(t="id"){ud[t]=ud[t]||1;const e=ud[t]++;return`${t}-${e}`}class Za extends $e{constructor(i,n={}){super(i,n);v(this,"device");v(this,"gl");v(this,"handle");v(this,"glTarget");v(this,"glUsage");v(this,"glIndexType",5123);v(this,"byteLength");v(this,"bytesUsed");this.device=i,this.gl=this.device.gl;const r=typeof n=="object"?n.handle:void 0;this.handle=r||this.gl.createBuffer(),i.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=RI(this.props.usage),this.glUsage=xI(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,n.data?this._initWithData(n.data,n.byteOffset,n.byteLength):this._initWithByteLength(n.byteLength||0)}_initWithData(i,n=0,r=i.byteLength+n){const o=this.glTarget;this.gl.bindBuffer(o,this.handle),this.gl.bufferData(o,r,this.glUsage),this.gl.bufferSubData(o,n,i),this.gl.bindBuffer(o,null),this.bytesUsed=r,this.byteLength=r,this._setDebugData(i,n,r),this.trackAllocatedMemory(r)}_initWithByteLength(i){let n=i;i===0&&(n=new Float32Array(0));const r=this.glTarget;return this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,n,this.glUsage),this.gl.bindBuffer(r,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(null,0,i),this.trackAllocatedMemory(i),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(i,n=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,n,i),this.gl.bindBuffer(36663,null),this._setDebugData(i,n,i.byteLength)}async readAsync(i=0,n){return this.readSyncWebGL(i,n)}readSyncWebGL(i=0,n){n=n??this.byteLength-i;const r=new Uint8Array(n),o=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,i,r,o,n),this.gl.bindBuffer(36662,null),this._setDebugData(r,i,n),r}}function RI(t){return t&$e.INDEX?34963:t&$e.VERTEX?34962:t&$e.UNIFORM?35345:34962}function xI(t){return t&$e.INDEX||t&$e.VERTEX?35044:t&$e.UNIFORM?35048:35044}function CI(t){const e=t.split(/\r?\n/),i=[];for(const n of e){if(n.length<=1)continue;const r=n.split(":");if(r.length===2){const[m,y]=r;i.push({message:y.trim(),type:kb(m),lineNum:0,linePos:0});continue}const[o,c,f,...h]=r;let g=parseInt(f,10);isNaN(g)&&(g=0);let _=parseInt(c,10);isNaN(_)&&(_=0),i.push({message:h.join(":").trim(),type:kb(o),lineNum:g,linePos:_})}return i}function kb(t){const e=["warning","error","info"],i=t.toLowerCase();return e.includes(i)?i:"info"}class MI extends Tc{constructor(i,n){super(i,n);v(this,"device");v(this,"handle");switch(this.device=i,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const i=this.device.gl.getShaderInfoLog(this.handle);return i?CI(i):[]}getTranslatedSource(){const n=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(n==null?void 0:n.getTranslatedShaderSource(this.handle))||null}async _compile(i){i=i.startsWith("#version ")?i:`#version 300 es
${i}`;const{gl:n}=this.device;if(n.shaderSource(this.handle,i),n.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}se.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),se.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const i=async o=>await new Promise(c=>setTimeout(c,o));if(!this.device.features.has("compilation-status-async-webgl")){await i(10);return}const{gl:r}=this.device;for(;;){if(r.getShaderParameter(this.handle,37297))return;await i(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function OI(t,e,i,n){if(DI(e))return n(t);const r=t;r.pushState();try{return PI(t,e),Fr(r.gl,i),n(t)}finally{r.popState()}}function PI(t,e){const i=t,{gl:n}=i;if(e.cullMode)switch(e.cullMode){case"none":n.disable(2884);break;case"front":n.enable(2884),n.cullFace(1028);break;case"back":n.enable(2884),n.cullFace(1029);break}if(e.frontFace&&n.frontFace(ms("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&n.enable(34383),e.depthBias!==void 0&&(n.enable(32823),n.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const o=i.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,c=ms("provokingVertex",e.provokingVertex,{first:36429,last:36430});o==null||o.provokingVertexWEBGL(c)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const o=i.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,c=ms("polygonMode",e.polygonMode,{fill:6914,line:6913});o==null||o.polygonModeWEBGL(1028,c),o==null||o.polygonModeWEBGL(1029,c)}e.polygonOffsetLine&&n.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&n.enable(12288),e.clipDistance1&&n.enable(12289),e.clipDistance2&&n.enable(12290),e.clipDistance3&&n.enable(12291),e.clipDistance4&&n.enable(12292),e.clipDistance5&&n.enable(12293),e.clipDistance6&&n.enable(12294),e.clipDistance7&&n.enable(12295)),e.depthWriteEnabled!==void 0&&n.depthMask(II("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?n.enable(2929):n.disable(2929),n.depthFunc(sg("depthCompare",e.depthCompare))),e.stencilWriteMask){const r=e.stencilWriteMask;n.stencilMaskSeparate(1028,r),n.stencilMaskSeparate(1029,r)}if(e.stencilReadMask&&se.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const r=e.stencilReadMask||4294967295,o=sg("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?n.enable(2960):n.disable(2960),n.stencilFuncSeparate(1028,o,0,r),n.stencilFuncSeparate(1029,o,0,r)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const r=fd("stencilPassOperation",e.stencilPassOperation),o=fd("stencilFailOperation",e.stencilFailOperation),c=fd("stencilDepthFailOperation",e.stencilDepthFailOperation);n.stencilOpSeparate(1028,o,c,r),n.stencilOpSeparate(1029,o,c,r)}switch(e.blend){case!0:n.enable(3042);break;case!1:n.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const r=Bb("blendColorOperation",e.blendColorOperation||"add"),o=Bb("blendAlphaOperation",e.blendAlphaOperation||"add");n.blendEquationSeparate(r,o);const c=Xl("blendColorSrcFactor",e.blendColorSrcFactor||"one"),f=Xl("blendColorDstFactor",e.blendColorDstFactor||"zero"),h=Xl("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),g=Xl("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");n.blendFuncSeparate(c,f,h,g)}}function sg(t,e){return ms(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function fd(t,e){return ms(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function Bb(t,e){return ms(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function Xl(t,e){return ms(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function NI(t,e){return`Illegal parameter ${e} for ${t}`}function ms(t,e,i){if(!(e in i))throw new Error(NI(t,e));return i[e]}function II(t,e){return e}function DI(t){let e=!0;for(const i in t){e=!1;break}return e}function zS(t){const e={};return t.addressModeU&&(e[10242]=hd(t.addressModeU)),t.addressModeV&&(e[10243]=hd(t.addressModeV)),t.addressModeW&&(e[32882]=hd(t.addressModeW)),t.magFilter&&(e[10240]=rg(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=kI(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=sg("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function hd(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function rg(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function kI(t,e="none"){if(!e)return rg(t);switch(e){case"none":return rg(t);case"nearest":return t==="nearest"?9984:9986;case"linear":return t==="nearest"?9985:9987}}class ag extends Sc{constructor(i,n){super(i,n);v(this,"device");v(this,"handle");v(this,"parameters");this.device=i,this.parameters=zS(n),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(i){for(const[n,r]of Object.entries(i)){const o=Number(n);switch(o){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,o,r);break;default:this.device.gl.samplerParameteri(this.handle,o,r);break}}}}class yr extends vc{constructor(i,n){super(i,{...et.defaultProps,...n});v(this,"device");v(this,"gl");v(this,"handle");v(this,"texture");this.device=i,this.gl=this.device.gl,this.handle=null,this.texture=n.texture}}const BI="Failed to deduce GL constant from typed array";function UI(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(BI)}}function FI(t,e){const{clamped:i=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return i?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function VS(t){switch(t){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function LI(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function kc(t,e,i){if(zI(e))return i(t);const{nocatch:n=!0}=e,r=_s.get(t);r.push(),Fr(t,e);let o;if(n)o=i(t),r.pop();else try{o=i(t)}finally{r.pop()}return o}function zI(t){for(const e in t)return!1;return!0}function VI(t,e,i){const{dimension:n,width:r,height:o,depth:c=0}=i,{glInternalFormat:f}=i,h=i.glTarget;switch(n){case"2d-array":case"3d":t.texStorage3D(h,e,f,r,o,c);break;default:t.texStorage2D(h,e,f,r,o)}}function Ub(t,e,i,n){const{width:r,height:o}=n,{dimension:c,depth:f=0,mipLevel:h=0}=n,{x:g=0,y:_=0,z:m=0}=n,{glFormat:y,glType:T}=n,R=HS(n.glTarget,c,f),x=n.flipY?{37440:!0}:{};kc(t,x,()=>{switch(c){case"2d-array":case"3d":t.bindTexture(R,e),t.texSubImage3D(R,h,g,_,m,r,o,f,y,T,i),t.bindTexture(R,null);break;case"2d":case"cube":t.bindTexture(R,e),t.texSubImage2D(R,h,g,_,r,o,y,T,i),t.bindTexture(R,null);break;default:throw new Error(c)}})}function Fb(t,e,i){const{dimension:n,width:r,height:o,depth:c=0,mipLevel:f=0,byteOffset:h=0}=i,{x:g=0,y:_=0,z:m=0}=i,{glFormat:y,glType:T,compressed:R}=i,x=HS(i.glTarget,n,c);switch(n){case"2d-array":case"3d":R?t.compressedTexSubImage3D(x,f,g,_,m,r,o,c,y,e,h):t.texSubImage3D(x,f,g,_,m,r,o,c,y,T,e,h);break;case"2d":case"cube":R?t.compressedTexSubImage2D(x,f,g,_,r,o,y,e,h):t.texSubImage2D(x,f,g,_,r,o,y,T,e,h);break;default:throw new Error(n)}}function HI(t){switch(t){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(t)}function HS(t,e,i){return e==="cube"?34069+i:t}function jI(t,e){var N;const{sourceX:i=0,sourceY:n=0,sourceAttachment:r=0}=e||{};let{target:o=null,sourceWidth:c,sourceHeight:f,sourceDepth:h,sourceFormat:g,sourceType:_}=e||{};const{framebuffer:m,deleteFramebuffer:y}=jS(t),{gl:T,handle:R}=m;c||(c=m.width),f||(f=m.height);const x=(N=m.colorAttachments[r])==null?void 0:N.texture;if(!x)throw new Error(`Invalid framebuffer attachment ${r}`);h=(x==null?void 0:x.depth)||1,g||(g=(x==null?void 0:x.glFormat)||6408),_||(_=(x==null?void 0:x.glType)||5121),o=$I(o,_,g,c,f),_=_||UI(o);const O=T.bindFramebuffer(36160,R);return T.readBuffer(36064+r),T.readPixels(i,n,c,f,g,_,o),T.readBuffer(36064),T.bindFramebuffer(36160,O||null),y&&m.destroy(),o}function WI(t,e){const{target:i,sourceX:n=0,sourceY:r=0,sourceFormat:o=6408,targetByteOffset:c=0}=e||{};let{sourceWidth:f,sourceHeight:h,sourceType:g}=e||{};const{framebuffer:_,deleteFramebuffer:m}=jS(t);f=f||_.width,h=h||_.height;const y=_;g=g||5121;let T=i;if(!T){const x=VS(o),O=LI(g),N=c+f*h*x*O;T=y.device.createBuffer({byteLength:N})}const R=t.device.createCommandEncoder();return R.copyTextureToBuffer({sourceTexture:t,width:f,height:h,origin:[n,r],destinationBuffer:T,byteOffset:c}),R.destroy(),m&&_.destroy(),T}function jS(t){return t instanceof Ac?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:XI(t),deleteFramebuffer:!0}}function XI(t,e){const{device:i,width:n,height:r,id:o}=t;return i.createFramebuffer({...e,id:`framebuffer-for-${o}`,width:n,height:r,colorAttachments:[t]})}function $I(t,e,i,n,r,o){if(t)return t;e||(e=5121);const c=FI(e,{clamped:!1}),f=VS(i);return new c(n*r*f)}class Qa extends et{constructor(i,n){super(i,n);v(this,"device");v(this,"gl");v(this,"handle");v(this,"sampler");v(this,"view");v(this,"mipmaps");v(this,"compressed");v(this,"glTarget");v(this,"glFormat");v(this,"glType");v(this,"glInternalFormat");v(this,"textureUnit",0);const r={...this.props};r.data=n.data,this.device=i,this.gl=this.device.gl,this.glTarget=HI(this.props.dimension);const o=US(this.props.format);this.glInternalFormat=o.internalFormat,this.glFormat=o.format,this.glType=o.type,this.compressed=o.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(r),Object.seal(this)}_initialize(i){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:i.data});let{width:n,height:r}=i;if(!n||!r){const o=et.getTextureDataSize(i.data);n=(o==null?void 0:o.width)||1,r=(o==null?void 0:o.height)||1}if(this.width=n,this.height=r,this.depth=i.depth,this.setSampler(i.sampler),this.view=new yr(this.device,{...this.props,texture:this}),this.bind(),VI(this.gl,this.mipLevels,this),i.data)switch(i.dimension){case"1d":this.setTexture1DData(i.data);break;case"2d":this.setTexture2DData(i.data);break;case"3d":this.setTexture3DData(i.data);break;case"cube":this.setTextureCubeData(i.data);break;case"2d-array":this.setTextureArrayData(i.data);break;case"cube-array":this.setTextureCubeArrayData(i.data);break;default:throw new Error(i.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(i){return new yr(this.device,{...i,texture:this})}setSampler(i={}){let n;i instanceof ag?(this.sampler=i,n=i.props):(this.sampler=new ag(this.device,i),n=i);const r=zS(n);this._setSamplerParameters(r)}generateMipmap(i){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(se.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!(i!=null&&i.force))))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(r){se.warn(`Error generating mipmap for ${this}: ${r.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(i){const n=et.getExternalImageSize(i.image),r={...et.defaultCopyExternalImageOptions,...n,...i},{image:o,depth:c,mipLevel:f,x:h,y:g,z:_,flipY:m}=r;let{width:y,height:T}=r;const{dimension:R,glTarget:x,glFormat:O,glInternalFormat:N,glType:B}=this;if(y=Math.min(y,this.width-h),T=Math.min(T,this.height-g),i.sourceX||i.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return Ub(this.device.gl,this.handle,o,{dimension:R,mipLevel:f,x:h,y:g,z:_,width:y,height:T,depth:c,glFormat:O,glType:B,glTarget:x,flipY:m}),{width:r.width,height:r.height}}setTexture1DData(i){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(i,n=0){this.bind();const r=et.normalizeTextureData(i,this);r.length>1&&this.props.mipmaps!==!1&&se.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let o=0;o<r.length;o++){const c=r[o];this._setMipLevel(n,o,c)}this.unbind()}setTexture3DData(i){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(i)&&(this.bind(),Fb(this.device.gl,i,this),this.unbind())}setTextureCubeData(i,n=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const r of et.CubeFaces)this.setTextureCubeFaceData(i[r],r)}setTextureArrayData(i){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(i){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(i,n,r=0){Array.isArray(i)&&i.length>1&&this.props.mipmaps!==!1&&se.warn(`${this.id} has mipmap and multiple LODs.`)();const o=et.CubeFaces.indexOf(n);this.setTexture2DData(i,o)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(i){const{face:n,width:r,height:o,pixels:c,data:f,format:h=6408,type:g=5121}=i,{gl:_}=this,m=c||f;this.bind(),m instanceof Promise?m.then(y=>this.setImageDataForFace(Object.assign({},i,{face:n,data:y,pixels:y}))):this.width||this.height?_.texImage2D(n,0,h,r,o,0,h,g,m):_.texImage2D(n,0,h,h,g,m)}_getImageDataMap(i){for(let n=0;n<et.CubeFaces.length;++n){const r=et.CubeFaces[n];i[r]&&(i[34069+n]=i[r],delete i[r])}return i}_setSamplerParameters(i){se.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(i))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[n,r]of Object.entries(i)){const o=Number(n),c=r;switch(o){case 33082:case 33083:this.gl.texParameterf(this.glTarget,o,c);break;case 10241:this.gl.texParameteri(this.glTarget,o,c);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,o,c);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,o,c);break;default:this.gl.texParameteri(this.glTarget,o,c);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(i,n,r,o=this.glTarget){if(et.isExternalImage(r)){Ub(this.device.gl,this.handle,r,{...this,depth:i,mipLevel:n,glTarget:o,flipY:this.props.flipY});return}if(et.isTextureLevelData(r)){Fb(this.device.gl,r.data,{...this,depth:i,mipLevel:n,glTarget:o});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(i){const{gl:n}=this;return i!==void 0&&(this.textureUnit=i,n.activeTexture(33984+i)),n.bindTexture(this.glTarget,this.handle),i}unbind(i){const{gl:n}=this;return i!==void 0&&(this.textureUnit=i,n.activeTexture(33984+i)),n.bindTexture(this.glTarget,null),i}}const YI=[1,2,4,8];class qI extends Dd{constructor(i,n){var o;super(i,n);v(this,"device");v(this,"glParameters");this.device=i;let r;if(!((o=n==null?void 0:n.parameters)!=null&&o.viewport))if(n!=null&&n.framebuffer){const{width:c,height:f}=n.framebuffer;r=[0,0,c,f]}else{const[c,f]=i.getCanvasContext().getDrawingBufferSize();r=[0,0,c,f]}if(this.device.pushState(),this.setParameters({viewport:r,...this.props.parameters}),this.props.framebuffer){const c=this.props.framebuffer.colorAttachments.map((f,h)=>36064+h);this.device.gl.drawBuffers(c)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(i){}popDebugGroup(){}insertDebugMarker(i){}setParameters(i={}){const n={...this.glParameters};n.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(n.depthMask=!this.props.depthReadOnly),n.stencilMask=this.props.stencilReadOnly?0:1,n[35977]=this.props.discard,i.viewport&&(i.viewport.length>=6?(n.viewport=i.viewport.slice(0,4),n.depthRange=[i.viewport[4],i.viewport[5]]):n.viewport=i.viewport),i.scissorRect&&(n.scissorTest=!0,n.scissor=i.scissorRect),i.blendConstant&&(n.blendColor=i.blendConstant),i.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),i[2967]=i.stencilReference),i.colorMask&&(n.colorMask=YI.map(r=>!!(r&i.colorMask))),this.glParameters=n,Fr(this.device.gl,n)}beginOcclusionQuery(i){const n=this.props.occlusionQuerySet;n==null||n.beginOcclusionQuery()}endOcclusionQuery(){const i=this.props.occlusionQuerySet;i==null||i.endOcclusionQuery()}clear(){const i={...this.glParameters};let n=0;this.props.clearColors&&this.props.clearColors.forEach((r,o)=>{r&&this.clearColorBuffer(o,r)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(n|=16384,i.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(n|=256,i.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(n|=1024,i.clearStencil=this.props.clearStencil),n!==0&&kc(this.device.gl,i,()=>{this.device.gl.clear(n)})}clearColorBuffer(i=0,n=[0,0,0,0]){kc(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(n.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,i,n);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,i,n);break;case Float32Array:this.device.gl.clearBufferfv(6144,i,n);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function KI(t){return ZI.includes(t)}const ZI=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],WS={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function XS(t){const e=WS[t];if(!e)throw new Error("uniform");const[i,n,,r]=e;return{format:r,components:n,glType:i}}function QI(t){const e=WS[t];if(!e)throw new Error("attribute");const[,i,,n,r]=e;return{attributeType:n,vertexFormat:r,components:i}}function GI(t,e){const i={attributes:[],bindings:[]};i.attributes=JI(t,e);const n=iD(t,e);for(const f of n){const h=f.uniforms.map(g=>({name:g.name,format:g.format,byteOffset:g.byteOffset,byteStride:g.byteStride,arrayLength:g.arrayLength}));i.bindings.push({type:"uniform",name:f.name,group:0,location:f.location,visibility:(f.vertex?1:0)&(f.fragment?2:0),minBindingSize:f.byteLength,uniforms:h})}const r=tD(t,e);let o=0;for(const f of r)if(KI(f.type)){const{viewDimension:h,sampleType:g}=sD(f.type);i.bindings.push({type:"texture",name:f.name,group:0,location:o,viewDimension:h,sampleType:g}),f.textureUnit=o,o+=1}r.length&&(i.uniforms=r);const c=eD(t,e);return c!=null&&c.length&&(i.varyings=c),i}function JI(t,e){const i=[],n=t.getProgramParameter(e,35721);for(let r=0;r<n;r++){const o=t.getActiveAttrib(e,r);if(!o)throw new Error("activeInfo");const{name:c,type:f}=o,h=t.getAttribLocation(e,c);if(h>=0){const{attributeType:g}=QI(f),_=/instance/i.test(c)?"instance":"vertex";i.push({name:c,location:h,stepMode:_,type:g})}}return i.sort((r,o)=>r.location-o.location),i}function eD(t,e){const i=[],n=t.getProgramParameter(e,35971);for(let r=0;r<n;r++){const o=t.getTransformFeedbackVarying(e,r);if(!o)throw new Error("activeInfo");const{name:c,type:f,size:h}=o,{glType:g,components:_}=XS(f),m={location:r,name:c,type:g,size:h*_};i.push(m)}return i.sort((r,o)=>r.location-o.location),i}function tD(t,e){const i=[],n=t.getProgramParameter(e,35718);for(let r=0;r<n;r++){const o=t.getActiveUniform(e,r);if(!o)throw new Error("activeInfo");const{name:c,size:f,type:h}=o,{name:g,isArray:_}=rD(c);let m=t.getUniformLocation(e,g);const y={location:m,name:g,size:f,type:h,isArray:_};if(i.push(y),y.size>1)for(let T=0;T<y.size;T++){const R=`${g}[${T}]`;m=t.getUniformLocation(e,R);const x={...y,name:R,location:m};i.push(x)}}return i}function iD(t,e){const i=(o,c)=>t.getActiveUniformBlockParameter(e,o,c),n=[],r=t.getProgramParameter(e,35382);for(let o=0;o<r;o++){const c={name:t.getActiveUniformBlockName(e,o)||"",location:i(o,35391),byteLength:i(o,35392),vertex:i(o,35396),fragment:i(o,35398),uniformCount:i(o,35394),uniforms:[]},f=i(o,35395)||[],h=t.getActiveUniforms(e,f,35383),g=t.getActiveUniforms(e,f,35384),_=t.getActiveUniforms(e,f,35387),m=t.getActiveUniforms(e,f,35388);for(let y=0;y<c.uniformCount;++y){const T=t.getActiveUniform(e,f[y]);if(!T)throw new Error("activeInfo");c.uniforms.push({name:T.name,format:XS(h[y]).format,type:h[y],arrayLength:g[y],byteOffset:_[y],byteStride:m[y]})}n.push(c)}return n.sort((o,c)=>o.location-c.location),n}const nD={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function sD(t){const e=nD[t];if(!e)throw new Error("sampler");const[i,n]=e;return{viewDimension:i,sampleType:n}}function rD(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const i=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!i||i.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:i[1],length:i[2]?1:0,isArray:!!i[2]}}function aD(t,e,i,n){const r=t;let o=n;o===!0&&(o=1),o===!1&&(o=0);const c=typeof o=="number"?[o]:o;switch(i){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof n!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,n);case 5126:return t.uniform1fv(e,c);case 35664:return t.uniform2fv(e,c);case 35665:return t.uniform3fv(e,c);case 35666:return t.uniform4fv(e,c);case 5124:return t.uniform1iv(e,c);case 35667:return t.uniform2iv(e,c);case 35668:return t.uniform3iv(e,c);case 35669:return t.uniform4iv(e,c);case 35670:return t.uniform1iv(e,c);case 35671:return t.uniform2iv(e,c);case 35672:return t.uniform3iv(e,c);case 35673:return t.uniform4iv(e,c);case 5125:return r.uniform1uiv(e,c,1);case 36294:return r.uniform2uiv(e,c,2);case 36295:return r.uniform3uiv(e,c,3);case 36296:return r.uniform4uiv(e,c,4);case 35674:return t.uniformMatrix2fv(e,!1,c);case 35675:return t.uniformMatrix3fv(e,!1,c);case 35676:return t.uniformMatrix4fv(e,!1,c);case 35685:return r.uniformMatrix2x3fv(e,!1,c);case 35686:return r.uniformMatrix2x4fv(e,!1,c);case 35687:return r.uniformMatrix3x2fv(e,!1,c);case 35688:return r.uniformMatrix3x4fv(e,!1,c);case 35689:return r.uniformMatrix4x2fv(e,!1,c);case 35690:return r.uniformMatrix4x3fv(e,!1,c)}throw new Error("Illegal uniform")}function oD(t){return wS(t)!==null||typeof t=="number"||typeof t=="boolean"}function lD(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(i=>{const n=t[i];oD(n)?e.uniforms[i]=n:e.bindings[i]=n}),e}function cD(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(t)}}function uD(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(t)}}const Lb=4;class fD extends Rr{constructor(i,n){super(i,n);v(this,"device");v(this,"handle");v(this,"vs");v(this,"fs");v(this,"introspectedLayout");v(this,"uniforms",{});v(this,"bindings",{});v(this,"varyings",null);v(this,"_uniformCount",0);v(this,"_uniformSetters",{});this.device=i,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=n.vs,this.fs=n.fs;const{varyings:r,bufferMode:o=35981}=n;r&&r.length>0&&(this.varyings=r,this.device.gl.transformFeedbackVaryings(this.handle,r,o)),this._linkShaders(),se.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=GI(this.device.gl,this.handle),se.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=hD(this.introspectedLayout,n.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(i,n){for(const[r,o]of Object.entries(i)){const c=this.shaderLayout.bindings.find(f=>f.name===r)||this.shaderLayout.bindings.find(f=>f.name===`${r}Uniforms`);if(!c){const f=this.shaderLayout.bindings.map(h=>`"${h.name}"`).join(", ");n!=null&&n.disableWarnings||se.warn(`No binding "${r}" in render pipeline "${this.id}", expected one of ${f}`,o)();continue}switch(o||se.warn(`Unsetting binding "${r}" in render pipeline "${this.id}"`)(),c.type){case"uniform":if(!(o instanceof Za)&&!(o.buffer instanceof Za))throw new Error("buffer value");break;case"texture":if(!(o instanceof yr||o instanceof Qa||o instanceof Ka))throw new Error("texture value");break;case"sampler":se.warn(`Ignoring sampler ${r}`)();break;default:throw new Error(c.type)}this.bindings[r]=o}}draw(i){var O;const{renderPass:n,parameters:r=this.props.parameters,topology:o=this.props.topology,vertexArray:c,vertexCount:f,instanceCount:h,isInstanced:g=!1,firstVertex:_=0,transformFeedback:m}=i,y=cD(o),T=!!c.indexBuffer,R=(O=c.indexBuffer)==null?void 0:O.glIndexType;if(this.linkStatus!=="success")return se.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return se.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),c.bindBeforeRender(n),m&&m.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const x=n;return OI(this.device,r,x.glParameters,()=>{T&&g?this.device.gl.drawElementsInstanced(y,f||0,R,_,h||0):T?this.device.gl.drawElements(y,f||0,R,_):g?this.device.gl.drawArraysInstanced(y,_,f||0,h||0):this.device.gl.drawArrays(y,_,f||0),m&&m.end()}),c.unbindAfterRender(n),!0}setUniformsWebGL(i){const{bindings:n}=lD(i);Object.keys(n).forEach(r=>{se.warn(`Unsupported value "${JSON.stringify(n[r])}" used in setUniforms() for key ${r}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,i)}async _linkShaders(){const{gl:i}=this.device;if(i.attachShader(this.handle,this.vs.handle),i.attachShader(this.handle,this.fs.handle),se.time(Lb,`linkProgram for ${this.id}`)(),i.linkProgram(this.handle),se.timeEnd(Lb,`linkProgram for ${this.id}`)(),se.level,!this.device.features.has("compilation-status-async-webgl")){const r=this._getLinkStatus();this._reportLinkStatus(r);return}se.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),se.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const n=this._getLinkStatus();this._reportLinkStatus(n)}async _reportLinkStatus(i){var n;switch(i){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch((n=this.fs)==null?void 0:n.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const r=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${i}: ${r}`)}}_getLinkStatus(){const{gl:i}=this.device;return i.getProgramParameter(this.handle,35714)?(i.validateProgram(this.handle),i.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const i=async o=>await new Promise(c=>setTimeout(c,o));if(!this.device.features.has("compilation-status-async-webgl")){await i(10);return}const{gl:r}=this.device;for(;;){if(r.getProgramParameter(this.handle,37297))return;await i(10)}}_areTexturesRenderable(){let i=!0;for(const n of this.shaderLayout.bindings)!this.bindings[n.name]&&!this.bindings[n.name.replace(/Uniforms$/,"")]&&(se.warn(`Binding ${n.name} not found in ${this.id}`)(),i=!1);return i}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:i}=this.device;i.useProgram(this.handle);let n=0,r=0;for(const o of this.shaderLayout.bindings){const c=this.bindings[o.name]||this.bindings[o.name.replace(/Uniforms$/,"")];if(!c)throw new Error(`No value for binding ${o.name} in ${this.id}`);switch(o.type){case"uniform":const{name:f}=o,h=i.getUniformBlockIndex(this.handle,f);if(h===4294967295)throw new Error(`Invalid uniform block name ${f}`);i.uniformBlockBinding(this.handle,r,h),c instanceof Za?i.bindBufferBase(35345,r,c.handle):i.bindBufferRange(35345,r,c.buffer.handle,c.offset||0,c.size||c.buffer.byteLength-c.offset),r+=1;break;case"texture":if(!(c instanceof yr||c instanceof Qa||c instanceof Ka))throw new Error("texture");let g;if(c instanceof yr)g=c.texture;else if(c instanceof Qa)g=c;else if(c instanceof Ka&&c.colorAttachments[0]instanceof yr)se.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),g=c.colorAttachments[0].texture;else throw new Error("No texture");i.activeTexture(33984+n),i.bindTexture(g.glTarget,g.handle),n+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${o.type}' not supported in WebGL`)}}}_applyUniforms(){for(const i of this.shaderLayout.uniforms||[]){const{name:n,location:r,type:o,textureUnit:c}=i,f=this.uniforms[n]??c;f!==void 0&&aD(this.device.gl,r,o,f)}}}function hD(t,e){const i={...t,attributes:t.attributes.map(n=>({...n}))};for(const n of(e==null?void 0:e.attributes)||[]){const r=i.attributes.find(o=>o.name===n.name);r?(r.type=n.type||r.type,r.stepMode=n.stepMode||r.stepMode):se.warn(`shader layout attribute ${n.name} not present in shader`)}return i}class dD extends Bd{constructor(i){super(i,{});v(this,"device");v(this,"commands",[]);this.device=i}submitCommands(i=this.commands){for(const n of i)switch(n.name){case"copy-buffer-to-buffer":gD(this.device,n.options);break;case"copy-buffer-to-texture":pD(this.device,n.options);break;case"copy-texture-to-buffer":_D(this.device,n.options);break;case"copy-texture-to-texture":mD(this.device,n.options);break;default:throw new Error(n.name)}}}function gD(t,e){const i=e.sourceBuffer,n=e.destinationBuffer;t.gl.bindBuffer(36662,i.handle),t.gl.bindBuffer(36663,n.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function pD(t,e){throw new Error("Not implemented")}function _D(t,e){const{sourceTexture:i,mipLevel:n=0,aspect:r="all",width:o=e.sourceTexture.width,height:c=e.sourceTexture.height,depthOrArrayLayers:f=0,origin:h=[0,0],destinationBuffer:g,byteOffset:_=0,bytesPerRow:m,rowsPerImage:y}=e;if(r!=="all")throw new Error("aspect not supported in WebGL");if(n!==0||f!==0||m||y)throw new Error("not implemented");const{framebuffer:T,destroyFramebuffer:R}=$S(i);let x;try{const O=g,N=o||T.width,B=c||T.height,P=US(T.colorAttachments[0].texture.props.format),j=P.format,z=P.type;t.gl.bindBuffer(35051,O.handle),x=t.gl.bindFramebuffer(36160,T.handle),t.gl.readPixels(h[0],h[1],N,B,j,z,_)}finally{t.gl.bindBuffer(35051,null),x!==void 0&&t.gl.bindFramebuffer(36160,x),R&&T.destroy()}}function mD(t,e){const{sourceTexture:i,destinationMipLevel:n=0,origin:r=[0,0],destinationOrigin:o=[0,0],destinationTexture:c}=e;let{width:f=e.destinationTexture.width,height:h=e.destinationTexture.height}=e;const{framebuffer:g,destroyFramebuffer:_}=$S(i),[m,y]=r,[T,R,x]=o,O=t.gl.bindFramebuffer(36160,g.handle);let N=null,B;if(c instanceof Qa)N=c,f=Number.isFinite(f)?f:N.width,h=Number.isFinite(h)?h:N.height,N.bind(0),B=N.glTarget;else throw new Error("invalid destination");switch(B){case 3553:case 34067:t.gl.copyTexSubImage2D(B,n,T,R,m,y,f,h);break;case 35866:case 32879:t.gl.copyTexSubImage3D(B,n,T,R,x,m,y,f,h);break}N&&N.unbind(),t.gl.bindFramebuffer(36160,O),_&&g.destroy()}function $S(t){if(t instanceof et){const{width:e,height:i,id:n}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${n}`,width:e,height:i,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class yD extends kd{constructor(i,n){super(i,n);v(this,"device");v(this,"commandBuffer");this.device=i,this.commandBuffer=new dD(i)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(i){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:i})}copyBufferToTexture(i){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:i})}copyTextureToBuffer(i){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:i})}copyTextureToTexture(i){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:i})}pushDebugGroup(i){}popDebugGroup(){}insertDebugMarker(i){}resolveQuerySet(i,n,r){}}function bD(t){const{target:e,source:i,start:n=0,count:r=1}=t,o=i.length,c=r*o;let f=0;for(let h=n;f<o;f++)e[h++]=i[f];for(;f<c;)f<c-f?(e.copyWithin(n+f,n,n+f),f*=2):(e.copyWithin(n+f,n,n+c-f),f=c);return t.target}class Hg extends Ud{constructor(i,n){super(i,n);v(this,"device");v(this,"handle");v(this,"buffer",null);v(this,"bufferValue",null);this.device=i,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(i){return Fw()==="Chrome"}destroy(){var i;super.destroy(),this.buffer&&((i=this.buffer)==null||i.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(i){const n=i;if(n&&n.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,n?n.handle:null),this.indexBuffer=n,this.device.gl.bindVertexArray(null)}setBuffer(i,n){const r=n;if(r.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:o,type:c,stride:f,offset:h,normalized:g,integer:_,divisor:m}=this._getAccessor(i);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,r.handle),_?this.device.gl.vertexAttribIPointer(i,o,c,f,h):this.device.gl.vertexAttribPointer(i,o,c,g,f,h),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(i),this.device.gl.vertexAttribDivisor(i,m||0),this.attributes[i]=r,this.device.gl.bindVertexArray(null)}setConstantWebGL(i,n){this._enable(i,!1),this.attributes[i]=n}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let i=0;i<this.maxVertexAttributes;++i){const n=this.attributes[i];ArrayBuffer.isView(n)&&this.device.setConstantAttributeWebGL(i,n)}}_getAccessor(i){const n=this.attributeInfos[i];if(!n)throw new Error(`Unknown attribute location ${i}`);const r=BS(n.bufferDataType);return{size:n.bufferComponents,type:r,stride:n.byteStride,offset:n.byteOffset,normalized:n.normalized,integer:n.integer,divisor:n.stepMode==="instance"?1:0}}_enable(i,n=!0){const o=Hg.isConstantAttributeZeroSupported(this.device)||i!==0;(n||o)&&(i=Number(i),this.device.gl.bindVertexArray(this.handle),n?this.device.gl.enableVertexAttribArray(i):this.device.gl.disableVertexAttribArray(i),this.device.gl.bindVertexArray(null))}getConstantBuffer(i,n){const r=vD(n),o=r.byteLength*i,c=r.length*i;if(this.buffer&&o!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${o} !== ${this.buffer.byteLength}.`);let f=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:o}),f=f||!TD(r,this.bufferValue),f){const h=E2(n.constructor,c);bD({target:h,source:r,start:0,count:c}),this.buffer.write(h),this.bufferValue=n}return this.buffer}}function vD(t){return Array.isArray(t)?new Float32Array(t):t}function TD(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}class SD extends Fd{constructor(i,n){super(i,n);v(this,"device");v(this,"gl");v(this,"handle");v(this,"layout");v(this,"buffers",{});v(this,"unusedBuffers",{});v(this,"bindOnUse",!0);v(this,"_bound",!1);this.device=i,this.gl=i.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,n.buffers&&this.setBuffers(n.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(i="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(uD(i))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(i){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const n in i)this.setBuffer(n,i[n])})}setBuffer(i,n){const r=this._getVaryingIndex(i),{buffer:o,byteLength:c,byteOffset:f}=this._getBufferRange(n);if(r<0){this.unusedBuffers[i]=o,se.warn(`${this.id} unusedBuffers varying buffer ${i}`)();return}this.buffers[r]={buffer:o,byteLength:c,byteOffset:f},this.bindOnUse||this._bindBuffer(r,o,f,c)}getBuffer(i){if(zb(i))return this.buffers[i]||null;const n=this._getVaryingIndex(i);return n>=0?this.buffers[n]:null}bind(i=this.handle){if(typeof i!="function")return this.gl.bindTransformFeedback(36386,i),this;let n;return this._bound?n=i():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,n=i(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),n}unbind(){this.bind(null)}_getBufferRange(i){if(i instanceof Za)return{buffer:i,byteOffset:0,byteLength:i.byteLength};const{buffer:n,byteOffset:r=0,byteLength:o=i.buffer.byteLength}=i;return{buffer:n,byteOffset:r,byteLength:o}}_getVaryingIndex(i){if(zb(i))return Number(i);for(const n of this.layout.varyings)if(i===n.name)return n.location;return-1}_bindBuffers(){for(const i in this.buffers){const{buffer:n,byteLength:r,byteOffset:o}=this._getBufferRange(this.buffers[i]);this._bindBuffer(Number(i),n,o,r)}}_unbindBuffers(){for(const i in this.buffers)this.gl.bindBufferBase(35982,Number(i),null)}_bindBuffer(i,n,r=0,o){const c=n&&n.handle;!c||o===void 0?this.gl.bindBufferBase(35982,i,c):this.gl.bindBufferRange(35982,i,c,r,o)}}function zb(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class AD extends Ld{constructor(i,n){super(i,n);v(this,"device");v(this,"handle");v(this,"target",null);v(this,"_queryPending",!1);v(this,"_pollingPromise",null);if(this.device=i,n.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(i){return this._begin(i!=null&&i.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(i){this._queryPending||(this.target=i,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const i=this.device.gl.getQueryParameter(this.handle,34919);return i&&(this._queryPending=!1),i}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(i=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((r,o)=>{const c=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):n++>i?(o("Timed out"),this._pollingPromise=null):requestAnimationFrame(c)};requestAnimationFrame(c)}),this._pollingPromise}}class Nn extends Dn{constructor(i){var m,y;super({...i,id:i.id||wI("webgl-device")});v(this,"type","webgl");v(this,"handle");v(this,"features");v(this,"limits");v(this,"info");v(this,"canvasContext");v(this,"lost");v(this,"_resolveContextLost");v(this,"gl");v(this,"debug",!1);v(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});v(this,"_extensions",{});v(this,"_polyfilled",!1);v(this,"spectorJS");v(this,"renderPass",null);v(this,"_constants");const n=Dn._getCanvasContextProps(i);if(!n)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let r=(y=(m=n.canvas)==null?void 0:m.gl)==null?void 0:y.device;if(r)throw new Error(`WebGL context already attached to device ${r.id}`);this.canvasContext=new gI(this,n),this.lost=new Promise(T=>{this._resolveContextLost=T});const o={...i.webgl};n.alphaMode==="premultiplied"&&(o.premultipliedAlpha=!0),i.powerPreference!==void 0&&(o.powerPreference=i.powerPreference);const f=this.props._handle||qN(this.canvasContext.canvas,{onContextLost:T=>{var R;return(R=this._resolveContextLost)==null?void 0:R.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:T=>console.log("WebGL context restored")},o);if(!f)throw new Error("WebGL context creation failed");if(r=f.device,r){if(i._reuseDevices)return se.log(1,`Not creating a new Device, instead returning a reference to Device ${r.id} already attached to WebGL context`,r)(),r._reused=!0,r;throw new Error(`WebGL context already attached to device ${r.id}`)}this.handle=f,this.gl=f,this.spectorJS=mI({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=KN(this.gl,this._extensions),this.limits=new fI(this.gl),this.features=new uI(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),n.autoResize!==!1&&this.canvasContext.resize(),new _s(this.gl,{log:(...T)=>se.log(1,...T)()}).trackState(this.gl,{copyState:!1});const g=i.debugWebGL||i.debug,_=i.debugWebGL;g&&(this.gl=vI(this.gl,{debugWebGL:g,traceWebGL:_}),se.warn("WebGL debug mode activated. Performance reduced.")(),i.debugWebGL&&(se.level=Math.max(se.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(i){throw new Error("WebGL only supports a single canvas")}createBuffer(i){const n=this._normalizeBufferProps(i);return new Za(this,n)}createTexture(i){return new Qa(this,i)}createExternalTexture(i){throw new Error("createExternalTexture() not implemented")}createSampler(i){return new ag(this,i)}createShader(i){return new MI(this,i)}createFramebuffer(i){return new Ka(this,i)}createVertexArray(i){return new Hg(this,i)}createTransformFeedback(i){return new SD(this,i)}createQuerySet(i){return new AD(this,i)}createRenderPipeline(i){return new fD(this,i)}beginRenderPass(i){return new qI(this,i)}createComputePipeline(i){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(i){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(i={}){return new yD(this,i)}submit(){var i;(i=this.renderPass)==null||i.end(),this.renderPass=null}readPixelsToArrayWebGL(i,n){return jI(i,n)}readPixelsToBufferWebGL(i,n){return WI(i,n)}setParametersWebGL(i){Fr(this.gl,i)}getParametersWebGL(i){return DS(this.gl,i)}withParametersWebGL(i,n){return kc(this.gl,i,n)}resetWebGL(){se.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),jN(this.gl)}_getDeviceSpecificTextureFormatCapabilities(i){return aI(this.gl,i,this._extensions)}loseDevice(){var o;let i=!1;const r=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return r&&(i=!0,r.loseContext()),(o=this._resolveContextLost)==null||o.call(this,{reason:"destroyed",message:"Application triggered context loss"}),i}pushState(){_s.get(this.gl).push()}popState(){_s.get(this.gl).pop()}setSpectorMetadata(i,n){i.__SPECTOR_Metadata=n}getGLKey(i,n){const r=Number(i);for(const o in this.gl)if(this.gl[o]===r)return`GL.${o}`;return n!=null&&n.emptyIfUnknown?"":String(i)}getGLKeys(i){const n={emptyIfUnknown:!0};return Object.entries(i).reduce((r,[o,c])=>(r[`${o}:${this.getGLKey(o,n)}`]=`${c}:${this.getGLKey(c,n)}`,r),{})}setConstantAttributeWebGL(i,n){const r=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(r).fill(null);const o=this._constants[i];switch(o&&xD(o,n)&&se.info(1,`setConstantAttributeWebGL(${i}) could have been skipped, value unchanged`)(),this._constants[i]=n,n.constructor){case Float32Array:ED(this,i,n);break;case Int32Array:wD(this,i,n);break;case Uint32Array:RD(this,i,n);break;default:throw new Error("constant")}}getExtension(i){return Br(this.gl,i,this._extensions),this._extensions}}function ED(t,e,i){switch(i.length){case 1:t.gl.vertexAttrib1fv(e,i);break;case 2:t.gl.vertexAttrib2fv(e,i);break;case 3:t.gl.vertexAttrib3fv(e,i);break;case 4:t.gl.vertexAttrib4fv(e,i);break}}function wD(t,e,i){t.gl.vertexAttribI4iv(e,i)}function RD(t,e,i){t.gl.vertexAttribI4uiv(e,i)}function xD(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}const CD={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},MD=t=>({drawBuffersWEBGL(e){return t.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),OD=t=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return t.createVertexArray()},deleteVertexArrayOES(e){return t.deleteVertexArray(e)},isVertexArrayOES(e){return t.isVertexArray(e)},bindVertexArrayOES(e){return t.bindVertexArray(e)}}),PD=t=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return t.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return t.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return t.vertexAttribDivisor(...e)}});function ND(t=!0){const e=HTMLCanvasElement.prototype;if(!t&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(i,n){if(i==="webgl"||i==="experimental-webgl"){const r=this.originalGetContext("webgl2",n);return r instanceof HTMLElement&&ID(r),r}return this.originalGetContext(i,n)}}function ID(t){t.getExtension("EXT_color_buffer_float");const e={...CD,WEBGL_disjoint_timer_query:t.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:MD(t),OES_vertex_array_object:OD(t),ANGLE_instanced_arrays:PD(t)},i=t.getExtension;t.getExtension=function(r){const o=i.call(t,r);return o||(r in e?e[r]:null)};const n=t.getSupportedExtensions;t.getSupportedExtensions=function(){const r=n.apply(t)||[];return r==null?void 0:r.concat(Object.keys(e))}}const $l=1;class DD extends e2{constructor(){super();v(this,"type","webgl");Dn.defaultProps={...Dn.defaultProps,...Vg},Nn.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(i){ND(i)}async attach(i){if(i instanceof Nn)return i;if((i==null?void 0:i.device)instanceof Dn)return i.device;if(!kD(i))throw new Error("Invalid WebGL2RenderingContext");return new Nn({_handle:i,createCanvasContext:{canvas:i.canvas,autoResize:!1}})}async create(i={}){se.groupCollapsed($l,"WebGLDevice created")();const n=[];(i.debugWebGL||i.debug)&&n.push(bI()),i.debugSpectorJS&&n.push(_I(i));const r=await Promise.allSettled(n);for(const f of r)f.status==="rejected"&&se.error(`Failed to initialize debug libraries ${f.reason}`)();const o=new Nn(i),c=`${o._reused?"Reusing":"Created"} device with WebGL2 ${o.debug?"debug ":""}context: ${o.info.vendor}, ${o.info.renderer} for canvas: ${o.canvasContext.id}`;return se.probe($l,c)(),se.table($l,o.info)(),se.groupEnd($l)(),o}}function kD(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}const Vb=new DD;function Rn(){}const BD=({isDragging:t})=>t?"grabbing":"grab",YS={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Rn,onWebGLInitialized:Rn,onResize:Rn,onViewStateChange:Rn,onInteractionStateChange:Rn,onBeforeRender:Rn,onAfterRender:Rn,onLoad:Rn,onError:t=>Oe.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:BD,getTooltip:null,debug:!1,drawPickingColors:!1};class jg{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new cu({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=n=>{const{_pickRequest:r}=this;if(n.type==="pointerleave")r.x=-1,r.y=-1,r.radius=0;else{if(n.leftButton||n.rightButton)return;{const o=n.offsetCenter;if(!o)return;r.x=o.x,r.y=o.y,r.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:r.x,y:r.y}),r.event=n},this._onEvent=n=>{const r=Kd[n.type],o=n.offsetCenter;if(!r||!o||!this.layerManager)return;const c=this.layerManager.getLayers(),f=this.deckPicker.getLastPickedObject({x:o.x,y:o.y,layers:c,viewports:this.getViewports(o)},this._lastPointerDownInfo),{layer:h}=f,g=h&&(h[r]||h.props[r]),_=this.props[r];let m=!1;g&&(m=g.call(h,f,n)),m||(_==null||_(f,n),this.widgetManager.onEvent(f,n))},this._onPointerDown=n=>{const r=n.offsetCenter,o=this._pick("pickObject","pickObject Time",{x:r.x,y:r.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=o.result[0]||o.emptyInfo},this.props={...YS,...e},e=this.props,e.viewState&&e.initialViewState&&Oe.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let i=this.device;!i&&e.gl&&(e.gl instanceof WebGLRenderingContext&&Oe.error("WebGL1 context not supported.")(),i=Vb.attach(e.gl)),i||(i=Nd.createDevice({type:"best-available",_reuseDevices:!0,adapters:[Vb],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(i,e),this.setProps(e),e._typedArrayManagerProps&&Nr.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,i,n,r,o,c,f,h,g,_;(e=this.animationLoop)==null||e.stop(),(i=this.animationLoop)==null||i.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(n=this.layerManager)==null||n.finalize(),this.layerManager=null,(r=this.viewManager)==null||r.finalize(),this.viewManager=null,(o=this.effectManager)==null||o.finalize(),this.effectManager=null,(c=this.deckRenderer)==null||c.finalize(),this.deckRenderer=null,(f=this.deckPicker)==null||f.finalize(),this.deckPicker=null,(h=this.eventManager)==null||h.destroy(),this.eventManager=null,(g=this.widgetManager)==null||g.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((_=this.canvas.parentElement)==null||_.removeChild(this.canvas),this.canvas=null)}setProps(e){var n;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Oe.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Oe.removed("onLayerClick","onClick")(),e.initialViewState&&!hi(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const i=Object.create(this.props);Object.assign(i,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(n=this.animationLoop)==null||n.setProps(i),this.layerManager&&(this.viewManager.setProps(i),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(i),this.effectManager.setProps(i),this.deckRenderer.setProps(i),this.deckPicker.setProps(i),this.widgetManager.setProps(i)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let i=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(e),r=this.layerManager.needsRedraw(e),o=this.effectManager.needsRedraw(e),c=this.deckRenderer.needsRedraw(e);return i=i||n||r||o||c,i}redraw(e){if(!this.layerManager)return;let i=this.needsRedraw({clearRedrawFlags:!0});i=e||i,i&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(i):this._drawLayers(i))}get isInitialized(){return this.viewManager!==null}getViews(){return vt(this.viewManager),this.viewManager.views}getViewports(e){return vt(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const i=this._pick("pickObject","pickObject Time",e).result;return i.length?i[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,i=!1){for(const n in e)this.layerManager.resourceManager.add({resourceId:n,data:e[n],forceUpdate:i})}_removeResources(e){for(const i of e)this.layerManager.resourceManager.remove(i)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var i;(i=this.layerManager)==null||i.removeDefaultShaderModule(e)}_pick(e,i,n){vt(this.deckPicker);const{stats:r}=this;r.get("Pick Count").incrementCount(),r.get(i).timeStart();const o=this.deckPicker[e]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return r.get(i).timeEnd(),o}_createCanvas(e){let i=e.canvas;return typeof i=="string"&&(i=document.getElementById(i),vt(i)),i||(i=document.createElement("canvas"),i.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(i)),Object.assign(i.style,e.style),i}_setCanvasSize(e){var r;if(!this.canvas)return;const{width:i,height:n}=e;if(i||i===0){const o=Number.isFinite(i)?`${i}px`:i;this.canvas.style.width=o}if(n||n===0){const o=Number.isFinite(n)?`${n}px`:n;this.canvas.style.position=((r=e.style)==null?void 0:r.position)||"absolute",this.canvas.style.height=o}}_updateCanvasSize(){var r,o;const{canvas:e}=this;if(!e)return;const i=e.clientWidth??e.width,n=e.clientHeight??e.height;(i!==this.width||n!==this.height)&&(this.width=i,this.height=n,(r=this.viewManager)==null||r.setProps({width:i,height:n}),(o=this.layerManager)==null||o.activateViewport(this.getViewports()[0]),this.props.onResize({width:i,height:n}))}_createAnimationLoop(e,i){const{gl:n,onError:r,useDevicePixels:o}=i;return new LP({device:e,useDevicePixels:o,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:c=>this._setDevice(c.device),onRender:this._onRenderFrame.bind(this),onError:r})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,i=Array.isArray(e)?e:e?[e]:[new PS({id:"default-view"})];return i.length&&this.props.controller&&(i[0].props.controller=this.props.controller),i}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var i,n,r;const{_pickRequest:e}=this;if(e.event){const{result:o,emptyInfo:c}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=o.length>0;let f=c,h=!1;for(const g of o)f=g,h=((i=g.layer)==null?void 0:i.onHover(g,e.event))||h;h||((r=(n=this.props).onHover)==null||r.call(n,f,e.event),this.widgetManager.onHover(f,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var r,o;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(r=this.device.canvasContext)==null?void 0:r.canvas),this.device instanceof Nn&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof Nn&&this.props.onWebGLInitialized(this.device.gl);const i=new ES;i.play(),this.animationLoop.attachTimeline(i),this.eventManager=new SO(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(ob).map(c=>{var T;const[f,h,g,_]=ob[c],m=(T=this.props.eventRecognizerOptions)==null?void 0:T[c],y={...h,...m,event:c};return{recognizer:new f(y),recognizeWith:g,requestFailure:_}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const c in Kd)this.eventManager.on(c,this._onEvent);this.viewManager=new cN({timeline:i,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new lN(this.device,{deck:this,stats:this.stats,viewport:n,timeline:i}),this.effectManager=new wN({deck:this,device:this.device}),this.deckRenderer=new CN(this.device),this.deckPicker=new DN(this.device),this.widgetManager=new UN({deck:this,parentElement:(o=this.canvas)==null?void 0:o.parentElement}),this.widgetManager.addDefault(new LN),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,i){var c;const{device:n,gl:r}=this.layerManager.context;this.props.onBeforeRender({device:n,gl:r});const o={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...i};(c=this.deckRenderer)==null||c.renderLayers(o),o.pass==="screen"&&this.widgetManager.onRedraw({viewports:o.viewports,layers:o.layers}),this.props.onAfterRender({device:n,gl:r})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Oe.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const i=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:i},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const i=this.animationLoop.stats;e.get("GPU Time").addTime(i.get("GPU Time").lastTiming),e.get("CPU Time").addTime(i.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:i}=this;e.fps=i.get("frameRate").getHz(),e.setPropsTime=i.get("setProps Time").time,e.updateAttributesTime=i.get("Update Attributes").time,e.framesRedrawn=i.get("Redraw Count").count,e.pickTime=i.get("pickObject Time").time+i.get("pickMultipleObjects Time").time+i.get("pickObjects Time").time,e.pickCount=i.get("Pick Count").count,e.gpuTime=i.get("GPU Time").time,e.cpuTime=i.get("CPU Time").time,e.gpuTimePerFrame=i.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=i.get("CPU Time").getAverageTime();const n=Nd.stats.get("Memory Usage");e.bufferMemory=n.get("Buffer Memory").count,e.textureMemory=n.get("Texture Memory").count,e.renderbufferMemory=n.get("Renderbuffer Memory").count,e.gpuMemory=n.get("GPU Memory").count}}jg.defaultProps=YS;jg.VERSION=rx;function UD(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return VT(t)}}const FD=zT;function Yl(t,e){return{attribute:t,format:e.size>1?`${e.type}x${e.size}`:e.type,byteOffset:e.offset||0}}function hs(t){return t.stride||t.size*t.bytesPerElement}function LD(t,e){return t.type===e.type&&t.size===e.size&&hs(t)===hs(e)&&(t.offset||0)===(e.offset||0)}function og(t,e){e.offset&&Oe.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const i=hs(t),n=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,r=e.elementOffset||0,o=n*i+r*t.bytesPerElement+(t.offset||0);return{...e,offset:o,stride:i}}function zD(t,e){const i=og(t,e);return{high:i,low:{...i,offset:i.offset+t.size*4}}}class VD{constructor(e,i,n){this._buffer=null,this.device=e,this.id=i.id||"",this.size=i.size||1;const r=i.logicalType||i.type,o=r==="float64";let{defaultValue:c}=i;c=Number.isFinite(c)?[c]:c||new Array(this.size).fill(0);let f;o?f="float32":!r&&i.isIndexed?f="uint32":f=r||"float32";let h=UD(r||f);this.doublePrecision=o,o&&i.fp64===!1&&(h=Float32Array),this.value=null,this.settings={...i,defaultType:h,defaultValue:c,logicalType:r,type:f,normalized:f.includes("norm"),size:this.size,bytesPerElement:h.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*hs(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Nr.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,i=null){const n={};if(this.state.constant){const r=this.value;if(i){const o=og(this.getAccessor(),i),c=o.offset/r.BYTES_PER_ELEMENT,f=o.size||this.size;n[e]=r.subarray(c,c+f)}else n[e]=r}else n[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${e}64Low`]=n[e]:n[`${e}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(e=this.id,i=null){const n=this.getAccessor(),r=[],o={name:this.id,byteStride:hs(n),attributes:r};if(this.doublePrecision){const c=zD(n,i||{});r.push(Yl(e,{...n,...c.high}),Yl(`${e}64Low`,{...n,...c.low}))}else if(i){const c=og(n,i);r.push(Yl(e,{...n,...c}))}else r.push(Yl(e,n));return o}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const i=Array.from(this.value);e=[i,i]}else{const{value:i,numInstances:n,size:r}=this,o=n*r;if(i&&o&&i.length>=o){const c=new Array(r).fill(1/0),f=new Array(r).fill(-1/0);for(let h=0;h<o;)for(let g=0;g<r;g++){const _=i[h++];_<c[g]&&(c[g]=_),_>f[g]&&(f[g]=_)}e=[c,f]}}return this.state.bounds=e,e}setData(e){const{state:i}=this;let n;ArrayBuffer.isView(e)?n={value:e}:e instanceof $e?n={buffer:e}:n=e;const r={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)r.type="float32";else{const c=FD(n.value);r.type=r.normalized?c.replace("int","norm"):c}r.bytesPerElement=n.value.BYTES_PER_ELEMENT,r.stride=hs(r)}if(i.bounds=null,n.constant){let o=n.value;if(o=this._normalizeValue(o,[],0),this.settings.normalized&&(o=this.normalizeConstant(o)),!(!i.constant||!this._areValuesEqual(o,this.value)))return!1;i.externalBuffer=null,i.constant=!0,this.value=ArrayBuffer.isView(o)?o:new Float32Array(o)}else if(n.buffer){const o=n.buffer;i.externalBuffer=o,i.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let o=n.value;i.externalBuffer=null,i.constant=!1,this.value=o;let{buffer:c}=this;const f=hs(r),h=(r.vertexOffset||0)*f;if(this.doublePrecision&&o instanceof Float64Array&&(o=sd(o,r)),this.settings.isIndexed){const _=this.settings.defaultType;o.constructor!==_&&(o=new _(o))}const g=o.byteLength+h+f*2;(!c||c.byteLength<g)&&(c=this._createBuffer(g)),c.write(o,h)}return this.setAccessor(r),!0}updateSubBuffer(e={}){this.state.bounds=null;const i=this.value,{startOffset:n=0,endOffset:r}=e;this.buffer.write(this.doublePrecision&&i instanceof Float64Array?sd(i,{size:this.size,startIndex:n,endIndex:r}):i.subarray(n,r),n*i.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,i=!1){const{state:n}=this,r=n.allocatedValue,o=Nr.allocate(r,e+1,{size:this.size,type:this.settings.defaultType,copy:i});this.value=o;const{byteOffset:c}=this;let{buffer:f}=this;return(!f||f.byteLength<o.byteLength+c)&&(f=this._createBuffer(o.byteLength+c),i&&r&&f.write(r instanceof Float64Array?sd(r,this):r,c)),n.allocatedValue=o,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:i}=e;if(!ArrayBuffer.isView(i))throw new Error(`Attribute ${this.id} value is not TypedArray`);const n=this.settings.defaultType;let r=!1;if(this.doublePrecision&&(r=i.BYTES_PER_ELEMENT<4),r)throw new Error(`Attribute ${this.id} does not support ${i.constructor.name}`);!(i instanceof n)&&this.settings.normalized&&!("normalized"in e)&&Oe.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(i=>(i+128)/255*2-1);case"snorm16":return new Float32Array(e).map(i=>(i+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(i=>i/255);case"unorm16":return new Float32Array(e).map(i=>i/65535);default:return e}}_normalizeValue(e,i,n){const{defaultValue:r,size:o}=this.settings;if(Number.isFinite(e))return i[n]=e,i;if(!e){let c=o;for(;--c>=0;)i[n+c]=r[c];return i}switch(o){case 4:i[n+3]=Number.isFinite(e[3])?e[3]:r[3];case 3:i[n+2]=Number.isFinite(e[2])?e[2]:r[2];case 2:i[n+1]=Number.isFinite(e[1])?e[1]:r[1];case 1:i[n+0]=Number.isFinite(e[0])?e[0]:r[0];break;default:let c=o;for(;--c>=0;)i[n+c]=Number.isFinite(e[c])?e[c]:r[c]}return i}_areValuesEqual(e,i){if(!e||!i)return!1;const{size:n}=this;for(let r=0;r<n;r++)if(e[r]!==i[r])return!1;return!0}_createBuffer(e){var r;this._buffer&&this._buffer.destroy();const{isIndexed:i,type:n}=this.settings;return this._buffer=this.device.createBuffer({...(r=this._buffer)==null?void 0:r.props,id:this.id,usage:i?$e.INDEX:$e.VERTEX,indexType:i?n:void 0,byteLength:e}),this._buffer}}const Hb=[],jb=[];function pu(t,e=0,i=1/0){let n=Hb;const r={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?n=t:t.length>0&&(jb.length=t.length,n=jb):n=Hb,(e>0||Number.isFinite(i))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(e,i),r.index=e-1),{iterable:n,objectInfo:r}}function qS(t){return t&&t[Symbol.asyncIterator]}function KS(t,e){const{size:i,stride:n,offset:r,startIndices:o,nested:c}=e,f=t.BYTES_PER_ELEMENT,h=n?n/f:i,g=r?r/f:0,_=Math.floor((t.length-g)/h);return(m,{index:y,target:T})=>{if(!o){const N=y*h+g;for(let B=0;B<i;B++)T[B]=t[N+B];return T}const R=o[y],x=o[y+1]||_;let O;if(c){O=new Array(x-R);for(let N=R;N<x;N++){const B=N*h+g;T=new Array(i);for(let P=0;P<i;P++)T[P]=t[B+P];O[N-R]=T}}else if(h===i)O=t.subarray(R*i+g,x*i+g);else{O=new t.constructor((x-R)*i);let N=0;for(let B=R;B<x;B++){const P=B*h+g;for(let j=0;j<i;j++)O[N++]=t[P+j]}}return O}}const HD=[],ac=[[0,1/0]];function jD(t,e){if(t===ac||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const i=[],n=t.length;let r=0;for(let o=0;o<n;o++){const c=t[o];c[1]<e[0]?(i.push(c),r=o+1):c[0]>e[1]?i.push(c):e=[Math.min(c[0],e[0]),Math.max(c[1],e[1])]}return i.splice(r,0,e),i}const WD={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function ZS(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const i=t.type||"interpolation";return{...WD[i],...e,...t,type:i}}class QS extends VD{constructor(e,i){super(e,i,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:ac}),this.constant=!1,this.settings.update=i.update||(i.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const i=this.state.needsRedraw;return this.state.needsRedraw=i&&!e,i}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var i;(i=this.state).layoutChanged||(i.layoutChanged=!LD(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:i}=this.settings,n=this.settings.transition,r=Array.isArray(i)?e[i.find(o=>e[o])]:e[i];return ZS(r,n)}setNeedsUpdate(e=this.id,i){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),i){const{startRow:n=0,endRow:r=1/0}=i;this.state.updateRanges=jD(this.state.updateRanges,[n,r])}else this.state.updateRanges=ac}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=HD}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:i,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(e,i.updateRanges!==ac),!0):!1}updateBuffer({numInstances:e,data:i,props:n,context:r}){if(!this.needsUpdate())return!1;const{state:{updateRanges:o},settings:{update:c,noAlloc:f}}=this;let h=!0;if(c){for(const[g,_]of o)c.call(r,this,{data:i,startRow:g,endRow:_,props:n,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[g,_]of o){const m=Number.isFinite(g)?this.getVertexOffset(g):0,y=Number.isFinite(_)?this.getVertexOffset(_):f||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:m,endOffset:y})}this._checkAttributeArray()}else h=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),h}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:i}=this;return e?(this.clearNeedsUpdate(),i.lastExternalBuffer===e||(i.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(i.lastExternalBuffer=null,!1)}setBinaryValue(e,i=null){const{state:n,settings:r}=this;if(!e)return n.binaryValue=null,n.binaryAccessor=null,!1;if(r.noAlloc)return!1;if(n.binaryValue===e)return this.clearNeedsUpdate(),!0;if(n.binaryValue=e,this.setNeedsRedraw(),r.transform||i!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const c=e;vt(ArrayBuffer.isView(c.value),`invalid ${r.accessor}`);const f=!!c.size&&c.size!==this.size;return n.binaryAccessor=KS(c.value,{size:c.size||this.size,stride:c.stride,offset:c.offset,startIndices:i,nested:f}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:i}=this;return(i?e<i.length?i[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,i=super.getValue();if(!e)return i;for(const n in e)Object.assign(i,super.getValue(n,e[n]));return i}getBufferLayout(e){this.state.layoutChanged=!1;const i=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:r}=this.settings;if(r==="dynamic"?n.stepMode=e?e.isInstanced?"instance":"vertex":"instance":n.stepMode=r??"vertex",!i)return n;for(const o in i){const c=super._getBufferLayout(o,i[o]);n.attributes.push(...c.attributes)}return n}_autoUpdater(e,{data:i,startRow:n,endRow:r,props:o,numInstances:c}){if(e.constant)return;const{settings:f,state:h,value:g,size:_,startIndices:m}=e,{accessor:y,transform:T}=f,R=h.binaryAccessor||(typeof y=="function"?y:o[y]);vt(typeof R=="function",`accessor "${y}" is not a function`);let x=e.getVertexOffset(n);const{iterable:O,objectInfo:N}=pu(i,n,r);for(const B of O){N.index++;let P=R(B,N);if(T&&(P=T.call(this,P)),m){const j=(N.index<m.length-1?m[N.index+1]:c)-m[N.index];if(P&&Array.isArray(P[0])){let z=x;for(const q of P)e._normalizeValue(q,g,z),z+=_}else P&&P.length>_?g.set(P,x):(e._normalizeValue(P,N.target,0),nN({target:g,source:N.target,start:x,count:j}));x+=j*_}else e._normalizeValue(P,g,x),x+=_}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,i=Math.min(4,this.size);if(e&&e.length>=i){let n=!0;switch(i){case 4:n=n&&Number.isFinite(e[3]);case 3:n=n&&Number.isFinite(e[2]);case 2:n=n&&Number.isFinite(e[1]);case 1:n=n&&Number.isFinite(e[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function dd(t){const{source:e,target:i,start:n=0,size:r,getData:o}=t,c=t.end||i.length,f=e.length,h=c-n;if(f>h){i.set(e.subarray(0,h),n);return}if(i.set(e,n),!o)return;let g=f;for(;g<h;){const _=o(g,e);for(let m=0;m<r;m++)i[n+g]=_[m]||0,g++}}function XD({source:t,target:e,size:i,getData:n,sourceStartIndices:r,targetStartIndices:o}){if(!r||!o)return dd({source:t,target:e,size:i,getData:n}),e;let c=0,f=0;const h=n&&((_,m)=>n(_+f,m)),g=Math.min(r.length,o.length);for(let _=1;_<g;_++){const m=r[_]*i,y=o[_]*i;dd({source:t.subarray(c,m),target:e,start:f,end:y,size:i,getData:h}),c=m,f=y}return f<e.length&&dd({source:[],target:e,start:f,size:i,getData:h}),e}function $D(t){const{device:e,settings:i,value:n}=t,r=new QS(e,i);return r.setData({value:n instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:i.normalized}),r}function GS(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function JS(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function eA(t){t.push(t.shift())}function YD(t,e){const{doublePrecision:i,settings:n,value:r,size:o}=t,c=i&&r instanceof Float64Array?2:1;let f=0;const{shaderAttributes:h}=t.settings;if(h)for(const g of Object.values(h))f=Math.max(f,g.vertexOffset??0);return(n.noAlloc?r.length:(e+f)*o)*c}function tA({device:t,source:e,target:i}){return(!i||i.byteLength<e.byteLength)&&(i==null||i.destroy(),i=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),i}function iA({device:t,buffer:e,attribute:i,fromLength:n,toLength:r,fromStartIndices:o,getData:c=f=>f}){const f=i.doublePrecision&&i.value instanceof Float64Array?2:1,h=i.size*f,g=i.byteOffset,_=i.settings.bytesPerElement<4?g/i.settings.bytesPerElement*4:g,m=i.startIndices,y=o&&m,T=i.isConstant;if(!y&&e&&n>=r)return e;const R=i.value instanceof Float64Array?Float32Array:i.value.constructor,x=T?i.value:new R(i.getBuffer().readSyncWebGL(g,r*R.BYTES_PER_ELEMENT).buffer);if(i.settings.normalized&&!T){const P=c;c=(j,z)=>i.normalizeConstant(P(j,z))}const O=T?(P,j)=>c(x,j):(P,j)=>c(x.subarray(P+g,P+g+h),j),N=e?new Float32Array(e.readSyncWebGL(_,n*4).buffer):new Float32Array(0),B=new Float32Array(r);return XD({source:N,target:B,sourceStartIndices:o,targetStartIndices:m,size:h,getData:O}),(!e||e.byteLength<B.byteLength+_)&&(e==null||e.destroy(),e=t.createBuffer({byteLength:B.byteLength+_,usage:35050})),e.write(B,_),e}class nA{constructor({device:e,attribute:i,timeline:n}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new gu(n),this.attribute=i,this.attributeInTransition=$D(i),this.currentStartIndices=i.startIndices}get inProgress(){return this.transition.inProgress}start(e,i,n=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=YD(this.attribute,i),this.transition.start({...e,duration:n})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class qD extends nA{constructor({device:e,attribute:i,timeline:n}){super({device:e,attribute:i,timeline:n}),this.type="interpolation",this.transform=GD(e,i)}start(e,i){const n=this.currentLength,r=this.currentStartIndices;if(super.start(e,i,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:o,attribute:c}=this;eA(o),o[0]=iA({device:this.device,buffer:o[0],attribute:c,fromLength:n,toLength:this.currentLength,fromStartIndices:r,getData:e.enter}),o[1]=tA({device:this.device,source:o[0],target:o[1]}),this.setBuffer(o[1]);const{transform:f}=this,h=f.model;let g=Math.floor(this.currentLength/c.size);sA(c)&&(g/=2),h.setVertexCount(g),c.isConstant?(h.setAttributes({aFrom:o[0]}),h.setConstantAttributes({aTo:c.value})):h.setAttributes({aFrom:o[0],aTo:c.getBuffer()}),f.transformFeedback.setBuffers({vCurrent:o[1]})}onUpdate(){const{duration:e,easing:i}=this.settings,{time:n}=this.transition;let r=n/e;i&&(r=i(r));const{model:o}=this.transform,c={time:r};o.shaderInputs.setProps({interpolation:c}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const KD=`uniform interpolationUniforms {
  float time;
} interpolation;
`,Wb={name:"interpolation",vs:KD,uniformTypes:{time:"f32"}},ZD=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,QD=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function sA(t){return t.doublePrecision&&t.value instanceof Float64Array}function GD(t,e){const i=e.size,n=GS(i),r=JS(i),o=e.getBufferLayout();return sA(e)?new no(t,{vs:QD,bufferLayout:[{name:"aFrom",byteStride:8*i,attributes:[{attribute:"aFrom",format:r,byteOffset:0},{attribute:"aFrom64Low",format:r,byteOffset:4*i}]},{name:"aTo",byteStride:8*i,attributes:[{attribute:"aTo",format:r,byteOffset:0},{attribute:"aTo64Low",format:r,byteOffset:4*i}]}],modules:[gM,Wb],defines:{ATTRIBUTE_TYPE:n,ATTRIBUTE_SIZE:i},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new no(t,{vs:ZD,bufferLayout:[{name:"aFrom",format:r},{name:"aTo",format:o.attributes[0].format}],modules:[Wb],defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"],disableWarnings:!0})}class JD extends nA{constructor({device:e,attribute:i,timeline:n}){super({device:e,attribute:i,timeline:n}),this.type="spring",this.texture=r6(e),this.framebuffer=a6(e,this.texture),this.transform=s6(e,i)}start(e,i){const n=this.currentLength,r=this.currentStartIndices;super.start(e,i);const{buffers:o,attribute:c}=this;for(let h=0;h<2;h++)o[h]=iA({device:this.device,buffer:o[h],attribute:c,fromLength:n,toLength:this.currentLength,fromStartIndices:r,getData:e.enter});o[2]=tA({device:this.device,source:o[0],target:o[2]}),this.setBuffer(o[1]);const{model:f}=this.transform;f.setVertexCount(Math.floor(this.currentLength/c.size)),c.isConstant?f.setConstantAttributes({aTo:c.value}):f.setAttributes({aTo:c.getBuffer()})}onUpdate(){const{buffers:e,transform:i,framebuffer:n,transition:r}=this,o=this.settings;i.model.setAttributes({aPrev:e[0],aCur:e[1]}),i.transformFeedback.setBuffers({vNext:e[2]});const c={stiffness:o.stiffness,damping:o.damping};i.model.shaderInputs.setProps({spring:c}),i.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),eA(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||r.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const e6=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,t6={name:"spring",vs:e6,uniformTypes:{damping:"f32",stiffness:"f32"}},i6=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,n6=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function s6(t,e){const i=GS(e.size),n=JS(e.size);return new no(t,{vs:i6,fs:n6,bufferLayout:[{name:"aPrev",format:n},{name:"aCur",format:n},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[t6],defines:{ATTRIBUTE_TYPE:i},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function r6(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function a6(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const o6={interpolation:qD,spring:JD};class l6{constructor(e,{id:i,timeline:n}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=i,this.device=e,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:i,numInstances:n}){this.numInstances=n||1;for(const r in e){const o=e[r],c=o.getTransitionSetting(i);c&&this._updateAttribute(r,o,c)}for(const r in this.transitions){const o=e[r];(!o||!o.getTransitionSetting(i))&&this._removeTransition(r)}}hasAttribute(e){const i=this.transitions[e];return i&&i.inProgress}getAttributes(){const e={};for(const i in this.transitions){const n=this.transitions[i];n.inProgress&&(e[i]=n.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const i in this.transitions)this.transitions[i].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,i,n){const r=this.transitions[e];let o=!r||r.type!==n.type;if(o){r&&this._removeTransition(e);const c=o6[n.type];c?this.transitions[e]=new c({attribute:i,timeline:this.timeline,device:this.device}):(Oe.error(`unsupported transition type '${n.type}'`)(),o=!1)}(o||i.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(n,this.numInstances))}}const Xb="attributeManager.invalidate",c6="attributeManager.updateStart",u6="attributeManager.updateEnd",f6="attribute.updateStart",h6="attribute.allocate",d6="attribute.updateEnd";class g6{constructor(e,{id:i="attribute-manager",stats:n,timeline:r}={}){this.mergeBoundsMemoized=go(RP),this.id=i,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new l6(e,{id:`${i}-transitions`,timeline:r}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const i=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,i&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const i of e)this.attributes[i]!==void 0&&(this.attributes[i].delete(),delete this.attributes[i])}invalidate(e,i){const n=this._invalidateTrigger(e,i);Rt(Xb,this,e,n)}invalidateAll(e){for(const i in this.attributes)this.attributes[i].setNeedsUpdate(i,e);Rt(Xb,this,"all")}update({data:e,numInstances:i,startIndices:n=null,transitions:r,props:o={},buffers:c={},context:f={}}){let h=!1;Rt(c6,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const g in this.attributes){const _=this.attributes[g],m=_.settings.accessor;_.startIndices=n,_.numInstances=i,o[g]&&Oe.removed(`props.${g}`,`data.attributes.${g}`)(),_.setExternalBuffer(c[g])||_.setBinaryValue(typeof m=="string"?c[m]:void 0,e.startIndices)||typeof m=="string"&&!c[m]&&_.setConstantValue(o[m])||_.needsUpdate()&&(h=!0,this._updateAttribute({attribute:_,numInstances:i,data:e,props:o,context:f})),this.needsRedraw=this.needsRedraw||_.needsRedraw()}h&&Rt(u6,this,i),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:i,transitions:r})}updateTransition(){const{attributeTransitionManager:e}=this,i=e.run();return this.needsRedraw=this.needsRedraw||i,i}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const i=e.map(n=>{var r;return(r=this.attributes[n])==null?void 0:r.getBounds()});return this.mergeBoundsMemoized(i)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:i,attributeTransitionManager:n}=this,r={...n.getAttributes()};for(const o in i){const c=i[o];c.needsRedraw(e)&&!n.hasAttribute(o)&&(r[o]=c)}return r}getBufferLayouts(e){return Object.values(this.getAttributes()).map(i=>i.getBufferLayout(e))}_add(e,i){for(const n in e){const r=e[n],o={...r,id:n,size:r.isIndexed&&1||r.size||1,...i};this.attributes[n]=new QS(this.device,o)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const i in this.attributes)this.attributes[i].getUpdateTriggers().forEach(r=>{e[r]||(e[r]=[]),e[r].push(i)});this.updateTriggers=e}_invalidateTrigger(e,i){const{attributes:n,updateTriggers:r}=this,o=r[e];return o&&o.forEach(c=>{const f=n[c];f&&f.setNeedsUpdate(f.id,i)}),o}_updateAttribute(e){const{attribute:i,numInstances:n}=e;if(Rt(f6,i),i.constant){i.setConstantValue(i.value);return}i.allocate(n)&&Rt(h6,i,n),i.updateBuffer(e)&&(this.needsRedraw=!0,Rt(d6,i,n))}}class p6 extends gu{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:i,toValue:n,duration:r,easing:o}}=this,c=o(e/r);this._value=Cc(i,n,c)}}const $b=1e-5;function Yb(t,e,i,n,r){const o=e-t,f=(i-e)*r,h=-o*n;return f+h+o+e}function _6(t,e,i,n,r){if(Array.isArray(i)){const o=[];for(let c=0;c<i.length;c++)o[c]=Yb(t[c],e[c],i[c],n,r);return o}return Yb(t,e,i,n,r)}function qb(t,e){if(Array.isArray(t)){let i=0;for(let n=0;n<t.length;n++){const r=t[n]-e[n];i+=r*r}return Math.sqrt(i)}return Math.abs(t-e)}class m6 extends gu{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:i,damping:n,stiffness:r}=this.settings,{_prevValue:o=e,_currValue:c=e}=this;let f=_6(o,c,i,n,r);const h=qb(f,i),g=qb(f,c);h<$b&&g<$b&&(f=i,this.end()),this._prevValue=c,this._currValue=f}}const y6={interpolation:p6,spring:m6};class b6{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,i,n,r){const{transitions:o}=this;if(o.has(e)){const h=o.get(e),{value:g=h.settings.fromValue}=h;i=g,this.remove(e)}if(r=ZS(r),!r)return;const c=y6[r.type];if(!c){Oe.error(`unsupported transition type '${r.type}'`)();return}const f=new c(this.timeline);f.start({...r,fromValue:i,toValue:n}),o.set(e,f)}remove(e){const{transitions:i}=this;i.has(e)&&(i.get(e).cancel(),i.delete(e))}update(){const e={};for(const[i,n]of this.transitions)n.update(),e[i]=n.value,n.inProgress||this.remove(i);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function v6(t){const e=t[kn];for(const i in e){const n=e[i],{validate:r}=n;if(r&&!r(t[i],n))throw new Error(`Invalid prop ${i}: ${t[i]}`)}}function T6(t,e){const i=rA({newProps:t,oldProps:e,propTypes:t[kn],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=A6(t,e);let r=!1;return n||(r=E6(t,e)),{dataChanged:n,propsChanged:i,updateTriggersChanged:r,extensionsChanged:w6(t,e),transitionsChanged:S6(t,e)}}function S6(t,e){if(!t.transitions)return!1;const i={},n=t[kn];let r=!1;for(const o in t.transitions){const c=n[o],f=c&&c.type;(f==="number"||f==="color"||f==="array")&&lg(t[o],e[o],c)&&(i[o]=!0,r=!0)}return r?i:!1}function rA({newProps:t,oldProps:e,ignoreProps:i={},propTypes:n={},triggerName:r="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${r} changed shallowly`;if(typeof e!="object"||e===null)return`${r} changed shallowly`;for(const o of Object.keys(t))if(!(o in i)){if(!(o in e))return`${r}.${o} added`;const c=lg(t[o],e[o],n[o]);if(c)return`${r}.${o} ${c}`}for(const o of Object.keys(e))if(!(o in i)){if(!(o in t))return`${r}.${o} dropped`;if(!Object.hasOwnProperty.call(t,o)){const c=lg(t[o],e[o],n[o]);if(c)return`${r}.${o} ${c}`}}return!1}function lg(t,e,i){let n=i&&i.equal;return n&&!n(t,e,i)||!n&&(n=t&&e&&t.equals,n&&!n.call(t,e))?"changed deeply":!n&&e!==t?"changed shallowly":null}function A6(t,e){if(e===null)return"oldProps is null, initial diff";let i=!1;const{dataComparator:n,_dataDiff:r}=t;return n?n(t.data,e.data)||(i="Data comparator detected a change"):t.data!==e.data&&(i="A new data container was supplied"),i&&r&&(i=r(t.data,e.data)||i),i}function E6(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&Kb(t,e,"all"))return{all:!0};const i={};let n=!1;for(const r in t.updateTriggers)r!=="all"&&Kb(t,e,r)&&(i[r]=!0,n=!0);return n?i:!1}function w6(t,e){if(e===null)return!0;const i=e.extensions,{extensions:n}=t;if(n===i)return!1;if(!i||!n||n.length!==i.length)return!0;for(let r=0;r<n.length;r++)if(!n[r].equals(i[r]))return!0;return!1}function Kb(t,e,i){let n=t.updateTriggers[i];n=n??{};let r=e.updateTriggers[i];return r=r??{},rA({oldProps:r,newProps:n,triggerName:i})}const R6="count(): argument not an object",x6="count(): argument not a container";function C6(t){if(!O6(t))throw new Error(R6);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(M6(t))return Object.keys(t).length;throw new Error(x6)}function M6(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function O6(t){return t!==null&&typeof t=="object"}function Zb(t,e){if(!e)return t;const i={...t,...e};if("defines"in e&&(i.defines={...t.defines,...e.defines}),"modules"in e&&(i.modules=(t.modules||[]).concat(e.modules),e.modules.some(n=>n.name==="project64"))){const n=i.modules.findIndex(r=>r.name==="project32");n>=0&&i.modules.splice(n,1)}if("inject"in e)if(!t.inject)i.inject=e.inject;else{const n={...t.inject};for(const r in e.inject)n[r]=(n[r]||"")+e.inject[r];i.inject=n}return i}const P6={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},cg={};function N6(t,e,i,n){if(i instanceof et)return i;i.constructor&&i.constructor.name!=="Object"&&(i={data:i});let r=null;i.compressed&&(r={minFilter:"linear",mipmapFilter:i.data.length>1?"nearest":"linear"});const o=e.createTexture({...i,sampler:{...P6,...r,...n},mipmaps:!0});return cg[o.id]=t,o}function I6(t,e){!e||!(e instanceof et)||cg[e.id]===t&&(e.delete(),delete cg[e.id])}const D6={boolean:{validate(t,e){return!0},equal(t,e,i){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||ug(t)&&(t.length===3||t.length===4)},equal(t,e,i){return hi(t,e,1)}},accessor:{validate(t,e){const i=Bc(t);return i==="function"||i===Bc(e.value)},equal(t,e,i){return typeof e=="function"?!0:hi(t,e,1)}},array:{validate(t,e){return e.optional&&!t||ug(t)},equal(t,e,i){const{compare:n}=i,r=Number.isInteger(n)?n:n?1:0;return n?hi(t,e,r):t===e}},object:{equal(t,e,i){if(i.ignore)return!0;const{compare:n}=i,r=Number.isInteger(n)?n:n?1:0;return n?hi(t,e,r):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,i){return!i.compare&&i.ignore!==!1||t===e}},data:{transform:(t,e,i)=>{if(!t)return t;const{dataTransform:n}=i.props;return n?n(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,i)=>{const n=i.context;return!n||!n.device?null:N6(i.id,n.device,t,{...e.parameters,...i.props.textureParameters})},release:(t,e,i)=>{I6(i.id,t)}}};function k6(t){const e={},i={},n={};for(const[r,o]of Object.entries(t)){const c=o==null?void 0:o.deprecatedFor;if(c)n[r]=Array.isArray(c)?c:[c];else{const f=B6(r,o);e[r]=f,i[r]=f.value}}return{propTypes:e,defaultProps:i,deprecatedProps:n}}function B6(t,e){switch(Bc(e)){case"object":return La(t,e);case"array":return La(t,{type:"array",value:e,compare:!1});case"boolean":return La(t,{type:"boolean",value:e});case"number":return La(t,{type:"number",value:e});case"function":return La(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function La(t,e){return"type"in e?{name:t,...D6[e.type],...e}:"value"in e?{name:t,type:Bc(e.value),...e}:{name:t,type:"object",value:e}}function ug(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Bc(t){return ug(t)?"array":t===null?"null":typeof t}function U6(t,e){let i;for(let o=e.length-1;o>=0;o--){const c=e[o];"extensions"in c&&(i=c.extensions)}const n=fg(t.constructor,i),r=Object.create(n);r[Dc]=t,r[vs]={},r[Pn]={};for(let o=0;o<e.length;++o){const c=e[o];for(const f in c)r[f]=c[f]}return Object.freeze(r),r}const F6="_mergedDefaultProps";function fg(t,e){if(!(t instanceof _u.constructor))return{};let i=F6;if(e)for(const r of e){const o=r.constructor;o&&(i+=`:${o.extensionName||o.name}`)}const n=aA(t,i);return n||(t[i]=L6(t,e||[]))}function L6(t,e){if(!t.prototype)return null;const n=Object.getPrototypeOf(t),r=fg(n),o=aA(t,"defaultProps")||{},c=k6(o),f=Object.assign(Object.create(null),r,c.defaultProps),h=Object.assign(Object.create(null),r==null?void 0:r[kn],c.propTypes),g=Object.assign(Object.create(null),r==null?void 0:r[ld],c.deprecatedProps);for(const _ of e){const m=fg(_.constructor);m&&(Object.assign(f,m),Object.assign(h,m[kn]),Object.assign(g,m[ld]))}return z6(f,t),H6(f,h),V6(f,g),f[kn]=h,f[ld]=g,e.length===0&&!Wg(t,"_propTypes")&&(t._propTypes=h),f}function z6(t,e){const i=W6(e);Object.defineProperties(t,{id:{writable:!0,value:i}})}function V6(t,e){for(const i in e)Object.defineProperty(t,i,{enumerable:!1,set(n){const r=`${this.id}: ${i}`;for(const o of e[i])Wg(this,o)||(this[o]=n);Oe.deprecated(r,e[i].join("/"))()}})}function H6(t,e){const i={},n={};for(const r in e){const o=e[r],{name:c,value:f}=o;o.async&&(i[c]=f,n[c]=j6(c))}t[Sr]=i,t[vs]={},Object.defineProperties(t,n)}function j6(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||qS(e)?this[vs][t]=e:this[Pn][t]=e},get(){if(this[Pn]){if(t in this[Pn])return this[Pn][t]||this[Sr][t];if(t in this[vs]){const e=this[Dc]&&this[Dc].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[Sr][t]}}return this[Sr][t]}}}function Wg(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function aA(t,e){return Wg(t,e)&&t[e]}function W6(t){const e=t.componentName;return e||Oe.warn(`${t.name}.componentName not specified`)(),e||t.name}let X6=0;class _u{constructor(...e){this.props=U6(this,e),this.id=this.props.id,this.count=X6++}clone(e){const{props:i}=this,n={};for(const r in i[Sr])r in i[Pn]?n[r]=i[Pn][r]:r in i[vs]&&(n[r]=i[vs][r]);return new this.constructor({...i,...n,...e})}}_u.componentName="Component";_u.defaultProps={};const $6=Object.freeze({});class Y6{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const i=this.asyncProps[e];i&&i.type&&i.type.release&&i.type.release(i.resolvedValue,i.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||$6}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const i=this.asyncProps[e];return i&&i.resolvedValue}isAsyncPropLoading(e){if(e){const i=this.asyncProps[e];return!!(i&&i.pendingLoadCount>0&&i.pendingLoadCount!==i.resolvedLoadCount)}for(const i in this.asyncProps)if(this.isAsyncPropLoading(i))return!0;return!1}reloadAsyncProp(e,i){this._watchPromise(e,Promise.resolve(i))}setAsyncProps(e){this.component=e[Dc]||this.component;const i=e[Pn]||{},n=e[vs]||e,r=e[Sr]||{};for(const o in i){const c=i[o];this._createAsyncPropData(o,r[o]),this._updateAsyncProp(o,c),i[o]=this.getAsyncProp(o)}for(const o in n){const c=n[o];this._createAsyncPropData(o,r[o]),this._updateAsyncProp(o,c)}}_fetch(e,i){return null}_onResolve(e,i){}_onError(e,i){}_updateAsyncProp(e,i){if(this._didAsyncInputValueChange(e,i)){if(typeof i=="string"&&(i=this._fetch(e,i)),i instanceof Promise){this._watchPromise(e,i);return}if(qS(i)){this._resolveAsyncIterable(e,i);return}this._setPropValue(e,i)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,i){const n=this.asyncProps[e];return i===n.resolvedValue||i===n.lastValue?!1:(n.lastValue=i,!0)}_setPropValue(e,i){this._freezeAsyncOldProps();const n=this.asyncProps[e];n&&(i=this._postProcessValue(n,i),n.resolvedValue=i,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(e,i,n){const r=this.asyncProps[e];r&&n>=r.resolvedLoadCount&&i!==void 0&&(this._freezeAsyncOldProps(),r.resolvedValue=i,r.resolvedLoadCount=n,this.onAsyncPropUpdated(e,i))}_watchPromise(e,i){const n=this.asyncProps[e];if(n){n.pendingLoadCount++;const r=n.pendingLoadCount;i.then(o=>{this.component&&(o=this._postProcessValue(n,o),this._setAsyncPropValue(e,o,r),this._onResolve(e,o))}).catch(o=>{this._onError(e,o)})}}async _resolveAsyncIterable(e,i){if(e!=="data"){this._setPropValue(e,i);return}const n=this.asyncProps[e];if(!n)return;n.pendingLoadCount++;const r=n.pendingLoadCount;let o=[],c=0;for await(const f of i){if(!this.component)return;const{dataTransform:h}=this.component.props;h?o=h(f,o):o=o.concat(f),Object.defineProperty(o,"__diff",{enumerable:!1,value:[{startRow:c,endRow:o.length}]}),c=o.length,this._setAsyncPropValue(e,o,r)}this._onResolve(e,o)}_postProcessValue(e,i){const n=e.type;return n&&this.component&&(n.release&&n.release(e.resolvedValue,n,this.component),n.transform)?n.transform(i,n,this.component):i}_createAsyncPropData(e,i){if(!this.asyncProps[e]){const r=this.component&&this.component.props[kn];this.asyncProps[e]={type:r&&r[e],lastValue:null,resolvedValue:i,pendingLoadCount:0,resolvedLoadCount:0}}}}class q6 extends Y6{constructor({attributeManager:e,layer:i}){super(i),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,i){const n=this.layer,r=n==null?void 0:n.props.fetch;return r?r(i,{propName:e,layer:n}):super._fetch(e,i)}_onResolve(e,i){const n=this.layer;if(n){const r=n.props.onDataLoad;e==="data"&&r&&r(i,{propName:e,layer:n})}}_onError(e,i){const n=this.layer;n&&n.raiseError(i,`loading ${e} of ${this.layer}`)}}const K6="layer.changeFlag",Z6="layer.initialize",Q6="layer.update",G6="layer.finalize",J6="layer.matched",Qb=2**24-1,ek=Object.freeze([]),tk=go(({oldViewport:t,viewport:e})=>t.equals(e));let li=new Uint8ClampedArray(0);const ik={data:{type:"data",value:ek,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:i,loaders:n,loadOptions:r,signal:o})=>{const{resourceManager:c}=i.context;r=r||i.getLoadOptions(),n=n||i.props.loaders,o&&(r={...r,fetch:{...r==null?void 0:r.fetch,signal:o}});let f=c.contains(t);return!f&&!r&&(c.add({resourceId:t,data:_c(t,n),persistent:!1}),f=!0),f?c.subscribe({resourceId:t,onChange:h=>{var g;return(g=i.internalState)==null?void 0:g.reloadAsyncProp(e,h)},consumerId:i.id,requestId:e}):_c(t,n,r)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Ue.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Gi extends _u{constructor(){super(...arguments),this.internalState=null,this.lifecycle=dr.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){vt(this.internalState);const i=this.internalState.viewport||this.context.viewport,n=AS(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[r,o,c]=bS(n,i.pixelProjectionMatrix);return e.length===2?[r,o]:[r,o,c]}unproject(e){return vt(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,i){vt(this.internalState);const n=this.internalState.viewport||this.context.viewport;return NP(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...i})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const i of this.getModels())i.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Ue.DEFAULT||e===Ue.LNGLAT||e===Ue.CARTESIAN}onHover(e,i){return this.props.onHover&&this.props.onHover(e,i)||!1}onClick(e,i){return this.props.onClick&&this.props.onClick(e,i)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,i=[]){return i[0]=e+1&255,i[1]=e+1>>8&255,i[2]=e+1>>8>>8&255,i}decodePickingColor(e){vt(e instanceof Uint8Array);const[i,n,r]=e;return i+n*256+r*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:C6(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=Zb(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const i of this.props.extensions)e=Zb(e,i.getShaders.call(this,i));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const i=this.getAttributeManager(),{dataChanged:n}=e.changeFlags;if(n&&i)if(Array.isArray(n))for(const r of n)i.invalidateAll(r);else i.invalidateAll();if(i){const{props:r}=e,o=this.internalState.hasPickingBuffer,c=Number.isInteger(r.highlightedObjectIndex)||r.pickable||r.extensions.some(f=>f.getNeedsPickingBuffer.call(this,f));if(o!==c){this.internalState.hasPickingBuffer=c;const{pickingColors:f,instancePickingColors:h}=i.attributes,g=f||h;g&&(c&&g.constant&&(g.constant=!1,i.invalidate(g.id)),!g.value&&!c&&(g.constant=!0,g.value=[0,0,0]))}}}finalizeState(e){for(const n of this.getModels())n.destroy();const i=this.getAttributeManager();i&&i.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const i of this.getModels())i.draw(e.renderPass)}getPickingInfo({info:e,mode:i,sourceLayer:n}){const{index:r}=e;return r>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[r]),e}raiseError(e,i){var n,r,o,c;i&&(e=new Error(`${i}: ${e.message}`,{cause:e})),(r=(n=this.props).onError)!=null&&r.call(n,e)||(c=(o=this.context)==null?void 0:o.onError)==null||c.call(o,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const i=this.internalState.viewport;this.internalState.viewport=e,(!i||!tk({oldViewport:i,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const i=this.getAttributeManager();i&&(e==="all"?i.invalidateAll():i.invalidate(e))}updateAttributes(e){let i=!1;for(const n in e)e[n].layoutChanged()&&(i=!0);for(const n of this.getModels())this._setModelAttributes(n,e,i)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const i=this.props,n=this.getNumInstances(),r=this.getStartIndices();e.update({data:i.data,numInstances:n,startIndices:r,props:i,transitions:i.transitions,buffers:i.data.attributes,context:this});const o=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(o)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const i=e.update(),n=Object.create(this.props);for(const r in i)Object.defineProperty(n,r,{value:i[r]});return n}return this.props}calculateInstancePickingColors(e,{numInstances:i}){if(e.constant)return;const n=Math.floor(li.length/4);if(this.internalState.usesPickingColorCache=!0,n<i){i>Qb&&Oe.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),li=Nr.allocate(li,i,{size:4,copy:!0,maxCount:Math.max(i,Qb)});const r=Math.floor(li.length/4),o=[0,0,0];for(let c=n;c<r;c++)this.encodePickingColor(c,o),li[c*4+0]=o[0],li[c*4+1]=o[1],li[c*4+2]=o[2],li[c*4+3]=0}e.value=li.subarray(0,i*4)}_setModelAttributes(e,i,n=!1){var f;if(!Object.keys(i).length)return;if(n){const h=this.getAttributeManager();e.setBufferLayout(h.getBufferLayouts(e)),i=h.getAttributes()}const r=((f=e.userData)==null?void 0:f.excludeAttributes)||{},o={},c={};for(const h in i){if(r[h])continue;const g=i[h].getValue();for(const _ in g){const m=g[_];m instanceof $e?i[h].settings.isIndexed?e.setIndexBuffer(m):o[_]=m:m&&(c[_]=m)}}e.setAttributes(o),e.setConstantAttributes(c)}disablePickingIndex(e){const i=this.props.data;if(!("attributes"in i)){this._disablePickingIndex(e);return}const{pickingColors:n,instancePickingColors:r}=this.getAttributeManager().attributes,o=n||r,c=o&&i.attributes&&i.attributes[o.id];if(c&&c.value){const f=c.value,h=this.encodePickingColor(e);for(let g=0;g<i.length;g++){const _=o.getVertexOffset(g);f[_]===h[0]&&f[_+1]===h[1]&&f[_+2]===h[2]&&this._disablePickingIndex(g)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:i,instancePickingColors:n}=this.getAttributeManager().attributes,r=i||n;if(!r)return;const o=r.getVertexOffset(e),c=r.getVertexOffset(e+1);r.buffer.write(new Uint8Array(c-o),o)}restorePickingColors(){const{pickingColors:e,instancePickingColors:i}=this.getAttributeManager().attributes,n=e||i;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==li.buffer&&(n.value=li.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){vt(!this.internalState),vt(Number.isFinite(this.props.coordinateSystem)),Rt(Z6,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new q6({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Oe.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new b6(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const i of this.props.extensions)i.initializeState.call(this,this.context,i);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Rt(J6,this,this===e);const{state:i,internalState:n}=e;this!==e&&(this.internalState=n,this.state=i,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Rt(Q6,this,e),!e)return;const i=this.props,n=this.context,r=this.internalState,o=n.viewport,c=this._updateUniformTransition();r.propsInTransition=c,n.viewport=r.viewport||o,this.props=c;try{const f=this._getUpdateParams(),h=this.getModels();if(n.device)this.updateState(f);else try{this.updateState(f)}catch{}for(const _ of this.props.extensions)_.updateState.call(this,f,_);this.setNeedsRedraw(),this._updateAttributes();const g=this.getModels()[0]!==h[0];this._postUpdate(f,g)}finally{n.viewport=o,this.props=i,this._clearChangeFlags(),r.needsUpdate=!1,r.resetOldProps()}}_finalize(){Rt(G6,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:i=null,uniforms:n={},parameters:r={}}){this._updateAttributeTransition();const o=this.props,c=this.context;this.props=this.internalState.propsInTransition||o;try{i&&this.setShaderModuleProps(i);const{getPolygonOffset:f}=this.props,h=f&&f(n)||[0,0];c.device instanceof Nn&&c.device.setParametersWebGL({polygonOffset:h});for(const g of this.getModels())g.setParameters(r);if(c.device instanceof Nn)c.device.withParametersWebGL(r,()=>{const g={renderPass:e,shaderModuleProps:i,uniforms:n,parameters:r,context:c};for(const _ of this.props.extensions)_.draw.call(this,g,_);this.draw(g)});else{const g={renderPass:e,shaderModuleProps:i,uniforms:n,parameters:r,context:c};for(const _ of this.props.extensions)_.draw.call(this,g,_);this.draw(g)}}finally{this.props=o}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:i}=this.internalState;for(const r in e)if(e[r]){let o=!1;switch(r){case"dataChanged":const c=e[r],f=i[r];c&&Array.isArray(f)&&(i.dataChanged=Array.isArray(c)?f.concat(c):c,o=!0);default:i[r]||(i[r]=e[r],o=!0)}o&&Rt(K6,this,r,e)}const n=!!(i.dataChanged||i.updateTriggersChanged||i.propsChanged||i.extensionsChanged);i.propsOrDataChanged=n,i.somethingChanged=n||i.viewportChanged||i.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,i){var r;const n=T6(e,i);if(n.updateTriggersChanged)for(const o in n.updateTriggersChanged)n.updateTriggersChanged[o]&&this.invalidateAttribute(o);if(n.transitionsChanged)for(const o in n.transitionsChanged)this.internalState.uniformTransitions.add(o,i[o],e[o],(r=e.transitions)==null?void 0:r[o]);return this.setChangeFlags(n)}validateProps(){v6(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const i={highlightedObjectColor:e.picked?e.color:null},{highlightColor:n}=this.props;e.picked&&typeof n=="function"&&(i.highlightColor=n(e)),this.setShaderModuleProps({picking:i}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new g6(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,i){const{props:n,oldProps:r}=e,o=this.state.model;o!=null&&o.isInstanced&&o.setInstanceCount(this.getNumInstances());const{autoHighlight:c,highlightedObjectIndex:f,highlightColor:h}=n;if(i||r.autoHighlight!==c||r.highlightedObjectIndex!==f||r.highlightColor!==h){const g={};Array.isArray(h)&&(g.highlightColor=h),(i||r.autoHighlight!==c||f!==r.highlightedObjectIndex)&&(g.highlightedObjectColor=Number.isFinite(f)&&f>=0?this.encodePickingColor(f):null),this.setShaderModuleProps({picking:g})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let i=!1;i=i||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),r=n?n.getNeedsRedraw(e):!1;if(i=i||r,i)for(const o of this.props.extensions)o.onNeedsRedraw.call(this,o);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,i}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Gi.defaultProps=ik;Gi.layerName="Layer";const nk="compositeLayer.renderLayers";class Xg extends Gi{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:i}=e;return i&&i.__source&&i.__source.parent&&i.__source.parent.id===this.id&&(e.object=i.__source.object,e.index=i.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,i){return i&&i.length}getSubLayerClass(e,i){const{_subLayerProps:n}=this.props;return n&&n[e]&&n[e].type||i}getSubLayerRow(e,i,n){return e.__source={parent:this,object:i,index:n},e}getSubLayerAccessor(e){if(typeof e=="function"){const i={index:-1,data:this.props.data,target:[]};return(n,r)=>n&&n.__source?(i.index=n.__source.index,e(n.__source.object,i)):e(n,r)}return e}getSubLayerProps(e={}){var ue;const{opacity:i,pickable:n,visible:r,parameters:o,getPolygonOffset:c,highlightedObjectIndex:f,autoHighlight:h,highlightColor:g,coordinateSystem:_,coordinateOrigin:m,wrapLongitude:y,positionFormat:T,modelMatrix:R,extensions:x,fetch:O,operation:N,_subLayerProps:B}=this.props,P={id:"",updateTriggers:{},opacity:i,pickable:n,visible:r,parameters:o,getPolygonOffset:c,highlightedObjectIndex:f,autoHighlight:h,highlightColor:g,coordinateSystem:_,coordinateOrigin:m,wrapLongitude:y,positionFormat:T,modelMatrix:R,extensions:x,fetch:O,operation:N},j=B&&e.id&&B[e.id],z=j&&j.updateTriggers,q=e.id||"sublayer";if(j){const oe=this.props[kn],G=e.type?e.type._propTypes:{};for(const ae in j){const te=G[ae]||oe[ae];te&&te.type==="accessor"&&(j[ae]=this.getSubLayerAccessor(j[ae]))}}Object.assign(P,e,j),P.id=`${this.props.id}-${q}`,P.updateTriggers={all:(ue=this.props.updateTriggers)==null?void 0:ue.all,...e.updateTriggers,...z};for(const oe of x){const G=oe.getSubLayerProps.call(this,oe);G&&Object.assign(P,G,{updateTriggers:Object.assign(P.updateTriggers,G.updateTriggers)})}return P}_updateAutoHighlight(e){for(const i of this.getSubLayers())i.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,i){let n=this.internalState.subLayers;const r=!n||this.needsUpdate();if(r){const o=this.renderLayers();n=Ug(o,Boolean),this.internalState.subLayers=n}Rt(nk,this,r,n);for(const o of n)o.parent=this}}Xg.layerName="CompositeLayer";class oA{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:i={}}=e;this.typedArrayManager=Nr,this.attributes={},this._attributeDefs=i,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:i,buffers:n={},getGeometry:r,geometryBuffer:o,positionFormat:c,dataChanged:f,normalize:h=!0}=this.opts;if(this.data=i,this.getGeometry=r,this.positionSize=o&&o.size||(c==="XY"?2:3),this.buffers=n,this.normalize=h,o&&(vt(i.startIndices),this.getGeometry=this.getGeometryFromBuffer(o),h||(n.vertexPositions=o)),this.geometryBuffer=n.vertexPositions,Array.isArray(f))for(const g of f)this._rebuildGeometry(g);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:i}){this._rebuildGeometry({startRow:e,endRow:i})}getGeometryFromBuffer(e){const i=e.value||e;return ArrayBuffer.isView(i)?KS(i,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,i){const{attributes:n,buffers:r,_attributeDefs:o,typedArrayManager:c}=this;for(const f in o)if(f in r)c.release(n[f]),n[f]=null;else{const h=o[f];h.copy=i,n[f]=c.allocate(n[f],e,h)}}_forEachGeometry(e,i,n){const{data:r,getGeometry:o}=this,{iterable:c,objectInfo:f}=pu(r,i,n);for(const h of c){f.index++;const g=o?o(h,f):null;e(g,f.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:i,vertexStarts:n,instanceCount:r}=this;const{data:o,geometryBuffer:c}=this,{startRow:f=0,endRow:h=1/0}=e||{},g={};if(e||(i=[0],n=[0]),this.normalize||!c)this._forEachGeometry((m,y)=>{const T=m&&this.normalizeGeometry(m);g[y]=T,n[y+1]=n[y]+(T?this.getGeometrySize(T):0)},f,h),r=n[n.length-1];else if(n=o.startIndices,r=n[o.length]||0,ArrayBuffer.isView(c))r=r||c.length/this.positionSize;else if(c instanceof $e){const m=this.positionSize*4;r=r||c.byteLength/m}else if(c.buffer){const m=c.stride||this.positionSize*4;r=r||c.buffer.byteLength/m}else if(c.value){const m=c.value,y=c.stride/m.BYTES_PER_ELEMENT||this.positionSize;r=r||m.length/y}this._allocate(r,!!e),this.indexStarts=i,this.vertexStarts=n,this.instanceCount=r;const _={};this._forEachGeometry((m,y)=>{const T=g[y]||m;_.vertexStart=n[y],_.indexStart=i[y];const R=y<n.length-1?n[y+1]:r;_.geometrySize=R-n[y],_.geometryIndex=y,this.updateGeometryAttributes(T,_)},f,h),this.vertexCount=i[i.length-1]}}const sk=typeof window<"u"?ee.useLayoutEffect:ee.useEffect;function Uc(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const rk={position:"absolute",zIndex:-1};function lA(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(i=>lA(i,e));if(mu(t)){if(ak(t))return e.style=rk,ee.cloneElement(t,e);if(ok(t))return ee.cloneElement(t,e)}return t}function mu(t){return t&&typeof t=="object"&&"type"in t||!1}function ak(t){var e;return(e=t.props)==null?void 0:e.mapStyle}function ok(t){const e=t.type;return e&&e.deckGLViewProps}function hg(t){if(typeof t=="function")return ee.createElement(kr,{},t);if(Array.isArray(t))return t.map(hg);if(mu(t)){if(t.type===ee.Fragment)return hg(t.props.children);if(Uc(t.type,kr))return t}return t}function lk({children:t,layers:e=[],views:i=null}){const n=[],r=[],o={};return ee.Children.forEach(hg(t),c=>{if(mu(c)){const f=c.type;if(Uc(f,Gi)){const h=ck(f,c.props);r.push(h)}else n.push(c);if(Uc(f,kr)&&f!==kr&&c.props.id){const h=new f(c.props);o[h.id]=h}}else c&&n.push(c)}),Object.keys(o).length>0&&(Array.isArray(i)?i.forEach(c=>{o[c.id]=c}):i&&(o[i.id]=i),i=Object.values(o)),e=r.length>0?[...r,...e]:e,{layers:e,children:n,views:i}}function ck(t,e){const i={},n=t.defaultProps||{};for(const r in e)n[r]!==e[r]&&(i[r]=e[r]);return new t(i)}const uk=ee.createContext();function fk({children:t,deck:e,ContextProvider:i=uk.Provider}){const{viewManager:n}=e||{};if(!n||!n.views.length)return[];const r={},o=n.views[0].id;for(const c of t){let f=o,h=c;mu(c)&&Uc(c.type,kr)&&(f=c.props.id||o,h=c.props.children);const g=n.getViewport(f),_=n.getViewState(f);if(g){_.padding=g.padding;const{x:m,y,width:T,height:R}=g;h=lA(h,{x:m,y,width:T,height:R,viewport:g,viewState:_}),r[f]||(r[f]={viewport:g,children:[]}),r[f].children.push(h)}}return Object.keys(r).map(c=>{const{viewport:f,children:h}=r[c],{x:g,y:_,width:m,height:y}=f,T={position:"absolute",left:g,top:_,width:m,height:y},R=`view-${c}`,x=ee.createElement("div",{key:R,id:R,style:T},...h),O={deck:e,viewport:f,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:B=>{B.viewId=c,e._onViewStateChange(B)},widgets:[]},N=`view-${c}-context`;return ee.createElement(i,{key:N,value:O},x)})}const hk={mixBlendMode:null};function dk({width:t,height:e,style:i}){const n={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},r={left:0,top:0};if(i)for(const o in i)o in hk?r[o]=i[o]:n[o]=i[o];return{containerStyle:n,canvasStyle:r}}function gk(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function cA(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function pk(t,e,i){const n=new e({...i,_customRender:r=>{t.redrawReason=r;const o=n.getViewports();t.lastRenderedViewports!==o?t.forceUpdate():cA(t)}});return n}function _k(t,e){const[i,n]=ee.useState(0),o=ee.useRef({control:null,version:i,forceUpdate:()=>n(z=>z+1)}).current,c=ee.useRef(null),f=ee.useRef(null),h=ee.useMemo(()=>lk(t),[t.layers,t.views,t.children]);let g=!0;const _=z=>{var q;return g&&t.viewState?(o.viewStateUpdateRequested=z,null):(o.viewStateUpdateRequested=null,(q=t.onViewStateChange)==null?void 0:q.call(t,z))},m=z=>{var q;g?o.interactionStateUpdateRequested=z:(o.interactionStateUpdateRequested=null,(q=t.onInteractionStateChange)==null||q.call(t,z))},y=ee.useMemo(()=>{const z={widgets:[],...t,style:null,width:"100%",height:"100%",parent:c.current,canvas:f.current,layers:h.layers,views:h.views,onViewStateChange:_,onInteractionStateChange:m};return delete z._customRender,o.deck&&o.deck.setProps(z),z},[t]);ee.useEffect(()=>{const z=t.Deck||jg;return o.deck=pk(o,z,{...y,parent:c.current,canvas:f.current}),()=>{var q;return(q=o.deck)==null?void 0:q.finalize()}},[]),sk(()=>{cA(o);const{viewStateUpdateRequested:z,interactionStateUpdateRequested:q}=o;z&&_(z),q&&m(q)}),ee.useImperativeHandle(e,()=>gk(o),[]);const T=o.deck&&o.deck.isInitialized?o.deck.getViewports():void 0,{ContextProvider:R,width:x="100%",height:O="100%",id:N,style:B}=t,{containerStyle:P,canvasStyle:j}=ee.useMemo(()=>dk({width:x,height:O,style:B}),[x,O,B]);if(!o.viewStateUpdateRequested&&o.lastRenderedViewports===T||o.version!==i){o.lastRenderedViewports=T,o.version=i;const z=fk({children:h.children,deck:o.deck,ContextProvider:R}),q=ee.createElement("canvas",{key:"canvas",id:N||"deckgl-overlay",ref:f,style:j});o.control=ee.createElement("div",{id:`${N||"deckgl"}-wrapper`,ref:c,style:P},[q,z])}return g=!1,o.control}const mk=ee.forwardRef(_k),Gb=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,yk={name:"icon",vs:Gb,fs:Gb,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},bk=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,vk=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Tk=1024,Sk=4,Jb=()=>{},ev={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Ak={x:0,y:0,width:0,height:0};function Ek(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function wk(t,e,i,n){const r=Math.min(i/e.width,n/e.height),o=Math.floor(e.width*r),c=Math.floor(e.height*r);return r===1?{image:e,width:o,height:c}:(t.canvas.height=c,t.canvas.width=o,t.clearRect(0,0,o,c),t.drawImage(e,0,0,e.width,e.height,0,0,o,c),{image:t.canvas,width:o,height:c})}function so(t){return t&&(t.id||t.url)}function Rk(t,e,i,n){const{width:r,height:o,device:c}=t,f=c.createTexture({format:"rgba8unorm",width:e,height:i,sampler:n,mipmaps:!0}),h=c.createCommandEncoder();return h.copyTextureToTexture({sourceTexture:t,destinationTexture:f,width:r,height:o}),h.finish(),t.destroy(),f}function tv(t,e,i){for(let n=0;n<e.length;n++){const{icon:r,xOffset:o}=e[n],c=so(r);t[c]={...r,x:o,y:i}}}function xk({icons:t,buffer:e,mapping:i={},xOffset:n=0,yOffset:r=0,rowHeight:o=0,canvasWidth:c}){let f=[];for(let h=0;h<t.length;h++){const g=t[h],_=so(g);if(!i[_]){const{height:m,width:y}=g;n+y+e>c&&(tv(i,f,r),n=0,r=o+r+e,o=0,f=[]),f.push({icon:g,xOffset:n}),n=n+y+e,o=Math.max(o,m)}}return f.length>0&&tv(i,f,r),{mapping:i,rowHeight:o,xOffset:n,yOffset:r,canvasWidth:c,canvasHeight:Ek(o+r+e)}}function Ck(t,e,i){if(!t||!e)return null;i=i||{};const n={},{iterable:r,objectInfo:o}=pu(t);for(const c of r){o.index++;const f=e(c,o),h=so(f);if(!f)throw new Error("Icon is missing.");if(!f.url)throw new Error("Icon url is missing.");!n[h]&&(!i[h]||f.url!==i[h].url)&&(n[h]={...f,source:c,sourceIndex:o.index})}return n}class Mk{constructor(e,{onUpdate:i=Jb,onError:n=Jb}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=Sk,this._canvasWidth=Tk,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=i,this.onError=n}finalize(){var e;(e=this._texture)==null||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const i=this._autoPacking?so(e):e;return this._mapping[i]||Ak}setProps({loadOptions:e,autoPacking:i,iconAtlas:n,iconMapping:r,textureParameters:o}){var c;e&&(this._loadOptions=e),i!==void 0&&(this._autoPacking=i),r&&(this._mapping=r),n&&((c=this._texture)==null||c.delete(),this._texture=null,this._externalTexture=n),o&&(this._samplerParameters=o)}get isLoaded(){return this._pendingCount===0}packIcons(e,i){if(!this._autoPacking||typeof document>"u")return;const n=Object.values(Ck(e,i,this._mapping)||{});if(n.length>0){const{mapping:r,xOffset:o,yOffset:c,rowHeight:f,canvasHeight:h}=xk({icons:n,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=f,this._mapping=r,this._xOffset=o,this._yOffset=c,this._canvasHeight=h,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||ev,mipmaps:!0})),this._texture.height!==this._canvasHeight&&(this._texture=Rk(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||ev)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(n)}}_loadIcons(e){const i=this._canvas.getContext("2d",{willReadFrequently:!0});for(const n of e)this._pendingCount++,_c(n.url,this._loadOptions).then(r=>{var R;const o=so(n),c=this._mapping[o],{x:f,y:h,width:g,height:_}=c,{image:m,width:y,height:T}=wk(i,r,g,_);(R=this._texture)==null||R.copyExternalImage({image:m,x:f+(g-y)/2,y:h+(_-T)/2,width:y,height:T}),c.width=y,c.height=T,this._texture.generateMipmap(),this.onUpdate()}).catch(r=>{this.onError({url:n.url,source:n.source,sourceIndex:n.sourceIndex,loadOptions:this._loadOptions,error:r})}).finally(()=>{this._pendingCount--})}}const uA=[0,0,0,255],Ok={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:uA},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class yu extends Gi{getShaders(){return super.getShaders({vs:bk,fs:vk,modules:[po,_o,yk]})}initializeState(){this.state={iconManager:new Mk(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:uA},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){var T;super.updateState(e);const{props:i,oldProps:n,changeFlags:r}=e,o=this.getAttributeManager(),{iconAtlas:c,iconMapping:f,data:h,getIcon:g,textureParameters:_}=i,{iconManager:m}=this.state;if(typeof c=="string")return;const y=c||this.internalState.isAsyncPropLoading("iconAtlas");m.setProps({loadOptions:i.loadOptions,autoPacking:!y,iconAtlas:c,iconMapping:y?f:null,textureParameters:_}),y?n.iconMapping!==i.iconMapping&&o.invalidate("getIcon"):(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getIcon))&&m.packIcons(h,g),r.extensionsChanged&&((T=this.state.model)==null||T.destroy(),this.state.model=this._getModel(),o.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:i,sizeMinPixels:n,sizeMaxPixels:r,sizeUnits:o,billboard:c,alphaCutoff:f}=this.props,{iconManager:h}=this.state,g=h.getTexture();if(g){const _=this.state.model,m={iconsTexture:g,iconsTextureDim:[g.width,g.height],sizeUnits:bs[o],sizeScale:i,sizeMinPixels:n,sizeMaxPixels:r,billboard:c,alphaCutoff:f};_.shaderInputs.setProps({icon:m}),_.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new gi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Dr({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var n;const i=(n=this.getCurrentLayer())==null?void 0:n.props.onIconError;i?i(e):Oe.error(e.error.message)()}getInstanceOffset(e){const{width:i,height:n,anchorX:r=i/2,anchorY:o=n/2}=this.state.iconManager.getIconMapping(e);return[i/2-r,n/2-o]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:i,y:n,width:r,height:o}=this.state.iconManager.getIconMapping(e);return[i,n,r,o]}}yu.defaultProps=Ok;yu.layerName="IconLayer";const iv=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  bool filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,Pk={name:"scatterplot",vs:iv,fs:iv,uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},Nk=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Ik=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled == false) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,nv=[0,0,0,255],Dk={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:nv},getLineColor:{type:"accessor",value:nv},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class bu extends Gi{getShaders(){return super.getShaders({vs:Nk,fs:Ik,modules:[po,_o,Pk]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var i;super.updateState(e),e.changeFlags.extensionsChanged&&((i=this.state.model)==null||i.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:i,radiusScale:n,radiusMinPixels:r,radiusMaxPixels:o,stroked:c,filled:f,billboard:h,antialiasing:g,lineWidthUnits:_,lineWidthScale:m,lineWidthMinPixels:y,lineWidthMaxPixels:T}=this.props,R={stroked:c,filled:f,billboard:h,antialiasing:g,radiusUnits:bs[i],radiusScale:n,radiusMinPixels:r,radiusMaxPixels:o,lineWidthUnits:bs[_],lineWidthScale:m,lineWidthMinPixels:y,lineWidthMaxPixels:T},x=this.state.model;x.shaderInputs.setProps({scatterplot:R}),x.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new gi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Dr({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}bu.defaultProps=Dk;bu.layerName="ScatterplotLayer";const fA={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function hA(t,e,i={}){return kk(t,i)!==e?(Uk(t,i),!0):!1}function kk(t,e={}){return Math.sign(Bk(t,e))}const sv={x:0,y:1,z:2};function Bk(t,e={}){const{start:i=0,end:n=t.length,plane:r="xy"}=e,o=e.size||2;let c=0;const f=sv[r[0]],h=sv[r[1]];for(let g=i,_=n-o;g<n;g+=o)c+=(t[g+f]-t[_+f])*(t[g+h]+t[_+h]),_=g;return c/2}function Uk(t,e){const{start:i=0,end:n=t.length,size:r=2}=e,o=(n-i)/r,c=Math.floor(o/2);for(let f=0;f<c;++f){const h=i+f*r,g=i+(o-1-f)*r;for(let _=0;_<r;++_){const m=t[h+_];t[h+_]=t[g+_],t[g+_]=m}}}function di(t,e){const i=e.length,n=t.length;if(n>0){let r=!0;for(let o=0;o<i;o++)if(t[n-i+o]!==e[o]){r=!1;break}if(r)return!1}for(let r=0;r<i;r++)t[n+r]=e[r];return!0}function dg(t,e){const i=e.length;for(let n=0;n<i;n++)t[n]=e[n]}function ro(t,e,i,n,r=[]){const o=n+e*i;for(let c=0;c<i;c++)r[c]=t[o+c];return r}function gg(t,e,i,n,r=[]){let o,c;if(i&8)o=(n[3]-t[1])/(e[1]-t[1]),c=3;else if(i&4)o=(n[1]-t[1])/(e[1]-t[1]),c=1;else if(i&2)o=(n[2]-t[0])/(e[0]-t[0]),c=2;else if(i&1)o=(n[0]-t[0])/(e[0]-t[0]),c=0;else return null;for(let f=0;f<t.length;f++)r[f]=(c&1)===f?n[c]:o*(e[f]-t[f])+t[f];return r}function oc(t,e){let i=0;return t[0]<e[0]?i|=1:t[0]>e[2]&&(i|=2),t[1]<e[1]?i|=4:t[1]>e[3]&&(i|=8),i}function dA(t,e){const{size:i=2,broken:n=!1,gridResolution:r=10,gridOffset:o=[0,0],startIndex:c=0,endIndex:f=t.length}=e||{},h=(f-c)/i;let g=[];const _=[g],m=ro(t,0,i,c);let y,T;const R=pA(m,r,o,[]),x=[];di(g,m);for(let O=1;O<h;O++){for(y=ro(t,O,i,c,y),T=oc(y,R);T;){gg(m,y,T,R,x);const N=oc(x,R);N&&(gg(m,x,N,R,x),T=N),di(g,x),dg(m,x),Lk(R,r,T),n&&g.length>i&&(g=[],_.push(g),di(g,m)),T=oc(y,R)}di(g,y),dg(m,y)}return n?_:_[0]}const rv=0,Fk=1;function gA(t,e=null,i){if(!t.length)return[];const{size:n=2,gridResolution:r=10,gridOffset:o=[0,0],edgeTypes:c=!1}=i||{},f=[],h=[{pos:t,types:c?new Array(t.length/n).fill(Fk):null,holes:e||[]}],g=[[],[]];let _=[];for(;h.length;){const{pos:m,types:y,holes:T}=h.shift();zk(m,n,T[0]||m.length,g),_=pA(g[0],r,o,_);const R=oc(g[1],_);if(R){let x=av(m,y,n,0,T[0]||m.length,_,R);const O={pos:x[0].pos,types:x[0].types,holes:[]},N={pos:x[1].pos,types:x[1].types,holes:[]};h.push(O,N);for(let B=0;B<T.length;B++)x=av(m,y,n,T[B],T[B+1]||m.length,_,R),x[0]&&(O.holes.push(O.pos.length),O.pos=ql(O.pos,x[0].pos),c&&(O.types=ql(O.types,x[0].types))),x[1]&&(N.holes.push(N.pos.length),N.pos=ql(N.pos,x[1].pos),c&&(N.types=ql(N.types,x[1].types)))}else{const x={positions:m};c&&(x.edgeTypes=y),T.length&&(x.holeIndices=T),f.push(x)}}return f}function av(t,e,i,n,r,o,c){const f=(r-n)/i,h=[],g=[],_=[],m=[],y=[];let T,R,x;const O=ro(t,f-1,i,n);let N=Math.sign(c&8?O[1]-o[3]:O[0]-o[2]),B=e&&e[f-1],P=0,j=0;for(let z=0;z<f;z++)T=ro(t,z,i,n,T),R=Math.sign(c&8?T[1]-o[3]:T[0]-o[2]),x=e&&e[n/i+z],R&&N&&N!==R&&(gg(O,T,c,o,y),di(h,y)&&_.push(B),di(g,y)&&m.push(B)),R<=0?(di(h,T)&&_.push(x),P-=R):_.length&&(_[_.length-1]=rv),R>=0?(di(g,T)&&m.push(x),j+=R):m.length&&(m[m.length-1]=rv),dg(O,T),N=R,B=x;return[P?{pos:h,types:e&&_}:null,j?{pos:g,types:e&&m}:null]}function pA(t,e,i,n){const r=Math.floor((t[0]-i[0])/e)*e+i[0],o=Math.floor((t[1]-i[1])/e)*e+i[1];return n[0]=r,n[1]=o,n[2]=r+e,n[3]=o+e,n}function Lk(t,e,i){i&8?(t[1]+=e,t[3]+=e):i&4?(t[1]-=e,t[3]-=e):i&2?(t[0]+=e,t[2]+=e):i&1&&(t[0]-=e,t[2]-=e)}function zk(t,e,i,n){let r=1/0,o=-1/0,c=1/0,f=-1/0;for(let h=0;h<i;h+=e){const g=t[h],_=t[h+1];r=g<r?g:r,o=g>o?g:o,c=_<c?_:c,f=_>f?_:f}return n[0][0]=r,n[0][1]=c,n[1][0]=o,n[1][1]=f,n}function ql(t,e){for(let i=0;i<e.length;i++)t.push(e[i]);return t}const Vk=85.051129;function Hk(t,e){const{size:i=2,startIndex:n=0,endIndex:r=t.length,normalize:o=!0}=e||{},c=t.slice(n,r);_A(c,i,0,r-n);const f=dA(c,{size:i,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(o)for(const h of f)mA(h,i);return f}function jk(t,e=null,i){const{size:n=2,normalize:r=!0,edgeTypes:o=!1}=i||{};e=e||[];const c=[],f=[];let h=0,g=0;for(let m=0;m<=e.length;m++){const y=e[m]||t.length,T=g,R=Wk(t,n,h,y);for(let x=R;x<y;x++)c[g++]=t[x];for(let x=h;x<R;x++)c[g++]=t[x];_A(c,n,T,g),Xk(c,n,T,g,i==null?void 0:i.maxLatitude),h=y,f[m]=g}f.pop();const _=gA(c,f,{size:n,gridResolution:360,gridOffset:[-180,-180],edgeTypes:o});if(r)for(const m of _)mA(m.positions,n);return _}function Wk(t,e,i,n){let r=-1,o=-1;for(let c=i+1;c<n;c+=e){const f=Math.abs(t[c]);f>r&&(r=f,o=c-1)}return o}function Xk(t,e,i,n,r=Vk){const o=t[i],c=t[n-e];if(Math.abs(o-c)>180){const f=ro(t,0,e,i);f[0]+=Math.round((c-o)/360)*360,di(t,f),f[1]=Math.sign(f[1])*r,di(t,f),f[0]=o,di(t,f)}}function _A(t,e,i,n){let r=t[0],o;for(let c=i;c<n;c+=e){o=t[c];const f=o-r;(f>180||f<-180)&&(o-=Math.round(f/360)*360),t[c]=r=o}}function mA(t,e){let i;const n=t.length/e;for(let o=0;o<n&&(i=t[o*e],(i+180)%360===0);o++);const r=-Math.round(i/360)*360;if(r!==0)for(let o=0;o<n;o++)t[o*e]+=r}function $k(t,e,i,n){let r;if(Array.isArray(t[0])){const o=t.length*e;r=new Array(o);for(let c=0;c<t.length;c++)for(let f=0;f<e;f++)r[c*e+f]=t[c][f]||0}else r=t;return i?dA(r,{size:e,gridResolution:i}):n?Hk(r,{size:e}):r}const Yk=1,qk=2,gd=4;class Kk extends oA{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?$k(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(ov(e)){let n=0;for(const r of e)n+=this.getGeometrySize(r);return n}const i=this.getPathLength(e);return i<2?0:this.isClosed(e)?i<3?0:i+2:i}updateGeometryAttributes(e,i){if(i.geometrySize!==0)if(e&&ov(e))for(const n of e){const r=this.getGeometrySize(n);i.geometrySize=r,this.updateGeometryAttributes(n,i),i.vertexStart+=r}else this._updateSegmentTypes(e,i),this._updatePositions(e,i)}_updateSegmentTypes(e,i){const n=this.attributes.segmentTypes,r=e?this.isClosed(e):!1,{vertexStart:o,geometrySize:c}=i;n.fill(0,o,o+c),r?(n[o]=gd,n[o+c-2]=gd):(n[o]+=Yk,n[o+c-2]+=qk),n[o+c-1]=gd}_updatePositions(e,i){const{positions:n}=this.attributes;if(!n||!e)return;const{vertexStart:r,geometrySize:o}=i,c=new Array(3);for(let f=r,h=0;h<o;f++,h++)this.getPointOnPath(e,h,c),n[f*3]=c[0],n[f*3+1]=c[1],n[f*3+2]=c[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,i,n=[]){const{positionSize:r}=this;i*r>=e.length&&(i+=1-e.length/r);const o=i*r;return n[0]=e[o],n[1]=e[o+1],n[2]=r===3&&e[o+2]||0,n}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:i}=this,n=e.length-i;return e[0]===e[n]&&e[1]===e[n+1]&&(i===2||e[2]===e[n+2])}}function ov(t){return Array.isArray(t[0])}const lv=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,Zk={name:"path",vs:lv,fs:lv,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},Qk=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Gk=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,yA=[0,0,0,255],Jk={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:yA},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},pd={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class $g extends Gi{getShaders(){return super.getShaders({vs:Qk,fs:Gk,modules:[po,_o,Zk]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:pd,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:pd,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:pd,defaultValue:yA},instancePickingColors:{size:4,type:"uint8",accessor:(n,{index:r,target:o})=>this.encodePickingColor(n&&n.__source?n.__source.index:r,o)}}),this.setState({pathTesselator:new Kk({fp64:this.use64bitPositions()})})}updateState(e){var c;super.updateState(e);const{props:i,changeFlags:n}=e,r=this.getAttributeManager();if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPath)){const{pathTesselator:f}=this.state,h=i.data.attributes||{};f.updateGeometry({data:i.data,geometryBuffer:h.getPath,buffers:h,normalize:!i._pathType,loop:i._pathType==="loop",getGeometry:i.getPath,positionFormat:i.positionFormat,wrapLongitude:i.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:n.dataChanged}),this.setState({numInstances:f.instanceCount,startIndices:f.vertexStarts}),n.dataChanged||r.invalidateAll()}n.extensionsChanged&&((c=this.state.model)==null||c.destroy(),this.state.model=this._getModel(),r.invalidateAll())}getPickingInfo(e){const i=super.getPickingInfo(e),{index:n}=i,r=this.props.data;return r[0]&&r[0].__source&&(i.object=r.find(o=>o.__source.index===n)),i}disablePickingIndex(e){const i=this.props.data;if(i[0]&&i[0].__source)for(let n=0;n<i.length;n++)i[n].__source.index===e&&this._disablePickingIndex(n);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:i,capRounded:n,billboard:r,miterLimit:o,widthUnits:c,widthScale:f,widthMinPixels:h,widthMaxPixels:g}=this.props,_=this.state.model,m={jointType:Number(i),capType:Number(n),billboard:r,widthUnits:bs[c],widthScale:f,miterLimit:o,widthMinPixels:h,widthMaxPixels:g};_.shaderInputs.setProps({path:m}),_.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],i=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new gi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Dr({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(i),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:i}=this.state;e.startIndices=i.vertexStarts,e.value=i.get("positions")}calculateSegmentTypes(e){const{pathTesselator:i}=this.state;e.startIndices=i.vertexStarts,e.value=i.get("segmentTypes")}}$g.defaultProps=Jk;$g.layerName="PathLayer";var Kl={exports:{}},cv;function e4(){if(cv)return Kl.exports;cv=1,Kl.exports=t,Kl.exports.default=t;function t(w,I,M){M=M||2;var X=I&&I.length,A=X?I[0]*M:w.length,D=e(w,0,A,M,!0),Y=[];if(!D||D.next===D.prev)return Y;var K,J,re,fe,le,he,xe;if(X&&(D=h(w,I,D,M)),w.length>80*M){K=re=w[0],J=fe=w[1];for(var ye=M;ye<A;ye+=M)le=w[ye],he=w[ye+1],le<K&&(K=le),he<J&&(J=he),le>re&&(re=le),he>fe&&(fe=he);xe=Math.max(re-K,fe-J),xe=xe!==0?32767/xe:0}return n(D,Y,M,K,J,xe,0),Y}function e(w,I,M,X,A){var D,Y;if(A===Pe(w,I,M,X)>0)for(D=I;D<M;D+=X)Y=ge(D,w[D],w[D+1],Y);else for(D=M-X;D>=I;D-=X)Y=ge(D,w[D],w[D+1],Y);return Y&&j(Y,Y.next)&&(ce(Y),Y=Y.next),Y}function i(w,I){if(!w)return w;I||(I=w);var M=w,X;do if(X=!1,!M.steiner&&(j(M,M.next)||P(M.prev,M,M.next)===0)){if(ce(M),M=I=M.prev,M===M.next)break;X=!0}else M=M.next;while(X||M!==I);return I}function n(w,I,M,X,A,D,Y){if(w){!Y&&D&&T(w,X,A,D);for(var K=w,J,re;w.prev!==w.next;){if(J=w.prev,re=w.next,D?o(w,X,A,D):r(w)){I.push(J.i/M|0),I.push(w.i/M|0),I.push(re.i/M|0),ce(w),w=re.next,K=re.next;continue}if(w=re,w===K){Y?Y===1?(w=c(i(w),I,M),n(w,I,M,X,A,D,2)):Y===2&&f(w,I,M,X,A,D):n(i(w),I,M,X,A,D,1);break}}}}function r(w){var I=w.prev,M=w,X=w.next;if(P(I,M,X)>=0)return!1;for(var A=I.x,D=M.x,Y=X.x,K=I.y,J=M.y,re=X.y,fe=A<D?A<Y?A:Y:D<Y?D:Y,le=K<J?K<re?K:re:J<re?J:re,he=A>D?A>Y?A:Y:D>Y?D:Y,xe=K>J?K>re?K:re:J>re?J:re,ye=X.next;ye!==I;){if(ye.x>=fe&&ye.x<=he&&ye.y>=le&&ye.y<=xe&&N(A,K,D,J,Y,re,ye.x,ye.y)&&P(ye.prev,ye,ye.next)>=0)return!1;ye=ye.next}return!0}function o(w,I,M,X){var A=w.prev,D=w,Y=w.next;if(P(A,D,Y)>=0)return!1;for(var K=A.x,J=D.x,re=Y.x,fe=A.y,le=D.y,he=Y.y,xe=K<J?K<re?K:re:J<re?J:re,ye=fe<le?fe<he?fe:he:le<he?le:he,Tt=K>J?K>re?K:re:J>re?J:re,ii=fe>le?fe>he?fe:he:le>he?le:he,ni=x(xe,ye,I,M,X),Un=x(Tt,ii,I,M,X),Ne=w.prevZ,Ce=w.nextZ;Ne&&Ne.z>=ni&&Ce&&Ce.z<=Un;){if(Ne.x>=xe&&Ne.x<=Tt&&Ne.y>=ye&&Ne.y<=ii&&Ne!==A&&Ne!==Y&&N(K,fe,J,le,re,he,Ne.x,Ne.y)&&P(Ne.prev,Ne,Ne.next)>=0||(Ne=Ne.prevZ,Ce.x>=xe&&Ce.x<=Tt&&Ce.y>=ye&&Ce.y<=ii&&Ce!==A&&Ce!==Y&&N(K,fe,J,le,re,he,Ce.x,Ce.y)&&P(Ce.prev,Ce,Ce.next)>=0))return!1;Ce=Ce.nextZ}for(;Ne&&Ne.z>=ni;){if(Ne.x>=xe&&Ne.x<=Tt&&Ne.y>=ye&&Ne.y<=ii&&Ne!==A&&Ne!==Y&&N(K,fe,J,le,re,he,Ne.x,Ne.y)&&P(Ne.prev,Ne,Ne.next)>=0)return!1;Ne=Ne.prevZ}for(;Ce&&Ce.z<=Un;){if(Ce.x>=xe&&Ce.x<=Tt&&Ce.y>=ye&&Ce.y<=ii&&Ce!==A&&Ce!==Y&&N(K,fe,J,le,re,he,Ce.x,Ce.y)&&P(Ce.prev,Ce,Ce.next)>=0)return!1;Ce=Ce.nextZ}return!0}function c(w,I,M){var X=w;do{var A=X.prev,D=X.next.next;!j(A,D)&&z(A,X,X.next,D)&&G(A,D)&&G(D,A)&&(I.push(A.i/M|0),I.push(X.i/M|0),I.push(D.i/M|0),ce(X),ce(X.next),X=w=D),X=X.next}while(X!==w);return i(X)}function f(w,I,M,X,A,D){var Y=w;do{for(var K=Y.next.next;K!==Y.prev;){if(Y.i!==K.i&&B(Y,K)){var J=te(Y,K);Y=i(Y,Y.next),J=i(J,J.next),n(Y,I,M,X,A,D,0),n(J,I,M,X,A,D,0);return}K=K.next}Y=Y.next}while(Y!==w)}function h(w,I,M,X){var A=[],D,Y,K,J,re;for(D=0,Y=I.length;D<Y;D++)K=I[D]*X,J=D<Y-1?I[D+1]*X:w.length,re=e(w,K,J,X,!1),re===re.next&&(re.steiner=!0),A.push(O(re));for(A.sort(g),D=0;D<A.length;D++)M=_(A[D],M);return M}function g(w,I){return w.x-I.x}function _(w,I){var M=m(w,I);if(!M)return I;var X=te(M,w);return i(X,X.next),i(M,M.next)}function m(w,I){var M=I,X=w.x,A=w.y,D=-1/0,Y;do{if(A<=M.y&&A>=M.next.y&&M.next.y!==M.y){var K=M.x+(A-M.y)*(M.next.x-M.x)/(M.next.y-M.y);if(K<=X&&K>D&&(D=K,Y=M.x<M.next.x?M:M.next,K===X))return Y}M=M.next}while(M!==I);if(!Y)return null;var J=Y,re=Y.x,fe=Y.y,le=1/0,he;M=Y;do X>=M.x&&M.x>=re&&X!==M.x&&N(A<fe?X:D,A,re,fe,A<fe?D:X,A,M.x,M.y)&&(he=Math.abs(A-M.y)/(X-M.x),G(M,w)&&(he<le||he===le&&(M.x>Y.x||M.x===Y.x&&y(Y,M)))&&(Y=M,le=he)),M=M.next;while(M!==J);return Y}function y(w,I){return P(w.prev,w,I.prev)<0&&P(I.next,w,w.next)<0}function T(w,I,M,X){var A=w;do A.z===0&&(A.z=x(A.x,A.y,I,M,X)),A.prevZ=A.prev,A.nextZ=A.next,A=A.next;while(A!==w);A.prevZ.nextZ=null,A.prevZ=null,R(A)}function R(w){var I,M,X,A,D,Y,K,J,re=1;do{for(M=w,w=null,D=null,Y=0;M;){for(Y++,X=M,K=0,I=0;I<re&&(K++,X=X.nextZ,!!X);I++);for(J=re;K>0||J>0&&X;)K!==0&&(J===0||!X||M.z<=X.z)?(A=M,M=M.nextZ,K--):(A=X,X=X.nextZ,J--),D?D.nextZ=A:w=A,A.prevZ=D,D=A;M=X}D.nextZ=null,re*=2}while(Y>1);return w}function x(w,I,M,X,A){return w=(w-M)*A|0,I=(I-X)*A|0,w=(w|w<<8)&16711935,w=(w|w<<4)&252645135,w=(w|w<<2)&858993459,w=(w|w<<1)&1431655765,I=(I|I<<8)&16711935,I=(I|I<<4)&252645135,I=(I|I<<2)&858993459,I=(I|I<<1)&1431655765,w|I<<1}function O(w){var I=w,M=w;do(I.x<M.x||I.x===M.x&&I.y<M.y)&&(M=I),I=I.next;while(I!==w);return M}function N(w,I,M,X,A,D,Y,K){return(A-Y)*(I-K)>=(w-Y)*(D-K)&&(w-Y)*(X-K)>=(M-Y)*(I-K)&&(M-Y)*(D-K)>=(A-Y)*(X-K)}function B(w,I){return w.next.i!==I.i&&w.prev.i!==I.i&&!oe(w,I)&&(G(w,I)&&G(I,w)&&ae(w,I)&&(P(w.prev,w,I.prev)||P(w,I.prev,I))||j(w,I)&&P(w.prev,w,w.next)>0&&P(I.prev,I,I.next)>0)}function P(w,I,M){return(I.y-w.y)*(M.x-I.x)-(I.x-w.x)*(M.y-I.y)}function j(w,I){return w.x===I.x&&w.y===I.y}function z(w,I,M,X){var A=ue(P(w,I,M)),D=ue(P(w,I,X)),Y=ue(P(M,X,w)),K=ue(P(M,X,I));return!!(A!==D&&Y!==K||A===0&&q(w,M,I)||D===0&&q(w,X,I)||Y===0&&q(M,w,X)||K===0&&q(M,I,X))}function q(w,I,M){return I.x<=Math.max(w.x,M.x)&&I.x>=Math.min(w.x,M.x)&&I.y<=Math.max(w.y,M.y)&&I.y>=Math.min(w.y,M.y)}function ue(w){return w>0?1:w<0?-1:0}function oe(w,I){var M=w;do{if(M.i!==w.i&&M.next.i!==w.i&&M.i!==I.i&&M.next.i!==I.i&&z(M,M.next,w,I))return!0;M=M.next}while(M!==w);return!1}function G(w,I){return P(w.prev,w,w.next)<0?P(w,I,w.next)>=0&&P(w,w.prev,I)>=0:P(w,I,w.prev)<0||P(w,w.next,I)<0}function ae(w,I){var M=w,X=!1,A=(w.x+I.x)/2,D=(w.y+I.y)/2;do M.y>D!=M.next.y>D&&M.next.y!==M.y&&A<(M.next.x-M.x)*(D-M.y)/(M.next.y-M.y)+M.x&&(X=!X),M=M.next;while(M!==w);return X}function te(w,I){var M=new _e(w.i,w.x,w.y),X=new _e(I.i,I.x,I.y),A=w.next,D=I.prev;return w.next=I,I.prev=w,M.next=A,A.prev=M,X.next=M,M.prev=X,D.next=X,X.prev=D,X}function ge(w,I,M,X){var A=new _e(w,I,M);return X?(A.next=X.next,A.prev=X,X.next.prev=A,X.next=A):(A.prev=A,A.next=A),A}function ce(w){w.next.prev=w.prev,w.prev.next=w.next,w.prevZ&&(w.prevZ.nextZ=w.nextZ),w.nextZ&&(w.nextZ.prevZ=w.prevZ)}function _e(w,I,M){this.i=w,this.x=I,this.y=M,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}t.deviation=function(w,I,M,X){var A=I&&I.length,D=A?I[0]*M:w.length,Y=Math.abs(Pe(w,0,D,M));if(A)for(var K=0,J=I.length;K<J;K++){var re=I[K]*M,fe=K<J-1?I[K+1]*M:w.length;Y-=Math.abs(Pe(w,re,fe,M))}var le=0;for(K=0;K<X.length;K+=3){var he=X[K]*M,xe=X[K+1]*M,ye=X[K+2]*M;le+=Math.abs((w[he]-w[ye])*(w[xe+1]-w[he+1])-(w[he]-w[xe])*(w[ye+1]-w[he+1]))}return Y===0&&le===0?0:Math.abs((le-Y)/Y)};function Pe(w,I,M,X){for(var A=0,D=I,Y=M-X;D<M;D+=X)A+=(w[Y]-w[D])*(w[D+1]+w[Y+1]),Y=D;return A}return t.flatten=function(w){for(var I=w[0][0].length,M={vertices:[],holes:[],dimensions:I},X=0,A=0;A<w.length;A++){for(var D=0;D<w[A].length;D++)for(var Y=0;Y<I;Y++)M.vertices.push(w[A][D][Y]);A>0&&(X+=w[A-1].length,M.holes.push(X))}return M},Kl.exports}var t4=e4();const i4=Qv(t4),Zl=fA.CLOCKWISE,uv=fA.COUNTER_CLOCKWISE,In={};function n4(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function $a(t){return"positions"in t?t.positions:t}function lc(t){return"holeIndices"in t?t.holeIndices:null}function s4(t){return Array.isArray(t[0])}function r4(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function a4(t){const e=t[0],i=t[t.length-1];return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]}function o4(t,e,i,n){for(let r=0;r<e;r++)if(t[i+r]!==t[n-e+r])return!1;return!0}function fv(t,e,i,n,r){let o=e;const c=i.length;for(let f=0;f<c;f++)for(let h=0;h<n;h++)t[o++]=i[f][h]||0;if(!a4(i))for(let f=0;f<n;f++)t[o++]=i[0][f]||0;return In.start=e,In.end=o,In.size=n,hA(t,r,In),o}function hv(t,e,i,n,r=0,o,c){o=o||i.length;const f=o-r;if(f<=0)return e;let h=e;for(let g=0;g<f;g++)t[h++]=i[r+g];if(!o4(i,n,r,o))for(let g=0;g<n;g++)t[h++]=i[r+g];return In.start=e,In.end=h,In.size=n,hA(t,c,In),h}function l4(t,e){n4(t);const i=[],n=[];if("positions"in t){const{positions:r,holeIndices:o}=t;if(o){let c=0;for(let f=0;f<=o.length;f++)c=hv(i,c,r,e,o[f-1],o[f],f===0?Zl:uv),n.push(c);return n.pop(),{positions:i,holeIndices:n}}t=r}if(!s4(t))return hv(i,0,t,e,0,i.length,Zl),i;if(!r4(t)){let r=0;for(const[o,c]of t.entries())r=fv(i,r,c,e,o===0?Zl:uv),n.push(r);return n.pop(),{positions:i,holeIndices:n}}return fv(i,0,t,e,Zl),i}function _d(t,e,i){const n=t.length/3;let r=0;for(let o=0;o<n;o++){const c=(o+1)%n;r+=t[o*3+e]*t[c*3+i],r-=t[c*3+e]*t[o*3+i]}return Math.abs(r/2)}function dv(t,e,i,n){const r=t.length/3;for(let o=0;o<r;o++){const c=o*3,f=t[c+0],h=t[c+1],g=t[c+2];t[c+e]=f,t[c+i]=h,t[c+n]=g}}function c4(t,e,i,n){let r=lc(t);r&&(r=r.map(f=>f/e));let o=$a(t);const c=n&&e===3;if(i){const f=o.length;o=o.slice();const h=[];for(let g=0;g<f;g+=e){h[0]=o[g],h[1]=o[g+1],c&&(h[2]=o[g+2]);const _=i(h);o[g]=_[0],o[g+1]=_[1],c&&(o[g+2]=_[2])}}if(c){const f=_d(o,0,1),h=_d(o,0,2),g=_d(o,1,2);if(!f&&!h&&!g)return[];f>h&&f>g||(h>g?(i||(o=o.slice()),dv(o,0,2,1)):(i||(o=o.slice()),dv(o,2,0,1)))}return i4(o,r,e)}class u4 extends oA{constructor(e){const{fp64:i,IndexType:n=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:i?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:n,size:1}}})}get(e){const{attributes:i}=this;return e==="indices"?i.indices&&i.indices.subarray(0,this.vertexCount):i[e]}updateGeometry(e){super.updateGeometry(e);const i=this.buffers.indices;if(i)this.vertexCount=(i.value||i).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const i=l4(e,this.positionSize);return this.opts.resolution?gA($a(i),lc(i),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?jk($a(i),lc(i),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):i}return e}getGeometrySize(e){if(gv(e)){let i=0;for(const n of e)i+=this.getGeometrySize(n);return i}return $a(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,i){if(e&&gv(e))for(const n of e){const r=this.getGeometrySize(n);i.geometrySize=r,this.updateGeometryAttributes(n,i),i.vertexStart+=r,i.indexStart=this.indexStarts[i.geometryIndex+1]}else{const n=e;this._updateIndices(n,i),this._updatePositions(n,i),this._updateVertexValid(n,i)}}_updateIndices(e,{geometryIndex:i,vertexStart:n,indexStart:r}){const{attributes:o,indexStarts:c,typedArrayManager:f}=this;let h=o.indices;if(!h||!e)return;let g=r;const _=c4(e,this.positionSize,this.opts.preproject,this.opts.full3d);h=f.allocate(h,r+_.length,{copy:!0});for(let m=0;m<_.length;m++)h[g++]=_[m]+n;c[i+1]=r+_.length,o.indices=h}_updatePositions(e,{vertexStart:i,geometrySize:n}){const{attributes:{positions:r},positionSize:o}=this;if(!r||!e)return;const c=$a(e);for(let f=i,h=0;h<n;f++,h++){const g=c[h*o],_=c[h*o+1],m=o>2?c[h*o+2]:0;r[f*3]=g,r[f*3+1]=_,r[f*3+2]=m}}_updateVertexValid(e,{vertexStart:i,geometrySize:n}){const{positionSize:r}=this,o=this.attributes.vertexValid,c=e&&lc(e);if(e&&e.edgeTypes?o.set(e.edgeTypes,i):o.fill(1,i,i+n),c)for(let f=0;f<c.length;f++)o[i+c[f]/r-1]=0;o[i+n-1]=0}}function gv(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const pv=`uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,f4={name:"solidPolygon",vs:pv,fs:pv,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},bA=`in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,h4=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${bA}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,d4=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${bA}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,g4=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Fc=[0,0,0,255],p4={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:Fc},getLineColor:{type:"accessor",value:Fc},material:!0},Ql={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class Yg extends Gi{getShaders(e){return super.getShaders({vs:e==="top"?h4:d4,fs:g4,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[po,sS,_o,f4]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:i}=this.props;const{_full3d:n}=this.props;e.isGeospatial&&i===Ue.DEFAULT&&(i=Ue.LNGLAT);let r;i===Ue.LNGLAT&&(n?r=e.projectPosition.bind(e):r=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new u4({preproject:r,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const o=this.getAttributeManager(),c=!0;o.remove(["instancePickingColors"]),o.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:c},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:Ql,accessor:"getPolygon",update:this.calculatePositions,noAlloc:c,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:c},elevations:{size:1,stepMode:"dynamic",transition:Ql,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:Ql,accessor:"getFillColor",defaultValue:Fc},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:Ql,accessor:"getLineColor",defaultValue:Fc},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(f,{index:h,target:g})=>this.encodePickingColor(f&&f.__source?f.__source.index:h,g)}})}getPickingInfo(e){const i=super.getPickingInfo(e),{index:n}=i,r=this.props.data;return r[0]&&r[0].__source&&(i.object=r.find(o=>o.__source.index===n)),i}disablePickingIndex(e){const i=this.props.data;if(i[0]&&i[0].__source)for(let n=0;n<i.length;n++)i[n].__source.index===e&&this._disablePickingIndex(n);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:i,filled:n,wireframe:r,elevationScale:o}=this.props,{topModel:c,sideModel:f,wireframeModel:h,polygonTesselator:g}=this.state,_={extruded:!!i,elevationScale:o,isWireframe:!1};h&&r&&(h.setInstanceCount(g.instanceCount-1),h.shaderInputs.setProps({solidPolygon:{..._,isWireframe:!0}}),h.draw(this.context.renderPass)),f&&n&&(f.setInstanceCount(g.instanceCount-1),f.shaderInputs.setProps({solidPolygon:_}),f.draw(this.context.renderPass)),c&&n&&(c.setVertexCount(g.vertexCount),c.shaderInputs.setProps({solidPolygon:_}),c.draw(this.context.renderPass))}updateState(e){var f;super.updateState(e),this.updateGeometry(e);const{props:i,oldProps:n,changeFlags:r}=e,o=this.getAttributeManager();(r.extensionsChanged||i.filled!==n.filled||i.extruded!==n.extruded)&&((f=this.state.models)==null||f.forEach(h=>h.destroy()),this.setState(this._getModels()),o.invalidateAll())}updateGeometry({props:e,oldProps:i,changeFlags:n}){if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon)){const{polygonTesselator:o}=this.state,c=e.data.attributes||{};o.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:c.getPolygon,buffers:c,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:n.dataChanged,full3d:e._full3d}),this.setState({numInstances:o.instanceCount,startIndices:o.vertexStarts}),n.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:i,extruded:n}=this.props;let r,o,c;if(i){const f=this.getShaders("top");f.defines.NON_INSTANCED_MODEL=1;const h=this.getAttributeManager().getBufferLayouts({isInstanced:!1});r=new gi(this.context.device,{...f,id:`${e}-top`,topology:"triangle-list",bufferLayout:h,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(n){const f=this.getAttributeManager().getBufferLayouts({isInstanced:!0});o=new gi(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:f,geometry:new Dr({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),c=new gi(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:f,geometry:new Dr({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[o,c,r].filter(Boolean),topModel:r,sideModel:o,wireframeModel:c}}calculateIndices(e){const{polygonTesselator:i}=this.state;e.startIndices=i.indexStarts,e.value=i.get("indices")}calculatePositions(e){const{polygonTesselator:i}=this.state;e.startIndices=i.vertexStarts,e.value=i.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}Yg.defaultProps=p4;Yg.layerName="SolidPolygonLayer";function _4({data:t,getIndex:e,dataRange:i,replace:n}){const{startRow:r=0,endRow:o=1/0}=i,c=t.length;let f=c,h=c;for(let y=0;y<c;y++){const T=e(t[y]);if(f>y&&T>=r&&(f=y),T>=o){h=y;break}}let g=f;const m=h-f!==n.length?t.slice(h):void 0;for(let y=0;y<n.length;y++)t[g++]=n[y];if(m){for(let y=0;y<m.length;y++)t[g++]=m[y];t.length=g}return{startRow:f,endRow:f+n.length}}function m4(t,e){if(!t)return null;const i="startIndices"in t?t.startIndices[e]:e,n=t.featureIds.value[i];return i!==-1?y4(t,n,i):null}function y4(t,e,i){const n={properties:{...t.properties[e]}};for(const r in t.numericProps)n.properties[r]=t.numericProps[r].value[i];return n}function b4(t,e){const i={points:null,lines:null,polygons:null};for(const n in i){const r=t[n].globalFeatureIds.value;i[n]=new Uint8ClampedArray(r.length*4);const o=[];for(let c=0;c<r.length;c++)e(r[c],o),i[n][c*4+0]=o[0],i[n][c*4+1]=o[1],i[n][c*4+2]=o[2],i[n][c*4+3]=255}return i}const _v=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,v4={name:"sdf",vs:_v,fs:_v,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},T4=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,md=192/256,mv=[],S4={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class qg extends yu{getShaders(){const e=super.getShaders();return{...e,modules:[...e.modules,v4],fs:T4}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(i,{index:n,target:r})=>this.encodePickingColor(n,r)}})}updateState(e){super.updateState(e);const{props:i,oldProps:n}=e;let{outlineColor:r}=i;r!==n.outlineColor&&(r=r.map(o=>o/255),r[3]=Number.isFinite(r[3])?r[3]:1,this.setState({outlineColor:r})),!i.sdf&&i.outlineWidth&&Oe.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:i,smoothing:n,outlineWidth:r}=this.props,{outlineColor:o}=this.state,c=r?Math.max(n,md*(1-r)):-1,f=this.state.model,h={buffer:md,outlineBuffer:c,gamma:n,enabled:!!i,outlineColor:o};if(f.shaderInputs.setProps({sdf:h}),super.draw(e),i&&r){const{iconManager:g}=this.state;g.getTexture()&&(f.shaderInputs.setProps({sdf:{...h,outlineBuffer:md}}),f.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(i=>super.getInstanceOffset(i)):mv}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(i=>super.getInstanceIconFrame(i)):mv}}qg.defaultProps=S4;qg.layerName="MultiIconLayer";const Lc=1e20;class A4{constructor({fontSize:e=24,buffer:i=3,radius:n=8,cutoff:r=.25,fontFamily:o="sans-serif",fontWeight:c="normal",fontStyle:f="normal"}={}){this.buffer=i,this.cutoff=r,this.radius=n;const h=this.size=e+i*4,g=this._createCanvas(h),_=this.ctx=g.getContext("2d",{willReadFrequently:!0});_.font=`${f} ${c} ${e}px ${o}`,_.textBaseline="alphabetic",_.textAlign="left",_.fillStyle="black",this.gridOuter=new Float64Array(h*h),this.gridInner=new Float64Array(h*h),this.f=new Float64Array(h),this.z=new Float64Array(h+1),this.v=new Uint16Array(h)}_createCanvas(e){const i=document.createElement("canvas");return i.width=i.height=e,i}draw(e){const{width:i,actualBoundingBoxAscent:n,actualBoundingBoxDescent:r,actualBoundingBoxLeft:o,actualBoundingBoxRight:c}=this.ctx.measureText(e),f=Math.ceil(n),h=0,g=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(c-o))),_=Math.min(this.size-this.buffer,f+Math.ceil(r)),m=g+2*this.buffer,y=_+2*this.buffer,T=Math.max(m*y,0),R=new Uint8ClampedArray(T),x={data:R,width:m,height:y,glyphWidth:g,glyphHeight:_,glyphTop:f,glyphLeft:h,glyphAdvance:i};if(g===0||_===0)return x;const{ctx:O,buffer:N,gridInner:B,gridOuter:P}=this;O.clearRect(N,N,g,_),O.fillText(e,N,N+f);const j=O.getImageData(N,N,g,_);P.fill(Lc,0,T),B.fill(0,0,T);for(let z=0;z<_;z++)for(let q=0;q<g;q++){const ue=j.data[4*(z*g+q)+3]/255;if(ue===0)continue;const oe=(z+N)*m+q+N;if(ue===1)P[oe]=0,B[oe]=Lc;else{const G=.5-ue;P[oe]=G>0?G*G:0,B[oe]=G<0?G*G:0}}yv(P,0,0,m,y,m,this.f,this.v,this.z),yv(B,N,N,g,_,m,this.f,this.v,this.z);for(let z=0;z<T;z++){const q=Math.sqrt(P[z])-Math.sqrt(B[z]);R[z]=Math.round(255-255*(q/this.radius+this.cutoff))}return x}}function yv(t,e,i,n,r,o,c,f,h){for(let g=e;g<e+n;g++)bv(t,i*o+g,o,r,c,f,h);for(let g=i;g<i+r;g++)bv(t,g*o+e,1,n,c,f,h)}function bv(t,e,i,n,r,o,c){o[0]=0,c[0]=-1e20,c[1]=Lc,r[0]=t[e];for(let f=1,h=0,g=0;f<n;f++){r[f]=t[e+f*i];const _=f*f;do{const m=o[h];g=(r[f]-r[m]+_-m*m)/(f-m)/2}while(g<=c[h]&&--h>-1);h++,o[h]=f,c[h]=g,c[h+1]=Lc}for(let f=0,h=0;f<n;f++){for(;c[h+1]<f;)h++;const g=o[h],_=f-g;t[e+f*i]=r[g]+_*_}}const E4=32,w4=[];function R4(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function x4({characterSet:t,getFontWidth:e,fontHeight:i,buffer:n,maxCanvasWidth:r,mapping:o={},xOffset:c=0,yOffset:f=0}){let h=0,g=c;const _=i+n*2;for(const m of t)if(!o[m]){const y=e(m);g+y+n*2>r&&(g=0,h++),o[m]={x:g+n,y:f+h*_+n,width:y,height:_,layoutWidth:y,layoutHeight:i},g+=y+n*2}return{mapping:o,xOffset:g,yOffset:f+h*_,canvasHeight:R4(f+(h+1)*_)}}function vA(t,e,i,n){var o;let r=0;for(let c=e;c<i;c++){const f=t[c];r+=((o=n[f])==null?void 0:o.layoutWidth)||0}return r}function TA(t,e,i,n,r,o){let c=e,f=0;for(let h=e;h<i;h++){const g=vA(t,h,h+1,r);f+g>n&&(c<h&&o.push(h),c=h,f=0),f+=g}return f}function C4(t,e,i,n,r,o){let c=e,f=e,h=e,g=0;for(let _=e;_<i;_++)if((t[_]===" "||t[_+1]===" "||_+1===i)&&(h=_+1),h>f){let m=vA(t,f,h,r);g+m>n&&(c<f&&(o.push(f),c=f,g=0),m>n&&(m=TA(t,f,h,n,r,o),c=o[o.length-1])),f=h,g+=m}return g}function M4(t,e,i,n,r=0,o){o===void 0&&(o=t.length);const c=[];return e==="break-all"?TA(t,r,o,i,n,c):C4(t,r,o,i,n,c),c}function O4(t,e,i,n,r,o){let c=0,f=0;for(let h=e;h<i;h++){const g=t[h],_=n[g];_?(f||(f=_.layoutHeight),r[h]=c+_.layoutWidth/2,c+=_.layoutWidth):(Oe.warn(`Missing character: ${g} (${g.codePointAt(0)})`)(),r[h]=c,c+=E4)}o[0]=c,o[1]=f}function P4(t,e,i,n,r){var O;const o=Array.from(t),c=o.length,f=new Array(c),h=new Array(c),g=new Array(c),_=(i==="break-word"||i==="break-all")&&isFinite(n)&&n>0,m=[0,0],y=[0,0];let T=0,R=0,x=0;for(let N=0;N<=c;N++){const B=o[N];if((B===`
`||N===c)&&(x=N),x>R){const P=_?M4(o,i,n,r,R,x):w4;for(let j=0;j<=P.length;j++){const z=j===0?R:P[j-1],q=j<P.length?P[j]:x;O4(o,z,q,r,f,y);for(let ue=z;ue<q;ue++){const oe=o[ue],G=((O=r[oe])==null?void 0:O.layoutOffsetY)||0;h[ue]=T+y[1]/2+G,g[ue]=y[0]}T=T+y[1]*e,m[0]=Math.max(m[0],y[0])}R=x}B===`
`&&(f[R]=0,h[R]=0,g[R]=0,R++)}return m[1]=T,{x:f,y:h,rowWidth:g,size:m}}function N4({value:t,length:e,stride:i,offset:n,startIndices:r,characterSet:o}){const c=t.BYTES_PER_ELEMENT,f=i?i/c:1,h=n?n/c:0,g=r[e]||Math.ceil((t.length-h)/f),_=o&&new Set,m=new Array(e);let y=t;if(f>1||h>0){const T=t.constructor;y=new T(g);for(let R=0;R<g;R++)y[R]=t[R*f+h]}for(let T=0;T<e;T++){const R=r[T],x=r[T+1]||g,O=y.subarray(R,x);m[T]=String.fromCodePoint.apply(null,O),_&&O.forEach(_.add,_)}if(_)for(const T of _)o.add(String.fromCodePoint(T));return{texts:m,characterCount:g}}class SA{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const i=this._cache[e];return i&&(this._deleteOrder(e),this._appendOrder(e)),i}set(e,i){this._cache[e]?(this.delete(e),this._cache[e]=i,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=i,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const i=this._order.indexOf(e);i>=0&&this._order.splice(i,1)}_appendOrder(e){this._order.push(e)}}function I4(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const Ar={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:I4(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},vv=1024,Tv=.9,Sv=1.2,AA=3;let zc=new SA(AA);function D4(t,e){let i;typeof e=="string"?i=new Set(Array.from(e)):i=new Set(e);const n=zc.get(t);if(!n)return i;for(const r in n.mapping)i.has(r)&&i.delete(r);return i}function k4(t,e){for(let i=0;i<t.length;i++)e.data[4*i+3]=t[i]}function Av(t,e,i,n){t.font=`${n} ${i}px ${e}`,t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function B4(t){Oe.assert(Number.isFinite(t)&&t>=AA,"Invalid cache limit"),zc=new SA(t)}class U4{constructor(){this.props={...Ar}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:i}=this.props;return(e*Sv+i*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const i=D4(this._key,this.props.characterSet),n=zc.get(this._key);if(n&&i.size===0){this._atlas!==n&&(this._atlas=n);return}const r=this._generateFontAtlas(i,n);this._atlas=r,zc.set(this._key,r)}_generateFontAtlas(e,i){const{fontFamily:n,fontWeight:r,fontSize:o,buffer:c,sdf:f,radius:h,cutoff:g}=this.props;let _=i&&i.data;_||(_=document.createElement("canvas"),_.width=vv);const m=_.getContext("2d",{willReadFrequently:!0});Av(m,n,o,r);const{mapping:y,canvasHeight:T,xOffset:R,yOffset:x}=x4({getFontWidth:O=>m.measureText(O).width,fontHeight:o*Sv,buffer:c,characterSet:e,maxCanvasWidth:vv,...i&&{mapping:i.mapping,xOffset:i.xOffset,yOffset:i.yOffset}});if(_.height!==T){const O=m.getImageData(0,0,_.width,_.height);_.height=T,m.putImageData(O,0,0)}if(Av(m,n,o,r),f){const O=new A4({fontSize:o,buffer:c,radius:h,cutoff:g,fontFamily:n,fontWeight:`${r}`});for(const N of e){const{data:B,width:P,height:j,glyphTop:z}=O.draw(N);y[N].width=P,y[N].layoutOffsetY=o*Tv-z;const q=m.createImageData(P,j);k4(B,q),m.putImageData(q,y[N].x,y[N].y)}}else for(const O of e)m.fillText(O,y[O].x,y[O].y+c+o*Tv);return{xOffset:R,yOffset:x,mapping:y,data:_,width:_.width,height:_.height}}_getKey(){const{fontFamily:e,fontWeight:i,fontSize:n,buffer:r,sdf:o,radius:c,cutoff:f}=this.props;return o?`${e} ${i} ${n} ${r} ${c} ${f}`:`${e} ${i} ${n} ${r}`}}const Ev=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,F4={name:"textBackground",vs:Ev,fs:Ev,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},L4=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,z4=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec2 pixelPosition = uv * dimensions;
if (textBackground.stroked) {
float distToEdge = min(
min(pixelPosition.x, dimensions.x - pixelPosition.x),
min(pixelPosition.y, dimensions.y - pixelPosition.y)
);
float isBorder = smoothedge(distToEdge, vLineWidth);
fragColor = mix(vFillColor, vLineColor, isBorder);
} else {
fragColor = vFillColor;
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,V4={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class Kg extends Gi{getShaders(){return super.getShaders({vs:L4,fs:z4,modules:[po,_o,F4]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var n;super.updateState(e);const{changeFlags:i}=e;i.extensionsChanged&&((n=this.state.model)==null||n.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:i,sizeScale:n,sizeUnits:r,sizeMinPixels:o,sizeMaxPixels:c,getLineWidth:f}=this.props;let{padding:h}=this.props;h.length<4&&(h=[h[0],h[1],h[0],h[1]]);const g=this.state.model,_={billboard:i,stroked:!!f,padding:h,sizeUnits:bs[r],sizeScale:n,sizeMinPixels:o,sizeMaxPixels:c};g.shaderInputs.setProps({textBackground:_}),g.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,0,1,1,1];return new gi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Dr({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}}Kg.defaultProps=V4;Kg.layerName="TextBackgroundLayer";const wv={start:1,middle:0,end:-1},Rv={top:1,center:0,bottom:-1},yd=[0,0,0,255],H4=1,j4={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:yd},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Ar.characterSet},fontFamily:Ar.fontFamily,fontWeight:Ar.fontWeight,lineHeight:H4,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:yd},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:yd},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class vu extends Xg{constructor(){super(...arguments),this.getBoundingRect=(e,i)=>{let{size:[n,r]}=this.transformParagraph(e,i);const{fontSize:o}=this.state.fontAtlasManager.props;n/=o,r/=o;const{getTextAnchor:c,getAlignmentBaseline:f}=this.props,h=wv[typeof c=="function"?c(e,i):c],g=Rv[typeof f=="function"?f(e,i):f];return[(h-1)*n/2,(g-1)*r/2,n,r]},this.getIconOffsets=(e,i)=>{const{getTextAnchor:n,getAlignmentBaseline:r}=this.props,{x:o,y:c,rowWidth:f,size:[h,g]}=this.transformParagraph(e,i),_=wv[typeof n=="function"?n(e,i):n],m=Rv[typeof r=="function"?r(e,i):r],y=o.length,T=new Array(y*2);let R=0;for(let x=0;x<y;x++){const O=(1-_)*(h-f[x])/2;T[R++]=(_-1)*h/2+O+o[x],T[R++]=(m-1)*g/2+c[x]}return T}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new U4},this.props.maxWidth>0&&Oe.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:i,oldProps:n,changeFlags:r}=e;(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||i.lineHeight!==n.lineHeight||i.wordBreak!==n.wordBreak||i.maxWidth!==n.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:i,fontWeight:n}=this.props,{fontAtlasManager:r,characterSet:o}=this.state,c={...e,characterSet:o,fontFamily:i,fontWeight:n};if(!r.mapping)return r.setProps(c),!0;for(const f in c)if(c[f]!==r.props[f])return r.setProps(c),!0;return!1}_updateText(){var h;const{data:e,characterSet:i}=this.props,n=(h=e.attributes)==null?void 0:h.getText;let{getText:r}=this.props,o=e.startIndices,c;const f=i==="auto"&&new Set;if(n&&o){const{texts:g,characterCount:_}=N4({...ArrayBuffer.isView(n)?{value:n}:n,length:e.length,startIndices:o,characterSet:f});c=_,r=(m,{index:y})=>g[y]}else{const{iterable:g,objectInfo:_}=pu(e);o=[0],c=0;for(const m of g){_.index++;const y=Array.from(r(m,_)||"");f&&y.forEach(f.add,f),c+=y.length,o.push(c)}}this.setState({getText:r,startIndices:o,numInstances:c,characterSet:f||i})}transformParagraph(e,i){const{fontAtlasManager:n}=this.state,r=n.mapping,o=this.state.getText,{wordBreak:c,lineHeight:f,maxWidth:h}=this.props,g=o(e,i)||"";return P4(g,f,c,h*n.props.fontSize,r)}renderLayers(){const{startIndices:e,numInstances:i,getText:n,fontAtlasManager:{scale:r,atlas:o,mapping:c},styleVersion:f}=this.state,{data:h,_dataDiff:g,getPosition:_,getColor:m,getSize:y,getAngle:T,getPixelOffset:R,getBackgroundColor:x,getBorderColor:O,getBorderWidth:N,backgroundPadding:B,background:P,billboard:j,fontSettings:z,outlineWidth:q,outlineColor:ue,sizeScale:oe,sizeUnits:G,sizeMinPixels:ae,sizeMaxPixels:te,transitions:ge,updateTriggers:ce}=this.props,_e=this.getSubLayerClass("characters",qg),Pe=this.getSubLayerClass("background",Kg);return[P&&new Pe({getFillColor:x,getLineColor:O,getLineWidth:N,padding:B,getPosition:_,getSize:y,getAngle:T,getPixelOffset:R,billboard:j,sizeScale:oe,sizeUnits:G,sizeMinPixels:ae,sizeMaxPixels:te,transitions:ge&&{getPosition:ge.getPosition,getAngle:ge.getAngle,getSize:ge.getSize,getFillColor:ge.getBackgroundColor,getLineColor:ge.getBorderColor,getLineWidth:ge.getBorderWidth,getPixelOffset:ge.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:ce.getPosition,getAngle:ce.getAngle,getSize:ce.getSize,getFillColor:ce.getBackgroundColor,getLineColor:ce.getBorderColor,getLineWidth:ce.getBorderWidth,getPixelOffset:ce.getPixelOffset,getBoundingRect:{getText:ce.getText,getTextAnchor:ce.getTextAnchor,getAlignmentBaseline:ce.getAlignmentBaseline,styleVersion:f}}}),{data:h.attributes&&h.attributes.background?{length:h.length,attributes:h.attributes.background}:h,_dataDiff:g,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new _e({sdf:z.sdf,smoothing:Number.isFinite(z.smoothing)?z.smoothing:Ar.smoothing,outlineWidth:q/(z.radius||Ar.radius),outlineColor:ue,iconAtlas:o,iconMapping:c,getPosition:_,getColor:m,getSize:y,getAngle:T,getPixelOffset:R,billboard:j,sizeScale:oe*r,sizeUnits:G,sizeMinPixels:ae*r,sizeMaxPixels:te*r,transitions:ge&&{getPosition:ge.getPosition,getAngle:ge.getAngle,getColor:ge.getColor,getSize:ge.getSize,getPixelOffset:ge.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:ce.getText,getPosition:ce.getPosition,getAngle:ce.getAngle,getColor:ce.getColor,getSize:ce.getSize,getPixelOffset:ce.getPixelOffset,getIconOffsets:{getTextAnchor:ce.getTextAnchor,getAlignmentBaseline:ce.getAlignmentBaseline,styleVersion:f}}}),{data:h,_dataDiff:g,startIndices:e,numInstances:i,getIconOffsets:this.getIconOffsets,getIcon:n})]}static set fontAtlasCacheLimit(e){B4(e)}}vu.defaultProps=j4;vu.layerName="TextLayer";const cc={circle:{type:bu,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:yu,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:vu,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},uc={type:$g,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},pg={type:Yg,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function za({type:t,props:e}){const i={};for(const n in e)i[n]=t.defaultProps[e[n]];return i}function bd(t,e){const{transitions:i,updateTriggers:n}=t.props,r={updateTriggers:{},transitions:i&&{getPosition:i.geometry}};for(const o in e){const c=e[o];let f=t.props[o];o.startsWith("get")&&(f=t.getSubLayerAccessor(f),r.updateTriggers[c]=n[o],i&&(r.transitions[c]=i[o])),r[c]=f}return r}function W4(t){if(Array.isArray(t))return t;switch(Oe.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return Oe.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function xv(t,e,i={}){const n={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:r=0,endRow:o=t.length}=i;for(let c=r;c<o;c++){const f=t[c],{geometry:h}=f;if(h)if(h.type==="GeometryCollection"){Oe.assert(Array.isArray(h.geometries),"GeoJSON does not have geometries array");const{geometries:g}=h;for(let _=0;_<g.length;_++){const m=g[_];Cv(m,n,e,f,c)}}else Cv(h,n,e,f,c)}return n}function Cv(t,e,i,n,r){const{type:o,coordinates:c}=t,{pointFeatures:f,lineFeatures:h,polygonFeatures:g,polygonOutlineFeatures:_}=e;if(!$4(o,c)){Oe.warn(`${o} coordinates are malformed`)();return}switch(o){case"Point":f.push(i({geometry:t},n,r));break;case"MultiPoint":c.forEach(m=>{f.push(i({geometry:{type:"Point",coordinates:m}},n,r))});break;case"LineString":h.push(i({geometry:t},n,r));break;case"MultiLineString":c.forEach(m=>{h.push(i({geometry:{type:"LineString",coordinates:m}},n,r))});break;case"Polygon":g.push(i({geometry:t},n,r)),c.forEach(m=>{_.push(i({geometry:{type:"LineString",coordinates:m}},n,r))});break;case"MultiPolygon":c.forEach(m=>{g.push(i({geometry:{type:"Polygon",coordinates:m}},n,r)),m.forEach(y=>{_.push(i({geometry:{type:"LineString",coordinates:y}},n,r))})});break}}const X4={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function $4(t,e){let i=X4[t];for(Oe.assert(i,`Unknown GeoJSON type ${t}`);e&&--i>0;)e=e[0];return e&&Number.isFinite(e[0])}function EA(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function Gl(t){return t.geometry.coordinates}function Y4(t,e){const i=EA(),{pointFeatures:n,lineFeatures:r,polygonFeatures:o,polygonOutlineFeatures:c}=t;return i.points.data=n,i.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),i.points.getPosition=Gl,i.lines.data=r,i.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),i.lines.getPath=Gl,i.polygons.data=o,i.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),i.polygons.getPolygon=Gl,i.polygonsOutline.data=c,i.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),i.polygonsOutline.getPath=Gl,i}function q4(t,e){const i=EA(),{points:n,lines:r,polygons:o}=t,c=b4(t,e);return i.points.data={length:n.positions.value.length/n.positions.size,attributes:{...n.attributes,getPosition:n.positions,instancePickingColors:{size:4,value:c.points}},properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},i.lines.data={length:r.pathIndices.value.length-1,startIndices:r.pathIndices.value,attributes:{...r.attributes,getPath:r.positions,instancePickingColors:{size:4,value:c.lines}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},i.lines._pathType="open",i.polygons.data={length:o.polygonIndices.value.length-1,startIndices:o.polygonIndices.value,attributes:{...o.attributes,getPolygon:o.positions,pickingColors:{size:4,value:c.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},i.polygons._normalize=!1,o.triangles&&(i.polygons.data.attributes.indices=o.triangles.value),i.polygonsOutline.data={length:o.primitivePolygonIndices.value.length-1,startIndices:o.primitivePolygonIndices.value,attributes:{...o.attributes,getPath:o.positions,instancePickingColors:{size:4,value:c.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},i.polygonsOutline._pathType="open",i}const K4=["points","linestrings","polygons"],Z4={...za(cc.circle),...za(cc.icon),...za(cc.text),...za(uc),...za(pg),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class yo extends Xg{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:i}){if(!i.dataChanged)return;const{data:n}=this.props,r=n&&"points"in n&&"polygons"in n&&"lines"in n;this.setState({binary:r}),r?this._updateStateBinary({props:e,changeFlags:i}):this._updateStateJSON({props:e,changeFlags:i})}_updateStateBinary({props:e,changeFlags:i}){const n=q4(e.data,this.encodePickingColor);this.setState({layerProps:n})}_updateStateJSON({props:e,changeFlags:i}){const n=W4(e.data),r=this.getSubLayerRow.bind(this);let o={};const c={};if(Array.isArray(i.dataChanged)){const h=this.state.features;for(const g in h)o[g]=h[g].slice(),c[g]=[];for(const g of i.dataChanged){const _=xv(n,r,g);for(const m in h)c[m].push(_4({data:o[m],getIndex:y=>y.__source.index,dataRange:g,replace:_[m]}))}}else o=xv(n,r);const f=Y4(o,c);this.setState({features:o,featuresDiff:c,layerProps:f})}getPickingInfo(e){const i=super.getPickingInfo(e),{index:n,sourceLayer:r}=i;return i.featureType=K4.find(o=>r.id.startsWith(`${this.id}-${o}-`)),n>=0&&r.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(i.index=this.props.data.points.globalFeatureIds.value[n]),i}_updateAutoHighlight(e){const i=`${this.id}-points-`,n=e.featureType==="points";for(const r of this.getSubLayers())r.id.startsWith(i)===n&&r.updateAutoHighlight(e)}_renderPolygonLayer(){var c;const{extruded:e,wireframe:i}=this.props,{layerProps:n}=this.state,r="polygons-fill",o=this.shouldRenderSubLayer(r,(c=n.polygons)==null?void 0:c.data)&&this.getSubLayerClass(r,pg.type);if(o){const f=bd(this,pg.props),h=e&&i;return h||delete f.getLineColor,f.updateTriggers.lineColors=h,new o(f,this.getSubLayerProps({id:r,updateTriggers:f.updateTriggers}),n.polygons)}return null}_renderLineLayers(){var h,g;const{extruded:e,stroked:i}=this.props,{layerProps:n}=this.state,r="polygons-stroke",o="linestrings",c=!e&&i&&this.shouldRenderSubLayer(r,(h=n.polygonsOutline)==null?void 0:h.data)&&this.getSubLayerClass(r,uc.type),f=this.shouldRenderSubLayer(o,(g=n.lines)==null?void 0:g.data)&&this.getSubLayerClass(o,uc.type);if(c||f){const _=bd(this,uc.props);return[c&&new c(_,this.getSubLayerProps({id:r,updateTriggers:_.updateTriggers}),n.polygonsOutline),f&&new f(_,this.getSubLayerProps({id:o,updateTriggers:_.updateTriggers}),n.lines)]}return null}_renderPointLayers(){var f;const{pointType:e}=this.props,{layerProps:i,binary:n}=this.state;let{highlightedObjectIndex:r}=this.props;!n&&Number.isFinite(r)&&(r=i.points.data.findIndex(h=>h.__source.index===r));const o=new Set(e.split("+")),c=[];for(const h of o){const g=`points-${h}`,_=cc[h],m=_&&this.shouldRenderSubLayer(g,(f=i.points)==null?void 0:f.data)&&this.getSubLayerClass(g,_.type);if(m){const y=bd(this,_.props);let T=i.points;if(h==="text"&&n){const{instancePickingColors:R,...x}=T.data.attributes;T={...T,data:{...T.data,attributes:x}}}c.push(new m(y,this.getSubLayerProps({id:g,updateTriggers:y.updateTriggers,highlightedObjectIndex:r}),T))}}return c}renderLayers(){const{extruded:e}=this.props,i=this._renderPolygonLayer(),n=this._renderLineLayers(),r=this._renderPointLayers();return[!e&&i,n,r,e&&i]}getSubLayerAccessor(e){const{binary:i}=this.state;return!i||typeof e!="function"?super.getSubLayerAccessor(e):(n,r)=>{const{data:o,index:c}=r,f=m4(o,c);return e(f,r)}}}yo.layerName="GeoJsonLayer";yo.defaultProps=Z4;const Q4="https://raw.githubusercontent.com/Kirman442/deckgl/main/boundaries/germany_bayern_boundaries.json",G4=()=>{const[t,e]=ee.useState(null),[i,n]=ee.useState(!0);return ee.useEffect(()=>{(async()=>{try{const f=await(await fetch(Q4)).json();e(f)}catch(c){console.error("Error loading regions:",c)}finally{n(!1)}})()},[]),{boundaryData:t,isLoading:i,createGlowLayer:(o,c,f)=>new yo({id:`border-glow-${f}`,data:t,filled:!1,stroked:!0,pickable:!1,opacity:c,getLineColor:[0,0,0],lineWidthMinPixels:o,lineJointRounded:!0,parameters:{blend:!0,depthTest:!0,blendFunc:[WebGLRenderingContext.SRC_ALPHA,WebGLRenderingContext.ONE_MINUS_SRC_ALPHA]}})}};function J4(t,e,i={}){const n={type:"Feature"};return(i.id===0||i.id)&&(n.id=i.id),i.bbox&&(n.bbox=i.bbox),n.properties=e||{},n.geometry=t,n}function eB(t,e,i={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Mv(t[0])||!Mv(t[1]))throw new Error("coordinates must contain numbers");return J4({type:"Point",coordinates:t},e,i)}function Mv(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function wA(t,e,i){if(t!==null)for(var n,r,o,c,f,h,g,_=0,m=0,y,T=t.type,R=T==="FeatureCollection",x=T==="Feature",O=R?t.features.length:1,N=0;N<O;N++){g=R?t.features[N].geometry:x?t.geometry:t,y=g?g.type==="GeometryCollection":!1,f=y?g.geometries.length:1;for(var B=0;B<f;B++){var P=0,j=0;if(c=y?g.geometries[B]:g,c!==null){h=c.coordinates;var z=c.type;switch(_=z==="Polygon"||z==="MultiPolygon"?1:0,z){case null:break;case"Point":if(e(h,m,N,P,j)===!1)return!1;m++,P++;break;case"LineString":case"MultiPoint":for(n=0;n<h.length;n++){if(e(h[n],m,N,P,j)===!1)return!1;m++,z==="MultiPoint"&&P++}z==="LineString"&&P++;break;case"Polygon":case"MultiLineString":for(n=0;n<h.length;n++){for(r=0;r<h[n].length-_;r++){if(e(h[n][r],m,N,P,j)===!1)return!1;m++}z==="MultiLineString"&&P++,z==="Polygon"&&j++}z==="Polygon"&&P++;break;case"MultiPolygon":for(n=0;n<h.length;n++){for(j=0,r=0;r<h[n].length;r++){for(o=0;o<h[n][r].length-_;o++){if(e(h[n][r][o],m,N,P,j)===!1)return!1;m++}j++}P++}break;case"GeometryCollection":for(n=0;n<c.geometries.length;n++)if(wA(c.geometries[n],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function tB(t,e={}){let i=0,n=0,r=0;return wA(t,function(o){i+=o[0],n+=o[1],r++}),eB([i/r,n/r],e.properties)}var iB=tB;const nB="https://raw.githubusercontent.com/Kirman442/deckgl/main/regions_filtered_min.json",sB=()=>{const[t,e]=ee.useState(null),[i,n]=ee.useState(!0);ee.useEffect(()=>{(async()=>{try{const g=await(await fetch(nB)).json();e(g)}catch(h){console.error("Error loading regions:",h)}finally{n(!1)}})()},[]);const r=t&&t.features&&t.features.length>0?t.features.map(f=>{const h={type:"Feature",geometry:f.geometry,properties:f.properties},g=iB(h);return{...f,centroid:g.geometry.coordinates}}):[];return{regionsData:t,regionsWithCentroids:r,isLoading:i,createRegionsLayer:(f,h,g)=>t?new yo({id:"regions",data:t,pickable:!0,stroked:!1,filled:!0,extruded:!0,lineWidthScale:1,wireframe:!0,lineWidthMinPixels:1,getFillColor:_=>{const m=f&&_.properties.id===f.properties.id,y=h&&_.properties.id===h.properties.id,T=f&&_.properties.id===f.properties.id;return m?[100,150,255,200]:y?[23,86,118,250]:f?[100,100,100,100]:T?[200,80,200,255]:[65,182,230,180]},getLineColor:_=>{const m=f&&_.properties.id===f.properties.id,y=h&&_.properties.id===h.properties.id;return m?[60,60,60,80]:y?[60,60,60,20]:f?[60,60,60,100]:[255,255,230,20]},getElevation:_=>_.properties.population/_.properties.area*5,updateTriggers:{getFillColor:[f,h,g]}}):null,createRegionsTextLayer:f=>!f||f.length===0?null:new vu({id:"regions-labels",data:f,getPosition:h=>h.centroid,getText:h=>h.properties.name,getSize:16,getColor:[255,255,255,100],getAngle:0,getTextAnchor:"middle",getAlignmentBaseline:"center",parameters:{depthTest:!1}})}};function fc(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function rB(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function RA(t){let e,i,n;t.length!==2?(e=fc,i=(f,h)=>fc(t(f),h),n=(f,h)=>t(f)-h):(e=t===fc||t===rB?t:aB,i=t,n=t);function r(f,h,g=0,_=f.length){if(g<_){if(e(h,h)!==0)return _;do{const m=g+_>>>1;i(f[m],h)<0?g=m+1:_=m}while(g<_)}return g}function o(f,h,g=0,_=f.length){if(g<_){if(e(h,h)!==0)return _;do{const m=g+_>>>1;i(f[m],h)<=0?g=m+1:_=m}while(g<_)}return g}function c(f,h,g=0,_=f.length){const m=r(f,h,g,_-1);return m>g&&n(f[m-1],h)>-n(f[m],h)?m-1:m}return{left:r,center:c,right:o}}function aB(){return 0}function oB(t){return t===null?NaN:+t}const lB=RA(fc),xA=lB.right;RA(oB).center;const cB=Math.sqrt(50),uB=Math.sqrt(10),fB=Math.sqrt(2);function Vc(t,e,i){const n=(e-t)/Math.max(0,i),r=Math.floor(Math.log10(n)),o=n/Math.pow(10,r),c=o>=cB?10:o>=uB?5:o>=fB?2:1;let f,h,g;return r<0?(g=Math.pow(10,-r)/c,f=Math.round(t*g),h=Math.round(e*g),f/g<t&&++f,h/g>e&&--h,g=-g):(g=Math.pow(10,r)*c,f=Math.round(t/g),h=Math.round(e/g),f*g<t&&++f,h*g>e&&--h),h<f&&.5<=i&&i<2?Vc(t,e,i*2):[f,h,g]}function hB(t,e,i){if(e=+e,t=+t,i=+i,!(i>0))return[];if(t===e)return[t];const n=e<t,[r,o,c]=n?Vc(e,t,i):Vc(t,e,i);if(!(o>=r))return[];const f=o-r+1,h=new Array(f);if(n)if(c<0)for(let g=0;g<f;++g)h[g]=(o-g)/-c;else for(let g=0;g<f;++g)h[g]=(o-g)*c;else if(c<0)for(let g=0;g<f;++g)h[g]=(r+g)/-c;else for(let g=0;g<f;++g)h[g]=(r+g)*c;return h}function _g(t,e,i){return e=+e,t=+t,i=+i,Vc(t,e,i)[2]}function dB(t,e,i){e=+e,t=+t,i=+i;const n=e<t,r=n?_g(e,t,i):_g(t,e,i);return(n?-1:1)*(r<0?1/-r:r)}function CA(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function Zg(t,e,i){t.prototype=e.prototype=i,i.constructor=t}function MA(t,e){var i=Object.create(t.prototype);for(var n in e)i[n]=e[n];return i}function bo(){}var ao=.7,Hc=1/ao,Er="\\s*([+-]?\\d+)\\s*",oo="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",xi="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",gB=/^#([0-9a-f]{3,8})$/,pB=new RegExp(`^rgb\\(${Er},${Er},${Er}\\)$`),_B=new RegExp(`^rgb\\(${xi},${xi},${xi}\\)$`),mB=new RegExp(`^rgba\\(${Er},${Er},${Er},${oo}\\)$`),yB=new RegExp(`^rgba\\(${xi},${xi},${xi},${oo}\\)$`),bB=new RegExp(`^hsl\\(${oo},${xi},${xi}\\)$`),vB=new RegExp(`^hsla\\(${oo},${xi},${xi},${oo}\\)$`),Ov={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Zg(bo,lo,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Pv,formatHex:Pv,formatHex8:TB,formatHsl:SB,formatRgb:Nv,toString:Nv});function Pv(){return this.rgb().formatHex()}function TB(){return this.rgb().formatHex8()}function SB(){return OA(this).formatHsl()}function Nv(){return this.rgb().formatRgb()}function lo(t){var e,i;return t=(t+"").trim().toLowerCase(),(e=gB.exec(t))?(i=e[1].length,e=parseInt(e[1],16),i===6?Iv(e):i===3?new Nt(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):i===8?Jl(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):i===4?Jl(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=pB.exec(t))?new Nt(e[1],e[2],e[3],1):(e=_B.exec(t))?new Nt(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=mB.exec(t))?Jl(e[1],e[2],e[3],e[4]):(e=yB.exec(t))?Jl(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=bB.exec(t))?Bv(e[1],e[2]/100,e[3]/100,1):(e=vB.exec(t))?Bv(e[1],e[2]/100,e[3]/100,e[4]):Ov.hasOwnProperty(t)?Iv(Ov[t]):t==="transparent"?new Nt(NaN,NaN,NaN,0):null}function Iv(t){return new Nt(t>>16&255,t>>8&255,t&255,1)}function Jl(t,e,i,n){return n<=0&&(t=e=i=NaN),new Nt(t,e,i,n)}function AB(t){return t instanceof bo||(t=lo(t)),t?(t=t.rgb(),new Nt(t.r,t.g,t.b,t.opacity)):new Nt}function mg(t,e,i,n){return arguments.length===1?AB(t):new Nt(t,e,i,n??1)}function Nt(t,e,i,n){this.r=+t,this.g=+e,this.b=+i,this.opacity=+n}Zg(Nt,mg,MA(bo,{brighter(t){return t=t==null?Hc:Math.pow(Hc,t),new Nt(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?ao:Math.pow(ao,t),new Nt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Nt(ys(this.r),ys(this.g),ys(this.b),jc(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Dv,formatHex:Dv,formatHex8:EB,formatRgb:kv,toString:kv}));function Dv(){return`#${ds(this.r)}${ds(this.g)}${ds(this.b)}`}function EB(){return`#${ds(this.r)}${ds(this.g)}${ds(this.b)}${ds((isNaN(this.opacity)?1:this.opacity)*255)}`}function kv(){const t=jc(this.opacity);return`${t===1?"rgb(":"rgba("}${ys(this.r)}, ${ys(this.g)}, ${ys(this.b)}${t===1?")":`, ${t})`}`}function jc(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function ys(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function ds(t){return t=ys(t),(t<16?"0":"")+t.toString(16)}function Bv(t,e,i,n){return n<=0?t=e=i=NaN:i<=0||i>=1?t=e=NaN:e<=0&&(t=NaN),new ui(t,e,i,n)}function OA(t){if(t instanceof ui)return new ui(t.h,t.s,t.l,t.opacity);if(t instanceof bo||(t=lo(t)),!t)return new ui;if(t instanceof ui)return t;t=t.rgb();var e=t.r/255,i=t.g/255,n=t.b/255,r=Math.min(e,i,n),o=Math.max(e,i,n),c=NaN,f=o-r,h=(o+r)/2;return f?(e===o?c=(i-n)/f+(i<n)*6:i===o?c=(n-e)/f+2:c=(e-i)/f+4,f/=h<.5?o+r:2-o-r,c*=60):f=h>0&&h<1?0:c,new ui(c,f,h,t.opacity)}function wB(t,e,i,n){return arguments.length===1?OA(t):new ui(t,e,i,n??1)}function ui(t,e,i,n){this.h=+t,this.s=+e,this.l=+i,this.opacity=+n}Zg(ui,wB,MA(bo,{brighter(t){return t=t==null?Hc:Math.pow(Hc,t),new ui(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?ao:Math.pow(ao,t),new ui(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,i=this.l,n=i+(i<.5?i:1-i)*e,r=2*i-n;return new Nt(vd(t>=240?t-240:t+120,r,n),vd(t,r,n),vd(t<120?t+240:t-120,r,n),this.opacity)},clamp(){return new ui(Uv(this.h),ec(this.s),ec(this.l),jc(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=jc(this.opacity);return`${t===1?"hsl(":"hsla("}${Uv(this.h)}, ${ec(this.s)*100}%, ${ec(this.l)*100}%${t===1?")":`, ${t})`}`}}));function Uv(t){return t=(t||0)%360,t<0?t+360:t}function ec(t){return Math.max(0,Math.min(1,t||0))}function vd(t,e,i){return(t<60?e+(i-e)*t/60:t<180?i:t<240?e+(i-e)*(240-t)/60:e)*255}const Qg=t=>()=>t;function RB(t,e){return function(i){return t+i*e}}function xB(t,e,i){return t=Math.pow(t,i),e=Math.pow(e,i)-t,i=1/i,function(n){return Math.pow(t+n*e,i)}}function CB(t){return(t=+t)==1?PA:function(e,i){return i-e?xB(e,i,t):Qg(isNaN(e)?i:e)}}function PA(t,e){var i=e-t;return i?RB(t,i):Qg(isNaN(t)?e:t)}const Fv=function t(e){var i=CB(e);function n(r,o){var c=i((r=mg(r)).r,(o=mg(o)).r),f=i(r.g,o.g),h=i(r.b,o.b),g=PA(r.opacity,o.opacity);return function(_){return r.r=c(_),r.g=f(_),r.b=h(_),r.opacity=g(_),r+""}}return n.gamma=t,n}(1);function MB(t,e){e||(e=[]);var i=t?Math.min(e.length,t.length):0,n=e.slice(),r;return function(o){for(r=0;r<i;++r)n[r]=t[r]*(1-o)+e[r]*o;return n}}function OB(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function PB(t,e){var i=e?e.length:0,n=t?Math.min(i,t.length):0,r=new Array(n),o=new Array(i),c;for(c=0;c<n;++c)r[c]=Gg(t[c],e[c]);for(;c<i;++c)o[c]=e[c];return function(f){for(c=0;c<n;++c)o[c]=r[c](f);return o}}function NB(t,e){var i=new Date;return t=+t,e=+e,function(n){return i.setTime(t*(1-n)+e*n),i}}function Wc(t,e){return t=+t,e=+e,function(i){return t*(1-i)+e*i}}function IB(t,e){var i={},n={},r;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(r in e)r in t?i[r]=Gg(t[r],e[r]):n[r]=e[r];return function(o){for(r in i)n[r]=i[r](o);return n}}var yg=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Td=new RegExp(yg.source,"g");function DB(t){return function(){return t}}function kB(t){return function(e){return t(e)+""}}function BB(t,e){var i=yg.lastIndex=Td.lastIndex=0,n,r,o,c=-1,f=[],h=[];for(t=t+"",e=e+"";(n=yg.exec(t))&&(r=Td.exec(e));)(o=r.index)>i&&(o=e.slice(i,o),f[c]?f[c]+=o:f[++c]=o),(n=n[0])===(r=r[0])?f[c]?f[c]+=r:f[++c]=r:(f[++c]=null,h.push({i:c,x:Wc(n,r)})),i=Td.lastIndex;return i<e.length&&(o=e.slice(i),f[c]?f[c]+=o:f[++c]=o),f.length<2?h[0]?kB(h[0].x):DB(e):(e=h.length,function(g){for(var _=0,m;_<e;++_)f[(m=h[_]).i]=m.x(g);return f.join("")})}function Gg(t,e){var i=typeof e,n;return e==null||i==="boolean"?Qg(e):(i==="number"?Wc:i==="string"?(n=lo(e))?(e=n,Fv):BB:e instanceof lo?Fv:e instanceof Date?NB:OB(e)?MB:Array.isArray(e)?PB:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?IB:Wc)(t,e)}function UB(t,e){return t=+t,e=+e,function(i){return Math.round(t*(1-i)+e*i)}}function FB(t){return function(){return t}}function LB(t){return+t}var Lv=[0,1];function br(t){return t}function bg(t,e){return(e-=t=+t)?function(i){return(i-t)/e}:FB(isNaN(e)?NaN:.5)}function zB(t,e){var i;return t>e&&(i=t,t=e,e=i),function(n){return Math.max(t,Math.min(e,n))}}function VB(t,e,i){var n=t[0],r=t[1],o=e[0],c=e[1];return r<n?(n=bg(r,n),o=i(c,o)):(n=bg(n,r),o=i(o,c)),function(f){return o(n(f))}}function HB(t,e,i){var n=Math.min(t.length,e.length)-1,r=new Array(n),o=new Array(n),c=-1;for(t[n]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++c<n;)r[c]=bg(t[c],t[c+1]),o[c]=i(e[c],e[c+1]);return function(f){var h=xA(t,f,1,n)-1;return o[h](r[h](f))}}function jB(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function WB(){var t=Lv,e=Lv,i=Gg,n,r,o,c=br,f,h,g;function _(){var y=Math.min(t.length,e.length);return c!==br&&(c=zB(t[0],t[y-1])),f=y>2?HB:VB,h=g=null,m}function m(y){return y==null||isNaN(y=+y)?o:(h||(h=f(t.map(n),e,i)))(n(c(y)))}return m.invert=function(y){return c(r((g||(g=f(e,t.map(n),Wc)))(y)))},m.domain=function(y){return arguments.length?(t=Array.from(y,LB),_()):t.slice()},m.range=function(y){return arguments.length?(e=Array.from(y),_()):e.slice()},m.rangeRound=function(y){return e=Array.from(y),i=UB,_()},m.clamp=function(y){return arguments.length?(c=y?!0:br,_()):c!==br},m.interpolate=function(y){return arguments.length?(i=y,_()):i},m.unknown=function(y){return arguments.length?(o=y,m):o},function(y,T){return n=y,r=T,_()}}function XB(){return WB()(br,br)}function $B(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function Xc(t,e){if((i=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var i,n=t.slice(0,i);return[n.length>1?n[0]+n.slice(2):n,+t.slice(i+1)]}function Ur(t){return t=Xc(Math.abs(t)),t?t[1]:NaN}function YB(t,e){return function(i,n){for(var r=i.length,o=[],c=0,f=t[0],h=0;r>0&&f>0&&(h+f+1>n&&(f=Math.max(1,n-h)),o.push(i.substring(r-=f,r+f)),!((h+=f+1)>n));)f=t[c=(c+1)%t.length];return o.reverse().join(e)}}function qB(t){return function(e){return e.replace(/[0-9]/g,function(i){return t[+i]})}}var KB=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function $c(t){if(!(e=KB.exec(t)))throw new Error("invalid format: "+t);var e;return new Jg({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}$c.prototype=Jg.prototype;function Jg(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}Jg.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function ZB(t){e:for(var e=t.length,i=1,n=-1,r;i<e;++i)switch(t[i]){case".":n=r=i;break;case"0":n===0&&(n=i),r=i;break;default:if(!+t[i])break e;n>0&&(n=0);break}return n>0?t.slice(0,n)+t.slice(r+1):t}var NA;function QB(t,e){var i=Xc(t,e);if(!i)return t+"";var n=i[0],r=i[1],o=r-(NA=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,c=n.length;return o===c?n:o>c?n+new Array(o-c+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+Xc(t,Math.max(0,e+o-1))[0]}function zv(t,e){var i=Xc(t,e);if(!i)return t+"";var n=i[0],r=i[1];return r<0?"0."+new Array(-r).join("0")+n:n.length>r+1?n.slice(0,r+1)+"."+n.slice(r+1):n+new Array(r-n.length+2).join("0")}const Vv={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:$B,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>zv(t*100,e),r:zv,s:QB,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Hv(t){return t}var jv=Array.prototype.map,Wv=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function GB(t){var e=t.grouping===void 0||t.thousands===void 0?Hv:YB(jv.call(t.grouping,Number),t.thousands+""),i=t.currency===void 0?"":t.currency[0]+"",n=t.currency===void 0?"":t.currency[1]+"",r=t.decimal===void 0?".":t.decimal+"",o=t.numerals===void 0?Hv:qB(jv.call(t.numerals,String)),c=t.percent===void 0?"%":t.percent+"",f=t.minus===void 0?"−":t.minus+"",h=t.nan===void 0?"NaN":t.nan+"";function g(m){m=$c(m);var y=m.fill,T=m.align,R=m.sign,x=m.symbol,O=m.zero,N=m.width,B=m.comma,P=m.precision,j=m.trim,z=m.type;z==="n"?(B=!0,z="g"):Vv[z]||(P===void 0&&(P=12),j=!0,z="g"),(O||y==="0"&&T==="=")&&(O=!0,y="0",T="=");var q=x==="$"?i:x==="#"&&/[boxX]/.test(z)?"0"+z.toLowerCase():"",ue=x==="$"?n:/[%p]/.test(z)?c:"",oe=Vv[z],G=/[defgprs%]/.test(z);P=P===void 0?6:/[gprs]/.test(z)?Math.max(1,Math.min(21,P)):Math.max(0,Math.min(20,P));function ae(te){var ge=q,ce=ue,_e,Pe,w;if(z==="c")ce=oe(te)+ce,te="";else{te=+te;var I=te<0||1/te<0;if(te=isNaN(te)?h:oe(Math.abs(te),P),j&&(te=ZB(te)),I&&+te==0&&R!=="+"&&(I=!1),ge=(I?R==="("?R:f:R==="-"||R==="("?"":R)+ge,ce=(z==="s"?Wv[8+NA/3]:"")+ce+(I&&R==="("?")":""),G){for(_e=-1,Pe=te.length;++_e<Pe;)if(w=te.charCodeAt(_e),48>w||w>57){ce=(w===46?r+te.slice(_e+1):te.slice(_e))+ce,te=te.slice(0,_e);break}}}B&&!O&&(te=e(te,1/0));var M=ge.length+te.length+ce.length,X=M<N?new Array(N-M+1).join(y):"";switch(B&&O&&(te=e(X+te,X.length?N-ce.length:1/0),X=""),T){case"<":te=ge+te+ce+X;break;case"=":te=ge+X+te+ce;break;case"^":te=X.slice(0,M=X.length>>1)+ge+te+ce+X.slice(M);break;default:te=X+ge+te+ce;break}return o(te)}return ae.toString=function(){return m+""},ae}function _(m,y){var T=g((m=$c(m),m.type="f",m)),R=Math.max(-8,Math.min(8,Math.floor(Ur(y)/3)))*3,x=Math.pow(10,-R),O=Wv[8+R/3];return function(N){return T(x*N)+O}}return{format:g,formatPrefix:_}}var tc,IA,DA;JB({thousands:",",grouping:[3],currency:["$",""]});function JB(t){return tc=GB(t),IA=tc.format,DA=tc.formatPrefix,tc}function eU(t){return Math.max(0,-Ur(Math.abs(t)))}function tU(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Ur(e)/3)))*3-Ur(Math.abs(t)))}function iU(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Ur(e)-Ur(t))+1}function nU(t,e,i,n){var r=dB(t,e,i),o;switch(n=$c(n??",f"),n.type){case"s":{var c=Math.max(Math.abs(t),Math.abs(e));return n.precision==null&&!isNaN(o=tU(r,c))&&(n.precision=o),DA(n,c)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(o=iU(r,Math.max(Math.abs(t),Math.abs(e))))&&(n.precision=o-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(o=eU(r))&&(n.precision=o-(n.type==="%")*2);break}}return IA(n)}function sU(t){var e=t.domain;return t.ticks=function(i){var n=e();return hB(n[0],n[n.length-1],i??10)},t.tickFormat=function(i,n){var r=e();return nU(r[0],r[r.length-1],i??10,n)},t.nice=function(i){i==null&&(i=10);var n=e(),r=0,o=n.length-1,c=n[r],f=n[o],h,g,_=10;for(f<c&&(g=c,c=f,f=g,g=r,r=o,o=g);_-- >0;){if(g=_g(c,f,i),g===h)return n[r]=c,n[o]=f,e(n);if(g>0)c=Math.floor(c/g)*g,f=Math.ceil(f/g)*g;else if(g<0)c=Math.ceil(c*g)/g,f=Math.floor(f*g)/g;else break;h=g}return t},t}function vo(){var t=XB();return t.copy=function(){return jB(t,vo())},CA.apply(t,arguments),sU(t)}function vg(){var t=[.5],e=[0,1],i,n=1;function r(o){return o!=null&&o<=o?e[xA(t,o,0,n)]:i}return r.domain=function(o){return arguments.length?(t=Array.from(o),n=Math.min(t.length,e.length-1),r):t.slice()},r.range=function(o){return arguments.length?(e=Array.from(o),n=Math.min(t.length,e.length-1),r):e.slice()},r.invertExtent=function(o){var c=e.indexOf(o);return[t[c-1],t[c]]},r.unknown=function(o){return arguments.length?(i=o,r):i},r.copy=function(){return vg().domain(t).range(e).unknown(i)},CA.apply(r,arguments)}const rU="https://raw.githubusercontent.com/Kirman442/deckgl/main/landkreisestaedte_min.json",aU="https://raw.githubusercontent.com/Kirman442/deckgl/main/kreisfreiestaedte_min.json",oU=()=>{const[t,e]=ee.useState([]),[i,n]=ee.useState([]),r=async g=>{try{const y=(await(await fetch(rU)).json()).features.filter(O=>O.properties.id.slice(0,3)===g.slice(0,3)).map(O=>({...O,properties:{...O.properties,name:`Landkreis ${O.properties.name}`}})),x=(await(await fetch(aU)).json()).features.filter(O=>O.properties.id.slice(0,3)===g.slice(0,3)).map(O=>{let N="Kreisfreiestadt";return O.properties.id==="09162"&&(N="Landeshauptstadt"),{...O,properties:{...O.properties,name:`${N} ${O.properties.name}`}}});e(y),n(x)}catch{}},o=()=>{e([]),n([])},c=vg().domain([500,1e3,1500,2e3,2500]).range([[37,52,148,200],[44,127,184,200],[65,182,196,200],[127,205,187,200],[199,233,180,200]]),f=vg().domain([100,200,300,400,500]).range([[27,120,55,255],[56,166,91,255],[109,192,124,255],[177,221,161,255],[230,245,208,255]]);return{districts:t,cities:i,fetchDistrictsAndCitiesData:r,createDistrictsLayer:(g,_)=>{const m=[...t,...i];return m.length===0?null:new yo({id:"districts",data:m,pickable:!0,stroked:!0,filled:!0,extruded:!0,wireframe:!0,getElevation:y=>{const T=_&&y.properties.id===_.properties.id,R=y.properties.name.includes("Kreisfreiestadt")||y.properties.name.includes("Landeshauptstadt");return T&&R?3e4:T&&!R?y.properties.population/y.properties.area*65:R?y.properties.population/y.properties.area*3:y.properties.population/y.properties.area*20},getFillColor:y=>{const T=g&&y.properties.id===g.properties.id,R=_&&y.properties.id===_.properties.id;return T?[23,86,118,250]:R?[23,86,118,250]:y.properties.name.includes("Kreisfreiestadt")||y.properties.name.includes("Landeshauptstadt")?f(y.properties.population):c(y.properties.area)},getLineColor:[255,255,255,50],lineWidthMinPixels:1,transitions:{getElevation:500},updateTriggers:{getFillColor:[g,_],getLineColor:[g],getElevation:[_]}})},resetDistrictsData:o,DISTRICTS_COLOR_SCALE:c}};var Sd={exports:{}},Va={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xv;function lU(){if(Xv)return Va;Xv=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function i(n,r,o){var c=null;if(o!==void 0&&(c=""+o),r.key!==void 0&&(c=""+r.key),"key"in r){o={};for(var f in r)f!=="key"&&(o[f]=r[f])}else o=r;return r=o.ref,{$$typeof:t,type:n,key:c,ref:r!==void 0?r:null,props:o}}return Va.Fragment=e,Va.jsx=i,Va.jsxs=i,Va}var $v;function cU(){return $v||($v=1,Sd.exports=lU()),Sd.exports}var kA=cU();const ve=kA.jsx,Te=kA.jsxs,uU=({colorScale:t})=>{const e=t.domain(),i=t.range(),n=10,r=250,o=r/i.length;return Te("div",{style:{width:r,margin:"10px"},children:[" ",ve("div",{style:{fontSize:"12px",textAlign:"center",marginBottom:"10px"},children:"Fläche der Landkreise, km² "}),Te("svg",{width:r,height:n+20,children:[" ",i.map((c,f)=>{const h=f*o;e[f];const g=f===0?`< ${e[0]}`:`${e[f]}`;return Te(ow.Fragment,{children:[" ",ve("rect",{x:h,y:0,width:o,height:n,fill:`rgba(${c.join(",")})`}),ve("text",{x:h+o/2,y:n+15,textAnchor:"middle",style:{fontSize:"10px"},children:g})]},f)}),ve("text",{x:r,y:n+15,textAnchor:"end",style:{fontSize:"10px"}})]})]})},Yv=vo().domain([1e3,5e4]).range([4,16]),fU=vo().domain([1e3,4e4]).range([[255,255,255],[200,0,0]]),hU=()=>{const t=Yv.domain(),e=[t[1],t[1]*.75,t[1]*.5,t[1]*.25,t[0]];return Te("div",{style:{width:"250px",margin:"10px"},children:[" ",Te("div",{style:{fontSize:"12px",textAlign:"center",marginBottom:"10px"},children:[" ","Größe der Städte nach Einwohnerzahl"]}),Te("div",{style:{display:"flex",justifyContent:"space-around",alignItems:"center",width:"100%",maxWidth:"250px"},children:[" ",e.map((i,n)=>{const r=Yv(i),o=fU(i);return ve("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:ve("svg",{width:r*2+8,height:r*2+8,children:ve("circle",{cx:r+4,cy:r+4,r,fill:`rgb(${o.join(",")})`,stroke:"#888",strokeWidth:"0.5"})})},n)})]})]})},dU=({selectedRegion:t,districts:e,cities:i,onDistrictClick:n,setSelectedDistrictCityInfo:r,selectedDistrictCityInfo:o,setSelectedRegionInfo:c,colorScale:f,currentCities:h,handleTabClick:g})=>{if(!t)return null;const[_,m]=ee.useState(!0),y=R=>{n(R)},T=()=>{g("districts")};return Te("div",{className:"mb-4",children:[Te("div",{className:"p-3 bg-blue-100 rounded",children:[ve("h3",{className:"text-lg font-semibold",children:t.properties.name}),Te("p",{className:"text-base",children:["Bevölkerung: ",t.properties.population.toLocaleString()," Einw."]}),Te("p",{className:"text-base",children:["Fläche: ",t.properties.area.toFixed(2)," km²"]}),Te("p",{className:"text-base",children:["Bevölkerungsdichte: ",(t.properties.population/t.properties.area).toFixed(1)," Einw/km²"]}),ve("h4",{className:"text-base font-semibold",children:"Als Teil des Bezirks:"}),Te("p",{className:"text-base",children:["Kreisfreiestädte: ",i.length]}),Te("p",{className:"text-base",children:["Landkreise: ",e.length]}),h&&Te("p",{className:"text-base",children:["Städte / Gemeinde: ",h.length]}),ve(uU,{colorScale:f}),ve(hU,{})]}),_&&ve("div",{className:"mt-2",children:Te("div",{className:"scrollable-list",style:{maxHeight:"250px",overflowY:"auto"},children:[ve("h5",{className:"font-semibold mt-2",children:"🏞️ Landkreise:"}),ve("ul",{className:"space-y-2",children:e.map(R=>ve("li",{children:Te("div",{className:`p-2 bg-gray-50 rounded cursor-pointer hover:bg-gray-100 scrollable-list-item 
                                            ${(o==null?void 0:o.properties.id)===R.properties.id?"bg-teal-100 font-bold":""}`,onClick:()=>{y(R),r(R),c(null)},children:[ve("p",{children:R.properties.name}),Te("p",{children:["Bevölkerung: ",R.properties.population.toLocaleString()," Einw."]}),Te("p",{children:["Fläche: ",R.properties.area.toFixed(2)," km²"]})]})},R.properties.id))}),ve("h5",{className:"font-semibold mt-2",children:"🏙️ Kreisfreiestädte:"}),ve("ul",{className:"space-y-2",children:i.map(R=>ve("li",{children:Te("div",{className:`p-2 bg-gray-50 rounded cursor-pointer hover:bg-gray-100 scrollable-list-item 
                                            ${(o==null?void 0:o.properties.id)===R.properties.id?"bg-teal-100 font-bold":""}`,onClick:()=>{y(R),r(R),c(null)},children:[ve("p",{children:R.properties.name}),Te("p",{children:["Bevölkerung: ",R.properties.population.toLocaleString()," Einw."]}),Te("p",{children:["Fläche: ",R.properties.area.toFixed(2)," km²"]})]})},R.properties.id))})]})}),Te("div",{className:"region-tab-content p-2 text-center",children:[" ",Te("h5",{className:"font-semibold mt-2",children:[ve("p",{onClick:T,className:"text-base cursor-pointer underline text-[#253494] hover:text-[#0C1130] transition-colors duration-200",children:"Hier klicken für weitere Informationen"}),ve("p",{className:"text-base text-gray-700",children:"Städte und Gemeinden des Kreises"})]})]})]})},gU=({selectedDistrict:t,currentCities:e})=>t?Te("div",{className:"mt-4 p-3 bg-blue-100 rounded",children:[ve("h3",{className:"text-lg font-semibold",children:t.properties.name}),Te("p",{className:"text-base",children:["Fläche: ",t.properties.area.toFixed(2)," km²"]}),Te("p",{className:"text-base",children:["Bevölkerung: ",t.properties.population.toLocaleString()," Einw."]}),Te("p",{className:"text-base",children:["Männer: ",t.properties.population_man.toLocaleString()," Einw."]}),Te("p",{className:"text-base",children:["Frauen: ",t.properties.population_woman.toLocaleString()," Einw."]}),Te("p",{className:"text-base",children:["Bevölkerungsdichte: ",(t.properties.population/t.properties.area).toFixed(1)," Einw/km²"]}),e&&Te("p",{className:"text-base",children:["Städte / Gemeinden: ",e.length]})]}):null,pU=({selectedCityInDistrict:t})=>!t||!t.properties||!t.properties["land-id"]?null:Te("div",{className:"mb-2 p-3 bg-blue-100 rounded",children:[ve("h3",{className:"text-lg font-semibold",children:t.properties.name}),Te("p",{className:"text-base",children:["Fläche: ",t.properties.area.toFixed(2)," km²"]}),Te("p",{className:"text-base",children:["Bevölkerung: ",t.properties.population.toLocaleString()," Einw."]}),Te("p",{className:"text-base",children:["Männer: ",t.properties.population_man.toLocaleString()," Einw."]}),Te("p",{className:"text-base",children:["Frauen: ",t.properties.population_woman.toLocaleString()," Einw."]}),Te("p",{className:"text-base",children:["Bevölkerungsdichte: ",(t.properties.population/t.properties.area).toFixed(1)," Einw/km²"]})]}),_U=({selectedRegion:t,districts:e,cities:i,onResetSelection:n,hoveredRegion:r,onDistrictClick:o,selectedDistrict:c,selectedCity:f,setSelectedDistrictCityInfo:h,selectedDistrictCityInfo:g,setSelectedRegionInfo:_,handleDistrictClick:m,colorScale:y,currentCities:T,clickedCity:R,setClickedCity:x,selectedCityInDistrict:O})=>{const[N,B]=ee.useState("regions"),P=t,[j,z]=ee.useState(!0),q=g&&(g.properties.name.includes("Kreisfreiestadt")||g.properties.name.includes("Landeshauptstadt")),ue=te=>{B(te)},oe=({city:te,isSelected:ge,onClick:ce})=>ve("div",{className:`p-2 bg-gray-50 rounded cursor-pointer hover:bg-gray-100 scrollable-list-item 
                        ${ge?"bg-teal-100 font-bold":""}`,onClick:ce,children:ve("p",{children:te.properties.name})}),G=te=>!te.properties["land-id"]||!te.properties.id?Math.random().toString():`${te.properties["land-id"]}${te.properties.id}`,ae="Wählen Sie einen Landkreis auf der Karte aus, um Informationen über den Landkreis und eine Liste der Städte im Landkreis anzuzeigen.";return Te("div",{className:"control-panel",children:[ve("h2",{className:"text-xl font-bold mb-4 text-center text-[#253494]",children:"Bayern"}),Te("div",{className:"side-panel-buttons mb-4 flex space-x-2",children:[ve("button",{className:`px-4 py-2 rounded ${N==="regions"?"bg-blue-500 text-blue-950":"bg-gray-300 text-gray-700 hover:bg-gray-400"}`,onClick:()=>ue("regions"),children:"Bezirke"}),ve("button",{className:`px-4 py-2 rounded ${N==="districts"?"bg-blue-500 text-blue-950":"bg-gray-300 text-gray-700"} ${P?"hover:bg-gray-400":"opacity-50 cursor-not-allowed pointer-events-none"}`,onClick:()=>P&&ue("districts"),disabled:!P,children:"Landkreis, kreisfreien Städte"})]}),Te("div",{className:"side-panel-content",children:[N==="regions"&&!t&&ve("div",{className:"text-base text-gray-600 mt-4",children:"Klicken Sie auf einen Bezirk, um detaillierte Informationen zu erhalten"}),N==="regions"&&r&&!t&&Te("div",{className:"mb-4 p-3 bg-gray-100 rounded",children:[ve("h3",{className:"text-lg font-semibold",children:r.properties.name}),Te("p",{className:"text-lg",children:["Bevölkerung: ",r.properties.population.toLocaleString()," Einw."]}),Te("p",{className:"text-lg",children:["Fläche: ",r.properties.area.toFixed(2)," km²"]})]}),N==="regions"&&t&&ve(dU,{handleTabClick:ue,selectedRegion:t,districts:e,cities:i,onDistrictClick:o,setSelectedDistrictCityInfo:h,selectedDistrictCityInfo:g,setSelectedRegionInfo:_,currentCities:c?null:T,colorScale:y}),N==="districts"&&t&&Te("div",{className:"district-tab-content",children:[ve("p",{className:"text-sm text-sm/4 text-gray-600 mb-2",children:q?ae:c?"Wählen Sie eine Stadt im ausgewählten Landkreis, um Informationen zu erhalten.":ae}),ve(gU,{selectedDistrict:c,currentCities:q?null:T}),j&&!q&&Te("div",{className:"scrollable-list",style:{maxHeight:"250px",overflowY:"auto"},children:[ve("h5",{className:"font-semibold mt-2",children:"🏞️ Städte / Gemeinde:"}),ve("ul",{className:"space-y-2",children:(c?T.filter(te=>te.properties["land-id"]===c.properties.id):T).map(te=>ve("li",{children:ve("div",{className:`p-1 bg-gray-50 rounded cursor-pointer hover:bg-gray-100 scrollable-list-item 
                                            ${(g==null?void 0:g.properties.id)===te.properties.id?"bg-teal-100 font-bold":""}`,children:ve(oe,{city:te,isSelected:(g==null?void 0:g.properties.id)===te.properties.id,onClick:()=>{h(te),R(te)}})})},G(te)))})]}),ve(pU,{selectedCityInDistrict:O})]})]}),(N==="regions"||N==="districts")&&t&&ve("button",{className:"px-4 py-2 bg-blue-500 text-blue-950 rounded hover:bg-blue-600",onClick:()=>{n(),B("regions")},children:"Map Zurücksetzen"})]})},mU="https://raw.githubusercontent.com/Kirman442/deckgl/main/cities",qv=["091","092","093","094","095","096","097"],Kv=vo().domain([0,3e4]).range([500,3e3]),yU=vo().domain([0,5e4]).range([[255,255,255],[189,0,38]]),bU=()=>{const[t,e]=ee.useState([]),[i,n]=ee.useState(!1),[r,o]=ee.useState(null),[c,f]=ee.useState({}),[h,g]=ee.useState(null),_=ee.useCallback(async x=>{try{const O=await fetch(x);if(!O.ok)throw new Error(`HTTP error! status: ${O.status}`);return await O.json()}catch(O){throw console.error(`Error loading GeoJSON from ${x}:`,O),O}},[]);ee.useEffect(()=>{(async()=>{n(!0),o(null);try{const O=qv.map(j=>_(`${mU}/${j}/cities_region_${j}.geojson`)),N=await Promise.all(O),B={},P=[];N.forEach((j,z)=>{if(j&&j.features){const q=qv[z];B[q]=j.features,P.push(...j.features)}}),f(B),e(P)}catch(O){o(O),console.error("Error loading city data:",O)}finally{n(!1)}})()},[_]);const m=ee.useCallback(x=>{if(!x)return[];const O=t.filter(N=>N.properties["land-id"]===x);return g(O),O},[t]),y=ee.useCallback(x=>{if(!x)return[];const O=c[x]||[];return g(O),O},[c]),T=ee.useCallback(()=>{g(null)},[]),R=ee.useCallback((x=null,O=null,N)=>{let B=[];return x?B=m(x):O?B=y(O):h&&(B=h),B=B.filter(P=>P&&P.properties&&P.properties.population!==void 0),B.length===0?null:new bu({id:"city-points",data:B,pickable:!0,opacity:.8,stroked:!0,filled:!0,radiusScale:.8,radiusMinPixels:3,radiusMaxPixels:25,lineWidthMinPixels:1,getPosition:P=>P.geometry.coordinates,getRadius:P=>{const j=`${P.properties["land-id"]}-${P.properties.id}`,z=N&&N.properties?`${N.properties["land-id"]}-${N.properties.id}`:null;return Kv(j===z?P.properties.population*10:P.properties.population*1.5)},getFillColor:P=>{if(!P||!P.properties||!P.properties.population)return[0,0,0,0];const j=`${P.properties["land-id"]}-${P.properties.id}`,z=N&&N.properties?`${N.properties["land-id"]}-${N.properties.id}`:null;return j===z?[100,150,255,200]:yU(P.properties.population*1.5)},getLineColor:[255,255,255],parameters:{depthTest:!1},updateTriggers:{getFillColor:[N],getRadius:[N]}})},[m,y,h]);return{allCitiesData:t,error:r,getCitiesForDistrict:m,getCitiesForRegion:y,createCityPointsLayer:R,resetCityPoints:T}},vU="https://basemaps.cartocdn.com/gl/positron-nolabels-gl-style/style.json",TU=`${vU}`,SU={longitude:11.4,latitude:48.5,zoom:7,maxZoom:10,minZoom:6,pitch:33,bearing:0},AU=()=>{const[t,e]=ee.useState(null),[i,n]=ee.useState(null),[r,o]=ee.useState(null),[c,f]=ee.useState(null),[h,g]=ee.useState(null),[_,m]=ee.useState(null),[y,T]=ee.useState(null),[R,x]=ee.useState(null),[O,N]=ee.useState(null),{createGlowLayer:B}=G4(),{regionsWithCentroids:P,isLoading:j,createRegionsLayer:z,createRegionsTextLayer:q}=sB(),{districts:ue,cities:oe,fetchDistrictsAndCitiesData:G,createDistrictsLayer:ae,resetDistrictsData:te,DISTRICTS_COLOR_SCALE:ge}=oU(),{createCityPointsLayer:ce,getCitiesForDistrict:_e,getCitiesForRegion:Pe,resetCityPoints:w}=bU(),[I,M]=ee.useState(null),[X,A]=ee.useState(null);ee.useEffect(()=>{if(_){const le=_e(_.properties.id);M(le)}},[_,_e]),ee.useEffect(()=>{if(y){const le=Pe(y.properties.id);M(le)}},[y,Pe]),ee.useEffect(()=>{},[X]);const D=le=>{e(le),x(le),T(le),g(null),N(null),G(le.properties.id),w()},Y=()=>{e(null),g(null),x(null),m(null),N(null),T(null),te(),w()},K=le=>{g(le),m(le),N(le),A(le)};if(j)return ve("div",{className:"flex items-center justify-center h-screen",children:ve("div",{className:"text-lg",children:"Загрузка данных..."})});const J=y&&I?ce(null,null,X):null,re=()=>[B(10,.1,"outer"),B(5,.2,"middle"),B(2,.3,"inner"),z(t,i,c),ae(r,_),q(P),J].filter(Boolean);function fe({object:le}){return le&&le.properties&&le.properties["land-id"]?{html:`
                    <div><b>Stadt / Gemeinde</b></div>
                    <div><b>Name:</b> ${le.properties.name}</div>
                    <div><b>Bevölkerung:</b> ${le.properties.population.toLocaleString()}</div>
                    <div><b>Fläche:</b> ${le.properties.area} km²</div>
                    `}:null}return Te("div",{style:{width:"800px",height:"600px"},children:[ve(mk,{layers:re(),initialViewState:SU,controller:!0,getTooltip:fe,onClick:({object:le,layer:he})=>{le?he.id==="regions"?D(le):he.id==="districts"?K(le):he.id==="city-points"?(A(le),N(le)):D(le):Y()},onHover:({object:le})=>{le?t?o(le):n(le):(n(null),o(null))},children:ve(Cw,{mapStyle:TU})}),ve(_U,{selectedRegion:t,districts:ue,cities:oe,onResetSelection:Y,setSelectedDistrictCityInfo:N,selectedDistrictCityInfo:O,setSelectedRegionInfo:x,onDistrictClick:K,selectedDistrict:h,hoveredRegion:i,hoveredObject:c,setHoveredObject:f,colorScale:ge,clickedCity:A,currentCities:I,selectedCityInDistrict:X})]})};function EU(){return ve(AU,{})}dw.createRoot(document.getElementById("root")).render(ve(EU,{}));export{Qv as g};
